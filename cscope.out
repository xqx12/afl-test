cscope 15 $HOME/data/xqx/projects/afl-test/afl-fuzz -q 0000001441 0000239978
	@afl-analyze.c

22 
	#AFL_MAIN


	)

24 
	~"c⁄fig.h
"

25 
	~"ty≥s.h
"

26 
	~"debug.h
"

27 
	~"Æloc-öl.h
"

28 
	~"hash.h
"

30 
	~<°dio.h
>

31 
	~<uni°d.h
>

32 
	~<°dlib.h
>

33 
	~<°rög.h
>

34 
	~<time.h
>

35 
	~<î∫o.h
>

36 
	~<sig«l.h
>

37 
	~<dúít.h
>

38 
	~<f˙é.h
>

39 
	~<˘y≥.h
>

41 
	~<sys/waô.h
>

42 
	~<sys/time.h
>

43 
	~<sys/shm.h
>

44 
	~<sys/°©.h
>

45 
	~<sys/ty≥s.h
>

46 
	~<sys/ªsour˚.h
>

48 
s32
 
	gchûd_pid
;

50 
u8
* 
	gåa˚_bôs
;

52 
u8
 *
	gö_fûe
,

53 *
	g¥og_ö
,

54 *
	gèrgë_∑th
,

55 *
	gdoc_∑th
;

57 
u8
 *
	gö_d©a
;

59 
u32
 
	gö_Àn
,

60 
	g‹ig_cksum
,

61 
	gtŸÆ_execs
,

62 
	gexec_h™gs
,

63 
	gexec_tmout
 = 
EXEC_TIMEOUT
;

65 
u64
 
	gmem_limô
 = 
MEM_LIMIT
;

67 
s32
 
	gshm_id
,

68 
	gdev_nuŒ_fd
 = -1;

70 
u8
 
	gedges_⁄ly
,

71 
	gu£_°dö
 = 1;

73 vﬁ©ûê
u8


74 
	g°›_so⁄
,

75 
	gchûd_timed_out
;

80 
	#RESP_NONE
 0x00

	)

81 
	#RESP_MINOR
 0x01

	)

82 
	#RESP_VARIABLE
 0x02

	)

83 
	#RESP_FIXED
 0x03

	)

85 
	#RESP_LEN
 0x04

	)

86 
	#RESP_CKSUM
 0x05

	)

87 
	#RESP_SUSPECT
 0x06

	)

92 
u8
 
	gcou¡_˛ass_lookup
[256] = {

106 
	$˛assify_cou¡s
(
u8
* 
mem
) {

108 
u32
 
i
 = 
MAP_SIZE
;

110 i‡(
edges_⁄ly
) {

112 
i
--) {

113 i‡(*
mem
) *mem = 1;

114 
mem
++;

119 
i
--) {

120 *
mem
 = 
cou¡_˛ass_lookup
[*mem];

121 
mem
++;

126 
	}
}

131 
ölöe
 
u8
 
	$™ythög_£t
() {

133 
u32
* 
±r
 = (u32*)
åa˚_bôs
;

134 
u32
 
i
 = (
MAP_SIZE
 >> 2);

136 
i
--Ëi‡(*(
±r
++))  1;

140 
	}
}

145 
	$ªmove_shm
() {

147 
	`u∆ök
(
¥og_ö
);

148 
	`shm˘l
(
shm_id
, 
IPC_RMID
, 
NULL
);

150 
	}
}

155 
	$£tup_shm
() {

157 
u8
* 
shm_°r
;

159 
shm_id
 = 
	`shmgë
(
IPC_PRIVATE
, 
MAP_SIZE
, 
IPC_CREAT
 | 
IPC_EXCL
 | 0600);

161 i‡(
shm_id
 < 0Ë
	`PFATAL
("shmget() failed");

163 
	`©exô
(
ªmove_shm
);

165 
shm_°r
 = 
	`Æloc_¥ötf
("%d", 
shm_id
);

167 
	`£ãnv
(
SHM_ENV_VAR
, 
shm_°r
, 1);

169 
	`ck_‰ì
(
shm_°r
);

171 
åa˚_bôs
 = 
	`shm©
(
shm_id
, 
NULL
, 0);

173 i‡(!
åa˚_bôs
Ë
	`PFATAL
("shmat() failed");

175 
	}
}

180 
	$ªad_öôül_fûe
() {

182 
°©
 
°
;

183 
s32
 
fd
 = 
	`›í
(
ö_fûe
, 
O_RDONLY
);

185 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
ö_fûe
);

187 i‡(
	`f°©
(
fd
, &
°
Ë|| !°.
°_size
)

188 
	`FATAL
("Zero-sized input file.");

190 i‡(
°
.
°_size
 >
TMIN_MAX_FILE
)

191 
	`FATAL
("I≈uàfûêi†toÿœrgê(%u MB max)", 
TMIN_MAX_FILE
 / 1024 / 1024);

193 
ö_Àn
 = 
°
.
°_size
;

194 
ö_d©a
 = 
	`ck_Æloc_nozîo
(
ö_Àn
);

196 
	`ck_ªad
(
fd
, 
ö_d©a
, 
ö_Àn
, 
ö_fûe
);

198 
	`˛o£
(
fd
);

200 
	`OKF
("Ród %u byã%†‰om '%s'.", 
ö_Àn
, in_À¿=1 ? "" : "s", 
ö_fûe
);

202 
	}
}

207 
s32
 
	$wrôe_to_fûe
(
u8
* 
∑th
, u8* 
mem
, 
u32
 
Àn
) {

209 
s32
 
ªt
;

211 
	`u∆ök
(
∑th
);

213 
ªt
 = 
	`›í
(
∑th
, 
O_RDWR
 | 
O_CREAT
 | 
O_EXCL
, 0600);

215 i‡(
ªt
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
∑th
);

217 
	`ck_wrôe
(
ªt
, 
mem
, 
Àn
, 
∑th
);

219 
	`l£ek
(
ªt
, 0, 
SEEK_SET
);

221  
ªt
;

223 
	}
}

228 
	$h™dÀ_timeout
(
sig
) {

230 
chûd_timed_out
 = 1;

231 i‡(
chûd_pid
 > 0Ë
	`kûl
(chûd_pid, 
SIGKILL
);

233 
	}
}

239 
u32
 
	$run_èrgë
(** 
¨gv
, 
u8
* 
mem
, 
u32
 
Àn
, u8 
fú°_run
) {

241 
ôimîvÆ
 
ô
;

242 
°©us
 = 0;

244 
s32
 
¥og_ö_fd
;

245 
u32
 
cksum
;

247 
	`mem£t
(
åa˚_bôs
, 0, 
MAP_SIZE
);

248 
	`MEM_BARRIER
();

250 
¥og_ö_fd
 = 
	`wrôe_to_fûe
(
¥og_ö
, 
mem
, 
Àn
);

252 
chûd_pid
 = 
	`f‹k
();

254 i‡(
chûd_pid
 < 0Ë
	`PFATAL
("fork() failed");

256 i‡(!
chûd_pid
) {

258 
æimô
 
r
;

260 i‡(
	`dup2
(
u£_°dö
 ? 
¥og_ö_fd
 : 
dev_nuŒ_fd
, 0) < 0 ||

261 
	`dup2
(
dev_nuŒ_fd
, 1) < 0 ||

262 
	`dup2
(
dev_nuŒ_fd
, 2) < 0) {

264 *(
u32
*)
åa˚_bôs
 = 
EXEC_FAIL_SIG
;

265 
	`PFATAL
("dup2() failed");

269 
	`˛o£
(
dev_nuŒ_fd
);

270 
	`˛o£
(
¥og_ö_fd
);

272 i‡(
mem_limô
) {

274 
r
.
æim_max
 =Ñ.
æim_cur
 = ((
æim_t
)
mem_limô
) << 20;

276 #ifde‡
RLIMIT_AS


278 
	`£ålimô
(
RLIMIT_AS
, &
r
);

282 
	`£ålimô
(
RLIMIT_DATA
, &
r
);

288 
r
.
æim_max
 =Ñ.
æim_cur
 = 0;

289 
	`£ålimô
(
RLIMIT_CORE
, &
r
);

291 
	`execv
(
èrgë_∑th
, 
¨gv
);

293 *(
u32
*)
åa˚_bôs
 = 
EXEC_FAIL_SIG
;

294 
	`exô
(0);

298 
	`˛o£
(
¥og_ö_fd
);

302 
chûd_timed_out
 = 0;

303 
ô
.
ô_vÆue
.
tv_£c
 = (
exec_tmout
 / 1000);

304 
ô
.
ô_vÆue
.
tv_u£c
 = (
exec_tmout
 % 1000) * 1000;

306 
	`£tôimî
(
ITIMER_REAL
, &
ô
, 
NULL
);

308 i‡(
	`waôpid
(
chûd_pid
, &
°©us
, 0Ë<0Ë
	`FATAL
("waitpid() failed");

310 
chûd_pid
 = 0;

311 
ô
.
ô_vÆue
.
tv_£c
 = 0;

312 
ô
.
ô_vÆue
.
tv_u£c
 = 0;

314 
	`£tôimî
(
ITIMER_REAL
, &
ô
, 
NULL
);

316 
	`MEM_BARRIER
();

320 i‡(*(
u32
*)
åa˚_bôs
 =
EXEC_FAIL_SIG
)

321 
	`FATAL
("U«bÀÅÿexecuã '%s'", 
¨gv
[0]);

323 
	`˛assify_cou¡s
(
åa˚_bôs
);

324 
tŸÆ_execs
++;

326 i‡(
°›_so⁄
) {

327 
	`SAYF
(
cRST
 
cLRD
 "\n+++ Analysisáborted by user +++\n" cRST);

328 
	`exô
(1);

333 i‡(
chûd_timed_out
) {

335 
exec_h™gs
++;

340 
cksum
 = 
	`hash32
(
åa˚_bôs
, 
MAP_SIZE
, 
HASH_CONST
);

345 i‡(
	`WIFSIGNALED
(
°©us
) ||

346 (
	`WIFEXITED
(
°©us
Ë&& 
	`WEXITSTATUS
(°©usË=
MSAN_ERROR
) ||

347 (
	`WIFEXITED
(
°©us
Ë&& 
	`WEXITSTATUS
(status))) {

349 
cksum
 ^= 0xffffffff;

353 i‡(
fú°_run
Ë
‹ig_cksum
 = 
cksum
;

355  
cksum
;

357 
	}
}

360 #ifde‡
USE_COLOR


364 
	$show_ch¨
(
u8
 
vÆ
) {

366 
vÆ
) {

369 127 ... 255: 
	`SAYF
("#%02x", 
vÆ
); ;

371 : 
	`SAYF
(" %¯", 
vÆ
);

375 
	}
}

380 
	$show_Àgíd
() {

382 
	`SAYF
(" " 
cLGR
 
bgGRA
 " 01 " 
cRST
 " -Ço-op block "

383 
cBLK
 
bgLGN
 " 01 " 
cRST
 " - suspectedÜength field\n"

384 " " 
cBRI
 
bgGRA
 " 01 " 
cRST
 " - superficial content "

385 
cBLK
 
bgYEL
 " 01 " 
cRST
 " - suspected cksum or magic int\n"

386 " " 
cBLK
 
bgCYA
 " 01 " 
cRST
 " - critical stream "

387 
cBLK
 
bgLRD
 " 01 " 
cRST
 " - suspected checksummed block\n"

388 " " 
cBLK
 
bgMGN
 " 01 " 
cRST
 " - \"magic value\" section\n\n");

390 
	}
}

397 
	$dump_hex
(
u8
* 
buf
, 
u32
 
Àn
, u8* 
b_d©a
) {

399 
u32
 
i
;

401 
i
 = 0; i < 
Àn
; i++) {

403 #ifde‡
USE_COLOR


404 
u32
 
æí
 = 1, 
off
;

406 
u32
 
æí
 = 1;

409 
u8
 
πy≥
 = 
b_d©a
[
i
] & 0x0f;

413 
i
 + 
æí
 < 
Àn
 && (
b_d©a
[i] >> 7) == (b_data[i +Ñlen] >> 7)) {

415 i‡(
πy≥
 < (
b_d©a
[
i
 + 
æí
] & 0x0f))Ñtype = b_data[i +Ñlen] & 0x0f;

416 
æí
++;

422 i‡(
πy≥
 =
RESP_FIXED
) {

424 
æí
) {

428 
u16
 
vÆ
 = *(u16*)(
ö_d©a
 + 
i
);

432 i‡(
vÆ
 && (vÆ <
ö_Àn
 || 
	`SWAP16
(val) <= in_len)) {

433 
πy≥
 = 
RESP_LEN
;

439 i‡(
vÆ
 && 
	`abs
(
ö_d©a
[
i
] - in_data[i + 1]) > 32) {

440 
πy≥
 = 
RESP_CKSUM
;

450 
u32
 
vÆ
 = *(u32*)(
ö_d©a
 + 
i
);

454 i‡(
vÆ
 && (vÆ <
ö_Àn
 || 
	`SWAP32
(val) <= in_len)) {

455 
πy≥
 = 
RESP_LEN
;

461 i‡(
vÆ
 && (
ö_d©a
[
i
] >> 7 != in_data[i + 1] >> 7 ||

462 
ö_d©a
[
i
] >> 7 != in_data[i + 2] >> 7 ||

463 
ö_d©a
[
i
] >> 7 != in_data[i + 3] >> 7)) {

464 
πy≥
 = 
RESP_CKSUM
;

472 1: 3: 5 ... 
MAX_AUTO_EXTRA
 - 1: ;

474 : 
πy≥
 = 
RESP_SUSPECT
;

482 #ifde‡
USE_COLOR


484 
off
 = 0; of‡< 
æí
; off++) {

488 i‡(!((
i
 + 
off
) % 16)) {

490 i‡(
off
Ë
	`SAYF
(
cRST
 
cLCY
 ">");

491 
	`SAYF
(
cRST
 
cGRA
 "%s[%06u] " cRST, (
i
 + 
off
) ? "\n" : "", i + off);

495 
πy≥
) {

497 
RESP_NONE
: 
	`SAYF
(
cLGR
 
bgGRA
); ;

498 
RESP_MINOR
: 
	`SAYF
(
cBRI
 
bgGRA
); ;

499 
RESP_VARIABLE
: 
	`SAYF
(
cBLK
 
bgCYA
); ;

500 
RESP_FIXED
: 
	`SAYF
(
cBLK
 
bgMGN
); ;

501 
RESP_LEN
: 
	`SAYF
(
cBLK
 
bgLGN
); ;

502 
RESP_CKSUM
: 
	`SAYF
(
cBLK
 
bgYEL
); ;

503 
RESP_SUSPECT
: 
	`SAYF
(
cBLK
 
bgLRD
); ;

507 
	`show_ch¨
(
ö_d©a
[
i
 + 
off
]);

509 i‡(
off
 !
æí
 - 1 && (
i
 + of‡+ 1Ë% 16Ë
	`SAYF
(" "); SAYF(
cRST
 " ");

515 
	`SAYF
(" Off£à%u,Üígth %u: ", 
i
, 
æí
);

517 
πy≥
) {

519 
RESP_NONE
: 
	`SAYF
("no-op block\n"); ;

520 
RESP_MINOR
: 
	`SAYF
("superficial content\n"); ;

521 
RESP_VARIABLE
: 
	`SAYF
("critical stream\n"); ;

522 
RESP_FIXED
: 
	`SAYF
("\"magic value\" section\n"); ;

523 
RESP_LEN
: 
	`SAYF
("suspectedÜength field\n"); ;

524 
RESP_CKSUM
: 
	`SAYF
("suspected cksum or magic int\n"); ;

525 
RESP_SUSPECT
: 
	`SAYF
("suspected checksummed block\n"); ;

531 
i
 +
æí
 - 1;

535 #ifde‡
USE_COLOR


536 
	`SAYF
(
cRST
 "\n");

539 
	}
}

545 
	$™Æyze
(** 
¨gv
) {

547 
u32
 
i
;

548 
u32
 
b‹ög_Àn
 = 0, 
¥ev_xff
 = 0, 
¥ev_x01
 = 0, 
¥ev_s10
 = 0, 
¥ev_a10
 = 0;

550 
u8
* 
b_d©a
 = 
	`ck_Æloc
(
ö_Àn
 + 1);

551 
u8
 
£q_byã
 = 0;

553 
b_d©a
[
ö_Àn
] = 0xff;

555 
	`ACTF
("Analyzing input file (this mayÅakeá while)...\n");

557 #ifde‡
USE_COLOR


558 
	`show_Àgíd
();

561 
i
 = 0; i < 
ö_Àn
; i++) {

563 
u32
 
x‹_ff
, 
x‹_01
, 
sub_10
, 
add_10
;

564 
u8
 
xff_‹ig
, 
x01_‹ig
, 
s10_‹ig
, 
a10_‹ig
;

570 
ö_d©a
[
i
] ^= 0xff;

571 
x‹_ff
 = 
	`run_èrgë
(
¨gv
, 
ö_d©a
, 
ö_Àn
, 0);

573 
ö_d©a
[
i
] ^= 0xfe;

574 
x‹_01
 = 
	`run_èrgë
(
¨gv
, 
ö_d©a
, 
ö_Àn
, 0);

576 
ö_d©a
[
i
] = (in_data[i] ^ 0x01) - 0x10;

577 
sub_10
 = 
	`run_èrgë
(
¨gv
, 
ö_d©a
, 
ö_Àn
, 0);

579 
ö_d©a
[
i
] += 0x20;

580 
add_10
 = 
	`run_èrgë
(
¨gv
, 
ö_d©a
, 
ö_Àn
, 0);

581 
ö_d©a
[
i
] -= 0x10;

585 
xff_‹ig
 = (
x‹_ff
 =
‹ig_cksum
);

586 
x01_‹ig
 = (
x‹_01
 =
‹ig_cksum
);

587 
s10_‹ig
 = (
sub_10
 =
‹ig_cksum
);

588 
a10_‹ig
 = (
add_10
 =
‹ig_cksum
);

590 i‡(
xff_‹ig
 && 
x01_‹ig
 && 
s10_‹ig
 && 
a10_‹ig
) {

592 
b_d©a
[
i
] = 
RESP_NONE
;

593 
b‹ög_Àn
++;

595 } i‡(
xff_‹ig
 || 
x01_‹ig
 || 
s10_‹ig
 || 
a10_‹ig
) {

597 
b_d©a
[
i
] = 
RESP_MINOR
;

598 
b‹ög_Àn
++;

600 } i‡(
x‹_ff
 =
x‹_01
 && x‹_f‡=
sub_10
 && x‹_f‡=
add_10
) {

602 
b_d©a
[
i
] = 
RESP_FIXED
;

604 } 
b_d©a
[
i
] = 
RESP_VARIABLE
;

608 i‡(
¥ev_xff
 !
x‹_ff
 && 
¥ev_x01
 !
x‹_01
 &&

609 
¥ev_s10
 !
sub_10
 && 
¥ev_a10
 !
add_10
Ë
£q_byã
 ^= 0x80;

611 
b_d©a
[
i
] |
£q_byã
;

613 
¥ev_xff
 = 
x‹_ff
;

614 
¥ev_x01
 = 
x‹_01
;

615 
¥ev_s10
 = 
sub_10
;

616 
¥ev_a10
 = 
add_10
;

620 
	`dump_hex
(
ö_d©a
, 
ö_Àn
, 
b_d©a
);

622 
	`SAYF
("\n");

624 
	`OKF
("Analysis complete. Interesting bits: %0.02f%% ofÅhe input file.",

625 100.0 - (()
b‹ög_Àn
 * 100Ë/ 
ö_Àn
);

627 i‡(
exec_h™gs
)

628 
	`WARNF
(
cLRD
 "Encou¡îed %uÅimeout†-Ñesu…†may bêskewed." 
cRST
,

629 
exec_h™gs
);

631 
	`ck_‰ì
(
b_d©a
);

633 
	}
}

639 
	$h™dÀ_°›_sig
(
sig
) {

641 
°›_so⁄
 = 1;

643 i‡(
chûd_pid
 > 0Ë
	`kûl
(chûd_pid, 
SIGKILL
);

645 
	}
}

650 
	$£t_up_ívú⁄mít
() {

652 
u8
* 
x
;

654 
dev_nuŒ_fd
 = 
	`›í
("/dev/nuŒ", 
O_RDWR
);

655 i‡(
dev_nuŒ_fd
 < 0Ë
	`PFATAL
("UnableÅo open /dev/null");

657 i‡(!
¥og_ö
) {

659 
u8
* 
u£_dú
 = ".";

661 i‡(!
	`ac˚ss
(
u£_dú
, 
R_OK
 | 
W_OK
 | 
X_OK
)) {

663 
u£_dú
 = 
	`gëív
("TMPDIR");

664 i‡(!
u£_dú
) use_dir = "/tmp";

666 
¥og_ö
 = 
	`Æloc_¥ötf
("%s/.aÊ-tmö-ãmp-%u", 
u£_dú
, 
	`gëpid
());

674 
x
 = 
	`gëív
("ASAN_OPTIONS");

676 i‡(
x
) {

678 i‡(!
	`°r°r
(
x
, "abort_on_error=1"))

679 
	`FATAL
("Custom ASAN_OPTIONS set withoutábort_on_error=1 -Ölease fix!");

681 i‡(!
	`°r°r
(
x
, "symbolize=0"))

682 
	`FATAL
("Custom ASAN_OPTIONS set without symbolize=0 -Ölease fix!");

686 
x
 = 
	`gëív
("MSAN_OPTIONS");

688 i‡(
x
) {

690 i‡(!
	`°r°r
(
x
, "exô_code=" 
	`STRINGIFY
(
MSAN_ERROR
)))

691 
	`FATAL
("Custom MSAN_OPTIONS set withoutÉxit_code="

692 
	`STRINGIFY
(
MSAN_ERROR
) " -Ölease fix!");

694 i‡(!
	`°r°r
(
x
, "symbolize=0"))

695 
	`FATAL
("Custom MSAN_OPTIONS set without symbolize=0 -Ölease fix!");

699 
	`£ãnv
("ASAN_OPTIONS", "abort_on_error=1:"

704 
	`£ãnv
("MSAN_OPTIONS", "exô_code=" 
	`STRINGIFY
(
MSAN_ERROR
) ":"

710 i‡(
	`gëív
("AFL_LD_PRELOAD"))

711 
	`£ãnv
("LD_PRELOAD", 
	`gëív
("AFL_LD_PRELOAD"), 1);

713 
	}
}

718 
	$£tup_sig«l_h™dÀrs
() {

720 
siga˘i⁄
 
ß
;

722 
ß
.
ß_h™dÀr
 = 
NULL
;

723 
ß
.
ß_Êags
 = 
SA_RESTART
;

724 
ß
.
ß_siga˘i⁄
 = 
NULL
;

726 
	`sigem±y£t
(&
ß
.
ß_mask
);

730 
ß
.
ß_h™dÀr
 = 
h™dÀ_°›_sig
;

731 
	`siga˘i⁄
(
SIGHUP
, &
ß
, 
NULL
);

732 
	`siga˘i⁄
(
SIGINT
, &
ß
, 
NULL
);

733 
	`siga˘i⁄
(
SIGTERM
, &
ß
, 
NULL
);

737 
ß
.
ß_h™dÀr
 = 
h™dÀ_timeout
;

738 
	`siga˘i⁄
(
SIGALRM
, &
ß
, 
NULL
);

740 
	}
}

745 
	$dëe˘_fûe_¨gs
(** 
¨gv
) {

747 
u32
 
i
 = 0;

748 
u8
* 
cwd
 = 
	`gëcwd
(
NULL
, 0);

750 i‡(!
cwd
Ë
	`PFATAL
("getcwd() failed");

752 
¨gv
[
i
]) {

754 
u8
* 
Ø_loc
 = 
	`°r°r
(
¨gv
[
i
], "@@");

756 i‡(
Ø_loc
) {

758 
u8
 *
Ø_sub°
, *
n_¨g
;

762 i‡(
¥og_ö
[0] ='/'Ë
Ø_sub°
 =Örog_in;

763 
Ø_sub°
 = 
	`Æloc_¥ötf
("%s/%s", 
cwd
, 
¥og_ö
);

767 *
Ø_loc
 = 0;

768 
n_¨g
 = 
	`Æloc_¥ötf
("%s%s%s", 
¨gv
[
i
], 
Ø_sub°
, 
Ø_loc
 + 2);

769 
¨gv
[
i
] = 
n_¨g
;

770 *
Ø_loc
 = '@';

772 i‡(
¥og_ö
[0] !'/'Ë
	`ck_‰ì
(
Ø_sub°
);

776 
i
++;

780 
	`‰ì
(
cwd
);

782 
	}
}

787 
	$ußge
(
u8
* 
¨gv0
) {

789 
	`SAYF
("\n%s [ options ] -- /path/to/target_app [ ... ]\n\n"

808 
¨gv0
, 
EXEC_TIMEOUT
, 
MEM_LIMIT
, 
doc_∑th
);

810 
	`exô
(1);

812 
	}
}

817 
	$föd_bö¨y
(
u8
* 
‚ame
) {

819 
u8
* 
ív_∑th
 = 0;

820 
°©
 
°
;

822 i‡(
	`°rchr
(
‚ame
, '/'Ë|| !(
ív_∑th
 = 
	`gëív
("PATH"))) {

824 
èrgë_∑th
 = 
	`ck_°rdup
(
‚ame
);

826 i‡(
	`°©
(
èrgë_∑th
, &
°
Ë|| !
	`S_ISREG
(°.
°_mode
) ||

827 !(
°
.
°_mode
 & 0111Ë|| st.
°_size
 < 4)

828 
	`FATAL
("Progøm '%s'ÇŸ found o∏nŸÉxecuèbÀ", 
‚ame
);

832 
ív_∑th
) {

834 
u8
 *
cur_ñem
, *
dñim
 = 
	`°rchr
(
ív_∑th
, ':');

836 i‡(
dñim
) {

838 
cur_ñem
 = 
	`ck_Æloc
(
dñim
 - 
ív_∑th
 + 1);

839 
	`mem˝y
(
cur_ñem
, 
ív_∑th
, 
dñim
 -Énv_path);

840 
dñim
++;

842 } 
cur_ñem
 = 
	`ck_°rdup
(
ív_∑th
);

844 
ív_∑th
 = 
dñim
;

846 i‡(
cur_ñem
[0])

847 
èrgë_∑th
 = 
	`Æloc_¥ötf
("%s/%s", 
cur_ñem
, 
‚ame
);

849 
èrgë_∑th
 = 
	`ck_°rdup
(
‚ame
);

851 
	`ck_‰ì
(
cur_ñem
);

853 i‡(!
	`°©
(
èrgë_∑th
, &
°
Ë&& 
	`S_ISREG
(°.
°_mode
) &&

854 (
°
.
°_mode
 & 0111Ë&& st.
°_size
 >= 4) ;

856 
	`ck_‰ì
(
èrgë_∑th
);

857 
èrgë_∑th
 = 0;

861 i‡(!
èrgë_∑th
Ë
	`FATAL
("Progøm '%s'ÇŸ found o∏nŸÉxecuèbÀ", 
‚ame
);

865 
	}
}

870 ** 
	$gë_qemu_¨gv
(
u8
* 
own_loc
, ** 
¨gv
, 
¨gc
) {

872 ** 
√w_¨gv
 = 
	`ck_Æloc
((*Ë* (
¨gc
 + 4));

873 
u8
 *
tmp
, *
˝
, *
r¶
, *
own_c›y
;

875 
	`mem˝y
(
√w_¨gv
 + 3, 
¨gv
 + 1, (*Ë* 
¨gc
);

879 
√w_¨gv
[2] = 
èrgë_∑th
;

880 
√w_¨gv
[1] = "--";

882 
tmp
 = 
	`gëív
("AFL_PATH");

884 i‡(
tmp
) {

886 
˝
 = 
	`Æloc_¥ötf
("%s/aÊ-qemu-åa˚", 
tmp
);

888 i‡(
	`ac˚ss
(
˝
, 
X_OK
))

889 
	`FATAL
("U«bÀÅÿföd '%s'", 
tmp
);

891 
èrgë_∑th
 = 
√w_¨gv
[0] = 
˝
;

892  
√w_¨gv
;

896 
own_c›y
 = 
	`ck_°rdup
(
own_loc
);

897 
r¶
 = 
	`°ºchr
(
own_c›y
, '/');

899 i‡(
r¶
) {

901 *
r¶
 = 0;

903 
˝
 = 
	`Æloc_¥ötf
("%s/aÊ-qemu-åa˚", 
own_c›y
);

904 
	`ck_‰ì
(
own_c›y
);

906 i‡(!
	`ac˚ss
(
˝
, 
X_OK
)) {

908 
èrgë_∑th
 = 
√w_¨gv
[0] = 
˝
;

909  
√w_¨gv
;

913 } 
	`ck_‰ì
(
own_c›y
);

915 i‡(!
	`ac˚ss
(
BIN_PATH
 "/aÊ-qemu-åa˚", 
X_OK
)) {

917 
èrgë_∑th
 = 
√w_¨gv
[0] = 
BIN_PATH
 "/afl-qemu-trace";

918  
√w_¨gv
;

922 
	`FATAL
("UnableÅo find 'afl-qemu-trace'.");

924 
	}
}

929 
	$maö
(
¨gc
, ** 
¨gv
) {

931 
s32
 
›t
;

932 
u8
 
mem_limô_giví
 = 0, 
timeout_giví
 = 0, 
qemu_mode
 = 0;

933 ** 
u£_¨gv
;

935 
doc_∑th
 = 
	`ac˚ss
(
DOC_PATH
, 
F_OK
) ? "docs" : DOC_PATH;

937 
	`SAYF
(
cCYA
 "aÊ-™Æyzê" 
cBRI
 
VERSION
 
cRST
 " by <lcamtuf@google.com>\n");

939 (
›t
 = 
	`gë›t
(
¨gc
,
¨gv
,"+i:f:m:t:eQ")) > 0)

941 
›t
) {

945 i‡(
ö_fûe
Ë
	`FATAL
("Multiple -i optionsÇot supported");

946 
ö_fûe
 = 
›èrg
;

951 i‡(
¥og_ö
Ë
	`FATAL
("Multiple -f optionsÇot supported");

952 
u£_°dö
 = 0;

953 
¥og_ö
 = 
›èrg
;

958 i‡(
edges_⁄ly
Ë
	`FATAL
("Multiple -e optionsÇot supported");

959 
edges_⁄ly
 = 1;

964 
u8
 
suffix
 = 'M';

966 i‡(
mem_limô_giví
Ë
	`FATAL
("Multiple -m optionsÇot supported");

967 
mem_limô_giví
 = 1;

969 i‡(!
	`°rcmp
(
›èrg
, "none")) {

971 
mem_limô
 = 0;

976 i‡(
	`ssˇnf
(
›èrg
, "%Œu%c", &
mem_limô
, &
suffix
) < 1 ||

977 
›èrg
[0] ='-'Ë
	`FATAL
("Bad syntax used for -m");

979 
suffix
) {

981 'T': 
mem_limô
 *= 1024 * 1024; ;

982 'G': 
mem_limô
 *= 1024; ;

983 'k': 
mem_limô
 /= 1024; ;

986 : 
	`FATAL
("Unsupported suffix or bad syntax for -m");

990 i‡(
mem_limô
 < 5Ë
	`FATAL
("DangerouslyÜow value of -m");

992 i‡((
æim_t
Ë=4 && 
mem_limô
 > 2000)

993 
	`FATAL
("Value of -m out ofÑange on 32-bit systems");

1001 i‡(
timeout_giví
Ë
	`FATAL
("Multiple -t optionsÇot supported");

1002 
timeout_giví
 = 1;

1004 
exec_tmout
 = 
	`©oi
(
›èrg
);

1006 i‡(
exec_tmout
 < 10 || 
›èrg
[0] == '-')

1007 
	`FATAL
("DangerouslyÜow value of -t");

1013 i‡(
qemu_mode
Ë
	`FATAL
("Multiple -Q optionsÇot supported");

1014 i‡(!
mem_limô_giví
Ë
mem_limô
 = 
MEM_LIMIT_QEMU
;

1016 
qemu_mode
 = 1;

1021 
	`ußge
(
¨gv
[0]);

1025 i‡(
›töd
 =
¨gc
 || !
ö_fûe
Ë
	`ußge
(
¨gv
[0]);

1027 
	`£tup_shm
();

1028 
	`£tup_sig«l_h™dÀrs
();

1030 
	`£t_up_ívú⁄mít
();

1032 
	`föd_bö¨y
(
¨gv
[
›töd
]);

1033 
	`dëe˘_fûe_¨gs
(
¨gv
 + 
›töd
);

1035 i‡(
qemu_mode
)

1036 
u£_¨gv
 = 
	`gë_qemu_¨gv
(
¨gv
[0],árgv + 
›töd
, 
¨gc
 - optind);

1038 
u£_¨gv
 = 
¨gv
 + 
›töd
;

1040 
	`SAYF
("\n");

1042 
	`ªad_öôül_fûe
();

1044 
	`ACTF
("Performing dryÑun (memÜimit = %llu MB,Åimeout = %u ms%s)...",

1045 
mem_limô
, 
exec_tmout
, 
edges_⁄ly
 ? ",Édges only" : "");

1047 
	`run_èrgë
(
u£_¨gv
, 
ö_d©a
, 
ö_Àn
, 1);

1049 i‡(
chûd_timed_out
)

1050 
	`FATAL
("Target binaryÅimes out (adjusting -t may help).");

1052 i‡(!
	`™ythög_£t
()Ë
	`FATAL
("No instrumentation detected.");

1054 
	`™Æyze
(
u£_¨gv
);

1056 
	`OKF
("We're done here. HaveáÇice day!\n");

1058 
	`exô
(0);

1060 
	}
}

	@afl-as.c

31 
	#AFL_MAIN


	)

33 
	~"c⁄fig.h
"

34 
	~"ty≥s.h
"

35 
	~"debug.h
"

36 
	~"Æloc-öl.h
"

38 
	~"aÊ-as.h
"

40 
	~<°dio.h
>

41 
	~<uni°d.h
>

42 
	~<°dlib.h
>

43 
	~<°rög.h
>

44 
	~<time.h
>

45 
	~<˘y≥.h
>

46 
	~<f˙é.h
>

48 
	~<sys/waô.h
>

49 
	~<sys/time.h
>

51 
u8
** 
	gas_∑øms
;

53 
u8
* 
	göput_fûe
;

54 
u8
* 
	gmodifõd_fûe
;

56 
u8
 
	gbe_quõt
,

57 
	g˛™g_mode
,

58 
	g∑ss_thru
,

59 
	gju°_vîsi⁄
;

61 
u32
 
	gö°_øtio
 = 100,

62 
	gas_∑r_˙t
 = 1;

68 #ifde‡
__x86_64__


70 
u8
 
	gu£_64bô
 = 1;

74 
u8
 
	gu£_64bô
 = 0;

76 #ifde‡
__APPLE__


87 
	$edô_∑øms
(
¨gc
, ** 
¨gv
) {

89 
u8
 *
tmp_dú
 = 
	`gëív
("TMPDIR"), *
aÊ_as
 = getenv("AFL_AS");

90 
u32
 
i
;

92 #ifde‡
__APPLE__


94 
u8
 
u£_˛™g_as
 = 0;

108 i‡(
˛™g_mode
 && !
aÊ_as
) {

110 
u£_˛™g_as
 = 1;

112 
aÊ_as
 = 
	`gëív
("AFL_CC");

113 i‡(!
aÊ_as
ËaÊ_a†
	`gëív
("AFL_CXX");

114 i‡(!
aÊ_as
)áfl_as = "clang";

124 i‡(!
tmp_dú
Ëtmp_dú = 
	`gëív
("TEMP");

125 i‡(!
tmp_dú
Ëtmp_dú = 
	`gëív
("TMP");

126 i‡(!
tmp_dú
)Åmp_dir = "/tmp";

128 
as_∑øms
 = 
	`ck_Æloc
((
¨gc
 + 32Ë* (
u8
*));

130 
as_∑øms
[0] = 
aÊ_as
 ?áÊ_a†: (
u8
*)"as";

132 
as_∑øms
[
¨gc
] = 0;

134 
i
 = 1; i < 
¨gc
 - 1; i++) {

136 i‡(!
	`°rcmp
(
¨gv
[
i
], "--64")Ë
u£_64bô
 = 1;

137 i‡(!
	`°rcmp
(
¨gv
[
i
], "--32")Ë
u£_64bô
 = 0;

139 #ifde‡
__APPLE__


143 i‡(!
	`°rcmp
(
¨gv
[
i
], "-¨ch"Ë&& i + 1 < 
¨gc
) {

145 i‡(!
	`°rcmp
(
¨gv
[
i
 + 1], "x86_64")Ë
u£_64bô
 = 1;

146 i‡(!
	`°rcmp
(
¨gv
[
i
 + 1], "i386"))

147 
	`FATAL
("Sorry, 32-bit AppleÖlatformsáreÇot supported.");

154 i‡(
˛™g_mode
 && (!
	`°rcmp
(
¨gv
[
i
], "-q") || !strcmp(argv[i], "-Q")))

159 
as_∑øms
[
as_∑r_˙t
++] = 
¨gv
[
i
];

163 #ifde‡
__APPLE__


168 i‡(
u£_˛™g_as
) {

170 
as_∑øms
[
as_∑r_˙t
++] = "-c";

171 
as_∑øms
[
as_∑r_˙t
++] = "-x";

172 
as_∑øms
[
as_∑r_˙t
++] = "assembler";

178 
öput_fûe
 = 
¨gv
[
¨gc
 - 1];

180 i‡(
öput_fûe
[0] == '-') {

182 i‡(!
	`°rcmp
(
öput_fûe
 + 1, "-version")) {

183 
ju°_vîsi⁄
 = 1;

184 
modifõd_fûe
 = 
öput_fûe
;

185 
wøp_thögs_up
;

188 i‡(
öput_fûe
[1]Ë
	`FATAL
("Incorrect use (not calledÅhrougháfl-gcc?)");

189 
öput_fûe
 = 
NULL
;

198 i‡(
	`°∫cmp
(
öput_fûe
, 
tmp_dú
, 
	`°æí
(tmp_dir)) &&

199 
	`°∫cmp
(
öput_fûe
, "/var/tmp/", 9) &&

200 
	`°∫cmp
(
öput_fûe
, "/tmp/", 5)Ë
∑ss_thru
 = 1;

204 
modifõd_fûe
 = 
	`Æloc_¥ötf
("%s/.aÊ-%u-%u.s", 
tmp_dú
, 
	`gëpid
(),

205 (
u32
)
	`time
(
NULL
));

207 
wøp_thögs_up
:

209 
as_∑øms
[
as_∑r_˙t
++] = 
modifõd_fûe
;

210 
as_∑øms
[
as_∑r_˙t
] = 
NULL
;

212 
	}
}

218 
	$add_ö°rumíèti⁄
() {

220 
u8
 
löe
[
MAX_LINE
];

222 
FILE
* 
öf
;

223 
FILE
* 
outf
;

224 
s32
 
outfd
;

225 
u32
 
ös_löes
 = 0;

227 
u8
 
ö°r_ok
 = 0, 
skù_c£˘
 = 0, 
skù_√xt_œbñ
 = 0,

228 
skù_öãl
 = 0, 
skù_≠p
 = 0, 
ö°rumít_√xt
 = 0;

230 #ifde‡
__APPLE__


232 
u8
* 
cﬁ⁄_pos
;

236 i‡(
öput_fûe
) {

238 
öf
 = 
	`f›í
(
öput_fûe
, "r");

239 i‡(!
öf
Ë
	`PFATAL
("U«bÀÅÿªad '%s'", 
öput_fûe
);

241 } 
öf
 = 
°dö
;

243 
outfd
 = 
	`›í
(
modifõd_fûe
, 
O_WRONLY
 | 
O_EXCL
 | 
O_CREAT
, 0600);

245 i‡(
outfd
 < 0Ë
	`PFATAL
("U«bÀÅÿwrôêtÿ'%s'", 
modifõd_fûe
);

247 
outf
 = 
	`fd›í
(
outfd
, "w");

249 i‡(!
outf
Ë
	`PFATAL
("fdopen() failed");

251 
	`fgës
(
löe
, 
MAX_LINE
, 
öf
)) {

258 i‡(!
∑ss_thru
 && !
skù_öãl
 && !
skù_≠p
 && !
skù_c£˘
 && 
ö°r_ok
 &&

259 
ö°rumít_√xt
 && 
löe
[0] ='\t' && 
	`ißÕha
(line[1])) {

261 
	`Ârötf
(
outf
, 
u£_64bô
 ? 
åampﬁöe_fmt_64
 : 
åampﬁöe_fmt_32
,

262 
	`R
(
MAP_SIZE
));

264 
ö°rumít_√xt
 = 0;

265 
ös_löes
++;

271 
	`Âuts
(
löe
, 
outf
);

273 i‡(
∑ss_thru
) ;

279 i‡(
löe
[0] == '\t' &&Üine[1] == '.') {

285 i‡(!
˛™g_mode
 && 
ö°r_ok
 && !
	`°∫cmp
(
löe
 + 2, "p2align ", 8) &&

286 
	`isdigô
(
löe
[10]Ë&&Üöe[11] ='\n'Ë
skù_√xt_œbñ
 = 1;

288 i‡(!
	`°∫cmp
(
löe
 + 2, "text\n", 5) ||

289 !
	`°∫cmp
(
löe
 + 2, "section\t.text", 13) ||

290 !
	`°∫cmp
(
löe
 + 2, "section\t__TEXT,__text", 21) ||

291 !
	`°∫cmp
(
löe
 + 2, "section __TEXT,__text", 21)) {

292 
ö°r_ok
 = 1;

296 i‡(!
	`°∫cmp
(
löe
 + 2, "section\t", 8) ||

297 !
	`°∫cmp
(
löe
 + 2, "section ", 8) ||

298 !
	`°∫cmp
(
löe
 + 2, "bss\n", 4) ||

299 !
	`°∫cmp
(
löe
 + 2, "data\n", 5)) {

300 
ö°r_ok
 = 0;

310 i‡(
	`°r°r
(
löe
, ".code")) {

312 i‡(
	`°r°r
(
löe
, ".code32")Ë
skù_c£˘
 = 
u£_64bô
;

313 i‡(
	`°r°r
(
löe
, ".code64")Ë
skù_c£˘
 = !
u£_64bô
;

320 i‡(
	`°r°r
(
löe
, ".öãl_sy¡ax")Ë
skù_öãl
 = 1;

321 i‡(
	`°r°r
(
löe
, ".©t_sy¡ax")Ë
skù_öãl
 = 0;

325 i‡(
löe
[0] == '#' ||Üine[1] == '#') {

327 i‡(
	`°r°r
(
löe
, "#APP")Ë
skù_≠p
 = 1;

328 i‡(
	`°r°r
(
löe
, "#NO_APP")Ë
skù_≠p
 = 0;

356 i‡(
skù_öãl
 || 
skù_≠p
 || 
skù_c£˘
 || !
ö°r_ok
 ||

357 
löe
[0] == '#' ||Üine[0] == ' ') ;

363 i‡(
löe
[0] == '\t') {

365 i‡(
löe
[1] ='j' &&Üöe[2] !'m' && 
	`R
(100Ë< 
ö°_øtio
) {

367 
	`Ârötf
(
outf
, 
u£_64bô
 ? 
åampﬁöe_fmt_64
 : 
åampﬁöe_fmt_32
,

368 
	`R
(
MAP_SIZE
));

370 
ös_löes
++;

382 #ifde‡
__APPLE__


386 i‡((
cﬁ⁄_pos
 = 
	`°r°r
(
löe
, ":"))) {

388 i‡(
löe
[0] ='L' && 
	`isdigô
(*(
cﬁ⁄_pos
 - 1))) {

394 i‡(
	`°r°r
(
löe
, ":")) {

396 i‡(
löe
[0] == '.') {

402 #ifde‡
__APPLE__


406 i‡((
	`isdigô
(
löe
[1]Ë|| (
˛™g_mode
 && !
	`°∫cmp
(line, "LBB", 3)))

407 && 
	`R
(100Ë< 
ö°_øtio
) {

413 i‡((
	`isdigô
(
löe
[2]Ë|| (
˛™g_mode
 && !
	`°∫cmp
(line + 1, "LBB", 3)))

414 && 
	`R
(100Ë< 
ö°_øtio
) {

429 i‡(!
skù_√xt_œbñ
Ë
ö°rumít_√xt
 = 1; skip_next_label = 0;

437 
ö°rumít_√xt
 = 1;

445 i‡(
ös_löes
)

446 
	`Âuts
(
u£_64bô
 ? 
maö_∑ylﬂd_64
 : 
maö_∑ylﬂd_32
, 
outf
);

448 i‡(
öput_fûe
Ë
	`f˛o£
(
öf
);

449 
	`f˛o£
(
outf
);

451 i‡(!
be_quõt
) {

453 i‡(!
ös_löes
Ë
	`WARNF
("No instrumentationÅargets found%s.",

454 
∑ss_thru
 ? " (pass-thru mode)" : "");

455 
	`OKF
("Instrumented %uÜocations (%s-bit, %s mode,Ñatio %u%%).",

456 
ös_löes
, 
u£_64bô
 ? "64" : "32",

457 
	`gëív
("AFL_HARDEN") ? "hardened" : "non-hardened",

458 
ö°_øtio
);

462 
	}
}

467 
	$maö
(
¨gc
, ** 
¨gv
) {

469 
s32
 
pid
;

470 
u32
 
ønd_£ed
;

471 
°©us
;

472 
u8
* 
ö°_øtio_°r
 = 
	`gëív
("AFL_INST_RATIO");

474 
timevÆ
 
tv
;

475 
timez⁄e
 
tz
;

477 
˛™g_mode
 = !!
	`gëív
(
CLANG_ENV_VAR
);

479 i‡(
	`ißây
(2Ë&& !
	`gëív
("AFL_QUIET")) {

481 
	`SAYF
(
cCYA
 "aÊ-a†" 
cBRI
 
VERSION
 
cRST
 " by <lcamtuf@google.com>\n");

483 } 
be_quõt
 = 1;

485 i‡(
¨gc
 < 2) {

487 
	`SAYF
("\n"

496 
	`exô
(1);

500 
	`gëtimeofday
(&
tv
, &
tz
);

502 
ønd_£ed
 = 
tv
.
tv_£c
 ^Åv.
tv_u£c
 ^ 
	`gëpid
();

504 
	`§™dom
(
ønd_£ed
);

506 
	`edô_∑øms
(
¨gc
, 
¨gv
);

508 i‡(
ö°_øtio_°r
) {

510 i‡(
	`ssˇnf
(
ö°_øtio_°r
, "%u", &
ö°_øtio
) != 1 || inst_ratio > 100)

511 
	`FATAL
("Bad value of AFL_INST_RATIO (must be between 0ánd 100)");

515 i‡(
	`gëív
(
AS_LOOP_ENV_VAR
))

516 
	`FATAL
("EndlessÜoop when calling 'as' (remove '.' from your PATH)");

518 
	`£ãnv
(
AS_LOOP_ENV_VAR
, "1", 1);

524 i‡(
	`gëív
("AFL_USE_ASAN"Ë|| gëív("AFL_USE_MSAN")Ë
ö°_øtio
 /= 3;

526 i‡(!
ju°_vîsi⁄
Ë
	`add_ö°rumíèti⁄
();

528 i‡(!(
pid
 = 
	`f‹k
())) {

530 
	`execvp
(
as_∑øms
[0], (**)as_params);

531 
	`FATAL
("O›s, faûedÅÿexecuã '%s' - check you∏PATH", 
as_∑øms
[0]);

535 i‡(
pid
 < 0Ë
	`PFATAL
("fork() failed");

537 i‡(
	`waôpid
(
pid
, &
°©us
, 0Ë<0Ë
	`PFATAL
("waitpid() failed");

539 i‡(!
	`gëív
("AFL_KEEP_ASSEMBLY")Ë
	`u∆ök
(
modifõd_fûe
);

541 
	`exô
(
	`WEXITSTATUS
(
°©us
));

543 
	}
}

	@afl-as.h

34 #i‚de‡
_HAVE_AFL_AS_H


35 
	#_HAVE_AFL_AS_H


	)

37 
	~"c⁄fig.h
"

38 
	~"ty≥s.h
"

107 c⁄° 
u8
* 
	gåampﬁöe_fmt_32
 =

130 c⁄° 
u8
* 
	gåampﬁöe_fmt_64
 =

151 c⁄° 
u8
* 
	gmaö_∑ylﬂd_32
 =

179 #i‚de‡
COVERAGE_ONLY


188 #ifde‡
SKIP_COUNTS


259 "Öush»$" 
STRINGIFY
((
FORKSRV_FD
 + 1)) " /* file desc */\n"

272 "Öush»$" 
STRINGIFY
(
FORKSRV_FD
) " /* file desc */\n"

296 "Öush»$" 
STRINGIFY
((
FORKSRV_FD
 + 1)) " /* file desc */\n"

313 "Öush»$" 
STRINGIFY
((
FORKSRV_FD
 + 1)) " /* file desc */\n"

323 "Öush»$" 
STRINGIFY
(
FORKSRV_FD
) "\n"

326 "Öush»$" 
STRINGIFY
((
FORKSRV_FD
 + 1)) "\n"

355 #i‚de‡
COVERAGE_ONLY


362 " .asciz \"" 
SHM_ENV_VAR
 "\"\n"

375 #ifde‡
__APPLE__


376 
	#CALL_L64
(
°r
Ë"ˇŒ _" så "\n"

	)

378 
	#CALL_L64
(
°r
Ë"ˇŒ " så "@PLT\n"

	)

381 c⁄° 
u8
* 
	gmaö_∑ylﬂd_64
 =

393 #i‡
deföed
(
__O≥nBSD__
Ë|| (deföed(
__FªeBSD__
) && (__FreeBSD__ < 9))

410 #i‚de‡
COVERAGE_ONLY


416 #ifde‡
SKIP_COUNTS


425 #i‡
deföed
(
__O≥nBSD__
Ë|| (deföed(
__FªeBSD__
) && (__FreeBSD__ < 9))

443 #i‚de‡
__APPLE__


499 
CALL_L64
("getenv")

505 
CALL_L64
("atoi")

510 
CALL_L64
("shmat")

520 #ifde‡
__APPLE__


543 " movq $" 
STRINGIFY
((
FORKSRV_FD
 + 1)) ", %rdi /* file desc */\n"

544 
CALL_L64
("write")

555 " movq $" 
STRINGIFY
(
FORKSRV_FD
) ", %rdi /* file desc */\n"

556 
CALL_L64
("read")

565 
CALL_L64
("fork")

576 " movq $" 
STRINGIFY
((
FORKSRV_FD
 + 1)) ", %rdi /* file desc */\n"

577 
CALL_L64
("write")

582 
CALL_L64
("waitpid")

590 " movq $" 
STRINGIFY
((
FORKSRV_FD
 + 1)) ", %rdi /* file desc */\n"

591 
CALL_L64
("write")

599 " movq $" 
STRINGIFY
(
FORKSRV_FD
) ", %rdi\n"

600 
CALL_L64
("close")

602 " movq $" 
STRINGIFY
((
FORKSRV_FD
 + 1)) ", %rdi\n"

603 
CALL_L64
("close")

644 
CALL_L64
("_exit")

689 #ifde‡
__APPLE__


692 #i‚de‡
COVERAGE_ONLY


702 #i‚de‡
COVERAGE_ONLY


714 " .asciz \"" 
SHM_ENV_VAR
 "\"\n"

	@afl-fuzz.c

23 
	#AFL_MAIN


	)

24 
	#MESSAGES_TO_STDOUT


	)

26 
	#_GNU_SOURCE


	)

27 
	#_FILE_OFFSET_BITS
 64

	)

29 
	~"c⁄fig.h
"

30 
	~"ty≥s.h
"

31 
	~"debug.h
"

32 
	~"Æloc-öl.h
"

33 
	~"hash.h
"

35 
	~<°dio.h
>

36 
	~<uni°d.h
>

37 
	~<°dlib.h
>

38 
	~<°rög.h
>

39 
	~<time.h
>

40 
	~<î∫o.h
>

41 
	~<sig«l.h
>

42 
	~<dúít.h
>

43 
	~<˘y≥.h
>

44 
	~<f˙é.h
>

45 
	~<ãrmios.h
>

46 
	~<dlf˙.h
>

47 
	~<sched.h
>

49 
	~<sys/waô.h
>

50 
	~<sys/time.h
>

51 
	~<sys/shm.h
>

52 
	~<sys/°©.h
>

53 
	~<sys/ty≥s.h
>

54 
	~<sys/ªsour˚.h
>

55 
	~<sys/mm™.h
>

56 
	~<sys/io˘l.h
>

57 
	~<sys/fûe.h
>

59 #i‡
deföed
(
__APPLE__
Ë|| deföed(
__FªeBSD__
Ë|| deföed (
__O≥nBSD__
)

60 
	~<sys/sys˘l.h
>

66 #ifde‡
__löux__


67 
	#HAVE_AFFINITY
 1

	)

73 #ifde‡
AFL_LIB


74 
	#EXP_ST


	)

76 
	#EXP_ST
 

	)

83 
EXP_ST
 
u8
 *
	gö_dú
,

84 *
	gout_fûe
,

85 *
	gout_dú
,

86 *
	gsync_dú
,

87 *
	gsync_id
,

88 *
	gu£_b™√r
,

89 *
	gö_bôm≠
,

90 *
	gdoc_∑th
,

91 *
	gèrgë_∑th
,

92 *
	g‹ig_cmdlöe
;

94 
EXP_ST
 
u32
 
	gexec_tmout
 = 
EXEC_TIMEOUT
;

95 
EXP_ST
 
u64
 
	gmem_limô
 = 
MEM_LIMIT
;

97 
u32
 
	g°©s_upd©e_‰eq
 = 1;

99 
EXP_ST
 
u8
 
	gskù_dëîmöi°ic
,

100 
	gf‹˚_dëîmöi°ic
,

101 
	gu£_•licög
,

102 
	gdumb_mode
,

103 
	gsc‹e_ch™ged
,

104 
	gkûl_sig«l
,

105 
	gªsumög_fuzz
,

106 
	gtimeout_giví
,

107 
	gnŸ_⁄_ây
,

108 
	gãrm_too_smÆl
,

109 
	gu£s_aßn
,

110 
	gno_f‹k£rvî
,

111 
	g¸ash_mode
,

112 
	gö_∂a˚_ªsume
,

113 
	gauto_ch™ged
,

114 
	gno_˝u_mëî_ªd
,

115 
	gno_v¨_check
,

116 
	gshufÊe_queue
,

117 
	gbôm≠_ch™ged
 = 1,

118 
	gqemu_mode
,

119 
	gskù_ªque°ed
,

120 
	grun_ovî10m
;

122 
s32
 
	gout_fd
,

123 
	gdev_uøndom_fd
 = -1,

124 
	gdev_nuŒ_fd
 = -1,

125 
	gf§v_˘l_fd
,

126 
	gf§v_°_fd
;

128 
s32
 
	gf‹k§v_pid
,

129 
	gchûd_pid
 = -1,

130 
	gout_dú_fd
 = -1;

132 
EXP_ST
 
u8
* 
	gåa˚_bôs
;

134 
EXP_ST
 
u8
 
	gvúgö_bôs
[
MAP_SIZE
],

135 
	gvúgö_h™g
[
MAP_SIZE
],

136 
	gvúgö_¸ash
[
MAP_SIZE
];

138 
s32
 
	gshm_id
;

140 vﬁ©ûê
u8
 
	g°›_so⁄
,

141 
	g˛ór_s¸ìn
 = 1,

142 
	gchûd_timed_out
;

144 
EXP_ST
 
u32
 
	gqueued_∑ths
,

145 
	gqueued_v¨übÀ
,

146 
	gqueued_©_°¨t
,

147 
	gqueued_discovîed
,

148 
	gqueued_imp‹ãd
,

149 
	gqueued_Áv‹ed
,

150 
	gqueued_wôh_cov
,

151 
	g≥ndög_nŸ_fuzzed
,

152 
	g≥ndög_Áv‹ed
,

153 
	gcur_skù≥d_∑ths
,

154 
	gcur_dïth
,

155 
	gmax_dïth
,

156 
	gu£Àss_©_°¨t
,

157 
	gcuºít_íåy
,

158 
	ghavoc_div
 = 1;

160 
EXP_ST
 
u64
 
	gtŸÆ_¸ashes
,

161 
	gunique_¸ashes
,

162 
	gtŸÆ_h™gs
,

163 
	gunique_h™gs
,

164 
	gtŸÆ_execs
,

165 
	g°¨t_time
,

166 
	gœ°_∑th_time
,

167 
	gœ°_¸ash_time
,

168 
	gœ°_h™g_time
,

169 
	gqueue_cy˛e
,

170 
	gcy˛es_wo_föds
,

171 
	gåim_execs
,

172 
	gbyãs_åim_ö
,

173 
	gbyãs_åim_out
,

174 
	gblocks_eff_tŸÆ
,

175 
	gblocks_eff_£À˘
;

177 
u32
 
	gsub£q_h™gs
;

179 
u8
 *
	g°age_«me
 = "init",

180 *
	g°age_sh‹t
,

181 *
	gsyncög_∑πy
;

183 
s32
 
	g°age_cur
, 
	g°age_max
;

184 
s32
 
	g•licög_wôh
 = -1;

186 
u32
 
	gsyncög_ˇ£
;

188 
s32
 
	g°age_cur_byã
,

189 
	g°age_cur_vÆ
;

191 
u8
 
	g°age_vÆ_ty≥
;

193 
u64
 
	g°age_föds
[32],

194 
	g°age_cy˛es
[32];

196 
u32
 
	gønd_˙t
;

198 
u64
 
	gtŸÆ_ˇl_us
,

199 
	gtŸÆ_ˇl_cy˛es
;

201 
u64
 
	gtŸÆ_bôm≠_size
,

202 
	gtŸÆ_bôm≠_íåõs
;

204 
s32
 
	g˝u_c‹e_cou¡
;

206 #ifde‡
HAVE_AFFINITY


208 
s32
 
	g˝u_aff
 = -1;

212 
FILE
* 
	g∂Ÿ_fûe
;

214 
	squeue_íåy
 {

216 
u8
* 
	m‚ame
;

217 
u32
 
	mÀn
;

219 
u8
 
	mˇl_Áûed
,

220 
	måim_d⁄e
,

221 
	mwas_fuzzed
,

222 
	m∑s£d_dë
,

223 
	mhas_√w_cov
,

224 
	mv¨_behavi‹
,

225 
	mÁv‹ed
,

226 
	mfs_ªdund™t
;

228 
u32
 
	mbôm≠_size
,

229 
	mexec_cksum
;

231 
u64
 
	mexec_us
,

232 
	mh™diˇp
,

233 
	mdïth
;

235 
u8
* 
	måa˚_möi
;

236 
u32
 
	mtc_ªf
;

238 
queue_íåy
 *
	m√xt
,

239 *
	m√xt_100
;

243 
queue_íåy
 *
	gqueue
,

244 *
	gqueue_cur
,

245 *
	gqueue_t›
,

246 *
	gq_¥ev100
;

248 
queue_íåy
*

249 
	gt›_øãd
[
MAP_SIZE
];

251 
	sexåa_d©a
 {

252 
u8
* 
	md©a
;

253 
u32
 
	mÀn
;

254 
u32
 
	mhô_˙t
;

257 
exåa_d©a
* 
	gexåas
;

258 
u32
 
	gexåas_˙t
;

260 
exåa_d©a
* 
	ga_exåas
;

261 
u32
 
	ga_exåas_˙t
;

263 
	gu8
* (*
	gpo°_h™dÀr
)(
u8
* 
	gbuf
, 
u32
* 
	gÀn
);

267 
s8
 
	göãª°ög_8
[] = { 
INTERESTING_8
 };

268 
s16
 
	göãª°ög_16
[] = { 
INTERESTING_8
, 
INTERESTING_16
 };

269 
s32
 
	göãª°ög_32
[] = { 
INTERESTING_8
, 
INTERESTING_16
, 
INTERESTING_32
 };

274  
	mSTAGE_FLIP1
,

275  
	mSTAGE_FLIP2
,

276  
	mSTAGE_FLIP4
,

277  
	mSTAGE_FLIP8
,

278  
	mSTAGE_FLIP16
,

279  
	mSTAGE_FLIP32
,

280  
	mSTAGE_ARITH8
,

281  
	mSTAGE_ARITH16
,

282  
	mSTAGE_ARITH32
,

283  
	mSTAGE_INTEREST8
,

284  
	mSTAGE_INTEREST16
,

285  
	mSTAGE_INTEREST32
,

286  
	mSTAGE_EXTRAS_UO
,

287  
	mSTAGE_EXTRAS_UI
,

288  
	mSTAGE_EXTRAS_AO
,

289  
	mSTAGE_HAVOC
,

290  
	mSTAGE_SPLICE


296  
	mSTAGE_VAL_NONE
,

297  
	mSTAGE_VAL_LE
,

298  
	mSTAGE_VAL_BE


304  
	mFAULT_NONE
,

305  
	mFAULT_HANG
,

306  
	mFAULT_CRASH
,

307  
	mFAULT_ERROR
,

308  
	mFAULT_NOINST
,

309  
	mFAULT_NOBITS


315 
u64
 
	$gë_cur_time
() {

317 
timevÆ
 
tv
;

318 
timez⁄e
 
tz
;

320 
	`gëtimeofday
(&
tv
, &
tz
);

322  (
tv
.
tv_£c
 * 1000ULLË+ (tv.
tv_u£c
 / 1000);

324 
	}
}

329 
u64
 
	$gë_cur_time_us
() {

331 
timevÆ
 
tv
;

332 
timez⁄e
 
tz
;

334 
	`gëtimeofday
(&
tv
, &
tz
);

336  (
tv
.
tv_£c
 * 1000000ULLË+Åv.
tv_u£c
;

338 
	}
}

344 
ölöe
 
u32
 
	$UR
(
u32
 
limô
) {

346 i‡(
	`u∆ikñy
(!
ønd_˙t
--)) {

348 
u32
 
£ed
[2];

350 
	`ck_ªad
(
dev_uøndom_fd
, &
£ed
, (seed), "/dev/urandom");

352 
	`§™dom
(
£ed
[0]);

353 
ønd_˙t
 = (
RESEED_RNG
 / 2Ë+ (
£ed
[1] % RESEED_RNG);

357  
	`øndom
(Ë% 
limô
;

359 
	}
}

364 
	$shufÊe_±rs
(** 
±rs
, 
u32
 
˙t
) {

366 
u32
 
i
;

368 
i
 = 0; i < 
˙t
 - 2; i++) {

370 
u32
 
j
 = 
i
 + 
	`UR
(
˙t
 - i);

371 *
s
 = 
±rs
[
i
];

372 
±rs
[
i
] =Öås[
j
];

373 
±rs
[
j
] = 
s
;

377 
	}
}

380 #ifde‡
HAVE_AFFINITY


385 
	$böd_to_‰ì_˝u
() {

387 
DIR
* 
d
;

388 
dúít
* 
de
;

389 
˝u_£t_t
 
c
;

391 
u8
 
˝u_u£d
[4096] = { 0 };

392 
u32
 
i
;

394 i‡(!
˝u_c‹e_cou¡
) ;

396 i‡(
	`gëív
("AFL_NO_AFFINITY")) {

398 
	`WARNF
("Not bindingÅoá CPU core (AFL_NO_AFFINITY set).");

403 
d
 = 
	`›ídú
("/proc");

405 i‡(!
d
) {

407 
	`WARNF
("UnableÅoáccess /proc - can't scan for free CPU cores.");

412 
	`ACTF
("Checking CPU coreÜoadout...");

417 
	`u¶ìp
(
	`R
(1000) * 250);

424 (
de
 = 
	`ªaddú
(
d
))) {

426 
u8
* 
‚
;

427 
FILE
* 
f
;

428 
u8
 
tmp
[
MAX_LINE
];

429 
u8
 
has_vmsize
 = 0;

431 i‡(!
	`isdigô
(
de
->
d_«me
[0])) ;

433 
‚
 = 
	`Æloc_¥ötf
("/¥oc/%s/°©us", 
de
->
d_«me
);

435 i‡(!(
f
 = 
	`f›í
(
‚
, "r"))) {

436 
	`ck_‰ì
(
‚
);

440 
	`fgës
(
tmp
, 
MAX_LINE
, 
f
)) {

442 
u32
 
hvÆ
;

446 i‡(!
	`°∫cmp
(
tmp
, "VmSize:\t", 8)Ë
has_vmsize
 = 1;

448 i‡(!
	`°∫cmp
(
tmp
, "Cpus_allowed_list:\t", 19) &&

449 !
	`°rchr
(
tmp
, '-') && !strchr(tmp, ',') &&

450 
	`ssˇnf
(
tmp
 + 19, "%u", &
hvÆ
Ë=1 && hvÆ < (
˝u_u£d
) &&

451 
has_vmsize
) {

453 
˝u_u£d
[
hvÆ
] = 1;

460 
	`ck_‰ì
(
‚
);

461 
	`f˛o£
(
f
);

465 
	`˛o£dú
(
d
);

467 
i
 = 0; i < 
˝u_c‹e_cou¡
; i++Ëi‡(!
˝u_u£d
[i]) ;

469 i‡(
i
 =
˝u_c‹e_cou¡
) {

471 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


476 
˝u_c‹e_cou¡
);

478 
	`FATAL
("No more free CPU cores");

482 
	`OKF
("Foundá fªêCPU c‹e, bödögÅÿ#%u.", 
i
);

484 
˝u_aff
 = 
i
;

486 
	`CPU_ZERO
(&
c
);

487 
	`CPU_SET
(
i
, &
c
);

489 i‡(
	`sched_£èfföôy
(0, (
c
), &c))

490 
	`PFATAL
("sched_setaffinity failed");

492 
	}
}

496 #i‚de‡
IGNORE_FINDS


501 
	$loˇã_diffs
(
u8
* 
±r1
, u8* 
±r2
, 
u32
 
Àn
, 
s32
* 
fú°
, s32* 
œ°
) {

503 
s32
 
f_loc
 = -1;

504 
s32
 
l_loc
 = -1;

505 
u32
 
pos
;

507 
pos
 = 0;Öo†< 
Àn
;Öos++) {

509 i‡(*(
±r1
++Ë!*(
±r2
++)) {

511 i‡(
f_loc
 =-1Ëf_lo¯
pos
;

512 
l_loc
 = 
pos
;

518 *
fú°
 = 
f_loc
;

519 *
œ°
 = 
l_loc
;

523 
	}
}

532 
u8
* 
	$DI
(
u64
 
vÆ
) {

534 
u8
 
tmp
[12][16];

535 
u8
 
cur
;

537 
cur
 = (cur + 1) % 12;

539 
	#CHK_FORMAT
(
_divis‹
, 
_limô_mu…
, 
_fmt
, 
_ˇ°
) do { \

540 i‡(
vÆ
 < (
_divis‹
Ë* (
_limô_mu…
)) { \

541 
	`•rötf
(
tmp
[
cur
], 
_fmt
, ((
_ˇ°
)
vÆ
Ë/ (
_divis‹
)); \

542  
tmp
[
cur
]; \

544 } 0)

	)

547 
	`CHK_FORMAT
(1, 10000, "%Œu", 
u64
);

550 
	`CHK_FORMAT
(1000, 99.95, "%0.01fk", );

553 
	`CHK_FORMAT
(1000, 1000, "%Œuk", 
u64
);

556 
	`CHK_FORMAT
(1000 * 1000, 9.995, "%0.02fM", );

559 
	`CHK_FORMAT
(1000 * 1000, 99.95, "%0.01fM", );

562 
	`CHK_FORMAT
(1000 * 1000, 1000, "%ŒuM", 
u64
);

565 
	`CHK_FORMAT
(1000LL * 1000 * 1000, 9.995, "%0.02fG", );

568 
	`CHK_FORMAT
(1000LL * 1000 * 1000, 99.95, "%0.01fG", );

571 
	`CHK_FORMAT
(1000LL * 1000 * 1000, 1000, "%ŒuG", 
u64
);

574 
	`CHK_FORMAT
(1000LL * 1000 * 1000 * 1000, 9.995, "%0.02fT", );

577 
	`CHK_FORMAT
(1000LL * 1000 * 1000 * 1000, 99.95, "%0.01fT", );

580 
	`°r˝y
(
tmp
[
cur
], "infty");

581  
tmp
[
cur
];

583 
	}
}

589 
u8
* 
	$DF
(
vÆ
) {

591 
u8
 
tmp
[16];

593 i‡(
vÆ
 < 99.995) {

594 
	`•rötf
(
tmp
, "%0.02f", 
vÆ
);

595  
tmp
;

598 i‡(
vÆ
 < 999.95) {

599 
	`•rötf
(
tmp
, "%0.01f", 
vÆ
);

600  
tmp
;

603  
	`DI
((
u64
)
vÆ
);

605 
	}
}

610 
u8
* 
	$DMS
(
u64
 
vÆ
) {

612 
u8
 
tmp
[12][16];

613 
u8
 
cur
;

615 
cur
 = (cur + 1) % 12;

618 
	`CHK_FORMAT
(1, 10000, "%Œu B", 
u64
);

621 
	`CHK_FORMAT
(1024, 99.95, "%0.01f kB", );

624 
	`CHK_FORMAT
(1024, 1000, "%Œu kB", 
u64
);

627 
	`CHK_FORMAT
(1024 * 1024, 9.995, "%0.02f MB", );

630 
	`CHK_FORMAT
(1024 * 1024, 99.95, "%0.01f MB", );

633 
	`CHK_FORMAT
(1024 * 1024, 1000, "%Œu MB", 
u64
);

636 
	`CHK_FORMAT
(1024LL * 1024 * 1024, 9.995, "%0.02f GB", );

639 
	`CHK_FORMAT
(1024LL * 1024 * 1024, 99.95, "%0.01f GB", );

642 
	`CHK_FORMAT
(1024LL * 1024 * 1024, 1000, "%Œu GB", 
u64
);

645 
	`CHK_FORMAT
(1024LL * 1024 * 1024 * 1024, 9.995, "%0.02f TB", );

648 
	`CHK_FORMAT
(1024LL * 1024 * 1024 * 1024, 99.95, "%0.01f TB", );

650 #unde‡
CHK_FORMAT


653 
	`°r˝y
(
tmp
[
cur
], "infty");

654  
tmp
[
cur
];

656 
	}
}

661 
u8
* 
	$DTD
(
u64
 
cur_ms
, u64 
evít_ms
) {

663 
u8
 
tmp
[64];

664 
u64
 
dñè
;

665 
s32
 
t_d
, 
t_h
, 
t_m
, 
t_s
;

667 i‡(!
evít_ms
)  "none seen yet";

669 
dñè
 = 
cur_ms
 - 
evít_ms
;

671 
t_d
 = 
dñè
 / 1000 / 60 / 60 / 24;

672 
t_h
 = (
dñè
 / 1000 / 60 / 60) % 24;

673 
t_m
 = (
dñè
 / 1000 / 60) % 60;

674 
t_s
 = (
dñè
 / 1000) % 60;

676 
	`•rötf
(
tmp
, "%†days, %u hrs, %u mö, %u sec", 
	`DI
(
t_d
), 
t_h
, 
t_m
, 
t_s
);

677  
tmp
;

679 
	}
}

686 
	$m¨k_as_dë_d⁄e
(
queue_íåy
* 
q
) {

688 
u8
* 
‚
 = 
	`°ºchr
(
q
->
‚ame
, '/');

689 
s32
 
fd
;

691 
‚
 = 
	`Æloc_¥ötf
("%s/queue/.°©e/dëîmöi°ic_d⁄e/%s", 
out_dú
, fn + 1);

693 
fd
 = 
	`›í
(
‚
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

694 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
‚
);

695 
	`˛o£
(
fd
);

697 
	`ck_‰ì
(
‚
);

699 
q
->
∑s£d_dë
 = 1;

701 
	}
}

707 
	$m¨k_as_v¨übÀ
(
queue_íåy
* 
q
) {

709 
u8
 *
‚
 = 
	`°ºchr
(
q
->
‚ame
, '/'Ë+ 1, *
lde°
;

711 
lde°
 = 
	`Æloc_¥ötf
("../../%s", 
‚
);

712 
‚
 = 
	`Æloc_¥ötf
("%s/queue/.°©e/v¨übÀ_behavi‹/%s", 
out_dú
, fn);

714 i‡(
	`symlök
(
lde°
, 
‚
)) {

716 
s32
 
fd
 = 
	`›í
(
‚
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

717 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
‚
);

718 
	`˛o£
(
fd
);

722 
	`ck_‰ì
(
lde°
);

723 
	`ck_‰ì
(
‚
);

725 
q
->
v¨_behavi‹
 = 1;

727 
	}
}

733 
	$m¨k_as_ªdund™t
(
queue_íåy
* 
q
, 
u8
 
°©e
) {

735 
u8
* 
‚
;

736 
s32
 
fd
;

738 i‡(
°©e
 =
q
->
fs_ªdund™t
) ;

740 
q
->
fs_ªdund™t
 = 
°©e
;

742 
‚
 = 
	`°ºchr
(
q
->
‚ame
, '/');

743 
‚
 = 
	`Æloc_¥ötf
("%s/queue/.°©e/ªdund™t_edges/%s", 
out_dú
, fn + 1);

745 i‡(
°©e
) {

747 
fd
 = 
	`›í
(
‚
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

748 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
‚
);

749 
	`˛o£
(
fd
);

753 i‡(
	`u∆ök
(
‚
)Ë
	`PFATAL
("UnableÅoÑemove '%s'", fn);

757 
	`ck_‰ì
(
‚
);

759 
	}
}

764 
	$add_to_queue
(
u8
* 
‚ame
, 
u32
 
Àn
, u8 
∑s£d_dë
) {

766 
queue_íåy
* 
q
 = 
	`ck_Æloc
((queue_entry));

768 
q
->
‚ame
 = fname;

769 
q
->
Àn
 =Üen;

770 
q
->
dïth
 = 
cur_dïth
 + 1;

771 
q
->
∑s£d_dë
 =Öassed_det;

773 i‡(
q
->
dïth
 > 
max_dïth
) max_depth = q->depth;

775 i‡(
queue_t›
) {

777 
queue_t›
->
√xt
 = 
q
;

778 
queue_t›
 = 
q
;

780 } 
q_¥ev100
 = 
queue
 = 
queue_t›
 = 
q
;

782 
queued_∑ths
++;

783 
≥ndög_nŸ_fuzzed
++;

785 
cy˛es_wo_föds
 = 0;

787 i‡(!(
queued_∑ths
 % 100)) {

789 
q_¥ev100
->
√xt_100
 = 
q
;

790 
q_¥ev100
 = 
q
;

794 
œ°_∑th_time
 = 
	`gë_cur_time
();

796 
	}
}

801 
EXP_ST
 
	$de°roy_queue
() {

803 
queue_íåy
 *
q
 = 
queue
, *
n
;

805 
q
) {

807 
n
 = 
q
->
√xt
;

808 
	`ck_‰ì
(
q
->
‚ame
);

809 
	`ck_‰ì
(
q
->
åa˚_möi
);

810 
	`ck_‰ì
(
q
);

811 
q
 = 
n
;

815 
	}
}

822 
EXP_ST
 
	$wrôe_bôm≠
() {

824 
u8
* 
‚ame
;

825 
s32
 
fd
;

827 i‡(!
bôm≠_ch™ged
) ;

828 
bôm≠_ch™ged
 = 0;

830 
‚ame
 = 
	`Æloc_¥ötf
("%s/fuzz_bôm≠", 
out_dú
);

831 
fd
 = 
	`›í
(
‚ame
, 
O_WRONLY
 | 
O_CREAT
 | 
O_TRUNC
, 0600);

833 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
‚ame
);

835 
	`ck_wrôe
(
fd
, 
vúgö_bôs
, 
MAP_SIZE
, 
‚ame
);

837 
	`˛o£
(
fd
);

838 
	`ck_‰ì
(
‚ame
);

840 
	}
}

845 
EXP_ST
 
	$ªad_bôm≠
(
u8
* 
‚ame
) {

847 
s32
 
fd
 = 
	`›í
(
‚ame
, 
O_RDONLY
);

849 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
‚ame
);

851 
	`ck_ªad
(
fd
, 
vúgö_bôs
, 
MAP_SIZE
, 
‚ame
);

853 
	`˛o£
(
fd
);

855 
	}
}

866 
ölöe
 
u8
 
	$has_√w_bôs
(
u8
* 
vúgö_m≠
) {

868 #ifde‡
__x86_64__


870 
u64
* 
cuºít
 = (u64*)
åa˚_bôs
;

871 
u64
* 
vúgö
 = (u64*)
vúgö_m≠
;

873 
u32
 
i
 = (
MAP_SIZE
 >> 3);

877 
u32
* 
cuºít
 = (u32*)
åa˚_bôs
;

878 
u32
* 
vúgö
 = (u32*)
vúgö_m≠
;

880 
u32
 
i
 = (
MAP_SIZE
 >> 2);

884 
u8
 
ªt
 = 0;

886 
i
--) {

892 i‡(
	`u∆ikñy
(*
cuºít
Ë&& u∆ikñy(*cuºíà& *
vúgö
)) {

894 i‡(
	`likñy
(
ªt
 < 2)) {

896 
u8
* 
cur
 = (u8*)
cuºít
;

897 
u8
* 
vú
 = (u8*)
vúgö
;

902 #ifde‡
__x86_64__


904 i‡((
cur
[0] && 
vú
[0] == 0xff) || (cur[1] && vir[1] == 0xff) ||

905 (
cur
[2] && 
vú
[2] == 0xff) || (cur[3] && vir[3] == 0xff) ||

906 (
cur
[4] && 
vú
[4] == 0xff) || (cur[5] && vir[5] == 0xff) ||

907 (
cur
[6] && 
vú
[6] =0xffË|| (cur[7] && vú[7] =0xff)Ë
ªt
 = 2;

908 
ªt
 = 1;

912 i‡((
cur
[0] && 
vú
[0] == 0xff) || (cur[1] && vir[1] == 0xff) ||

913 (
cur
[2] && 
vú
[2] =0xffË|| (cur[3] && vú[3] =0xff)Ë
ªt
 = 2;

914 
ªt
 = 1;

920 *
vúgö
 &~*
cuºít
;

924 
cuºít
++;

925 
vúgö
++;

929 i‡(
ªt
 && 
vúgö_m≠
 =
vúgö_bôs
Ë
bôm≠_ch™ged
 = 1;

931  
ªt
;

933 
	}
}

939 
u32
 
	$cou¡_bôs
(
u8
* 
mem
) {

941 
u32
* 
±r
 = (u32*)
mem
;

942 
u32
 
i
 = (
MAP_SIZE
 >> 2);

943 
u32
 
ªt
 = 0;

945 
i
--) {

947 
u32
 
v
 = *(
±r
++);

952 i‡(
v
 == 0xffffffff) {

953 
ªt
 += 32;

957 
v
 -= ((v >> 1) & 0x55555555);

958 
v
 = (v & 0x33333333) + ((v >> 2) & 0x33333333);

959 
ªt
 +(((
v
 + (v >> 4)) & 0xF0F0F0F) * 0x01010101) >> 24;

963  
ªt
;

965 
	}
}

968 
	#FF
(
_b
Ë(0xf‡<< ((_bË<< 3))

	)

974 
u32
 
	$cou¡_byãs
(
u8
* 
mem
) {

976 
u32
* 
±r
 = (u32*)
mem
;

977 
u32
 
i
 = (
MAP_SIZE
 >> 2);

978 
u32
 
ªt
 = 0;

980 
i
--) {

982 
u32
 
v
 = *(
±r
++);

984 i‡(!
v
) ;

985 i‡(
v
 & 
	`FF
(0)Ë
ªt
++;

986 i‡(
v
 & 
	`FF
(1)Ë
ªt
++;

987 i‡(
v
 & 
	`FF
(2)Ë
ªt
++;

988 i‡(
v
 & 
	`FF
(3)Ë
ªt
++;

992  
ªt
;

994 
	}
}

1000 
u32
 
	$cou¡_n⁄_255_byãs
(
u8
* 
mem
) {

1002 
u32
* 
±r
 = (u32*)
mem
;

1003 
u32
 
i
 = (
MAP_SIZE
 >> 2);

1004 
u32
 
ªt
 = 0;

1006 
i
--) {

1008 
u32
 
v
 = *(
±r
++);

1013 i‡(
v
 == 0xffffffff) ;

1014 i‡((
v
 & 
	`FF
(0)Ë!FF(0)Ë
ªt
++;

1015 i‡((
v
 & 
	`FF
(1)Ë!FF(1)Ë
ªt
++;

1016 i‡((
v
 & 
	`FF
(2)Ë!FF(2)Ë
ªt
++;

1017 i‡((
v
 & 
	`FF
(3)Ë!FF(3)Ë
ªt
++;

1021  
ªt
;

1023 
	}
}

1031 c⁄° 
u8
 
	gsim∂ify_lookup
[256] = {

1038 #ifde‡
__x86_64__


1040 
	$sim∂ify_åa˚
(
u64
* 
mem
) {

1042 
u32
 
i
 = 
MAP_SIZE
 >> 3;

1044 
i
--) {

1048 i‡(
	`u∆ikñy
(*
mem
)) {

1050 
u8
* 
mem8
 = (u8*)
mem
;

1052 
mem8
[0] = 
sim∂ify_lookup
[mem8[0]];

1053 
mem8
[1] = 
sim∂ify_lookup
[mem8[1]];

1054 
mem8
[2] = 
sim∂ify_lookup
[mem8[2]];

1055 
mem8
[3] = 
sim∂ify_lookup
[mem8[3]];

1056 
mem8
[4] = 
sim∂ify_lookup
[mem8[4]];

1057 
mem8
[5] = 
sim∂ify_lookup
[mem8[5]];

1058 
mem8
[6] = 
sim∂ify_lookup
[mem8[6]];

1059 
mem8
[7] = 
sim∂ify_lookup
[mem8[7]];

1061 } *
mem
 = 0x0101010101010101ULL;

1063 
mem
++;

1067 
	}
}

1071 
	$sim∂ify_åa˚
(
u32
* 
mem
) {

1073 
u32
 
i
 = 
MAP_SIZE
 >> 2;

1075 
i
--) {

1079 i‡(
	`u∆ikñy
(*
mem
)) {

1081 
u8
* 
mem8
 = (u8*)
mem
;

1083 
mem8
[0] = 
sim∂ify_lookup
[mem8[0]];

1084 
mem8
[1] = 
sim∂ify_lookup
[mem8[1]];

1085 
mem8
[2] = 
sim∂ify_lookup
[mem8[2]];

1086 
mem8
[3] = 
sim∂ify_lookup
[mem8[3]];

1088 } *
mem
 = 0x01010101;

1090 
mem
++;

1093 
	}
}

1102 c⁄° 
u8
 
	gcou¡_˛ass_lookup8
[256] = {

1116 
u16
 
	gcou¡_˛ass_lookup16
[65536];

1119 
	$öô_cou¡_˛ass16
() {

1121 
u32
 
b1
, 
b2
;

1123 
b1
 = 0; b1 < 256; b1++)

1124 
b2
 = 0; b2 < 256; b2++)

1125 
cou¡_˛ass_lookup16
[(
b1
 << 8Ë+ 
b2
] =

1126 (
cou¡_˛ass_lookup8
[
b1
] << 8) |

1127 
cou¡_˛ass_lookup8
[
b2
];

1129 
	}
}

1132 #ifde‡
__x86_64__


1134 
ölöe
 
	$˛assify_cou¡s
(
u64
* 
mem
) {

1136 
u32
 
i
 = 
MAP_SIZE
 >> 3;

1138 
i
--) {

1142 i‡(
	`u∆ikñy
(*
mem
)) {

1144 
u16
* 
mem16
 = (u16*)
mem
;

1146 
mem16
[0] = 
cou¡_˛ass_lookup16
[mem16[0]];

1147 
mem16
[1] = 
cou¡_˛ass_lookup16
[mem16[1]];

1148 
mem16
[2] = 
cou¡_˛ass_lookup16
[mem16[2]];

1149 
mem16
[3] = 
cou¡_˛ass_lookup16
[mem16[3]];

1153 
mem
++;

1157 
	}
}

1161 
ölöe
 
	$˛assify_cou¡s
(
u32
* 
mem
) {

1163 
u32
 
i
 = 
MAP_SIZE
 >> 2;

1165 
i
--) {

1169 i‡(
	`u∆ikñy
(*
mem
)) {

1171 
u16
* 
mem16
 = (u16*)
mem
;

1173 
mem16
[0] = 
cou¡_˛ass_lookup16
[mem16[0]];

1174 
mem16
[1] = 
cou¡_˛ass_lookup16
[mem16[1]];

1178 
mem
++;

1182 
	}
}

1189 
	$ªmove_shm
() {

1191 
	`shm˘l
(
shm_id
, 
IPC_RMID
, 
NULL
);

1193 
	}
}

1200 
	$möimize_bôs
(
u8
* 
d°
, u8* 
§c
) {

1202 
u32
 
i
 = 0;

1204 
i
 < 
MAP_SIZE
) {

1206 i‡(*(
§c
++)Ë
d°
[
i
 >> 3] |= 1 << (i & 7);

1207 
i
++;

1211 
	}
}

1224 
	$upd©e_bôm≠_sc‹e
(
queue_íåy
* 
q
) {

1226 
u32
 
i
;

1227 
u64
 
Áv_Á˘‹
 = 
q
->
exec_us
 * q->
Àn
;

1232 
i
 = 0; i < 
MAP_SIZE
; i++)

1234 i‡(
åa˚_bôs
[
i
]) {

1236 i‡(
t›_øãd
[
i
]) {

1240 i‡(
Áv_Á˘‹
 > 
t›_øãd
[
i
]->
exec_us
 *Å›_øãd[i]->
Àn
) ;

1245 i‡(!--
t›_øãd
[
i
]->
tc_ªf
) {

1246 
	`ck_‰ì
(
t›_øãd
[
i
]->
åa˚_möi
);

1247 
t›_øãd
[
i
]->
åa˚_möi
 = 0;

1254 
t›_øãd
[
i
] = 
q
;

1255 
q
->
tc_ªf
++;

1257 i‡(!
q
->
åa˚_möi
) {

1258 
q
->
åa˚_möi
 = 
	`ck_Æloc
(
MAP_SIZE
 >> 3);

1259 
	`möimize_bôs
(
q
->
åa˚_möi
, 
åa˚_bôs
);

1262 
sc‹e_ch™ged
 = 1;

1266 
	}
}

1275 
	$cuŒ_queue
() {

1277 
queue_íåy
* 
q
;

1278 
u8
 
ãmp_v
[
MAP_SIZE
 >> 3];

1279 
u32
 
i
;

1281 i‡(
dumb_mode
 || !
sc‹e_ch™ged
) ;

1283 
sc‹e_ch™ged
 = 0;

1285 
	`mem£t
(
ãmp_v
, 255, 
MAP_SIZE
 >> 3);

1287 
queued_Áv‹ed
 = 0;

1288 
≥ndög_Áv‹ed
 = 0;

1290 
q
 = 
queue
;

1292 
q
) {

1293 
q
->
Áv‹ed
 = 0;

1294 
q
 = q->
√xt
;

1300 
i
 = 0; i < 
MAP_SIZE
; i++)

1301 i‡(
t›_øãd
[
i
] && (
ãmp_v
[i >> 3] & (1 << (i & 7)))) {

1303 
u32
 
j
 = 
MAP_SIZE
 >> 3;

1307 
j
--)

1308 i‡(
t›_øãd
[
i
]->
åa˚_möi
[
j
])

1309 
ãmp_v
[
j
] &~
t›_øãd
[
i
]->
åa˚_möi
[j];

1311 
t›_øãd
[
i
]->
Áv‹ed
 = 1;

1312 
queued_Áv‹ed
++;

1314 i‡(!
t›_øãd
[
i
]->
was_fuzzed
Ë
≥ndög_Áv‹ed
++;

1318 
q
 = 
queue
;

1320 
q
) {

1321 
	`m¨k_as_ªdund™t
(
q
, !q->
Áv‹ed
);

1322 
q
 = q->
√xt
;

1325 
	}
}

1330 
EXP_ST
 
	$£tup_shm
() {

1332 
u8
* 
shm_°r
;

1334 i‡(!
ö_bôm≠
Ë
	`mem£t
(
vúgö_bôs
, 255, 
MAP_SIZE
);

1336 
	`mem£t
(
vúgö_h™g
, 255, 
MAP_SIZE
);

1337 
	`mem£t
(
vúgö_¸ash
, 255, 
MAP_SIZE
);

1339 
shm_id
 = 
	`shmgë
(
IPC_PRIVATE
, 
MAP_SIZE
, 
IPC_CREAT
 | 
IPC_EXCL
 | 0600);

1341 i‡(
shm_id
 < 0Ë
	`PFATAL
("shmget() failed");

1343 
	`©exô
(
ªmove_shm
);

1345 
shm_°r
 = 
	`Æloc_¥ötf
("%d", 
shm_id
);

1352 i‡(!
dumb_mode
Ë
	`£ãnv
(
SHM_ENV_VAR
, 
shm_°r
, 1);

1354 
	`ck_‰ì
(
shm_°r
);

1356 
åa˚_bôs
 = 
	`shm©
(
shm_id
, 
NULL
, 0);

1358 i‡(!
åa˚_bôs
Ë
	`PFATAL
("shmat() failed");

1360 
	}
}

1365 
	$£tup_po°
() {

1367 * 
dh
;

1368 
u8
* 
‚
 = 
	`gëív
("AFL_POST_LIBRARY");

1369 
u32
 
éí
 = 6;

1371 i‡(!
‚
) ;

1373 
	`ACTF
("LﬂdögÖo°¥o˚ss‹ from '%s'...", 
‚
);

1375 
dh
 = 
	`dl›í
(
‚
, 
RTLD_NOW
);

1376 i‡(!
dh
Ë
	`FATAL
("%s", 
	`dÀº‹
());

1378 
po°_h™dÀr
 = 
	`dlsym
(
dh
, "afl_postprocess");

1379 i‡(!
po°_h™dÀr
Ë
	`FATAL
("Symbol 'afl_postprocess'Çot found.");

1383 
	`po°_h™dÀr
("hñlo", &
éí
);

1385 
	`OKF
("Postprocessor installed successfully.");

1387 
	}
}

1393 
	$ªad_ã°ˇ£s
() {

1395 
dúít
 **
∆
;

1396 
s32
 
∆_˙t
;

1397 
u32
 
i
;

1398 
u8
* 
‚
;

1402 
‚
 = 
	`Æloc_¥ötf
("%s/queue", 
ö_dú
);

1403 i‡(!
	`ac˚ss
(
‚
, 
F_OK
)Ë
ö_dú
 = fn; 
	`ck_‰ì
(fn);

1405 
	`ACTF
("Sˇ¬ög '%s'...", 
ö_dú
);

1411 
∆_˙t
 = 
	`sˇndú
(
ö_dú
, &
∆
, 
NULL
, 
Æphas‹t
);

1413 i‡(
∆_˙t
 < 0) {

1415 i‡(
î∫o
 =
ENOENT
 ||Éºnÿ=
ENOTDIR
)

1417 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


1423 
	`PFATAL
("U«bÀÅÿ›í '%s'", 
ö_dú
);

1427 i‡(
shufÊe_queue
 && 
∆_˙t
 > 1) {

1429 
	`ACTF
("Shuffling queue...");

1430 
	`shufÊe_±rs
((**)
∆
, 
∆_˙t
);

1434 
i
 = 0; i < 
∆_˙t
; i++) {

1436 
°©
 
°
;

1438 
u8
* 
‚
 = 
	`Æloc_¥ötf
("%s/%s", 
ö_dú
, 
∆
[
i
]->
d_«me
);

1439 
u8
* 
d‚
 = 
	`Æloc_¥ötf
("%s/.°©e/dëîmöi°ic_d⁄e/%s", 
ö_dú
, 
∆
[
i
]->
d_«me
);

1441 
u8
 
∑s£d_dë
 = 0;

1443 
	`‰ì
(
∆
[
i
]);

1445 i‡(
	`l°©
(
‚
, &
°
Ë|| 
	`ac˚ss
(‚, 
R_OK
))

1446 
	`PFATAL
("U«bÀÅÿac˚s†'%s'", 
‚
);

1450 i‡(!
	`S_ISREG
(
°
.
°_mode
Ë|| !°.
°_size
 || 
	`°r°r
(
‚
, "/README.txt")) {

1452 
	`ck_‰ì
(
‚
);

1453 
	`ck_‰ì
(
d‚
);

1458 i‡(
°
.
°_size
 > 
MAX_FILE
)

1459 
	`FATAL
("Te° ca£ '%s' i†toÿbig (%s,Üimô i†%s)", 
‚
,

1460 
	`DMS
(
°
.
°_size
), DMS(
MAX_FILE
));

1467 i‡(!
	`ac˚ss
(
d‚
, 
F_OK
)Ë
∑s£d_dë
 = 1;

1468 
	`ck_‰ì
(
d‚
);

1470 
	`add_to_queue
(
‚
, 
°
.
°_size
, 
∑s£d_dë
);

1474 
	`‰ì
(
∆
);

1476 i‡(!
queued_∑ths
) {

1478 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


1484 
	`FATAL
("NÿußbÀÅe° ca£†ö '%s'", 
ö_dú
);

1488 
œ°_∑th_time
 = 0;

1489 
queued_©_°¨t
 = 
queued_∑ths
;

1491 
	}
}

1496 
	$com∑ª_exåas_Àn
(c⁄° * 
p1
, c⁄° * 
p2
) {

1497 
exåa_d©a
 *
e1
 = (exåa_d©a*)
p1
,

1498 *
e2
 = (
exåa_d©a
*)
p2
;

1500  
e1
->
Àn
 - 
e2
->len;

1501 
	}
}

1503 
	$com∑ª_exåas_u£_d
(c⁄° * 
p1
, c⁄° * 
p2
) {

1504 
exåa_d©a
 *
e1
 = (exåa_d©a*)
p1
,

1505 *
e2
 = (
exåa_d©a
*)
p2
;

1507  
e2
->
hô_˙t
 - 
e1
->hit_cnt;

1508 
	}
}

1513 
	$lﬂd_exåas_fûe
(
u8
* 
‚ame
, 
u32
* 
mö_Àn
, u32* 
max_Àn
,

1514 
u32
 
di˘_Àvñ
) {

1516 
FILE
* 
f
;

1517 
u8
 
buf
[
MAX_LINE
];

1518 
u8
 *
Õå
;

1519 
u32
 
cur_löe
 = 0;

1521 
f
 = 
	`f›í
(
‚ame
, "r");

1523 i‡(!
f
Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
‚ame
);

1525 (
Õå
 = 
	`fgës
(
buf
, 
MAX_LINE
, 
f
))) {

1527 
u8
 *
Ωå
, *
w±r
;

1528 
u32
 
kÀn
 = 0;

1530 
cur_löe
++;

1534 
	`is•a˚
(*
Õå
))Üptr++;

1536 
Ωå
 = 
Õå
 + 
	`°æí
(lptr) - 1;

1537 
Ωå
 >
Õå
 && 
	`is•a˚
(*rptr))Ñptr--;

1538 
Ωå
++;

1539 *
Ωå
 = 0;

1543 i‡(!*
Õå
 || *lptr == '#') ;

1547 
Ωå
--;

1549 i‡(
Ωå
 < 
Õå
 || *rptr != '"')

1550 
	`FATAL
("MÆf‹medÇame=\"vÆue\"Öaú i¿löê%u.", 
cur_löe
);

1552 *
Ωå
 = 0;

1556 
	`iß um
(*
Õå
) || *lptr == '_')Üptr++;

1560 i‡(*
Õå
 == '@') {

1562 
Õå
++;

1563 i‡(
	`©oi
(
Õå
Ë> 
di˘_Àvñ
) ;

1564 
	`isdigô
(*
Õå
))Üptr++;

1570 
	`is•a˚
(*
Õå
) || *lptr == '=')Üptr++;

1574 i‡(*
Õå
 != '"')

1575 
	`FATAL
("MÆf‹medÇame=\"keyw‹d\"Öaú i¿löê%u.", 
cur_löe
);

1577 
Õå
++;

1579 i‡(!*
Õå
Ë
	`FATAL
("Em±y keyw‹d i¿löê%u.", 
cur_löe
);

1584 
exåas
 = 
	`ck_ªÆloc_block
”xåas, (
exåas_˙t
 + 1) *

1585 (
exåa_d©a
));

1587 
w±r
 = 
exåas
[
exåas_˙t
].
d©a
 = 
	`ck_Æloc
(
Ωå
 - 
Õå
);

1589 *
Õå
) {

1591 * 
hexdigôs
 = "0123456789abcdef";

1593 *
Õå
) {

1597 
	`FATAL
("N⁄-¥öèbÀ ch¨a˘î†öÜöê%u.", 
cur_löe
);

1601 
Õå
++;

1603 i‡(*
Õå
 == '\\' || *lptr == '"') {

1604 *(
w±r
++Ë*(
Õå
++);

1605 
kÀn
++;

1609 i‡(*
Õå
 !'x' || !
	`isxdigô
(lptr[1]) || !isxdigit(lptr[2]))

1610 
	`FATAL
("InvÆidÉsˇpög (nŸ \\xNNËöÜöê%u.", 
cur_löe
);

1612 *(
w±r
++) =

1613 ((
	`°rchr
(
hexdigôs
, 
	`tﬁowî
(
Õå
[1])) - hexdigits) << 4) |

1614 (
	`°rchr
(
hexdigôs
, 
	`tﬁowî
(
Õå
[2])) - hexdigits);

1616 
Õå
 += 3;

1617 
kÀn
++;

1623 *(
w±r
++Ë*(
Õå
++);

1624 
kÀn
++;

1630 
exåas
[
exåas_˙t
].
Àn
 = 
kÀn
;

1632 i‡(
exåas
[
exåas_˙t
].
Àn
 > 
MAX_DICT_FILE
)

1633 
	`FATAL
("Keyw‹dÅoÿbig i¿löê%u (%s,Üimô i†%s)", 
cur_löe
,

1634 
	`DMS
(
kÀn
), DMS(
MAX_DICT_FILE
));

1636 i‡(*
mö_Àn
 > 
kÀn
) *min_len = klen;

1637 i‡(*
max_Àn
 < 
kÀn
) *max_len = klen;

1639 
exåas_˙t
++;

1643 
	`f˛o£
(
f
);

1645 
	}
}

1650 
	$lﬂd_exåas
(
u8
* 
dú
) {

1652 
DIR
* 
d
;

1653 
dúít
* 
de
;

1654 
u32
 
mö_Àn
 = 
MAX_DICT_FILE
, 
max_Àn
 = 0, 
di˘_Àvñ
 = 0;

1655 
u8
* 
x
;

1659 i‡((
x
 = 
	`°rchr
(
dú
, '@'))) {

1661 *
x
 = 0;

1662 
di˘_Àvñ
 = 
	`©oi
(
x
 + 1);

1666 
	`ACTF
("LﬂdögÉxå®di˘i⁄¨y from '%s' (Àvñ %u)...", 
dú
, 
di˘_Àvñ
);

1668 
d
 = 
	`›ídú
(
dú
);

1670 i‡(!
d
) {

1672 i‡(
î∫o
 =
ENOTDIR
) {

1673 
	`lﬂd_exåas_fûe
(
dú
, &
mö_Àn
, &
max_Àn
, 
di˘_Àvñ
);

1674 
check_™d_s‹t
;

1677 
	`PFATAL
("U«bÀÅÿ›í '%s'", 
dú
);

1681 i‡(
x
Ë
	`FATAL
("DictionaryÜevelsÇot supported for directories.");

1683 (
de
 = 
	`ªaddú
(
d
))) {

1685 
°©
 
°
;

1686 
u8
* 
‚
 = 
	`Æloc_¥ötf
("%s/%s", 
dú
, 
de
->
d_«me
);

1687 
s32
 
fd
;

1689 i‡(
	`l°©
(
‚
, &
°
Ë|| 
	`ac˚ss
(‚, 
R_OK
))

1690 
	`PFATAL
("U«bÀÅÿac˚s†'%s'", 
‚
);

1693 i‡(!
	`S_ISREG
(
°
.
°_mode
Ë|| !°.
°_size
) {

1695 
	`ck_‰ì
(
‚
);

1700 i‡(
°
.
°_size
 > 
MAX_DICT_FILE
)

1701 
	`FATAL
("Exå®'%s' i†toÿbig (%s,Üimô i†%s)", 
‚
,

1702 
	`DMS
(
°
.
°_size
), DMS(
MAX_DICT_FILE
));

1704 i‡(
mö_Àn
 > 
°
.
°_size
) min_len = st.st_size;

1705 i‡(
max_Àn
 < 
°
.
°_size
) max_len = st.st_size;

1707 
exåas
 = 
	`ck_ªÆloc_block
”xåas, (
exåas_˙t
 + 1) *

1708 (
exåa_d©a
));

1710 
exåas
[
exåas_˙t
].
d©a
 = 
	`ck_Æloc
(
°
.
°_size
);

1711 
exåas
[
exåas_˙t
].
Àn
 = 
°
.
°_size
;

1713 
fd
 = 
	`›í
(
‚
, 
O_RDONLY
);

1715 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
‚
);

1717 
	`ck_ªad
(
fd
, 
exåas
[
exåas_˙t
].
d©a
, 
°
.
°_size
, 
‚
);

1719 
	`˛o£
(
fd
);

1720 
	`ck_‰ì
(
‚
);

1722 
exåas_˙t
++;

1726 
	`˛o£dú
(
d
);

1728 
check_™d_s‹t
:

1730 i‡(!
exåas_˙t
Ë
	`FATAL
("NÿußbÀ fûe†ö '%s'", 
dú
);

1732 
	`qs‹t
(
exåas
, 
exåas_˙t
, (
exåa_d©a
), 
com∑ª_exåas_Àn
);

1734 
	`OKF
("Lﬂded %uÉxå®tokís, sizêøngê%†tÿ%s.", 
exåas_˙t
,

1735 
	`DMS
(
mö_Àn
), DMS(
max_Àn
));

1737 i‡(
max_Àn
 > 32)

1738 
	`WARNF
("SomeÅokensáreÑelativelyÜarge (%s) - considerÅrimming.",

1739 
	`DMS
(
max_Àn
));

1741 i‡(
exåas_˙t
 > 
MAX_DET_EXTRAS
)

1742 
	`WARNF
("MoreÅhan %uÅokens - will useÅhemÖrobabilistically.",

1743 
MAX_DET_EXTRAS
);

1745 
	}
}

1752 
ölöe
 
u8
 
	$memcmp_noˇ£
(
u8
* 
m1
, u8* 
m2
, 
u32
 
Àn
) {

1754 
Àn
--Ëi‡(
	`tﬁowî
(*(
m1
++)Ë^Åﬁowî(*(
m2
++)))  1;

1757 
	}
}

1762 
	$maybe_add_auto
(
u8
* 
mem
, 
u32
 
Àn
) {

1764 
u32
 
i
;

1768 i‡(!
MAX_AUTO_EXTRAS
 || !
USE_AUTO_EXTRAS
) ;

1772 
i
 = 1; i < 
Àn
; i++)

1773 i‡(
mem
[0] ^ mem[
i
]) ;

1775 i‡(
i
 =
Àn
) ;

1779 i‡(
Àn
 == 2) {

1781 
i
 = (
öãª°ög_16
) >> 1;

1783 
i
--)

1784 i‡(*((
u16
*)
mem
Ë=
öãª°ög_16
[
i
] ||

1785 *((
u16
*)
mem
Ë=
	`SWAP16
(
öãª°ög_16
[
i
])) ;

1789 i‡(
Àn
 == 4) {

1791 
i
 = (
öãª°ög_32
) >> 2;

1793 
i
--)

1794 i‡(*((
u32
*)
mem
Ë=
öãª°ög_32
[
i
] ||

1795 *((
u32
*)
mem
Ë=
	`SWAP32
(
öãª°ög_32
[
i
])) ;

1803 
i
 = 0; i < 
exåas_˙t
; i++)

1804 i‡(
exåas
[
i
].
Àn
 >=Üen) ;

1806 ; 
i
 < 
exåas_˙t
 && 
exåas
[i].
Àn
 ==Üen; i++)

1807 i‡(!
	`memcmp_noˇ£
(
exåas
[
i
].
d©a
, 
mem
, 
Àn
)) ;

1812 
auto_ch™ged
 = 1;

1814 
i
 = 0; i < 
a_exåas_˙t
; i++) {

1816 i‡(
a_exåas
[
i
].
Àn
 =À¿&& !
	`memcmp_noˇ£
◊_exåas[i].
d©a
, 
mem
,Üen)) {

1818 
a_exåas
[
i
].
hô_˙t
++;

1819 
s‹t_a_exåas
;

1829 i‡(
a_exåas_˙t
 < 
MAX_AUTO_EXTRAS
) {

1831 
a_exåas
 = 
	`ck_ªÆloc_block
◊_exåas, (
a_exåas_˙t
 + 1) *

1832 (
exåa_d©a
));

1834 
a_exåas
[
a_exåas_˙t
].
d©a
 = 
	`ck_memdup
(
mem
, 
Àn
);

1835 
a_exåas
[
a_exåas_˙t
].
Àn
 =Üen;

1836 
a_exåas_˙t
++;

1840 
i
 = 
MAX_AUTO_EXTRAS
 / 2 +

1841 
	`UR
((
MAX_AUTO_EXTRAS
 + 1) / 2);

1843 
	`ck_‰ì
(
a_exåas
[
i
].
d©a
);

1845 
a_exåas
[
i
].
d©a
 = 
	`ck_memdup
(
mem
, 
Àn
);

1846 
a_exåas
[
i
].
Àn
 =Üen;

1847 
a_exåas
[
i
].
hô_˙t
 = 0;

1851 
s‹t_a_exåas
:

1855 
	`qs‹t
(
a_exåas
, 
a_exåas_˙t
, (
exåa_d©a
),

1856 
com∑ª_exåas_u£_d
);

1860 
	`qs‹t
(
a_exåas
, 
	`MIN
(
USE_AUTO_EXTRAS
, 
a_exåas_˙t
),

1861 (
exåa_d©a
), 
com∑ª_exåas_Àn
);

1863 
	}
}

1868 
	$ßve_auto
() {

1870 
u32
 
i
;

1872 i‡(!
auto_ch™ged
) ;

1873 
auto_ch™ged
 = 0;

1875 
i
 = 0; i < 
	`MIN
(
USE_AUTO_EXTRAS
, 
a_exåas_˙t
); i++) {

1877 
u8
* 
‚
 = 
	`Æloc_¥ötf
("%s/queue/.°©e/auto_exåas/auto_%06u", 
out_dú
, 
i
);

1878 
s32
 
fd
;

1880 
fd
 = 
	`›í
(
‚
, 
O_WRONLY
 | 
O_CREAT
 | 
O_TRUNC
, 0600);

1882 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
‚
);

1884 
	`ck_wrôe
(
fd
, 
a_exåas
[
i
].
d©a
,á_exåas[i].
Àn
, 
‚
);

1886 
	`˛o£
(
fd
);

1887 
	`ck_‰ì
(
‚
);

1891 
	}
}

1896 
	$lﬂd_auto
() {

1898 
u32
 
i
;

1900 
i
 = 0; i < 
USE_AUTO_EXTRAS
; i++) {

1902 
u8
 
tmp
[
MAX_AUTO_EXTRA
 + 1];

1903 
u8
* 
‚
 = 
	`Æloc_¥ötf
("%s/.°©e/auto_exåas/auto_%06u", 
ö_dú
, 
i
);

1904 
s32
 
fd
, 
Àn
;

1906 
fd
 = 
	`›í
(
‚
, 
O_RDONLY
, 0600);

1908 i‡(
fd
 < 0) {

1910 i‡(
î∫o
 !
ENOENT
Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
‚
);

1911 
	`ck_‰ì
(
‚
);

1919 
Àn
 = 
	`ªad
(
fd
, 
tmp
, 
MAX_AUTO_EXTRA
 + 1);

1921 i‡(
Àn
 < 0Ë
	`PFATAL
("U«bÀÅÿªad from '%s'", 
‚
);

1923 i‡(
Àn
 >
MIN_AUTO_EXTRA
 &&Üí <
MAX_AUTO_EXTRA
)

1924 
	`maybe_add_auto
(
tmp
, 
Àn
);

1926 
	`˛o£
(
fd
);

1927 
	`ck_‰ì
(
‚
);

1931 i‡(
i
Ë
	`OKF
("Loaded %uáuto-discovered dictionaryÅokens.", i);

1932 
	`OKF
("Noáuto-generated dictionaryÅokensÅoÑeuse.");

1934 
	}
}

1939 
	$de°roy_exåas
() {

1941 
u32
 
i
;

1943 
i
 = 0; i < 
exåas_˙t
; i++)

1944 
	`ck_‰ì
(
exåas
[
i
].
d©a
);

1946 
	`ck_‰ì
(
exåas
);

1948 
i
 = 0; i < 
a_exåas_˙t
; i++)

1949 
	`ck_‰ì
(
a_exåas
[
i
].
d©a
);

1951 
	`ck_‰ì
(
a_exåas
);

1953 
	}
}

1964 
EXP_ST
 
	$öô_f‹k£rvî
(** 
¨gv
) {

1966 
ôimîvÆ
 
ô
;

1967 
°_pùe
[2], 
˘l_pùe
[2];

1968 
°©us
;

1969 
s32
 
æí
;

1971 
	`ACTF
("Spinning upÅhe fork server...");

1973 i‡(
	`pùe
(
°_pùe
Ë||Öùe(
˘l_pùe
)Ë
	`PFATAL
("pipe() failed");

1975 
f‹k§v_pid
 = 
	`f‹k
();

1977 i‡(
f‹k§v_pid
 < 0Ë
	`PFATAL
("fork() failed");

1979 i‡(!
f‹k§v_pid
) {

1981 
æimô
 
r
;

1986 i‡(!
	`gëæimô
(
RLIMIT_NOFILE
, &
r
Ë&&Ñ.
æim_cur
 < 
FORKSRV_FD
 + 2) {

1988 
r
.
æim_cur
 = 
FORKSRV_FD
 + 2;

1989 
	`£ålimô
(
RLIMIT_NOFILE
, &
r
);

1993 i‡(
mem_limô
) {

1995 
r
.
æim_max
 =Ñ.
æim_cur
 = ((
æim_t
)
mem_limô
) << 20;

1997 #ifde‡
RLIMIT_AS


1999 
	`£ålimô
(
RLIMIT_AS
, &
r
);

2007 
	`£ålimô
(
RLIMIT_DATA
, &
r
);

2017 
r
.
æim_max
 =Ñ.
æim_cur
 = 0;

2019 
	`£ålimô
(
RLIMIT_CORE
, &
r
);

2024 
	`£tsid
();

2026 
	`dup2
(
dev_nuŒ_fd
, 1);

2027 
	`dup2
(
dev_nuŒ_fd
, 2);

2029 i‡(
out_fûe
) {

2031 
	`dup2
(
dev_nuŒ_fd
, 0);

2035 
	`dup2
(
out_fd
, 0);

2036 
	`˛o£
(
out_fd
);

2042 i‡(
	`dup2
(
˘l_pùe
[0], 
FORKSRV_FD
Ë< 0Ë
	`PFATAL
("dup2() failed");

2043 i‡(
	`dup2
(
°_pùe
[1], 
FORKSRV_FD
 + 1Ë< 0Ë
	`PFATAL
("dup2() failed");

2045 
	`˛o£
(
˘l_pùe
[0]);

2046 
	`˛o£
(
˘l_pùe
[1]);

2047 
	`˛o£
(
°_pùe
[0]);

2048 
	`˛o£
(
°_pùe
[1]);

2050 
	`˛o£
(
out_dú_fd
);

2051 
	`˛o£
(
dev_nuŒ_fd
);

2052 
	`˛o£
(
dev_uøndom_fd
);

2053 
	`˛o£
(
	`fûío
(
∂Ÿ_fûe
));

2058 i‡(!
	`gëív
("LD_BIND_LAZY")Ë
	`£ãnv
("LD_BIND_NOW", "1", 0);

2062 
	`£ãnv
("ASAN_OPTIONS", "abort_on_error=1:"

2070 
	`£ãnv
("MSAN_OPTIONS", "exô_code=" 
	`STRINGIFY
(
MSAN_ERROR
) ":"

2076 
	`execv
(
èrgë_∑th
, 
¨gv
);

2081 *(
u32
*)
åa˚_bôs
 = 
EXEC_FAIL_SIG
;

2082 
	`exô
(0);

2088 
	`˛o£
(
˘l_pùe
[0]);

2089 
	`˛o£
(
°_pùe
[1]);

2091 
f§v_˘l_fd
 = 
˘l_pùe
[1];

2092 
f§v_°_fd
 = 
°_pùe
[0];

2096 
ô
.
ô_vÆue
.
tv_£c
 = ((
exec_tmout
 * 
FORK_WAIT_MULT
) / 1000);

2097 
ô
.
ô_vÆue
.
tv_u£c
 = ((
exec_tmout
 * 
FORK_WAIT_MULT
) % 1000) * 1000;

2099 
	`£tôimî
(
ITIMER_REAL
, &
ô
, 
NULL
);

2101 
æí
 = 
	`ªad
(
f§v_°_fd
, &
°©us
, 4);

2103 
ô
.
ô_vÆue
.
tv_£c
 = 0;

2104 
ô
.
ô_vÆue
.
tv_u£c
 = 0;

2106 
	`£tôimî
(
ITIMER_REAL
, &
ô
, 
NULL
);

2111 i‡(
æí
 == 4) {

2112 
	`OKF
("AllÑight - fork server is up.");

2116 i‡(
chûd_timed_out
)

2117 
	`FATAL
("Timeout while initializing fork server (adjusting -t may help)");

2119 i‡(
	`waôpid
(
f‹k§v_pid
, &
°©us
, 0) <= 0)

2120 
	`PFATAL
("waitpid() failed");

2122 i‡(
	`WIFSIGNALED
(
°©us
)) {

2124 i‡(
mem_limô
 && mem_limô < 500 && 
u£s_aßn
) {

2126 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


2130 " %s/nŸes_f‹_aßn.txàf‹ hñp.\n", 
doc_∑th
);

2132 } i‡(!
mem_limô
) {

2134 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


2141 #ifde‡
__APPLE__


2154 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


2163 #ifde‡
RLIMIT_AS


2175 #ifde‡
__APPLE__


2185 
	`DMS
(
mem_limô
 << 20), mem_limit - 1);

2189 
	`FATAL
("F‹k sîvî cøshed wôh sig«»%d", 
	`WTERMSIG
(
°©us
));

2193 i‡(*(
u32
*)
åa˚_bôs
 =
EXEC_FAIL_SIG
)

2194 
	`FATAL
("U«bÀÅÿexecuãÅ¨gëáµliˇti⁄ ('%s')", 
¨gv
[0]);

2196 i‡(
mem_limô
 && mem_limô < 500 && 
u£s_aßn
) {

2198 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


2202 "Ñód %s/nŸes_f‹_aßn.txàf‹ hñp.\n", 
doc_∑th
);

2204 } i‡(!
mem_limô
) {

2206 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


2213 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


2222 #ifde‡
RLIMIT_AS


2233 
	`gëív
(
DEFER_ENV_VAR
) ? "three" : "two",

2234 
	`gëív
(
DEFER_ENV_VAR
) ?

2237 
	`DMS
(
mem_limô
 << 20), mem_limit - 1);

2241 
	`FATAL
("Fork server handshake failed");

2243 
	}
}

2249 
u8
 
	$run_èrgë
(** 
¨gv
) {

2251 
ôimîvÆ
 
ô
;

2252 
u32
 
¥ev_timed_out
 = 0;

2254 
°©us
 = 0;

2255 
u32
 
tb4
;

2257 
chûd_timed_out
 = 0;

2263 
	`mem£t
(
åa˚_bôs
, 0, 
MAP_SIZE
);

2264 
	`MEM_BARRIER
();

2271 i‡(
dumb_mode
 =1 || 
no_f‹k£rvî
) {

2273 
chûd_pid
 = 
	`f‹k
();

2275 i‡(
chûd_pid
 < 0Ë
	`PFATAL
("fork() failed");

2277 i‡(!
chûd_pid
) {

2279 
æimô
 
r
;

2281 i‡(
mem_limô
) {

2283 
r
.
æim_max
 =Ñ.
æim_cur
 = ((
æim_t
)
mem_limô
) << 20;

2285 #ifde‡
RLIMIT_AS


2287 
	`£ålimô
(
RLIMIT_AS
, &
r
);

2291 
	`£ålimô
(
RLIMIT_DATA
, &
r
);

2297 
r
.
æim_max
 =Ñ.
æim_cur
 = 0;

2299 
	`£ålimô
(
RLIMIT_CORE
, &
r
);

2304 
	`£tsid
();

2306 
	`dup2
(
dev_nuŒ_fd
, 1);

2307 
	`dup2
(
dev_nuŒ_fd
, 2);

2309 i‡(
out_fûe
) {

2311 
	`dup2
(
dev_nuŒ_fd
, 0);

2315 
	`dup2
(
out_fd
, 0);

2316 
	`˛o£
(
out_fd
);

2322 
	`˛o£
(
dev_nuŒ_fd
);

2323 
	`˛o£
(
out_dú_fd
);

2324 
	`˛o£
(
dev_uøndom_fd
);

2325 
	`˛o£
(
	`fûío
(
∂Ÿ_fûe
));

2329 
	`£ãnv
("ASAN_OPTIONS", "abort_on_error=1:"

2334 
	`£ãnv
("MSAN_OPTIONS", "exô_code=" 
	`STRINGIFY
(
MSAN_ERROR
) ":"

2338 
	`execv
(
èrgë_∑th
, 
¨gv
);

2343 *(
u32
*)
åa˚_bôs
 = 
EXEC_FAIL_SIG
;

2344 
	`exô
(0);

2350 
s32
 
ªs
;

2355 i‡((
ªs
 = 
	`wrôe
(
f§v_˘l_fd
, &
¥ev_timed_out
, 4)) != 4) {

2357 i‡(
°›_so⁄
)  0;

2358 
	`RPFATAL
(
ªs
, "UnableÅoÑequestÇewÖrocess from fork server (OOM?)");

2362 i‡((
ªs
 = 
	`ªad
(
f§v_°_fd
, &
chûd_pid
, 4)) != 4) {

2364 i‡(
°›_so⁄
)  0;

2365 
	`RPFATAL
(
ªs
, "UnableÅoÑequestÇewÖrocess from fork server (OOM?)");

2369 i‡(
chûd_pid
 <0Ë
	`FATAL
("Fork server is misbehaving (OOM?)");

2375 
ô
.
ô_vÆue
.
tv_£c
 = (
exec_tmout
 / 1000);

2376 
ô
.
ô_vÆue
.
tv_u£c
 = (
exec_tmout
 % 1000) * 1000;

2378 
	`£tôimî
(
ITIMER_REAL
, &
ô
, 
NULL
);

2382 i‡(
dumb_mode
 =1 || 
no_f‹k£rvî
) {

2384 i‡(
	`waôpid
(
chûd_pid
, &
°©us
, 0Ë<0Ë
	`PFATAL
("waitpid() failed");

2388 
s32
 
ªs
;

2390 i‡((
ªs
 = 
	`ªad
(
f§v_°_fd
, &
°©us
, 4)) != 4) {

2392 i‡(
°›_so⁄
)  0;

2393 
	`RPFATAL
(
ªs
, "UnableÅo communicate with fork server (OOM?)");

2399 
chûd_pid
 = 0;

2400 
ô
.
ô_vÆue
.
tv_£c
 = 0;

2401 
ô
.
ô_vÆue
.
tv_u£c
 = 0;

2403 
	`£tôimî
(
ITIMER_REAL
, &
ô
, 
NULL
);

2405 
tŸÆ_execs
++;

2411 
	`MEM_BARRIER
();

2413 
tb4
 = *(
u32
*)
åa˚_bôs
;

2415 #ifde‡
__x86_64__


2416 
	`˛assify_cou¡s
((
u64
*)
åa˚_bôs
);

2418 
	`˛assify_cou¡s
((
u32
*)
åa˚_bôs
);

2421 
¥ev_timed_out
 = 
chûd_timed_out
;

2425 i‡(
chûd_timed_out
Ë 
FAULT_HANG
;

2427 i‡(
	`WIFSIGNALED
(
°©us
Ë&& !
°›_so⁄
) {

2428 
kûl_sig«l
 = 
	`WTERMSIG
(
°©us
);

2429  
FAULT_CRASH
;

2435 i‡(
u£s_aßn
 && 
	`WEXITSTATUS
(
°©us
Ë=
MSAN_ERROR
) {

2436 
kûl_sig«l
 = 0;

2437  
FAULT_CRASH
;

2440 i‡((
dumb_mode
 =1 || 
no_f‹k£rvî
Ë&& 
tb4
 =
EXEC_FAIL_SIG
)

2441  
FAULT_ERROR
;

2443  
FAULT_NONE
;

2445 
	}
}

2452 
	$wrôe_to_ã°ˇ£
(* 
mem
, 
u32
 
Àn
) {

2454 
s32
 
fd
 = 
out_fd
;

2456 i‡(
out_fûe
) {

2458 
	`u∆ök
(
out_fûe
);

2460 
fd
 = 
	`›í
(
out_fûe
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

2462 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
out_fûe
);

2464 } 
	`l£ek
(
fd
, 0, 
SEEK_SET
);

2466 
	`ck_wrôe
(
fd
, 
mem
, 
Àn
, 
out_fûe
);

2468 i‡(!
out_fûe
) {

2470 i‡(
	`·runˇã
(
fd
, 
Àn
)Ë
	`PFATAL
("ftruncate() failed");

2471 
	`l£ek
(
fd
, 0, 
SEEK_SET
);

2473 } 
	`˛o£
(
fd
);

2475 
	}
}

2480 
	$wrôe_wôh_g≠
(* 
mem
, 
u32
 
Àn
, u32 
skù_©
, u32 
skù_Àn
) {

2482 
s32
 
fd
 = 
out_fd
;

2483 
u32
 
èû_Àn
 = 
Àn
 - 
skù_©
 - 
skù_Àn
;

2485 i‡(
out_fûe
) {

2487 
	`u∆ök
(
out_fûe
);

2489 
fd
 = 
	`›í
(
out_fûe
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

2491 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
out_fûe
);

2493 } 
	`l£ek
(
fd
, 0, 
SEEK_SET
);

2495 i‡(
skù_©
Ë
	`ck_wrôe
(
fd
, 
mem
, skù_©, 
out_fûe
);

2497 i‡(
èû_Àn
Ë
	`ck_wrôe
(
fd
, 
mem
 + 
skù_©
 + 
skù_Àn
,Åaû_Àn, 
out_fûe
);

2499 i‡(!
out_fûe
) {

2501 i‡(
	`·runˇã
(
fd
, 
Àn
 - 
skù_Àn
)Ë
	`PFATAL
("ftruncate() failed");

2502 
	`l£ek
(
fd
, 0, 
SEEK_SET
);

2504 } 
	`˛o£
(
fd
);

2506 
	}
}

2509 
show_°©s
();

2515 
u8
 
	$ˇlibøã_ˇ£
(** 
¨gv
, 
queue_íåy
* 
q
, 
u8
* 
u£_mem
,

2516 
u32
 
h™diˇp
, 
u8
 
‰om_queue
) {

2518 
u8
 
Áu…
 = 0, 
√w_bôs
 = 0, 
v¨_dëe˘ed
 = 0, 
fú°_run
 = (
q
->
exec_cksum
 == 0);

2519 
u64
 
°¨t_us
, 
°›_us
;

2521 
s32
 
ﬁd_sc
 = 
°age_cur
, 
ﬁd_sm
 = 
°age_max
, 
ﬁd_tmout
 = 
exec_tmout
;

2522 
u8
* 
ﬁd_¢
 = 
°age_«me
;

2528 i‡(!
‰om_queue
 || 
ªsumög_fuzz
)

2529 
exec_tmout
 = 
	`MAX
”xec_tmouà+ 
CAL_TMOUT_ADD
,

2530 
exec_tmout
 * 
CAL_TMOUT_PERC
 / 100);

2532 
q
->
ˇl_Áûed
++;

2534 
°age_«me
 = "calibration";

2535 
°age_max
 = 
no_v¨_check
 ? 
CAL_CYCLES_NO_VAR
 : 
CAL_CYCLES
;

2540 i‡(
dumb_mode
 !1 && !
no_f‹k£rvî
 && !
f‹k§v_pid
)

2541 
	`öô_f‹k£rvî
(
¨gv
);

2543 
°¨t_us
 = 
	`gë_cur_time_us
();

2545 
°age_cur
 = 0; sège_cu∏< 
°age_max
; stage_cur++) {

2547 
u32
 
cksum
;

2549 i‡(!
fú°_run
 && !(
°age_cur
 % 
°©s_upd©e_‰eq
)Ë
	`show_°©s
();

2551 
	`wrôe_to_ã°ˇ£
(
u£_mem
, 
q
->
Àn
);

2553 
Áu…
 = 
	`run_èrgë
(
¨gv
);

2558 i‡(
°›_so⁄
 || 
Áu…
 !
¸ash_mode
Ë
ab‹t_ˇlibøti⁄
;

2560 i‡(!
dumb_mode
 && !
°age_cur
 && !
	`cou¡_byãs
(
åa˚_bôs
)) {

2561 
Áu…
 = 
FAULT_NOINST
;

2562 
ab‹t_ˇlibøti⁄
;

2565 
cksum
 = 
	`hash32
(
åa˚_bôs
, 
MAP_SIZE
, 
HASH_CONST
);

2567 i‡(
q
->
exec_cksum
 !
cksum
) {

2569 
u8
 
hnb
 = 
	`has_√w_bôs
(
vúgö_bôs
);

2570 i‡(
hnb
 > 
√w_bôs
)Çew_bits = hnb;

2572 i‡(!
no_v¨_check
 && 
q
->
exec_cksum
) {

2574 
v¨_dëe˘ed
 = 1;

2575 
°age_max
 = 
CAL_CYCLES_LONG
;

2577 } 
q
->
exec_cksum
 = 
cksum
;

2583 
°›_us
 = 
	`gë_cur_time_us
();

2585 
tŸÆ_ˇl_us
 +
°›_us
 - 
°¨t_us
;

2586 
tŸÆ_ˇl_cy˛es
 +
°age_max
;

2591 
q
->
exec_us
 = (
°›_us
 - 
°¨t_us
Ë/ 
°age_max
;

2592 
q
->
bôm≠_size
 = 
	`cou¡_byãs
(
åa˚_bôs
);

2593 
q
->
h™diˇp
 = handicap;

2594 
q
->
ˇl_Áûed
 = 0;

2596 
tŸÆ_bôm≠_size
 +
q
->
bôm≠_size
;

2597 
tŸÆ_bôm≠_íåõs
++;

2599 
	`upd©e_bôm≠_sc‹e
(
q
);

2605 i‡(!
dumb_mode
 && 
fú°_run
 && !
Áu…
 && !
√w_bôs
ËÁu… = 
FAULT_NOBITS
;

2607 
ab‹t_ˇlibøti⁄
:

2609 i‡(
√w_bôs
 =2 && !
q
->
has_√w_cov
) {

2610 
q
->
has_√w_cov
 = 1;

2611 
queued_wôh_cov
++;

2616 i‡(
v¨_dëe˘ed
 && !
q
->
v¨_behavi‹
) {

2617 
	`m¨k_as_v¨übÀ
(
q
);

2618 
queued_v¨übÀ
++;

2621 
°age_«me
 = 
ﬁd_¢
;

2622 
°age_cur
 = 
ﬁd_sc
;

2623 
°age_max
 = 
ﬁd_sm
;

2624 
exec_tmout
 = 
ﬁd_tmout
;

2626 i‡(!
fú°_run
Ë
	`show_°©s
();

2628  
Áu…
;

2630 
	}
}

2635 
	$check_m≠_covîage
() {

2637 
u32
 
i
;

2639 i‡(
	`cou¡_byãs
(
åa˚_bôs
) < 100) ;

2641 
i
 = (1 << (
MAP_SIZE_POW2
 - 1)); i < 
MAP_SIZE
; i++)

2642 i‡(
åa˚_bôs
[
i
]) ;

2644 
	`WARNF
("Recompile binary withÇewer version ofáflÅo improve coverage!");

2646 
	}
}

2652 
	$≥rf‹m_dry_run
(** 
¨gv
) {

2654 
queue_íåy
* 
q
 = 
queue
;

2655 
u32
 
ˇl_Áûuªs
 = 0;

2656 
u8
* 
skù_¸ashes
 = 
	`gëív
("AFL_SKIP_CRASHES");

2658 
q
) {

2660 
u8
* 
u£_mem
;

2661 
u8
 
ªs
;

2662 
s32
 
fd
;

2664 
u8
* 
‚
 = 
	`°ºchr
(
q
->
‚ame
, '/') + 1;

2666 
	`ACTF
("Aâem±ög dryÑu¿wôh '%s'...", 
‚
);

2668 
fd
 = 
	`›í
(
q
->
‚ame
, 
O_RDONLY
);

2669 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
q
->
‚ame
);

2671 
u£_mem
 = 
	`ck_Æloc_nozîo
(
q
->
Àn
);

2673 i‡(
	`ªad
(
fd
, 
u£_mem
, 
q
->
Àn
) != q->len)

2674 
	`FATAL
("Sh‹àªad from '%s'", 
q
->
‚ame
);

2676 
	`˛o£
(
fd
);

2678 
ªs
 = 
	`ˇlibøã_ˇ£
(
¨gv
, 
q
, 
u£_mem
, 0, 1);

2679 
	`ck_‰ì
(
u£_mem
);

2681 i‡(
°›_so⁄
) ;

2683 i‡(
ªs
 =
¸ash_mode
 ||Ñe†=
FAULT_NOBITS
)

2684 
	`SAYF
(
cGRA
 "Üí = %u, m≠ sizê%u,Éxe¯•ìd = %Œu us\n" 
cRST
,

2685 
q
->
Àn
, q->
bôm≠_size
, q->
exec_us
);

2687 
ªs
) {

2689 
FAULT_NONE
:

2691 i‡(
q
 =
queue
Ë
	`check_m≠_covîage
();

2693 i‡(
¸ash_mode
Ë
	`FATAL
("Te° ca£ '%s' d€†*NOT* cøsh", 
‚
);

2697 
FAULT_HANG
:

2699 i‡(
timeout_giví
) {

2705 i‡(
timeout_giví
 > 1) {

2706 
	`WARNF
("Test caseÑesults iná hang (skipping)");

2707 
q
->
ˇl_Áûed
 = 
CAL_CHANCES
;

2708 
ˇl_Áûuªs
++;

2712 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


2717 " '+'áàthêíd o‡thêvÆuê∑s£dÅÿ-à('-à%u+').\n", 
exec_tmout
,

2718 
exec_tmout
);

2720 
	`FATAL
("Te° ca£ '%s'Ñesu…†öá h™g", 
‚
);

2724 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


2730 "á…ogëhî,ánd föd o√Åh© i†Às†o‡®CPU hog.\n", 
exec_tmout
);

2732 
	`FATAL
("Te° ca£ '%s'Ñesu…†öá h™g", 
‚
);

2736 
FAULT_CRASH
:

2738 i‡(
¸ash_mode
) ;

2740 i‡(
skù_¸ashes
) {

2741 
	`WARNF
("Test caseÑesults iná crash (skipping)");

2742 
q
->
ˇl_Áûed
 = 
CAL_CHANCES
;

2743 
ˇl_Áûuªs
++;

2747 i‡(
mem_limô
) {

2749 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


2762 #ifde‡
RLIMIT_AS


2772 #ifde‡
__APPLE__


2782 
	`DMS
(
mem_limô
 << 20), mem_limô - 1, 
doc_∑th
);

2786 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


2794 #ifde‡
__APPLE__


2807 
	`FATAL
("Te° ca£ '%s'Ñesu…†öá cøsh", 
‚
);

2809 
FAULT_ERROR
:

2811 
	`FATAL
("U«bÀÅÿexecuãÅ¨gëáµliˇti⁄ ('%s')", 
¨gv
[0]);

2813 
FAULT_NOINST
:

2815 
	`FATAL
("No instrumentation detected");

2817 
FAULT_NOBITS
:

2819 
u£Àss_©_°¨t
++;

2821 i‡(!
ö_bôm≠
 && !
shufÊe_queue
)

2822 
	`WARNF
("NoÇew instrumentation output,Åest case may be useless.");

2828 i‡(
q
->
v¨_behavi‹
Ë
	`WARNF
("Instrumentation output variesácrossÑuns.");

2830 
q
 = q->
√xt
;

2834 i‡(
ˇl_Áûuªs
) {

2836 i‡(
ˇl_Áûuªs
 =
queued_∑ths
)

2837 
	`FATAL
("AllÅest casesÅime out%s, giving up!",

2838 
skù_¸ashes
 ? " or crash" : "");

2840 
	`WARNF
("Skù≥d %uÅe° ca£†(%0.02f%%Ëduêtÿtimeouts%s.", 
ˇl_Áûuªs
,

2841 (()
ˇl_Áûuªs
Ë* 100 / 
queued_∑ths
,

2842 
skù_¸ashes
 ? " or crashes" : "");

2844 i‡(
ˇl_Áûuªs
 * 5 > 
queued_∑ths
)

2845 
	`WARNF
(
cLRD
 "HighÖercentage ofÑejectedÅest cases, check settings!");

2849 
	`OKF
("AllÅest casesÖrocessed.");

2851 
	}
}

2856 
	$lök_‹_c›y
(
u8
* 
ﬁd_∑th
, u8* 
√w_∑th
) {

2858 
s32
 
i
 = 
	`lök
(
ﬁd_∑th
, 
√w_∑th
);

2859 
s32
 
sfd
, 
dfd
;

2860 
u8
* 
tmp
;

2862 i‡(!
i
) ;

2864 
sfd
 = 
	`›í
(
ﬁd_∑th
, 
O_RDONLY
);

2865 i‡(
sfd
 < 0Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
ﬁd_∑th
);

2867 
dfd
 = 
	`›í
(
√w_∑th
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

2868 i‡(
dfd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
√w_∑th
);

2870 
tmp
 = 
	`ck_Æloc
(64 * 1024);

2872 (
i
 = 
	`ªad
(
sfd
, 
tmp
, 64 * 1024)) > 0)

2873 
	`ck_wrôe
(
dfd
, 
tmp
, 
i
, 
√w_∑th
);

2875 i‡(
i
 < 0Ë
	`PFATAL
("read() failed");

2877 
	`ck_‰ì
(
tmp
);

2878 
	`˛o£
(
sfd
);

2879 
	`˛o£
(
dfd
);

2881 
	}
}

2884 
nuke_ªsume_dú
();

2889 
	$pivŸ_öputs
() {

2891 
queue_íåy
* 
q
 = 
queue
;

2892 
u32
 
id
 = 0;

2894 
	`ACTF
("Creating hardÜinks foráll input files...");

2896 
q
) {

2898 
u8
 *
n‚
, *
r¶
 = 
	`°ºchr
(
q
->
‚ame
, '/');

2899 
u32
 
‹ig_id
;

2901 i‡(!
r¶
Ër¶ = 
q
->
‚ame
; rsl++;

2907 #i‚de‡
SIMPLE_FILES


2908 
	#CASE_PREFIX
 "id:"

	)

2910 
	#CASE_PREFIX
 "id_"

	)

2913 i‡(!
	`°∫cmp
(
r¶
, 
CASE_PREFIX
, 3) &&

2914 
	`ssˇnf
(
r¶
 + 3, "%06u", &
‹ig_id
Ë=1 && orig_id =
id
) {

2916 
u8
* 
§c_°r
;

2917 
u32
 
§c_id
;

2919 
ªsumög_fuzz
 = 1;

2920 
n‚
 = 
	`Æloc_¥ötf
("%s/queue/%s", 
out_dú
, 
r¶
);

2925 
§c_°r
 = 
	`°rchr
(
r¶
 + 3, ':');

2927 i‡(
§c_°r
 && 
	`ssˇnf
(§c_°∏+ 1, "%06u", &
§c_id
) == 1) {

2929 
queue_íåy
* 
s
 = 
queue
;

2930 
§c_id
-- && 
s
Ë†s->
√xt
;

2931 i‡(
s
Ë
q
->
dïth
 = s->depth + 1;

2933 i‡(
max_dïth
 < 
q
->
dïth
) max_depth = q->depth;

2942 #i‚de‡
SIMPLE_FILES


2944 
u8
* 
u£_«me
 = 
	`°r°r
(
r¶
, ",orig:");

2946 i‡(
u£_«me
Ëu£_«mê+6; u£_«mê
r¶
;

2947 
n‚
 = 
	`Æloc_¥ötf
("%s/queue/id:%06u,‹ig:%s", 
out_dú
, 
id
, 
u£_«me
);

2951 
n‚
 = 
	`Æloc_¥ötf
("%s/queue/id_%06u", 
out_dú
, 
id
);

2959 
	`lök_‹_c›y
(
q
->
‚ame
, 
n‚
);

2960 
	`ck_‰ì
(
q
->
‚ame
);

2961 
q
->
‚ame
 = 
n‚
;

2965 i‡(
q
->
∑s£d_dë
Ë
	`m¨k_as_dë_d⁄e
(q);

2967 
q
 = q->
√xt
;

2968 
id
++;

2972 i‡(
ö_∂a˚_ªsume
Ë
	`nuke_ªsume_dú
();

2974 
	}
}

2977 #i‚de‡
SIMPLE_FILES


2982 
u8
* 
	$des¸ibe_›
(
u8
 
hnb
) {

2984 
u8
 
ªt
[256];

2986 i‡(
syncög_∑πy
) {

2988 
	`•rötf
(
ªt
, "sync:%s,§c:%06u", 
syncög_∑πy
, 
syncög_ˇ£
);

2992 
	`•rötf
(
ªt
, "§c:%06u", 
cuºít_íåy
);

2994 i‡(
•licög_wôh
 >= 0)

2995 
	`•rötf
(
ªt
 + 
	`°æí
‘ë), "+%06u", 
•licög_wôh
);

2997 
	`•rötf
(
ªt
 + 
	`°æí
‘ë), ",›:%s", 
°age_sh‹t
);

2999 i‡(
°age_cur_byã
 >= 0) {

3001 
	`•rötf
(
ªt
 + 
	`°æí
‘ë), ",pos:%u", 
°age_cur_byã
);

3003 i‡(
°age_vÆ_ty≥
 !
STAGE_VAL_NONE
)

3004 
	`•rötf
(
ªt
 + 
	`°æí
(ret), ",val:%s%+d",

3005 (
°age_vÆ_ty≥
 =
STAGE_VAL_BE
) ? "be:" : "",

3006 
°age_cur_vÆ
);

3008 } 
	`•rötf
(
ªt
 + 
	`°æí
‘ë), ",ªp:%u", 
°age_cur_vÆ
);

3012 i‡(
hnb
 =2Ë
	`°rˇt
(
ªt
, ",+cov");

3014  
ªt
;

3016 
	}
}

3023 
	$wrôe_¸ash_ªadme
() {

3025 
u8
* 
‚
 = 
	`Æloc_¥ötf
("%s/¸ashes/README.txt", 
out_dú
);

3026 
s32
 
fd
;

3027 
FILE
* 
f
;

3029 
fd
 = 
	`›í
(
‚
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

3030 
	`ck_‰ì
(
‚
);

3034 i‡(
fd
 < 0) ;

3036 
f
 = 
	`fd›í
(
fd
, "w");

3038 i‡(!
f
) {

3039 
	`˛o£
(
fd
);

3043 
	`Ârötf
(
f
, "CommandÜine usedÅo findÅhis crash:\n\n"

3061 
‹ig_cmdlöe
, 
	`DMS
(
mem_limô
 << 20));

3063 
	`f˛o£
(
f
);

3065 
	}
}

3072 
u8
 
	$ßve_if_öãª°ög
(** 
¨gv
, * 
mem
, 
u32
 
Àn
, 
u8
 
Áu…
) {

3074 
u8
 *
‚
 = "";

3075 
u8
 
hnb
;

3076 
s32
 
fd
;

3077 
u8
 
kìpög
 = 0, 
ªs
;

3079 i‡(
Áu…
 =
¸ash_mode
) {

3084 i‡(!(
hnb
 = 
	`has_√w_bôs
(
vúgö_bôs
))) {

3085 i‡(
¸ash_mode
Ë
tŸÆ_¸ashes
++;

3089 #i‚de‡
SIMPLE_FILES


3091 
‚
 = 
	`Æloc_¥ötf
("%s/queue/id:%06u,%s", 
out_dú
, 
queued_∑ths
,

3092 
	`des¸ibe_›
(
hnb
));

3096 
‚
 = 
	`Æloc_¥ötf
("%s/queue/id_%06u", 
out_dú
, 
queued_∑ths
);

3100 
	`add_to_queue
(
‚
, 
Àn
, 0);

3102 i‡(
hnb
 == 2) {

3103 
queue_t›
->
has_√w_cov
 = 1;

3104 
queued_wôh_cov
++;

3107 
queue_t›
->
exec_cksum
 = 
	`hash32
(
åa˚_bôs
, 
MAP_SIZE
, 
HASH_CONST
);

3112 
ªs
 = 
	`ˇlibøã_ˇ£
(
¨gv
, 
queue_t›
, 
mem
, 
queue_cy˛e
 - 1, 0);

3114 i‡(
ªs
 =
FAULT_ERROR
)

3115 
	`FATAL
("UnableÅoÉxecuteÅargetápplication");

3117 
fd
 = 
	`›í
(
‚
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

3118 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
‚
);

3119 
	`ck_wrôe
(
fd
, 
mem
, 
Àn
, 
‚
);

3120 
	`˛o£
(
fd
);

3122 
kìpög
 = 1;

3126 
Áu…
) {

3128 
FAULT_HANG
:

3135 
tŸÆ_h™gs
++;

3137 i‡(
unique_h™gs
 >
KEEP_UNIQUE_HANG
Ë 
kìpög
;

3139 i‡(!
dumb_mode
) {

3141 #ifde‡
__x86_64__


3142 
	`sim∂ify_åa˚
((
u64
*)
åa˚_bôs
);

3144 
	`sim∂ify_åa˚
((
u32
*)
åa˚_bôs
);

3147 i‡(!
	`has_√w_bôs
(
vúgö_h™g
)Ë 
kìpög
;

3151 #i‚de‡
SIMPLE_FILES


3153 
‚
 = 
	`Æloc_¥ötf
("%s/h™gs/id:%06Œu,%s", 
out_dú
,

3154 
unique_h™gs
, 
	`des¸ibe_›
(0));

3158 
‚
 = 
	`Æloc_¥ötf
("%s/h™gs/id_%06Œu", 
out_dú
,

3159 
unique_h™gs
);

3163 
unique_h™gs
++;

3165 
œ°_h™g_time
 = 
	`gë_cur_time
();

3169 
FAULT_CRASH
:

3174 
tŸÆ_¸ashes
++;

3176 i‡(
unique_¸ashes
 >
KEEP_UNIQUE_CRASH
Ë 
kìpög
;

3178 i‡(!
dumb_mode
) {

3180 #ifde‡
__x86_64__


3181 
	`sim∂ify_åa˚
((
u64
*)
åa˚_bôs
);

3183 
	`sim∂ify_åa˚
((
u32
*)
åa˚_bôs
);

3186 i‡(!
	`has_√w_bôs
(
vúgö_¸ash
)Ë 
kìpög
;

3190 i‡(!
unique_¸ashes
Ë
	`wrôe_¸ash_ªadme
();

3192 #i‚de‡
SIMPLE_FILES


3194 
‚
 = 
	`Æloc_¥ötf
("%s/¸ashes/id:%06Œu,sig:%02u,%s", 
out_dú
,

3195 
unique_¸ashes
, 
kûl_sig«l
, 
	`des¸ibe_›
(0));

3199 
‚
 = 
	`Æloc_¥ötf
("%s/¸ashes/id_%06Œu_%02u", 
out_dú
, 
unique_¸ashes
,

3200 
kûl_sig«l
);

3204 
unique_¸ashes
++;

3206 
œ°_¸ash_time
 = 
	`gë_cur_time
();

3210 
FAULT_ERROR
: 
	`FATAL
("UnableÅoÉxecuteÅargetápplication");

3212 :  
kìpög
;

3219 
fd
 = 
	`›í
(
‚
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

3220 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
‚
);

3221 
	`ck_wrôe
(
fd
, 
mem
, 
Àn
, 
‚
);

3222 
	`˛o£
(
fd
);

3224 
	`ck_‰ì
(
‚
);

3226  
kìpög
;

3228 
	}
}

3234 
u32
 
	$föd_°¨t_posôi⁄
() {

3236 
u8
 
tmp
[4096];

3238 
u8
 *
‚
, *
off
;

3239 
s32
 
fd
, 
i
;

3240 
u32
 
ªt
;

3242 i‡(!
ªsumög_fuzz
)  0;

3244 i‡(
ö_∂a˚_ªsume
Ë
‚
 = 
	`Æloc_¥ötf
("%s/fuzzî_°©s", 
out_dú
);

3245 
‚
 = 
	`Æloc_¥ötf
("%s/../fuzzî_°©s", 
ö_dú
);

3247 
fd
 = 
	`›í
(
‚
, 
O_RDONLY
);

3248 
	`ck_‰ì
(
‚
);

3250 i‡(
fd
 < 0)  0;

3252 
i
 = 
	`ªad
(
fd
, 
tmp
, (tmp) - 1); ()i;

3253 
	`˛o£
(
fd
);

3255 
off
 = 
	`°r°r
(
tmp
, "cur_path : ");

3256 i‡(!
off
)  0;

3258 
ªt
 = 
	`©oi
(
off
 + 17);

3259 i‡(
ªt
 >
queued_∑ths
)Ñet = 0;

3260  
ªt
;

3262 
	}
}

3269 
	$föd_timeout
() {

3271 
u8
 
tmp
[4096];

3273 
u8
 *
‚
, *
off
;

3274 
s32
 
fd
, 
i
;

3275 
u32
 
ªt
;

3277 i‡(!
ªsumög_fuzz
) ;

3279 i‡(
ö_∂a˚_ªsume
Ë
‚
 = 
	`Æloc_¥ötf
("%s/fuzzî_°©s", 
out_dú
);

3280 
‚
 = 
	`Æloc_¥ötf
("%s/../fuzzî_°©s", 
ö_dú
);

3282 
fd
 = 
	`›í
(
‚
, 
O_RDONLY
);

3283 
	`ck_‰ì
(
‚
);

3285 i‡(
fd
 < 0) ;

3287 
i
 = 
	`ªad
(
fd
, 
tmp
, (tmp) - 1); ()i;

3288 
	`˛o£
(
fd
);

3290 
off
 = 
	`°r°r
(
tmp
, "exec_timeout : ");

3291 i‡(!
off
) ;

3293 
ªt
 = 
	`©oi
(
off
 + 17);

3294 i‡(
ªt
 <= 4) ;

3296 
exec_tmout
 = 
ªt
;

3297 
timeout_giví
 = 3;

3299 
	}
}

3304 
	$wrôe_°©s_fûe
(
bôm≠_cvg
, 
ïs
) {

3306 
œ°_bcvg
, 
œ°_ïs
;

3308 
u8
* 
‚
 = 
	`Æloc_¥ötf
("%s/fuzzî_°©s", 
out_dú
);

3309 
s32
 
fd
;

3310 
FILE
* 
f
;

3312 
fd
 = 
	`›í
(
‚
, 
O_WRONLY
 | 
O_CREAT
 | 
O_TRUNC
, 0600);

3314 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
‚
);

3316 
	`ck_‰ì
(
‚
);

3318 
f
 = 
	`fd›í
(
fd
, "w");

3320 i‡(!
f
Ë
	`PFATAL
("fdopen() failed");

3325 i‡(!
bôm≠_cvg
 && !
ïs
) {

3326 
bôm≠_cvg
 = 
œ°_bcvg
;

3327 
ïs
 = 
œ°_ïs
;

3329 
œ°_bcvg
 = 
bôm≠_cvg
;

3330 
œ°_ïs
 = 
ïs
;

3333 
	`Ârötf
(
f
, "start_time : %llu\n"

3356 "aÊ_vîsi⁄ : " 
VERSION
 "\n"

3358 
°¨t_time
 / 1000, 
	`gë_cur_time
(Ë/ 1000, 
	`gëpid
(),

3359 
queue_cy˛e
 ? (queue_cy˛ê- 1Ë: 0, 
tŸÆ_execs
, 
ïs
,

3360 
queued_∑ths
, 
queued_Áv‹ed
, 
queued_discovîed
, 
queued_imp‹ãd
,

3361 
max_dïth
, 
cuºít_íåy
, 
≥ndög_Áv‹ed
, 
≥ndög_nŸ_fuzzed
,

3362 
queued_v¨übÀ
, 
bôm≠_cvg
, 
unique_¸ashes
, 
unique_h™gs
,

3363 
œ°_∑th_time
 / 1000, 
œ°_¸ash_time
 / 1000,

3364 
œ°_h™g_time
 / 1000, 
exec_tmout
, 
u£_b™√r
, 
‹ig_cmdlöe
);

3367 
	`f˛o£
(
f
);

3369 
	}
}

3374 
	$maybe_upd©e_∂Ÿ_fûe
(
bôm≠_cvg
, 
ïs
) {

3376 
u32
 
¥ev_qp
, 
¥ev_pf
, 
¥ev_≤f
, 
¥ev_˚
, 
¥ev_md
;

3377 
u64
 
¥ev_qc
, 
¥ev_uc
, 
¥ev_uh
;

3379 i‡(
¥ev_qp
 =
queued_∑ths
 && 
¥ev_pf
 =
≥ndög_Áv‹ed
 &&

3380 
¥ev_≤f
 =
≥ndög_nŸ_fuzzed
 && 
¥ev_˚
 =
cuºít_íåy
 &&

3381 
¥ev_qc
 =
queue_cy˛e
 && 
¥ev_uc
 =
unique_¸ashes
 &&

3382 
¥ev_uh
 =
unique_h™gs
 && 
¥ev_md
 =
max_dïth
) ;

3384 
¥ev_qp
 = 
queued_∑ths
;

3385 
¥ev_pf
 = 
≥ndög_Áv‹ed
;

3386 
¥ev_≤f
 = 
≥ndög_nŸ_fuzzed
;

3387 
¥ev_˚
 = 
cuºít_íåy
;

3388 
¥ev_qc
 = 
queue_cy˛e
;

3389 
¥ev_uc
 = 
unique_¸ashes
;

3390 
¥ev_uh
 = 
unique_h™gs
;

3391 
¥ev_md
 = 
max_dïth
;

3399 
	`Ârötf
(
∂Ÿ_fûe
,

3401 
	`gë_cur_time
(Ë/ 1000, 
queue_cy˛e
 - 1, 
cuºít_íåy
, 
queued_∑ths
,

3402 
≥ndög_nŸ_fuzzed
, 
≥ndög_Áv‹ed
, 
bôm≠_cvg
, 
unique_¸ashes
,

3403 
unique_h™gs
, 
max_dïth
, 
ïs
);

3405 
	`fÊush
(
∂Ÿ_fûe
);

3407 
	}
}

3414 
u8
 
	$dñëe_fûes
(
u8
* 
∑th
, u8* 
¥efix
) {

3416 
DIR
* 
d
;

3417 
dúít
* 
d_ít
;

3419 
d
 = 
	`›ídú
(
∑th
);

3421 i‡(!
d
)  0;

3423 (
d_ít
 = 
	`ªaddú
(
d
))) {

3425 i‡(
d_ít
->
d_«me
[0] !'.' && (!
¥efix
 ||

3426 !
	`°∫cmp
(
d_ít
->
d_«me
, 
¥efix
, 
	`°æí
(prefix)))) {

3428 
u8
* 
‚ame
 = 
	`Æloc_¥ötf
("%s/%s", 
∑th
, 
d_ít
->
d_«me
);

3429 i‡(
	`u∆ök
(
‚ame
)Ë
	`PFATAL
("UnableÅo delete '%s'", fname);

3430 
	`ck_‰ì
(
‚ame
);

3436 
	`˛o£dú
(
d
);

3438  !!
	`rmdú
(
∑th
);

3440 
	}
}

3445 
	$gë_ru¬abÀ_¥o˚s£s
() {

3447 
ªs
;

3449 #i‡
	`deföed
(
__APPLE__
Ë|| deföed(
__FªeBSD__
Ë|| deföed (
__O≥nBSD__
)

3455 i‡(
	`gëlﬂdavg
(&
ªs
, 1) != 1)  0;

3463 
FILE
* 
f
 = 
	`f›í
("/proc/stat", "r");

3464 
u8
 
tmp
[1024];

3465 
u32
 
vÆ
 = 0;

3467 i‡(!
f
)  0;

3469 
	`fgës
(
tmp
, —mp), 
f
)) {

3471 i‡(!
	`°∫cmp
(
tmp
, "procs_running ", 14) ||

3472 !
	`°∫cmp
(
tmp
, "¥ocs_blocked ", 14)Ë
vÆ
 +
	`©oi
(tmp + 14);

3476 
	`f˛o£
(
f
);

3478 i‡(!
ªs
) {

3480 
ªs
 = 
vÆ
;

3484 
ªs
 =Ñe†* (1.0 - 1.0 / 
AVG_SMOOTHING
) +

3485 (()
vÆ
Ë* (1.0 / 
AVG_SMOOTHING
);

3491  
ªs
;

3493 
	}
}

3498 
	$nuke_ªsume_dú
() {

3500 
u8
* 
‚
;

3502 
‚
 = 
	`Æloc_¥ötf
("%s/_ªsume/.°©e/dëîmöi°ic_d⁄e", 
out_dú
);

3503 i‡(
	`dñëe_fûes
(
‚
, 
CASE_PREFIX
)Ë
dú_˛ónup_Áûed
;

3504 
	`ck_‰ì
(
‚
);

3506 
‚
 = 
	`Æloc_¥ötf
("%s/_ªsume/.°©e/auto_exåas", 
out_dú
);

3507 i‡(
	`dñëe_fûes
(
‚
, "auto_")Ë
dú_˛ónup_Áûed
;

3508 
	`ck_‰ì
(
‚
);

3510 
‚
 = 
	`Æloc_¥ötf
("%s/_ªsume/.°©e/ªdund™t_edges", 
out_dú
);

3511 i‡(
	`dñëe_fûes
(
‚
, 
CASE_PREFIX
)Ë
dú_˛ónup_Áûed
;

3512 
	`ck_‰ì
(
‚
);

3514 
‚
 = 
	`Æloc_¥ötf
("%s/_ªsume/.°©e/v¨übÀ_behavi‹", 
out_dú
);

3515 i‡(
	`dñëe_fûes
(
‚
, 
CASE_PREFIX
)Ë
dú_˛ónup_Áûed
;

3516 
	`ck_‰ì
(
‚
);

3518 
‚
 = 
	`Æloc_¥ötf
("%s/_ªsume/.°©e", 
out_dú
);

3519 i‡(
	`rmdú
(
‚
Ë&& 
î∫o
 !
ENOENT
Ë
dú_˛ónup_Áûed
;

3520 
	`ck_‰ì
(
‚
);

3522 
‚
 = 
	`Æloc_¥ötf
("%s/_ªsume", 
out_dú
);

3523 i‡(
	`dñëe_fûes
(
‚
, 
CASE_PREFIX
)Ë
dú_˛ónup_Áûed
;

3524 
	`ck_‰ì
(
‚
);

3528 
dú_˛ónup_Áûed
:

3530 
	`FATAL
("_resume directory cleanup failed");

3532 
	}
}

3538 
	$maybe_dñëe_out_dú
() {

3540 
FILE
* 
f
;

3541 
u8
 *
‚
 = 
	`Æloc_¥ötf
("%s/fuzzî_°©s", 
out_dú
);

3547 
out_dú_fd
 = 
	`›í
(
out_dú
, 
O_RDONLY
);

3548 i‡(
out_dú_fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
out_dú
);

3550 #i‚de‡
__sun


3552 i‡(
	`Êock
(
out_dú_fd
, 
LOCK_EX
 | 
LOCK_NB
Ë&& 
î∫o
 =
EWOULDBLOCK
) {

3554 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


3558 
sync_id
 ? "fuzzer ID" : "outputÜocation");

3560 
	`FATAL
("Dúe˘‹y '%s' i†ö u£", 
out_dú
);

3566 
f
 = 
	`f›í
(
‚
, "r");

3568 i‡(
f
) {

3570 
u64
 
°¨t_time
, 
œ°_upd©e
;

3572 i‡(
	`fsˇnf
(
f
, "start_time : %llu\n"

3573 "œ°_upd©ê : %Œu\n", &
°¨t_time
, &
œ°_upd©e
) != 2)

3574 
	`FATAL
("MÆf‹med d©®ö '%s'", 
‚
);

3576 
	`f˛o£
(
f
);

3580 i‡(!
ö_∂a˚_ªsume
 && 
œ°_upd©e
 - 
°¨t_time
 > 
OUTPUT_GRACE
 * 60) {

3582 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


3590 "Åryágaö.\n", 
OUTPUT_GRACE
);

3592 
	`FATAL
("At-risk d©®found i¿'%s'", 
out_dú
);

3598 
	`ck_‰ì
(
‚
);

3606 i‡(
ö_∂a˚_ªsume
) {

3608 
u8
* 
‹ig_q
 = 
	`Æloc_¥ötf
("%s/queue", 
out_dú
);

3610 
ö_dú
 = 
	`Æloc_¥ötf
("%s/_ªsume", 
out_dú
);

3612 
	`ª«me
(
‹ig_q
, 
ö_dú
);

3614 
	`OKF
("Output directoryÉxists, willáttempt sessionÑesume.");

3616 
	`ck_‰ì
(
‹ig_q
);

3620 
	`OKF
("Output directoryÉxists but deemed OKÅoÑeuse.");

3624 
	`ACTF
("Deleting old session data...");

3629 
‚
 = 
	`Æloc_¥ötf
("%s/.syn˚d", 
out_dú
);

3630 i‡(
	`dñëe_fûes
(
‚
, 
NULL
)Ë
dú_˛ónup_Áûed
;

3631 
	`ck_‰ì
(
‚
);

3635 
‚
 = 
	`Æloc_¥ötf
("%s/queue/.°©e/dëîmöi°ic_d⁄e", 
out_dú
);

3636 i‡(
	`dñëe_fûes
(
‚
, 
CASE_PREFIX
)Ë
dú_˛ónup_Áûed
;

3637 
	`ck_‰ì
(
‚
);

3639 
‚
 = 
	`Æloc_¥ötf
("%s/queue/.°©e/auto_exåas", 
out_dú
);

3640 i‡(
	`dñëe_fûes
(
‚
, "auto_")Ë
dú_˛ónup_Áûed
;

3641 
	`ck_‰ì
(
‚
);

3643 
‚
 = 
	`Æloc_¥ötf
("%s/queue/.°©e/ªdund™t_edges", 
out_dú
);

3644 i‡(
	`dñëe_fûes
(
‚
, 
CASE_PREFIX
)Ë
dú_˛ónup_Áûed
;

3645 
	`ck_‰ì
(
‚
);

3647 
‚
 = 
	`Æloc_¥ötf
("%s/queue/.°©e/v¨übÀ_behavi‹", 
out_dú
);

3648 i‡(
	`dñëe_fûes
(
‚
, 
CASE_PREFIX
)Ë
dú_˛ónup_Áûed
;

3649 
	`ck_‰ì
(
‚
);

3654 
‚
 = 
	`Æloc_¥ötf
("%s/queue/.°©e", 
out_dú
);

3655 i‡(
	`rmdú
(
‚
Ë&& 
î∫o
 !
ENOENT
Ë
dú_˛ónup_Áûed
;

3656 
	`ck_‰ì
(
‚
);

3658 
‚
 = 
	`Æloc_¥ötf
("%s/queue", 
out_dú
);

3659 i‡(
	`dñëe_fûes
(
‚
, 
CASE_PREFIX
)Ë
dú_˛ónup_Áûed
;

3660 
	`ck_‰ì
(
‚
);

3664 i‡(!
ö_∂a˚_ªsume
) {

3666 
‚
 = 
	`Æloc_¥ötf
("%s/¸ashes/README.txt", 
out_dú
);

3667 
	`u∆ök
(
‚
);

3668 
	`ck_‰ì
(
‚
);

3672 
‚
 = 
	`Æloc_¥ötf
("%s/¸ashes", 
out_dú
);

3677 i‡(
ö_∂a˚_ªsume
 && 
	`rmdú
(
‚
)) {

3679 
time_t
 
cur_t
 = 
	`time
(0);

3680 
tm
* 
t
 = 
	`loˇ…ime
(&
cur_t
);

3682 #i‚de‡
SIMPLE_FILES


3684 
u8
* 
n‚
 = 
	`Æloc_¥ötf
("%s.%04u-%02u-%02u-%02u:%02u:%02u", 
‚
,

3685 
t
->
tm_yór
 + 1900,Å->
tm_m⁄
 + 1,Å->
tm_mday
,

3686 
t
->
tm_hour
,Å->
tm_mö
,Å->
tm_£c
);

3690 
u8
* 
n‚
 = 
	`Æloc_¥ötf
("%s_%04u%02u%02u%02u%02u%02u", 
‚
,

3691 
t
->
tm_yór
 + 1900,Å->
tm_m⁄
 + 1,Å->
tm_mday
,

3692 
t
->
tm_hour
,Å->
tm_mö
,Å->
tm_£c
);

3696 
	`ª«me
(
‚
, 
n‚
);

3697 
	`ck_‰ì
(
n‚
);

3701 i‡(
	`dñëe_fûes
(
‚
, 
CASE_PREFIX
)Ë
dú_˛ónup_Áûed
;

3702 
	`ck_‰ì
(
‚
);

3704 
‚
 = 
	`Æloc_¥ötf
("%s/h™gs", 
out_dú
);

3708 i‡(
ö_∂a˚_ªsume
 && 
	`rmdú
(
‚
)) {

3710 
time_t
 
cur_t
 = 
	`time
(0);

3711 
tm
* 
t
 = 
	`loˇ…ime
(&
cur_t
);

3713 #i‚de‡
SIMPLE_FILES


3715 
u8
* 
n‚
 = 
	`Æloc_¥ötf
("%s.%04u-%02u-%02u-%02u:%02u:%02u", 
‚
,

3716 
t
->
tm_yór
 + 1900,Å->
tm_m⁄
 + 1,Å->
tm_mday
,

3717 
t
->
tm_hour
,Å->
tm_mö
,Å->
tm_£c
);

3721 
u8
* 
n‚
 = 
	`Æloc_¥ötf
("%s_%04u%02u%02u%02u%02u%02u", 
‚
,

3722 
t
->
tm_yór
 + 1900,Å->
tm_m⁄
 + 1,Å->
tm_mday
,

3723 
t
->
tm_hour
,Å->
tm_mö
,Å->
tm_£c
);

3727 
	`ª«me
(
‚
, 
n‚
);

3728 
	`ck_‰ì
(
n‚
);

3732 i‡(
	`dñëe_fûes
(
‚
, 
CASE_PREFIX
)Ë
dú_˛ónup_Áûed
;

3733 
	`ck_‰ì
(
‚
);

3737 
‚
 = 
	`Æloc_¥ötf
("%s/.cur_öput", 
out_dú
);

3738 i‡(
	`u∆ök
(
‚
Ë&& 
î∫o
 !
ENOENT
Ë
dú_˛ónup_Áûed
;

3739 
	`ck_‰ì
(
‚
);

3741 
‚
 = 
	`Æloc_¥ötf
("%s/fuzz_bôm≠", 
out_dú
);

3742 i‡(
	`u∆ök
(
‚
Ë&& 
î∫o
 !
ENOENT
Ë
dú_˛ónup_Áûed
;

3743 
	`ck_‰ì
(
‚
);

3745 i‡(!
ö_∂a˚_ªsume
) {

3746 
‚
 = 
	`Æloc_¥ötf
("%s/fuzzî_°©s", 
out_dú
);

3747 i‡(
	`u∆ök
(
‚
Ë&& 
î∫o
 !
ENOENT
Ë
dú_˛ónup_Áûed
;

3748 
	`ck_‰ì
(
‚
);

3751 
‚
 = 
	`Æloc_¥ötf
("%s/∂Ÿ_d©a", 
out_dú
);

3752 i‡(
	`u∆ök
(
‚
Ë&& 
î∫o
 !
ENOENT
Ë
dú_˛ónup_Áûed
;

3753 
	`ck_‰ì
(
‚
);

3755 
	`OKF
("Output dir cleanup successful.");

3761 
dú_˛ónup_Áûed
:

3763 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


3770 " ouçuàloˇti⁄ f‹Åhêtoﬁ.\n", 
‚
);

3772 
	`FATAL
("Output directory cleanup failed");

3774 
	}
}

3777 
check_ãrm_size
();

3783 
	$show_°©s
() {

3785 
u64
 
œ°_°©s_ms
, 
œ°_∂Ÿ_ms
, 
œ°_ms
, 
œ°_execs
;

3786 
avg_exec
;

3787 
t_byã_øtio
;

3789 
u64
 
cur_ms
;

3790 
u32
 
t_byãs
, 
t_bôs
;

3792 
u32
 
b™√r_Àn
, 
b™√r_∑d
;

3793 
u8
 
tmp
[256];

3795 
cur_ms
 = 
	`gë_cur_time
();

3799 i‡(
cur_ms
 - 
œ°_ms
 < 1000 / 
UI_TARGET_HZ
) ;

3803 i‡(
cur_ms
 - 
°¨t_time
 > 10 * 60 * 1000Ë
run_ovî10m
 = 1;

3807 i‡(!
œ°_execs
) {

3809 
avg_exec
 = (()
tŸÆ_execs
Ë* 1000 / (
cur_ms
 - 
°¨t_time
);

3813 
cur_avg
 = (()(
tŸÆ_execs
 - 
œ°_execs
)) * 1000 /

3814 (
cur_ms
 - 
œ°_ms
);

3819 i‡(
cur_avg
 * 5 < 
avg_exec
 || cur_avg / 5 >ávg_exec)

3820 
avg_exec
 = 
cur_avg
;

3822 
avg_exec
 =ávg_exe¯* (1.0 - 1.0 / 
AVG_SMOOTHING
) +

3823 
cur_avg
 * (1.0 / 
AVG_SMOOTHING
);

3827 
œ°_ms
 = 
cur_ms
;

3828 
œ°_execs
 = 
tŸÆ_execs
;

3832 
°©s_upd©e_‰eq
 = 
avg_exec
 / (
UI_TARGET_HZ
 * 10);

3833 i‡(!
°©s_upd©e_‰eq
) stats_update_freq = 1;

3837 
t_byãs
 = 
	`cou¡_n⁄_255_byãs
(
vúgö_bôs
);

3838 
t_byã_øtio
 = (()
t_byãs
 * 100Ë/ 
MAP_SIZE
;

3842 i‡(
cur_ms
 - 
œ°_°©s_ms
 > 
STATS_UPDATE_SEC
 * 1000) {

3844 
œ°_°©s_ms
 = 
cur_ms
;

3845 
	`wrôe_°©s_fûe
(
t_byã_øtio
, 
avg_exec
);

3846 
	`ßve_auto
();

3847 
	`wrôe_bôm≠
();

3853 i‡(
cur_ms
 - 
œ°_∂Ÿ_ms
 > 
PLOT_UPDATE_SEC
 * 1000) {

3855 
œ°_∂Ÿ_ms
 = 
cur_ms
;

3856 
	`maybe_upd©e_∂Ÿ_fûe
(
t_byã_øtio
, 
avg_exec
);

3862 i‡(!
dumb_mode
 && 
cy˛es_wo_föds
 > 20 && !
≥ndög_nŸ_fuzzed
 &&

3863 
	`gëív
("AFL_EXIT_WHEN_DONE")Ë
°›_so⁄
 = 2;

3865 i‡(
tŸÆ_¸ashes
 && 
	`gëív
("AFL_BENCH_UNTIL_CRASH")Ë
°›_so⁄
 = 2;

3869 i‡(
nŸ_⁄_ây
) ;

3873 
t_bôs
 = (
MAP_SIZE
 << 3Ë- 
	`cou¡_bôs
(
vúgö_bôs
);

3877 i‡(
˛ór_s¸ìn
) {

3879 
	`SAYF
(
TERM_CLEAR
 
CURSOR_HIDE
);

3880 
˛ór_s¸ìn
 = 0;

3882 
	`check_ãrm_size
();

3886 
	`SAYF
(
TERM_HOME
);

3888 i‡(
ãrm_too_smÆl
) {

3890 
	`SAYF
(
cBRI
 "YourÅerminal isÅoo smallÅo displayÅhe UI.\n"

3891 "PÀa£ÑesizêãrmöÆ wödowÅÿ©Üó° 80x25.\n" 
cRST
);

3899 
b™√r_Àn
 = (
¸ash_mode
 ? 24 : 22Ë+ 
	`°æí
(
VERSION
Ë+ såÀn(
u£_b™√r
);

3900 
b™√r_∑d
 = (80 - 
b™√r_Àn
) / 2;

3901 
	`mem£t
(
tmp
, ' ', 
b™√r_∑d
);

3903 
	`•rötf
(
tmp
 + 
b™√r_∑d
, "%†" 
cLCY
 
VERSION
 
cLGN


3904 " (%s)", 
¸ash_mode
 ? 
cPIN
 "peruvian were-rabbit" :

3905 
cYEL
 "amîiˇ¿fuzzyÜ›", 
u£_b™√r
);

3907 
	`SAYF
("\n%s\n\n", 
tmp
);

3911 
	#bSTG
 
bSTART
 
cGRA


	)

3912 
	#bH2
 
bH
 
	)
bH

3913 
	#bH5
 
bH2
 bH2 
bH


	)

3914 
	#bH10
 
bH5
 
	)
bH5

3915 
	#bH20
 
bH10
 
	)
bH10

3916 
	#bH30
 
bH20
 
bH10


	)

3917 
	#SP5
 " "

	)

3918 
	#SP10
 
SP5
 
	)
SP5

3919 
	#SP20
 
SP10
 
	)
SP10

3923 
	`SAYF
(
SET_G1
 
bSTG
 
bLT
 
bH
 
bSTOP
 
cCYA
 "Öro˚s†timög " bSTG 
bH30
 
bH5
 
bH2
 
bHB


3924 
bH
 
bSTOP
 
cCYA
 " ovîÆ»ªsu…†" 
bSTG
 
bH5
 
bRT
 "\n");

3926 i‡(
dumb_mode
) {

3928 
	`°r˝y
(
tmp
, 
cRST
);

3933 i‡(
queue_cy˛e
 =1Ë
	`°r˝y
(
tmp
, 
cMGN
); 

3936 i‡(
cy˛es_wo_föds
 < 3Ë
	`°r˝y
(
tmp
, 
cYEL
); 

3939 i‡(
cy˛es_wo_föds
 > 20 && !
≥ndög_nŸ_fuzzed
Ë
	`°r˝y
(
tmp
, 
cLGN
);

3942 
	`°r˝y
(
tmp
, 
cLBL
);

3946 
	`SAYF
(
bV
 
bSTOP
 "Ñu¿timê: " 
cRST
 "%-34†" 
bSTG
 bV bSTOP

3947 " cy˛e†d⁄ê: %s%-5† " 
bSTG
 
bV
 "\n",

3948 
	`DTD
(
cur_ms
, 
°¨t_time
), 
tmp
, 
	`DI
(
queue_cy˛e
 - 1));

3953 i‡(!
dumb_mode
 && (
œ°_∑th_time
 || 
ªsumög_fuzz
 || 
queue_cy˛e
 == 1 ||

3954 
ö_bôm≠
 || 
¸ash_mode
)) {

3956 
	`SAYF
(
bV
 
bSTOP
 "Üa°ÇewÖ©h : " 
cRST
 "%-34s ",

3957 
	`DTD
(
cur_ms
, 
œ°_∑th_time
));

3961 i‡(
dumb_mode
)

3963 
	`SAYF
(
bV
 
bSTOP
 "Üa°ÇewÖ©h : " 
cPIN
 "n/a" 
cRST


3968 
	`SAYF
(
bV
 
bSTOP
 "Üa°ÇewÖ©h : " 
cRST
 "n⁄êyë " 
cLRD


3973 
	`SAYF
(
bSTG
 
bV
 
bSTOP
 "ÅŸÆÖ©h†: " 
cRST
 "%-5s " bSTG bV "\n",

3974 
	`DI
(
queued_∑ths
));

3979 
	`•rötf
(
tmp
, "%s%s", 
	`DI
(
unique_¸ashes
),

3980 (
unique_¸ashes
 >
KEEP_UNIQUE_CRASH
) ? "+" : "");

3982 
	`SAYF
(
bV
 
bSTOP
 "Üa° uniq cøsh : " 
cRST
 "%-34†" 
bSTG
 bV bSTOP

3983 " uniq cøshe†: %s%-6†" 
bSTG
 
bV
 "\n",

3984 
	`DTD
(
cur_ms
, 
œ°_¸ash_time
), 
unique_¸ashes
 ? 
cLRD
 : 
cRST
,

3985 
tmp
);

3987 
	`•rötf
(
tmp
, "%s%s", 
	`DI
(
unique_h™gs
),

3988 (
unique_h™gs
 >
KEEP_UNIQUE_HANG
) ? "+" : "");

3990 
	`SAYF
(
bV
 
bSTOP
 "Üa° uniq h™g : " 
cRST
 "%-34†" 
bSTG
 bV bSTOP

3991 " uniq h™g†: " 
cRST
 "%-6†" 
bSTG
 
bV
 "\n",

3992 
	`DTD
(
cur_ms
, 
œ°_h™g_time
), 
tmp
);

3994 
	`SAYF
(
bVR
 
bH
 
bSTOP
 
cCYA
 " cy˛ê¥ogªs†" 
bSTG
 
bH20
 
bHB
 bH bSTOP cCYA

3995 " m≠ covîagê" 
bSTG
 
bH
 
bHT
 
bH20
 
bH2
 bH 
bVL
 "\n");

4001 
	`•rötf
(
tmp
, "%s%†(%0.02f%%)", 
	`DI
(
cuºít_íåy
),

4002 
queue_cur
->
Áv‹ed
 ? "" : "*",

4003 (()
cuºít_íåy
 * 100Ë/ 
queued_∑ths
);

4005 
	`SAYF
(
bV
 
bSTOP
 "ÇowÖro˚ssög : " 
cRST
 "%-17†" 
bSTG
 bV bSTOP, 
tmp
);

4008 
	`•rötf
(
tmp
, "%†(%0.02f%%)", 
	`DI
(
t_byãs
), 
t_byã_øtio
);

4010 
	`SAYF
(" m≠ dísôy : %s%-21†" 
bSTG
 
bV
 "\n", 
t_byã_øtio
 > 70 ? 
cLRD
 :

4011 ((
t_byãs
 < 200 && !
dumb_mode
Ë? 
cPIN
 : 
cRST
), 
tmp
);

4013 
	`•rötf
(
tmp
, "%†(%0.02f%%)", 
	`DI
(
cur_skù≥d_∑ths
),

4014 (()
cur_skù≥d_∑ths
 * 100Ë/ 
queued_∑ths
);

4016 
	`SAYF
(
bV
 
bSTOP
 "Ö©h†timed ouà: " 
cRST
 "%-17†" 
bSTG
 bV, 
tmp
);

4018 
	`•rötf
(
tmp
, "%0.02f bits/tuple",

4019 
t_byãs
 ? ((()
t_bôs
) /Å_bytes) : 0);

4021 
	`SAYF
(
bSTOP
 " cou¡ covîagê: " 
cRST
 "%-21†" 
bSTG
 
bV
 "\n", 
tmp
);

4023 
	`SAYF
(
bVR
 
bH
 
bSTOP
 
cCYA
 " sègê¥ogªs†" 
bSTG
 
bH20
 
bX
 bH bSTOP cCYA

4024 " födög†ö dïth " 
bSTG
 
bH20
 
bVL
 "\n");

4026 
	`•rötf
(
tmp
, "%†(%0.02f%%)", 
	`DI
(
queued_Áv‹ed
),

4027 (()
queued_Áv‹ed
Ë* 100 / 
queued_∑ths
);

4031 
	`SAYF
(
bV
 
bSTOP
 "ÇowÅryög : " 
cRST
 "%-21†" 
bSTG
 bV bSTOP

4032 " fav‹edÖ©h†: " 
cRST
 "%-22†" 
bSTG
 
bV
 "\n", 
°age_«me
, 
tmp
);

4034 i‡(!
°age_max
) {

4036 
	`•rötf
(
tmp
, "%s/-", 
	`DI
(
°age_cur
));

4040 
	`•rötf
(
tmp
, "%s/%†(%0.02f%%)", 
	`DI
(
°age_cur
), DI(
°age_max
),

4041 (()
°age_cur
Ë* 100 / 
°age_max
);

4045 
	`SAYF
(
bV
 
bSTOP
 " sègêexec†: " 
cRST
 "%-21†" 
bSTG
 bV bSTOP, 
tmp
);

4047 
	`•rötf
(
tmp
, "%†(%0.02f%%)", 
	`DI
(
queued_wôh_cov
),

4048 (()
queued_wôh_cov
Ë* 100 / 
queued_∑ths
);

4050 
	`SAYF
("ÇewÉdge†⁄ : " 
cRST
 "%-22†" 
bSTG
 
bV
 "\n", 
tmp
);

4052 
	`•rötf
(
tmp
, "%†(%s%†unique)", 
	`DI
(
tŸÆ_¸ashes
), DI(
unique_¸ashes
),

4053 (
unique_¸ashes
 >
KEEP_UNIQUE_CRASH
) ? "+" : "");

4055 i‡(
¸ash_mode
) {

4057 
	`SAYF
(
bV
 
bSTOP
 "ÅŸÆÉxec†: " 
cRST
 "%-21†" 
bSTG
 bV bSTOP

4058 "Çew cøshe†: %s%-22†" 
bSTG
 
bV
 "\n", 
	`DI
(
tŸÆ_execs
),

4059 
unique_¸ashes
 ? 
cLRD
 : 
cRST
, 
tmp
);

4063 
	`SAYF
(
bV
 
bSTOP
 "ÅŸÆÉxec†: " 
cRST
 "%-21†" 
bSTG
 bV bSTOP

4064 "ÅŸÆ cøshe†: %s%-22†" 
bSTG
 
bV
 "\n", 
	`DI
(
tŸÆ_execs
),

4065 
unique_¸ashes
 ? 
cLRD
 : 
cRST
, 
tmp
);

4071 i‡(
avg_exec
 < 100) {

4073 
	`•rötf
(
tmp
, "%s/£¯(%s)", 
	`DF
(
avg_exec
),ávg_exec < 20 ?

4076 
	`SAYF
(
bV
 
bSTOP
 "Éxe¯•ìd : " 
cLRD
 "%-21†", 
tmp
);

4080 
	`•rötf
(
tmp
, "%s/£c", 
	`DF
(
avg_exec
));

4081 
	`SAYF
(
bV
 
bSTOP
 "Éxe¯•ìd : " 
cRST
 "%-21†", 
tmp
);

4085 
	`•rötf
(
tmp
, "%†(%s%†unique)", 
	`DI
(
tŸÆ_h™gs
), DI(
unique_h™gs
),

4086 (
unique_h™gs
 >
KEEP_UNIQUE_HANG
) ? "+" : "");

4088 
	`SAYF
 (
bSTG
 
bV
 
bSTOP
 "ÅŸÆ h™g†: " 
cRST
 "%-22†" bSTG bV "\n", 
tmp
);

4092 
	`SAYF
(
bVR
 
bH
 
cCYA
 
bSTOP
 " fuzzög så©egy yõld†" 
bSTG
 
bH10
 bH 
bHT
 bH10

4093 
bH5
 
bHB
 
bH
 
bSTOP
 
cCYA
 "Ö©h geomëry " 
bSTG
 bH5 
bH2
 bH 
bVL
 "\n");

4095 i‡(
skù_dëîmöi°ic
) {

4097 
	`°r˝y
(
tmp
, "n/a,Ç/a,Ç/a");

4101 
	`•rötf
(
tmp
, "%s/%s, %s/%s, %s/%s",

4102 
	`DI
(
°age_föds
[
STAGE_FLIP1
]), DI(
°age_cy˛es
[STAGE_FLIP1]),

4103 
	`DI
(
°age_föds
[
STAGE_FLIP2
]), DI(
°age_cy˛es
[STAGE_FLIP2]),

4104 
	`DI
(
°age_föds
[
STAGE_FLIP4
]), DI(
°age_cy˛es
[STAGE_FLIP4]));

4108 
	`SAYF
(
bV
 
bSTOP
 " bô flù†: " 
cRST
 "%-37†" 
bSTG
 bV bSTOP "Üevels : "

4109 
cRST
 "%-10†" 
bSTG
 
bV
 "\n", 
tmp
, 
	`DI
(
max_dïth
));

4111 i‡(!
skù_dëîmöi°ic
)

4112 
	`•rötf
(
tmp
, "%s/%s, %s/%s, %s/%s",

4113 
	`DI
(
°age_föds
[
STAGE_FLIP8
]), DI(
°age_cy˛es
[STAGE_FLIP8]),

4114 
	`DI
(
°age_föds
[
STAGE_FLIP16
]), DI(
°age_cy˛es
[STAGE_FLIP16]),

4115 
	`DI
(
°age_föds
[
STAGE_FLIP32
]), DI(
°age_cy˛es
[STAGE_FLIP32]));

4117 
	`SAYF
(
bV
 
bSTOP
 " byã flù†: " 
cRST
 "%-37†" 
bSTG
 bV bSTOP "Öending : "

4118 
cRST
 "%-10†" 
bSTG
 
bV
 "\n", 
tmp
, 
	`DI
(
≥ndög_nŸ_fuzzed
));

4120 i‡(!
skù_dëîmöi°ic
)

4121 
	`•rötf
(
tmp
, "%s/%s, %s/%s, %s/%s",

4122 
	`DI
(
°age_föds
[
STAGE_ARITH8
]), DI(
°age_cy˛es
[STAGE_ARITH8]),

4123 
	`DI
(
°age_föds
[
STAGE_ARITH16
]), DI(
°age_cy˛es
[STAGE_ARITH16]),

4124 
	`DI
(
°age_föds
[
STAGE_ARITH32
]), DI(
°age_cy˛es
[STAGE_ARITH32]));

4126 
	`SAYF
(
bV
 
bSTOP
 "árôhmëic†: " 
cRST
 "%-37†" 
bSTG
 bV bSTOP "Öend fav : "

4127 
cRST
 "%-10†" 
bSTG
 
bV
 "\n", 
tmp
, 
	`DI
(
≥ndög_Áv‹ed
));

4129 i‡(!
skù_dëîmöi°ic
)

4130 
	`•rötf
(
tmp
, "%s/%s, %s/%s, %s/%s",

4131 
	`DI
(
°age_föds
[
STAGE_INTEREST8
]), DI(
°age_cy˛es
[STAGE_INTEREST8]),

4132 
	`DI
(
°age_föds
[
STAGE_INTEREST16
]), DI(
°age_cy˛es
[STAGE_INTEREST16]),

4133 
	`DI
(
°age_föds
[
STAGE_INTEREST32
]), DI(
°age_cy˛es
[STAGE_INTEREST32]));

4135 
	`SAYF
(
bV
 
bSTOP
 " know¿öt†: " 
cRST
 "%-37†" 
bSTG
 bV bSTOP " own finds : "

4136 
cRST
 "%-10†" 
bSTG
 
bV
 "\n", 
tmp
, 
	`DI
(
queued_discovîed
));

4138 i‡(!
skù_dëîmöi°ic
)

4139 
	`•rötf
(
tmp
, "%s/%s, %s/%s, %s/%s",

4140 
	`DI
(
°age_föds
[
STAGE_EXTRAS_UO
]), DI(
°age_cy˛es
[STAGE_EXTRAS_UO]),

4141 
	`DI
(
°age_föds
[
STAGE_EXTRAS_UI
]), DI(
°age_cy˛es
[STAGE_EXTRAS_UI]),

4142 
	`DI
(
°age_föds
[
STAGE_EXTRAS_AO
]), DI(
°age_cy˛es
[STAGE_EXTRAS_AO]));

4144 
	`SAYF
(
bV
 
bSTOP
 " di˘i⁄¨y : " 
cRST
 "%-37†" 
bSTG
 bV bSTOP

4145 " imp‹ãd : " 
cRST
 "%-10†" 
bSTG
 
bV
 "\n", 
tmp
,

4146 
sync_id
 ? 
	`DI
(
queued_imp‹ãd
Ë: (
u8
*)"n/a");

4148 
	`•rötf
(
tmp
, "%s/%s, %s/%s",

4149 
	`DI
(
°age_föds
[
STAGE_HAVOC
]), DI(
°age_cy˛es
[STAGE_HAVOC]),

4150 
	`DI
(
°age_föds
[
STAGE_SPLICE
]), DI(
°age_cy˛es
[STAGE_SPLICE]));

4152 
	`SAYF
(
bV
 
bSTOP
 " havo¯: " 
cRST
 "%-37†" 
bSTG
 bV bSTOP

4153 " v¨übÀ : %s%-10†" 
bSTG
 
bV
 "\n", 
tmp
, 
queued_v¨übÀ
 ? 
cLRD
 : 
cRST
,

4154 
no_v¨_check
 ? (
u8
*)"n/a" : 
	`DI
(
queued_v¨übÀ
));

4156 i‡(!
byãs_åim_out
) {

4158 
	`•rötf
(
tmp
, "n/a, ");

4162 
	`•rötf
(
tmp
, "%0.02f%%/%s, ",

4163 (()(
byãs_åim_ö
 - 
byãs_åim_out
)) * 100 / bytes_trim_in,

4164 
	`DI
(
åim_execs
));

4168 i‡(!
blocks_eff_tŸÆ
) {

4170 
u8
 
tmp2
[128];

4172 
	`•rötf
(
tmp2
, "n/a");

4173 
	`°rˇt
(
tmp
, 
tmp2
);

4177 
u8
 
tmp2
[128];

4179 
	`•rötf
(
tmp2
, "%0.02f%%",

4180 (()(
blocks_eff_tŸÆ
 - 
blocks_eff_£À˘
)) * 100 /

4181 
blocks_eff_tŸÆ
);

4183 
	`°rˇt
(
tmp
, 
tmp2
);

4187 
	`SAYF
(
bV
 
bSTOP
 "Årim : " 
cRST
 "%-37†" 
bSTG
 
bVR
 
bH20
 
bH2
 bH2 
bRB
 "\n"

4188 
bLB
 
bH30
 
bH20
 
bH2
 
bH
 
bRB
 
bSTOP
 
cRST
 
RESET_G1
, 
tmp
);

4192 i‡(
˝u_c‹e_cou¡
) {

4194 
cur_ru¬abÀ
 = 
	`gë_ru¬abÀ_¥o˚s£s
();

4195 
u32
 
cur_utûiz©i⁄
 = 
cur_ru¬abÀ
 * 100 / 
˝u_c‹e_cou¡
;

4197 
u8
* 
˝u_cﬁ‹
 = 
cCYA
;

4201 i‡(
˝u_c‹e_cou¡
 > 1 && 
cur_ru¬abÀ
 + 1 <= cpu_core_count)

4202 
˝u_cﬁ‹
 = 
cLGN
;

4206 i‡(!
no_˝u_mëî_ªd
 && 
cur_utûiz©i⁄
 >150Ë
˝u_cﬁ‹
 = 
cLRD
;

4208 #ifde‡
HAVE_AFFINITY


4210 i‡(
˝u_aff
 >= 0) {

4212 
	`SAYF
(
SP10
 
cGRA
 "[˝u%03u:%s%3u%%" cGRA "]\r" 
cRST
,

4213 
	`MIN
(
˝u_aff
, 999), 
˝u_cﬁ‹
,

4214 
	`MIN
(
cur_utûiz©i⁄
, 999));

4218 
	`SAYF
(
SP10
 
cGRA
 " [˝u:%s%3u%%" cGRA "]\r" 
cRST
,

4219 
˝u_cﬁ‹
, 
	`MIN
(
cur_utûiz©i⁄
, 999));

4225 
	`SAYF
(
SP10
 
cGRA
 " [˝u:%s%3u%%" cGRA "]\r" 
cRST
,

4226 
˝u_cﬁ‹
, 
	`MIN
(
cur_utûiz©i⁄
, 999));

4230 } 
	`SAYF
("\r");

4234 
	`fÊush
(0);

4236 
	}
}

4243 
	$show_öô_°©s
() {

4245 
queue_íåy
* 
q
 = 
queue
;

4246 
u32
 
mö_bôs
 = 0, 
max_bôs
 = 0;

4247 
u64
 
mö_us
 = 0, 
max_us
 = 0;

4248 
u64
 
avg_us
 = 0;

4249 
u32
 
max_Àn
 = 0;

4251 i‡(
tŸÆ_ˇl_cy˛es
Ë
avg_us
 = 
tŸÆ_ˇl_us
 /Åotal_cal_cycles;

4253 
q
) {

4255 i‡(!
mö_us
 || 
q
->
exec_us
 < min_us) min_us = q->exec_us;

4256 i‡(
q
->
exec_us
 > 
max_us
) max_us = q->exec_us;

4258 i‡(!
mö_bôs
 || 
q
->
bôm≠_size
 < min_bits) min_bits = q->bitmap_size;

4259 i‡(
q
->
bôm≠_size
 > 
max_bôs
) max_bits = q->bitmap_size;

4261 i‡(
q
->
Àn
 > 
max_Àn
) max_len = q->len;

4263 
q
 = q->
√xt
;

4267 
	`SAYF
("\n");

4269 i‡(
avg_us
 > (
qemu_mode
 ? 50000 : 10000))

4270 
	`WARNF
(
cLRD
 "TheÅarget binary isÖretty slow! See %s/perf_tips.txt.",

4271 
doc_∑th
);

4275 i‡(
avg_us
 > 50000Ë
havoc_div
 = 10;

4276 i‡(
avg_us
 > 20000Ë
havoc_div
 = 5;

4277 i‡(
avg_us
 > 10000Ë
havoc_div
 = 2;

4279 i‡(!
ªsumög_fuzz
) {

4281 i‡(
max_Àn
 > 50 * 1024)

4282 
	`WARNF
(
cLRD
 "SomeÅest casesáre huge (%s) - see %s/perf_tips.txt!",

4283 
	`DMS
(
max_Àn
), 
doc_∑th
);

4284 i‡(
max_Àn
 > 10 * 1024)

4285 
	`WARNF
("SomeÅest casesáre big (%s) - see %s/perf_tips.txt.",

4286 
	`DMS
(
max_Àn
), 
doc_∑th
);

4288 i‡(
u£Àss_©_°¨t
 && !
ö_bôm≠
)

4289 
	`WARNF
(
cLRD
 "SomeÅest casesÜook useless. Consider usingá smaller set.");

4291 i‡(
queued_∑ths
 > 100)

4292 
	`WARNF
(
cLRD
 "YouÖrobably have farÅoo many input files! ConsiderÅrimming down.");

4293 i‡(
queued_∑ths
 > 20)

4294 
	`WARNF
("You haveÜots of input files;Åry starting small.");

4298 
	`OKF
("Hereáre some useful stats:\n\n"

4300 
cGRA
 " Te° ca£ cou¡ : " 
cRST
 "%u favored, %u variable, %uÅotal\n"

4301 
cGRA
 " Bôm≠Ñ™gê: " 
cRST
 "%uÅo %u bits (average: %0.02f bits)\n"

4302 
cGRA
 " Exe¯timög : " 
cRST
 "%sÅo %s us (average: %s us)\n",

4303 
queued_Áv‹ed
, 
queued_v¨übÀ
, 
queued_∑ths
, 
mö_bôs
, 
max_bôs
,

4304 (()
tŸÆ_bôm≠_size
Ë/ (
tŸÆ_bôm≠_íåõs
 ?Åotal_bitmap_entries : 1),

4305 
	`DI
(
mö_us
), DI(
max_us
), DI(
avg_us
));

4307 i‡(!
timeout_giví
) {

4316 i‡(
avg_us
 > 50000Ë
exec_tmout
 =ávg_us * 2 / 1000;

4317 i‡(
avg_us
 > 10000Ë
exec_tmout
 =ávg_us * 3 / 1000;

4318 
exec_tmout
 = 
avg_us
 * 5 / 1000;

4320 
exec_tmout
 = 
	`MAX
”xec_tmout, 
max_us
 / 1000);

4321 
exec_tmout
 = (exec_tmouà+ 
EXEC_TM_ROUND
) / EXEC_TM_ROUND * EXEC_TM_ROUND;

4323 i‡(
exec_tmout
 > 
EXEC_TIMEOUT
)Éxec_tmout = EXEC_TIMEOUT;

4325 
	`ACTF
("No -t option specified, so I'll useÉxecÅimeout of %u ms.",

4326 
exec_tmout
);

4328 
timeout_giví
 = 1;

4330 } i‡(
timeout_giví
 == 3) {

4332 
	`ACTF
("AµlyögÅimeouà£âög†‰omÑesumed sessi⁄ (%u ms).", 
exec_tmout
);

4336 
	`OKF
("All setándÑeadyÅoÑoll!");

4338 
	}
}

4343 
u32
 
	$√xt_p2
(
u32
 
vÆ
) {

4345 
u32
 
ªt
 = 1;

4346 
vÆ
 > 
ªt
)Ñet <<= 1;

4347  
ªt
;

4349 
	}
}

4356 
u8
 
	$åim_ˇ£
(** 
¨gv
, 
queue_íåy
* 
q
, 
u8
* 
ö_buf
) {

4358 
u8
 
tmp
[64];

4359 
u8
 
˛ón_åa˚
[
MAP_SIZE
];

4361 
u8
 
√eds_wrôe
 = 0, 
Áu…
 = 0;

4362 
u32
 
åim_exec
 = 0;

4363 
u32
 
ªmove_Àn
;

4364 
u32
 
Àn_p2
;

4370 i‡(
q
->
Àn
 < 5)  0;

4372 
°age_«me
 = 
tmp
;

4373 
byãs_åim_ö
 +
q
->
Àn
;

4377 
Àn_p2
 = 
	`√xt_p2
(
q
->
Àn
);

4379 
ªmove_Àn
 = 
	`MAX
(
Àn_p2
 / 
TRIM_START_STEPS
, 
TRIM_MIN_BYTES
);

4384 
ªmove_Àn
 >
	`MAX
(
Àn_p2
 / 
TRIM_END_STEPS
, 
TRIM_MIN_BYTES
)) {

4386 
u32
 
ªmove_pos
 = 
ªmove_Àn
;

4388 
	`•rötf
(
tmp
, "åim %s/%s", 
	`DI
(
ªmove_Àn
), DI(remove_len));

4390 
°age_cur
 = 0;

4391 
°age_max
 = 
q
->
Àn
 / 
ªmove_Àn
;

4393 
ªmove_pos
 < 
q
->
Àn
) {

4395 
u32
 
åim_avaû
 = 
	`MIN
(
ªmove_Àn
, 
q
->
Àn
 - 
ªmove_pos
);

4396 
u32
 
cksum
;

4398 
	`wrôe_wôh_g≠
(
ö_buf
, 
q
->
Àn
, 
ªmove_pos
, 
åim_avaû
);

4400 
Áu…
 = 
	`run_èrgë
(
¨gv
);

4401 
åim_execs
++;

4403 i‡(
°›_so⁄
 || 
Áu…
 =
FAULT_ERROR
Ë
ab‹t_åimmög
;

4407 
cksum
 = 
	`hash32
(
åa˚_bôs
, 
MAP_SIZE
, 
HASH_CONST
);

4414 i‡(
cksum
 =
q
->
exec_cksum
) {

4416 
u32
 
move_èû
 = 
q
->
Àn
 - 
ªmove_pos
 - 
åim_avaû
;

4418 
q
->
Àn
 -
åim_avaû
;

4419 
Àn_p2
 = 
	`√xt_p2
(
q
->
Àn
);

4421 
	`memmove
(
ö_buf
 + 
ªmove_pos
, in_bu‡+Ñemove_po†+ 
åim_avaû
,

4422 
move_èû
);

4427 i‡(!
√eds_wrôe
) {

4429 
√eds_wrôe
 = 1;

4430 
	`mem˝y
(
˛ón_åa˚
, 
åa˚_bôs
, 
MAP_SIZE
);

4434 } 
ªmove_pos
 +
ªmove_Àn
;

4438 i‡(!(
åim_exec
++ % 
°©s_upd©e_‰eq
)Ë
	`show_°©s
();

4439 
°age_cur
++;

4443 
ªmove_Àn
 >>= 1;

4450 i‡(
√eds_wrôe
) {

4452 
s32
 
fd
;

4454 
	`u∆ök
(
q
->
‚ame
);

4456 
fd
 = 
	`›í
(
q
->
‚ame
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

4458 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
q
->
‚ame
);

4460 
	`ck_wrôe
(
fd
, 
ö_buf
, 
q
->
Àn
, q->
‚ame
);

4461 
	`˛o£
(
fd
);

4463 
	`mem˝y
(
åa˚_bôs
, 
˛ón_åa˚
, 
MAP_SIZE
);

4464 
	`upd©e_bôm≠_sc‹e
(
q
);

4470 
ab‹t_åimmög
:

4472 
byãs_åim_out
 +
q
->
Àn
;

4473  
Áu…
;

4475 
	}
}

4482 
EXP_ST
 
u8
 
	$comm⁄_fuzz_°uff
(** 
¨gv
, 
u8
* 
out_buf
, 
u32
 
Àn
) {

4484 
u8
 
Áu…
;

4486 i‡(
po°_h™dÀr
) {

4488 
out_buf
 = 
	`po°_h™dÀr
(out_buf, &
Àn
);

4489 i‡(!
out_buf
 || !
Àn
)  0;

4493 
	`wrôe_to_ã°ˇ£
(
out_buf
, 
Àn
);

4495 
Áu…
 = 
	`run_èrgë
(
¨gv
);

4497 i‡(
°›_so⁄
)  1;

4499 i‡(
Áu…
 =
FAULT_HANG
) {

4501 i‡(
sub£q_h™gs
++ > 
HANG_LIMIT
) {

4502 
cur_skù≥d_∑ths
++;

4506 } 
sub£q_h™gs
 = 0;

4511 i‡(
skù_ªque°ed
) {

4513 
skù_ªque°ed
 = 0;

4514 
cur_skù≥d_∑ths
++;

4521 
queued_discovîed
 +
	`ßve_if_öãª°ög
(
¨gv
, 
out_buf
, 
Àn
, 
Áu…
);

4523 i‡(!(
°age_cur
 % 
°©s_upd©e_‰eq
Ë|| sège_cu∏+ 1 =
°age_max
)

4524 
	`show_°©s
();

4528 
	}
}

4534 
u32
 
	$choo£_block_Àn
(
u32
 
limô
) {

4536 
u32
 
mö_vÆue
, 
max_vÆue
;

4537 
u32
 
æim
 = 
	`MIN
(
queue_cy˛e
, 3);

4539 i‡(!
run_ovî10m
Ë
æim
 = 1;

4541 
	`UR
(
æim
)) {

4543 0: 
mö_vÆue
 = 1;

4544 
max_vÆue
 = 
HAVOC_BLK_SMALL
;

4547 1: 
mö_vÆue
 = 
HAVOC_BLK_SMALL
;

4548 
max_vÆue
 = 
HAVOC_BLK_MEDIUM
;

4551 : 
mö_vÆue
 = 
HAVOC_BLK_MEDIUM
;

4552 
max_vÆue
 = 
HAVOC_BLK_LARGE
;

4557 i‡(
mö_vÆue
 >
limô
) min_value = 1;

4559  
mö_vÆue
 + 
	`UR
(
	`MIN
(
max_vÆue
, 
limô
) - min_value + 1);

4561 
	}
}

4568 
u32
 
	$ˇlcuœã_sc‹e
(
queue_íåy
* 
q
) {

4570 
u32
 
avg_exec_us
 = 
tŸÆ_ˇl_us
 / 
tŸÆ_ˇl_cy˛es
;

4571 
u32
 
avg_bôm≠_size
 = 
tŸÆ_bôm≠_size
 / 
tŸÆ_bôm≠_íåõs
;

4572 
u32
 
≥rf_sc‹e
 = 100;

4578 i‡(
q
->
exec_us
 * 0.1 > 
avg_exec_us
Ë
≥rf_sc‹e
 = 10;

4579 i‡(
q
->
exec_us
 * 0.25 > 
avg_exec_us
Ë
≥rf_sc‹e
 = 25;

4580 i‡(
q
->
exec_us
 * 0.5 > 
avg_exec_us
Ë
≥rf_sc‹e
 = 50;

4581 i‡(
q
->
exec_us
 * 0.75 > 
avg_exec_us
Ë
≥rf_sc‹e
 = 75;

4582 i‡(
q
->
exec_us
 * 4 < 
avg_exec_us
Ë
≥rf_sc‹e
 = 300;

4583 i‡(
q
->
exec_us
 * 3 < 
avg_exec_us
Ë
≥rf_sc‹e
 = 200;

4584 i‡(
q
->
exec_us
 * 2 < 
avg_exec_us
Ë
≥rf_sc‹e
 = 150;

4589 i‡(
q
->
bôm≠_size
 * 0.3 > 
avg_bôm≠_size
Ë
≥rf_sc‹e
 *= 3;

4590 i‡(
q
->
bôm≠_size
 * 0.5 > 
avg_bôm≠_size
Ë
≥rf_sc‹e
 *= 2;

4591 i‡(
q
->
bôm≠_size
 * 0.75 > 
avg_bôm≠_size
Ë
≥rf_sc‹e
 *= 1.5;

4592 i‡(
q
->
bôm≠_size
 * 3 < 
avg_bôm≠_size
Ë
≥rf_sc‹e
 *= 0.25;

4593 i‡(
q
->
bôm≠_size
 * 2 < 
avg_bôm≠_size
Ë
≥rf_sc‹e
 *= 0.5;

4594 i‡(
q
->
bôm≠_size
 * 1.5 < 
avg_bôm≠_size
Ë
≥rf_sc‹e
 *= 0.75;

4600 i‡(
q
->
h™diˇp
 >= 4) {

4602 
≥rf_sc‹e
 *= 4;

4603 
q
->
h™diˇp
 -= 4;

4605 } i‡(
q
->
h™diˇp
) {

4607 
≥rf_sc‹e
 *= 2;

4608 
q
->
h™diˇp
--;

4616 
q
->
dïth
) {

4619 4 ... 7: 
≥rf_sc‹e
 *= 2; ;

4620 8 ... 13: 
≥rf_sc‹e
 *= 4; ;

4621 14 ... 25: 
≥rf_sc‹e
 *= 6; ;

4622 : 
≥rf_sc‹e
 *= 8;

4628 i‡(
≥rf_sc‹e
 > 
HAVOC_MAX_MULT
 * 100)Öerf_score = HAVOC_MAX_MULT * 100;

4630  
≥rf_sc‹e
;

4632 
	}
}

4642 
u8
 
	$could_be_bôÊù
(
u32
 
x‹_vÆ
) {

4644 
u32
 
sh
 = 0;

4646 i‡(!
x‹_vÆ
)  1;

4650 !(
x‹_vÆ
 & 1)Ë{ 
sh
++; xor_val >>= 1; }

4654 i‡(
x‹_vÆ
 == 1 || xor_val == 3 || xor_val == 15)  1;

4659 i‡(
sh
 & 7)  0;

4661 i‡(
x‹_vÆ
 == 0xff || xor_val == 0xffff || xor_val == 0xffffffff)

4666 
	}
}

4672 
u8
 
	$could_be_¨ôh
(
u32
 
ﬁd_vÆ
, u32 
√w_vÆ
, 
u8
 
bÀn
) {

4674 
u32
 
i
, 
ov
 = 0, 
nv
 = 0, 
diffs
 = 0;

4676 i‡(
ﬁd_vÆ
 =
√w_vÆ
)  1;

4680 
i
 = 0; i < 
bÀn
; i++) {

4682 
u8
 
a
 = 
ﬁd_vÆ
 >> (8 * 
i
),

4683 
b
 = 
√w_vÆ
 >> (8 * 
i
);

4685 i‡(
a
 !
b
Ë{ 
diffs
++; 
ov
 =á; 
nv
 = b; }

4691 i‡(
diffs
 == 1) {

4693 i‡((
u8
)(
ov
 - 
nv
Ë<
ARITH_MAX
 ||

4694 (
u8
)(
nv
 - 
ov
Ë<
ARITH_MAX
)  1;

4698 i‡(
bÀn
 == 1)  0;

4702 
diffs
 = 0;

4704 
i
 = 0; i < 
bÀn
 / 2; i++) {

4706 
u16
 
a
 = 
ﬁd_vÆ
 >> (16 * 
i
),

4707 
b
 = 
√w_vÆ
 >> (16 * 
i
);

4709 i‡(
a
 !
b
Ë{ 
diffs
++; 
ov
 =á; 
nv
 = b; }

4715 i‡(
diffs
 == 1) {

4717 i‡((
u16
)(
ov
 - 
nv
Ë<
ARITH_MAX
 ||

4718 (
u16
)(
nv
 - 
ov
Ë<
ARITH_MAX
)  1;

4720 
ov
 = 
	`SWAP16
(ov); 
nv
 = SWAP16(nv);

4722 i‡((
u16
)(
ov
 - 
nv
Ë<
ARITH_MAX
 ||

4723 (
u16
)(
nv
 - 
ov
Ë<
ARITH_MAX
)  1;

4729 i‡(
bÀn
 == 4) {

4731 i‡((
u32
)(
ﬁd_vÆ
 - 
√w_vÆ
Ë<
ARITH_MAX
 ||

4732 (
u32
)(
√w_vÆ
 - 
ﬁd_vÆ
Ë<
ARITH_MAX
)  1;

4734 
√w_vÆ
 = 
	`SWAP32
(new_val);

4735 
ﬁd_vÆ
 = 
	`SWAP32
(old_val);

4737 i‡((
u32
)(
ﬁd_vÆ
 - 
√w_vÆ
Ë<
ARITH_MAX
 ||

4738 (
u32
)(
√w_vÆ
 - 
ﬁd_vÆ
Ë<
ARITH_MAX
)  1;

4744 
	}
}

4753 
u8
 
	$could_be_öãª°
(
u32
 
ﬁd_vÆ
, u32 
√w_vÆ
, 
u8
 
bÀn
, u8 
check_À
) {

4755 
u32
 
i
, 
j
;

4757 i‡(
ﬁd_vÆ
 =
√w_vÆ
)  1;

4762 
i
 = 0; i < 
bÀn
; i++) {

4764 
j
 = 0; j < (
öãª°ög_8
); j++) {

4766 
u32
 
tvÆ
 = (
ﬁd_vÆ
 & ~(0xf‡<< (
i
 * 8))) |

4767 (((
u8
)
öãª°ög_8
[
j
]Ë<< (
i
 * 8));

4769 i‡(
√w_vÆ
 =
tvÆ
)  1;

4778 i‡(
bÀn
 =2 && !
check_À
)  0;

4782 
i
 = 0; i < 
bÀn
 - 1; i++) {

4784 
j
 = 0; j < (
öãª°ög_16
) / 2; j++) {

4786 
u32
 
tvÆ
 = (
ﬁd_vÆ
 & ~(0xfff‡<< (
i
 * 8))) |

4787 (((
u16
)
öãª°ög_16
[
j
]Ë<< (
i
 * 8));

4789 i‡(
√w_vÆ
 =
tvÆ
)  1;

4793 i‡(
bÀn
 > 2) {

4795 
tvÆ
 = (
ﬁd_vÆ
 & ~(0xfff‡<< (
i
 * 8))) |

4796 (
	`SWAP16
(
öãª°ög_16
[
j
]Ë<< (
i
 * 8));

4798 i‡(
√w_vÆ
 =
tvÆ
)  1;

4806 i‡(
bÀn
 =4 && 
check_À
) {

4811 
j
 = 0; j < (
öãª°ög_32
) / 4; j++)

4812 i‡(
√w_vÆ
 =(
u32
)
öãª°ög_32
[
j
])  1;

4818 
	}
}

4825 
u8
 
	$fuzz_⁄e
(** 
¨gv
) {

4827 
s32
 
Àn
, 
fd
, 
ãmp_Àn
, 
i
, 
j
;

4828 
u8
 *
ö_buf
, *
out_buf
, *
‹ig_ö
, *
ex_tmp
, *
eff_m≠
 = 0;

4829 
u64
 
havoc_queued
, 
‹ig_hô_˙t
, 
√w_hô_˙t
;

4830 
u32
 
•li˚_cy˛e
 = 0, 
≥rf_sc‹e
 = 100, 
‹ig_≥rf
, 
¥ev_cksum
, 
eff_˙t
 = 1;

4832 
u8
 
ªt_vÆ
 = 1;

4834 
u8
 
a_cﬁÀ˘
[
MAX_AUTO_EXTRA
];

4835 
u32
 
a_Àn
 = 0;

4837 #ifde‡
IGNORE_FINDS


4842 i‡(
queue_cur
->
dïth
 > 1)  1;

4846 i‡(
≥ndög_Áv‹ed
) {

4852 i‡((
queue_cur
->
was_fuzzed
 || !queue_cur->
Áv‹ed
) &&

4853 
	`UR
(100Ë< 
SKIP_TO_NEW_PROB
)  1;

4855 } i‡(!
dumb_mode
 && !
queue_cur
->
Áv‹ed
 && 
queued_∑ths
 > 10) {

4861 i‡(
queue_cy˛e
 > 1 && !
queue_cur
->
was_fuzzed
) {

4863 i‡(
	`UR
(100Ë< 
SKIP_NFAV_NEW_PROB
)  1;

4867 i‡(
	`UR
(100Ë< 
SKIP_NFAV_OLD_PROB
)  1;

4875 i‡(
nŸ_⁄_ây
)

4876 
	`ACTF
("FuzzögÅe° ca£ #%u (%uÅŸÆ)...", 
cuºít_íåy
, 
queued_∑ths
);

4880 
fd
 = 
	`›í
(
queue_cur
->
‚ame
, 
O_RDONLY
);

4882 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
queue_cur
->
‚ame
);

4884 
Àn
 = 
queue_cur
->len;

4886 
‹ig_ö
 = 
ö_buf
 = 
	`mm≠
(0, 
Àn
, 
PROT_READ
 | 
PROT_WRITE
, 
MAP_PRIVATE
, 
fd
, 0);

4888 i‡(
‹ig_ö
 =
MAP_FAILED
Ë
	`PFATAL
("U«bÀÅÿmm≠ '%s'", 
queue_cur
->
‚ame
);

4890 
	`˛o£
(
fd
);

4896 
out_buf
 = 
	`ck_Æloc_nozîo
(
Àn
);

4898 
sub£q_h™gs
 = 0;

4900 
cur_dïth
 = 
queue_cur
->
dïth
;

4906 i‡(
queue_cur
->
ˇl_Áûed
) {

4908 
u8
 
ªs
 = 
FAULT_HANG
;

4910 i‡(
queue_cur
->
ˇl_Áûed
 < 
CAL_CHANCES
) {

4912 
ªs
 = 
	`ˇlibøã_ˇ£
(
¨gv
, 
queue_cur
, 
ö_buf
, 
queue_cy˛e
 - 1, 0);

4914 i‡(
ªs
 =
FAULT_ERROR
)

4915 
	`FATAL
("UnableÅoÉxecuteÅargetápplication");

4919 i‡(
°›_so⁄
 || 
ªs
 !
¸ash_mode
) {

4920 
cur_skù≥d_∑ths
++;

4921 
ab™d⁄_íåy
;

4930 i‡(!
dumb_mode
 && !
queue_cur
->
åim_d⁄e
) {

4932 
u8
 
ªs
 = 
	`åim_ˇ£
(
¨gv
, 
queue_cur
, 
ö_buf
);

4934 i‡(
ªs
 =
FAULT_ERROR
)

4935 
	`FATAL
("UnableÅoÉxecuteÅargetápplication");

4937 i‡(
°›_so⁄
) {

4938 
cur_skù≥d_∑ths
++;

4939 
ab™d⁄_íåy
;

4944 
queue_cur
->
åim_d⁄e
 = 1;

4946 i‡(
Àn
 !
queue_cur
->len)Üen = queue_cur->len;

4950 
	`mem˝y
(
out_buf
, 
ö_buf
, 
Àn
);

4956 
‹ig_≥rf
 = 
≥rf_sc‹e
 = 
	`ˇlcuœã_sc‹e
(
queue_cur
);

4962 i‡(
skù_dëîmöi°ic
 || 
queue_cur
->
was_fuzzed
 || queue_cur->
∑s£d_dë
)

4963 
havoc_°age
;

4969 
	#FLIP_BIT
(
_¨
, 
_b
) do { \

4970 
u8
* 
_¨f
 = (u8*)(
_¨
); \

4971 
u32
 
_bf
 = (
_b
); \

4972 
_¨f
[(
_bf
) >> 3] ^= (128 >> ((_bf) & 7)); \

4973 } 0)

	)

4977 
°age_sh‹t
 = "flip1";

4978 
°age_max
 = 
Àn
 << 3;

4979 
°age_«me
 = "bitflip 1/1";

4981 
°age_vÆ_ty≥
 = 
STAGE_VAL_NONE
;

4983 
‹ig_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

4985 
¥ev_cksum
 = 
queue_cur
->
exec_cksum
;

4987 
°age_cur
 = 0; sège_cu∏< 
°age_max
; stage_cur++) {

4989 
°age_cur_byã
 = 
°age_cur
 >> 3;

4991 
	`FLIP_BIT
(
out_buf
, 
°age_cur
);

4993 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

4995 
	`FLIP_BIT
(
out_buf
, 
°age_cur
);

5024 i‡(!
dumb_mode
 && (
°age_cur
 & 7) == 7) {

5026 
u32
 
cksum
 = 
	`hash32
(
åa˚_bôs
, 
MAP_SIZE
, 
HASH_CONST
);

5028 i‡(
°age_cur
 =
°age_max
 - 1 && 
cksum
 =
¥ev_cksum
) {

5033 i‡(
a_Àn
 < 
MAX_AUTO_EXTRA
Ë
a_cﬁÀ˘
[a_Àn] = 
out_buf
[
°age_cur
 >> 3];

5034 
a_Àn
++;

5036 i‡(
a_Àn
 >
MIN_AUTO_EXTRA
 &&á_À¿<
MAX_AUTO_EXTRA
)

5037 
	`maybe_add_auto
(
a_cﬁÀ˘
, 
a_Àn
);

5039 } i‡(
cksum
 !
¥ev_cksum
) {

5044 i‡(
a_Àn
 >
MIN_AUTO_EXTRA
 &&á_À¿<
MAX_AUTO_EXTRA
)

5045 
	`maybe_add_auto
(
a_cﬁÀ˘
, 
a_Àn
);

5047 
a_Àn
 = 0;

5048 
¥ev_cksum
 = 
cksum
;

5055 i‡(
cksum
 !
queue_cur
->
exec_cksum
) {

5057 i‡(
a_Àn
 < 
MAX_AUTO_EXTRA
Ë
a_cﬁÀ˘
[a_Àn] = 
out_buf
[
°age_cur
 >> 3];

5058 
a_Àn
++;

5066 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5068 
°age_föds
[
STAGE_FLIP1
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5069 
°age_cy˛es
[
STAGE_FLIP1
] +
°age_max
;

5071 i‡(
queue_cur
->
∑s£d_dë
Ë
havoc_°age
;

5075 
°age_«me
 = "bitflip 2/1";

5076 
°age_sh‹t
 = "flip2";

5077 
°age_max
 = (
Àn
 << 3) - 1;

5079 
‹ig_hô_˙t
 = 
√w_hô_˙t
;

5081 
°age_cur
 = 0; sège_cu∏< 
°age_max
; stage_cur++) {

5083 
°age_cur_byã
 = 
°age_cur
 >> 3;

5085 
	`FLIP_BIT
(
out_buf
, 
°age_cur
);

5086 
	`FLIP_BIT
(
out_buf
, 
°age_cur
 + 1);

5088 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5090 
	`FLIP_BIT
(
out_buf
, 
°age_cur
);

5091 
	`FLIP_BIT
(
out_buf
, 
°age_cur
 + 1);

5095 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5097 
°age_föds
[
STAGE_FLIP2
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5098 
°age_cy˛es
[
STAGE_FLIP2
] +
°age_max
;

5102 
°age_«me
 = "bitflip 4/1";

5103 
°age_sh‹t
 = "flip4";

5104 
°age_max
 = (
Àn
 << 3) - 3;

5106 
‹ig_hô_˙t
 = 
√w_hô_˙t
;

5108 
°age_cur
 = 0; sège_cu∏< 
°age_max
; stage_cur++) {

5110 
°age_cur_byã
 = 
°age_cur
 >> 3;

5112 
	`FLIP_BIT
(
out_buf
, 
°age_cur
);

5113 
	`FLIP_BIT
(
out_buf
, 
°age_cur
 + 1);

5114 
	`FLIP_BIT
(
out_buf
, 
°age_cur
 + 2);

5115 
	`FLIP_BIT
(
out_buf
, 
°age_cur
 + 3);

5117 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5119 
	`FLIP_BIT
(
out_buf
, 
°age_cur
);

5120 
	`FLIP_BIT
(
out_buf
, 
°age_cur
 + 1);

5121 
	`FLIP_BIT
(
out_buf
, 
°age_cur
 + 2);

5122 
	`FLIP_BIT
(
out_buf
, 
°age_cur
 + 3);

5126 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5128 
°age_föds
[
STAGE_FLIP4
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5129 
°age_cy˛es
[
STAGE_FLIP4
] +
°age_max
;

5139 
	#EFF_APOS
(
_p
Ë((_pË>> 
EFF_MAP_SCALE2
)

	)

5140 
	#EFF_REM
(
_x
Ë((_xË& ((1 << 
EFF_MAP_SCALE2
Ë- 1))

	)

5141 
	#EFF_ALEN
(
_l
Ë(
	`EFF_APOS
(_lË+ !!
	`EFF_REM
(_l))

	)

5142 
	#EFF_SPAN_ALEN
(
_p
, 
_l
Ë(
	`EFF_APOS
((_pË+ (_lË- 1Ë- EFF_APOS(_pË+ 1)

	)

5147 
eff_m≠
 = 
	`ck_Æloc
(
	`EFF_ALEN
(
Àn
));

5148 
eff_m≠
[0] = 1;

5150 i‡(
	`EFF_APOS
(
Àn
 - 1) != 0) {

5151 
eff_m≠
[
	`EFF_APOS
(
Àn
 - 1)] = 1;

5152 
eff_˙t
++;

5157 
°age_«me
 = "bitflip 8/8";

5158 
°age_sh‹t
 = "flip8";

5159 
°age_max
 = 
Àn
;

5161 
‹ig_hô_˙t
 = 
√w_hô_˙t
;

5163 
°age_cur
 = 0; sège_cu∏< 
°age_max
; stage_cur++) {

5165 
°age_cur_byã
 = 
°age_cur
;

5167 
out_buf
[
°age_cur
] ^= 0xFF;

5169 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5176 i‡(!
eff_m≠
[
	`EFF_APOS
(
°age_cur
)]) {

5178 
u32
 
cksum
;

5183 i‡(!
dumb_mode
 && 
Àn
 >
EFF_MIN_LEN
)

5184 
cksum
 = 
	`hash32
(
åa˚_bôs
, 
MAP_SIZE
, 
HASH_CONST
);

5186 
cksum
 = ~
queue_cur
->
exec_cksum
;

5188 i‡(
cksum
 !
queue_cur
->
exec_cksum
) {

5189 
eff_m≠
[
	`EFF_APOS
(
°age_cur
)] = 1;

5190 
eff_˙t
++;

5195 
out_buf
[
°age_cur
] ^= 0xFF;

5203 i‡(
eff_˙t
 !
	`EFF_ALEN
(
Àn
) &&

5204 
eff_˙t
 * 100 / 
	`EFF_ALEN
(
Àn
Ë> 
EFF_MAX_PERC
) {

5206 
	`mem£t
(
eff_m≠
, 1, 
	`EFF_ALEN
(
Àn
));

5208 
blocks_eff_£À˘
 +
	`EFF_ALEN
(
Àn
);

5212 
blocks_eff_£À˘
 +
eff_˙t
;

5216 
blocks_eff_tŸÆ
 +
	`EFF_ALEN
(
Àn
);

5218 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5220 
°age_föds
[
STAGE_FLIP8
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5221 
°age_cy˛es
[
STAGE_FLIP8
] +
°age_max
;

5225 i‡(
Àn
 < 2Ë
skù_bôÊù
;

5227 
°age_«me
 = "bitflip 16/8";

5228 
°age_sh‹t
 = "flip16";

5229 
°age_cur
 = 0;

5230 
°age_max
 = 
Àn
 - 1;

5232 
‹ig_hô_˙t
 = 
√w_hô_˙t
;

5234 
i
 = 0; i < 
Àn
 - 1; i++) {

5238 i‡(!
eff_m≠
[
	`EFF_APOS
(
i
)] && !eff_map[EFF_APOS(i + 1)]) {

5239 
°age_max
--;

5243 
°age_cur_byã
 = 
i
;

5245 *(
u16
*)(
out_buf
 + 
i
) ^= 0xFFFF;

5247 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5248 
°age_cur
++;

5250 *(
u16
*)(
out_buf
 + 
i
) ^= 0xFFFF;

5255 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5257 
°age_föds
[
STAGE_FLIP16
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5258 
°age_cy˛es
[
STAGE_FLIP16
] +
°age_max
;

5260 i‡(
Àn
 < 4Ë
skù_bôÊù
;

5264 
°age_«me
 = "bitflip 32/8";

5265 
°age_sh‹t
 = "flip32";

5266 
°age_cur
 = 0;

5267 
°age_max
 = 
Àn
 - 3;

5269 
‹ig_hô_˙t
 = 
√w_hô_˙t
;

5271 
i
 = 0; i < 
Àn
 - 3; i++) {

5274 i‡(!
eff_m≠
[
	`EFF_APOS
(
i
)] && !eff_map[EFF_APOS(i + 1)] &&

5275 !
eff_m≠
[
	`EFF_APOS
(
i
 + 2)] && !eff_map[EFF_APOS(i + 3)]) {

5276 
°age_max
--;

5280 
°age_cur_byã
 = 
i
;

5282 *(
u32
*)(
out_buf
 + 
i
) ^= 0xFFFFFFFF;

5284 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5285 
°age_cur
++;

5287 *(
u32
*)(
out_buf
 + 
i
) ^= 0xFFFFFFFF;

5291 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5293 
°age_föds
[
STAGE_FLIP32
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5294 
°age_cy˛es
[
STAGE_FLIP32
] +
°age_max
;

5296 
skù_bôÊù
:

5304 
°age_«me
 = "arith 8/8";

5305 
°age_sh‹t
 = "arith8";

5306 
°age_cur
 = 0;

5307 
°age_max
 = 2 * 
Àn
 * 
ARITH_MAX
;

5309 
°age_vÆ_ty≥
 = 
STAGE_VAL_LE
;

5311 
‹ig_hô_˙t
 = 
√w_hô_˙t
;

5313 
i
 = 0; i < 
Àn
; i++) {

5315 
u8
 
‹ig
 = 
out_buf
[
i
];

5319 i‡(!
eff_m≠
[
	`EFF_APOS
(
i
)]) {

5320 
°age_max
 -2 * 
ARITH_MAX
;

5324 
°age_cur_byã
 = 
i
;

5326 
j
 = 1; j <
ARITH_MAX
; j++) {

5328 
u8
 
r
 = 
‹ig
 ^ (‹ig + 
j
);

5333 i‡(!
	`could_be_bôÊù
(
r
)) {

5335 
°age_cur_vÆ
 = 
j
;

5336 
out_buf
[
i
] = 
‹ig
 + 
j
;

5338 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5339 
°age_cur
++;

5341 } 
°age_max
--;

5343 
r
 = 
‹ig
 ^ (‹ig - 
j
);

5345 i‡(!
	`could_be_bôÊù
(
r
)) {

5347 
°age_cur_vÆ
 = -
j
;

5348 
out_buf
[
i
] = 
‹ig
 - 
j
;

5350 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5351 
°age_cur
++;

5353 } 
°age_max
--;

5355 
out_buf
[
i
] = 
‹ig
;

5361 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5363 
°age_föds
[
STAGE_ARITH8
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5364 
°age_cy˛es
[
STAGE_ARITH8
] +
°age_max
;

5368 i‡(
Àn
 < 2Ë
skù_¨ôh
;

5370 
°age_«me
 = "arith 16/8";

5371 
°age_sh‹t
 = "arith16";

5372 
°age_cur
 = 0;

5373 
°age_max
 = 4 * (
Àn
 - 1Ë* 
ARITH_MAX
;

5375 
‹ig_hô_˙t
 = 
√w_hô_˙t
;

5377 
i
 = 0; i < 
Àn
 - 1; i++) {

5379 
u16
 
‹ig
 = *(u16*)(
out_buf
 + 
i
);

5383 i‡(!
eff_m≠
[
	`EFF_APOS
(
i
)] && !eff_map[EFF_APOS(i + 1)]) {

5384 
°age_max
 -4 * 
ARITH_MAX
;

5388 
°age_cur_byã
 = 
i
;

5390 
j
 = 1; j <
ARITH_MAX
; j++) {

5392 
u16
 
r1
 = 
‹ig
 ^ (‹ig + 
j
),

5393 
r2
 = 
‹ig
 ^ (‹ig - 
j
),

5394 
r3
 = 
‹ig
 ^ 
	`SWAP16
(SWAP16(‹igË+ 
j
),

5395 
r4
 = 
‹ig
 ^ 
	`SWAP16
(SWAP16(‹igË- 
j
);

5402 
°age_vÆ_ty≥
 = 
STAGE_VAL_LE
;

5404 i‡((
‹ig
 & 0xffË+ 
j
 > 0xf‡&& !
	`could_be_bôÊù
(
r1
)) {

5406 
°age_cur_vÆ
 = 
j
;

5407 *(
u16
*)(
out_buf
 + 
i
Ë
‹ig
 + 
j
;

5409 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5410 
°age_cur
++;

5412 } 
°age_max
--;

5414 i‡((
‹ig
 & 0xffË< 
j
 && !
	`could_be_bôÊù
(
r2
)) {

5416 
°age_cur_vÆ
 = -
j
;

5417 *(
u16
*)(
out_buf
 + 
i
Ë
‹ig
 - 
j
;

5419 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5420 
°age_cur
++;

5422 } 
°age_max
--;

5426 
°age_vÆ_ty≥
 = 
STAGE_VAL_BE
;

5429 i‡((
‹ig
 >> 8Ë+ 
j
 > 0xf‡&& !
	`could_be_bôÊù
(
r3
)) {

5431 
°age_cur_vÆ
 = 
j
;

5432 *(
u16
*)(
out_buf
 + 
i
Ë
	`SWAP16
(SWAP16(
‹ig
Ë+ 
j
);

5434 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5435 
°age_cur
++;

5437 } 
°age_max
--;

5439 i‡((
‹ig
 >> 8Ë< 
j
 && !
	`could_be_bôÊù
(
r4
)) {

5441 
°age_cur_vÆ
 = -
j
;

5442 *(
u16
*)(
out_buf
 + 
i
Ë
	`SWAP16
(SWAP16(
‹ig
Ë- 
j
);

5444 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5445 
°age_cur
++;

5447 } 
°age_max
--;

5449 *(
u16
*)(
out_buf
 + 
i
Ë
‹ig
;

5455 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5457 
°age_föds
[
STAGE_ARITH16
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5458 
°age_cy˛es
[
STAGE_ARITH16
] +
°age_max
;

5462 i‡(
Àn
 < 4Ë
skù_¨ôh
;

5464 
°age_«me
 = "arith 32/8";

5465 
°age_sh‹t
 = "arith32";

5466 
°age_cur
 = 0;

5467 
°age_max
 = 4 * (
Àn
 - 3Ë* 
ARITH_MAX
;

5469 
‹ig_hô_˙t
 = 
√w_hô_˙t
;

5471 
i
 = 0; i < 
Àn
 - 3; i++) {

5473 
u32
 
‹ig
 = *(u32*)(
out_buf
 + 
i
);

5477 i‡(!
eff_m≠
[
	`EFF_APOS
(
i
)] && !eff_map[EFF_APOS(i + 1)] &&

5478 !
eff_m≠
[
	`EFF_APOS
(
i
 + 2)] && !eff_map[EFF_APOS(i + 3)]) {

5479 
°age_max
 -4 * 
ARITH_MAX
;

5483 
°age_cur_byã
 = 
i
;

5485 
j
 = 1; j <
ARITH_MAX
; j++) {

5487 
u32
 
r1
 = 
‹ig
 ^ (‹ig + 
j
),

5488 
r2
 = 
‹ig
 ^ (‹ig - 
j
),

5489 
r3
 = 
‹ig
 ^ 
	`SWAP32
(SWAP32(‹igË+ 
j
),

5490 
r4
 = 
‹ig
 ^ 
	`SWAP32
(SWAP32(‹igË- 
j
);

5495 
°age_vÆ_ty≥
 = 
STAGE_VAL_LE
;

5497 i‡((
‹ig
 & 0xffffË+ 
j
 > 0xfff‡&& !
	`could_be_bôÊù
(
r1
)) {

5499 
°age_cur_vÆ
 = 
j
;

5500 *(
u32
*)(
out_buf
 + 
i
Ë
‹ig
 + 
j
;

5502 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5503 
°age_cur
++;

5505 } 
°age_max
--;

5507 i‡((
‹ig
 & 0xffffË< 
j
 && !
	`could_be_bôÊù
(
r2
)) {

5509 
°age_cur_vÆ
 = -
j
;

5510 *(
u32
*)(
out_buf
 + 
i
Ë
‹ig
 - 
j
;

5512 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5513 
°age_cur
++;

5515 } 
°age_max
--;

5519 
°age_vÆ_ty≥
 = 
STAGE_VAL_BE
;

5521 i‡((
	`SWAP32
(
‹ig
Ë& 0xffffË+ 
j
 > 0xfff‡&& !
	`could_be_bôÊù
(
r3
)) {

5523 
°age_cur_vÆ
 = 
j
;

5524 *(
u32
*)(
out_buf
 + 
i
Ë
	`SWAP32
(SWAP32(
‹ig
Ë+ 
j
);

5526 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5527 
°age_cur
++;

5529 } 
°age_max
--;

5531 i‡((
	`SWAP32
(
‹ig
Ë& 0xffffË< 
j
 && !
	`could_be_bôÊù
(
r4
)) {

5533 
°age_cur_vÆ
 = -
j
;

5534 *(
u32
*)(
out_buf
 + 
i
Ë
	`SWAP32
(SWAP32(
‹ig
Ë- 
j
);

5536 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5537 
°age_cur
++;

5539 } 
°age_max
--;

5541 *(
u32
*)(
out_buf
 + 
i
Ë
‹ig
;

5547 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5549 
°age_föds
[
STAGE_ARITH32
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5550 
°age_cy˛es
[
STAGE_ARITH32
] +
°age_max
;

5552 
skù_¨ôh
:

5558 
°age_«me
 = "interest 8/8";

5559 
°age_sh‹t
 = "int8";

5560 
°age_cur
 = 0;

5561 
°age_max
 = 
Àn
 * (
öãª°ög_8
);

5563 
°age_vÆ_ty≥
 = 
STAGE_VAL_LE
;

5565 
‹ig_hô_˙t
 = 
√w_hô_˙t
;

5569 
i
 = 0; i < 
Àn
; i++) {

5571 
u8
 
‹ig
 = 
out_buf
[
i
];

5575 i‡(!
eff_m≠
[
	`EFF_APOS
(
i
)]) {

5576 
°age_max
 -(
öãª°ög_8
);

5580 
°age_cur_byã
 = 
i
;

5582 
j
 = 0; j < (
öãª°ög_8
); j++) {

5586 i‡(
	`could_be_bôÊù
(
‹ig
 ^ (
u8
)
öãª°ög_8
[
j
]) ||

5587 
	`could_be_¨ôh
(
‹ig
, (
u8
)
öãª°ög_8
[
j
], 1)) {

5588 
°age_max
--;

5592 
°age_cur_vÆ
 = 
öãª°ög_8
[
j
];

5593 
out_buf
[
i
] = 
öãª°ög_8
[
j
];

5595 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5597 
out_buf
[
i
] = 
‹ig
;

5598 
°age_cur
++;

5604 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5606 
°age_föds
[
STAGE_INTEREST8
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5607 
°age_cy˛es
[
STAGE_INTEREST8
] +
°age_max
;

5611 i‡(
Àn
 < 2Ë
skù_öãª°
;

5613 
°age_«me
 = "interest 16/8";

5614 
°age_sh‹t
 = "int16";

5615 
°age_cur
 = 0;

5616 
°age_max
 = 2 * (
Àn
 - 1Ë* ((
öãª°ög_16
) >> 1);

5618 
‹ig_hô_˙t
 = 
√w_hô_˙t
;

5620 
i
 = 0; i < 
Àn
 - 1; i++) {

5622 
u16
 
‹ig
 = *(u16*)(
out_buf
 + 
i
);

5626 i‡(!
eff_m≠
[
	`EFF_APOS
(
i
)] && !eff_map[EFF_APOS(i + 1)]) {

5627 
°age_max
 -(
öãª°ög_16
);

5631 
°age_cur_byã
 = 
i
;

5633 
j
 = 0; j < (
öãª°ög_16
) / 2; j++) {

5635 
°age_cur_vÆ
 = 
öãª°ög_16
[
j
];

5640 i‡(!
	`could_be_bôÊù
(
‹ig
 ^ (
u16
)
öãª°ög_16
[
j
]) &&

5641 !
	`could_be_¨ôh
(
‹ig
, (
u16
)
öãª°ög_16
[
j
], 2) &&

5642 !
	`could_be_öãª°
(
‹ig
, (
u16
)
öãª°ög_16
[
j
], 2, 0)) {

5644 
°age_vÆ_ty≥
 = 
STAGE_VAL_LE
;

5646 *(
u16
*)(
out_buf
 + 
i
Ë
öãª°ög_16
[
j
];

5648 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5649 
°age_cur
++;

5651 } 
°age_max
--;

5653 i‡((
u16
)
öãª°ög_16
[
j
] !
	`SWAP16
(interesting_16[j]) &&

5654 !
	`could_be_bôÊù
(
‹ig
 ^ 
	`SWAP16
(
öãª°ög_16
[
j
])) &&

5655 !
	`could_be_¨ôh
(
‹ig
, 
	`SWAP16
(
öãª°ög_16
[
j
]), 2) &&

5656 !
	`could_be_öãª°
(
‹ig
, 
	`SWAP16
(
öãª°ög_16
[
j
]), 2, 1)) {

5658 
°age_vÆ_ty≥
 = 
STAGE_VAL_BE
;

5660 *(
u16
*)(
out_buf
 + 
i
Ë
	`SWAP16
(
öãª°ög_16
[
j
]);

5661 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5662 
°age_cur
++;

5664 } 
°age_max
--;

5668 *(
u16
*)(
out_buf
 + 
i
Ë
‹ig
;

5672 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5674 
°age_föds
[
STAGE_INTEREST16
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5675 
°age_cy˛es
[
STAGE_INTEREST16
] +
°age_max
;

5677 i‡(
Àn
 < 4Ë
skù_öãª°
;

5681 
°age_«me
 = "interest 32/8";

5682 
°age_sh‹t
 = "int32";

5683 
°age_cur
 = 0;

5684 
°age_max
 = 2 * (
Àn
 - 3Ë* ((
öãª°ög_32
) >> 2);

5686 
‹ig_hô_˙t
 = 
√w_hô_˙t
;

5688 
i
 = 0; i < 
Àn
 - 3; i++) {

5690 
u32
 
‹ig
 = *(u32*)(
out_buf
 + 
i
);

5694 i‡(!
eff_m≠
[
	`EFF_APOS
(
i
)] && !eff_map[EFF_APOS(i + 1)] &&

5695 !
eff_m≠
[
	`EFF_APOS
(
i
 + 2)] && !eff_map[EFF_APOS(i + 3)]) {

5696 
°age_max
 -(
öãª°ög_32
) >> 1;

5700 
°age_cur_byã
 = 
i
;

5702 
j
 = 0; j < (
öãª°ög_32
) / 4; j++) {

5704 
°age_cur_vÆ
 = 
öãª°ög_32
[
j
];

5709 i‡(!
	`could_be_bôÊù
(
‹ig
 ^ (
u32
)
öãª°ög_32
[
j
]) &&

5710 !
	`could_be_¨ôh
(
‹ig
, 
öãª°ög_32
[
j
], 4) &&

5711 !
	`could_be_öãª°
(
‹ig
, 
öãª°ög_32
[
j
], 4, 0)) {

5713 
°age_vÆ_ty≥
 = 
STAGE_VAL_LE
;

5715 *(
u32
*)(
out_buf
 + 
i
Ë
öãª°ög_32
[
j
];

5717 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5718 
°age_cur
++;

5720 } 
°age_max
--;

5722 i‡((
u32
)
öãª°ög_32
[
j
] !
	`SWAP32
(interesting_32[j]) &&

5723 !
	`could_be_bôÊù
(
‹ig
 ^ 
	`SWAP32
(
öãª°ög_32
[
j
])) &&

5724 !
	`could_be_¨ôh
(
‹ig
, 
	`SWAP32
(
öãª°ög_32
[
j
]), 4) &&

5725 !
	`could_be_öãª°
(
‹ig
, 
	`SWAP32
(
öãª°ög_32
[
j
]), 4, 1)) {

5727 
°age_vÆ_ty≥
 = 
STAGE_VAL_BE
;

5729 *(
u32
*)(
out_buf
 + 
i
Ë
	`SWAP32
(
öãª°ög_32
[
j
]);

5730 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5731 
°age_cur
++;

5733 } 
°age_max
--;

5737 *(
u32
*)(
out_buf
 + 
i
Ë
‹ig
;

5741 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5743 
°age_föds
[
STAGE_INTEREST32
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5744 
°age_cy˛es
[
STAGE_INTEREST32
] +
°age_max
;

5746 
skù_öãª°
:

5752 i‡(!
exåas_˙t
Ë
skù_u£r_exåas
;

5756 
°age_«me
 = "userÉxtras (over)";

5757 
°age_sh‹t
 = "ext_UO";

5758 
°age_cur
 = 0;

5759 
°age_max
 = 
exåas_˙t
 * 
Àn
;

5761 
°age_vÆ_ty≥
 = 
STAGE_VAL_NONE
;

5763 
‹ig_hô_˙t
 = 
√w_hô_˙t
;

5765 
i
 = 0; i < 
Àn
; i++) {

5767 
u32
 
œ°_Àn
 = 0;

5769 
°age_cur_byã
 = 
i
;

5776 
j
 = 0; j < 
exåas_˙t
; j++) {

5783 i‡((
exåas_˙t
 > 
MAX_DET_EXTRAS
 && 
	`UR
(extras_cnt) >= MAX_DET_EXTRAS) ||

5784 
exåas
[
j
].
Àn
 >Üí - 
i
 ||

5785 !
	`memcmp
(
exåas
[
j
].
d©a
, 
out_buf
 + 
i
,Éxåas[j].
Àn
) ||

5786 !
	`memchr
(
eff_m≠
 + 
	`EFF_APOS
(
i
), 1, 
	`EFF_SPAN_ALEN
(i, 
exåas
[
j
].
Àn
))) {

5788 
°age_max
--;

5793 
œ°_Àn
 = 
exåas
[
j
].
Àn
;

5794 
	`mem˝y
(
out_buf
 + 
i
, 
exåas
[
j
].
d©a
, 
œ°_Àn
);

5796 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5798 
°age_cur
++;

5803 
	`mem˝y
(
out_buf
 + 
i
, 
ö_buf
 + i, 
œ°_Àn
);

5807 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5809 
°age_föds
[
STAGE_EXTRAS_UO
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5810 
°age_cy˛es
[
STAGE_EXTRAS_UO
] +
°age_max
;

5814 
°age_«me
 = "userÉxtras (insert)";

5815 
°age_sh‹t
 = "ext_UI";

5816 
°age_cur
 = 0;

5817 
°age_max
 = 
exåas_˙t
 * 
Àn
;

5819 
‹ig_hô_˙t
 = 
√w_hô_˙t
;

5821 
ex_tmp
 = 
	`ck_Æloc
(
Àn
 + 
MAX_DICT_FILE
);

5823 
i
 = 0; i < 
Àn
; i++) {

5825 
°age_cur_byã
 = 
i
;

5827 
j
 = 0; j < 
exåas_˙t
; j++) {

5829 i‡(
Àn
 + 
exåas
[
j
].À¿> 
MAX_FILE
) {

5830 
°age_max
--;

5835 
	`mem˝y
(
ex_tmp
 + 
i
, 
exåas
[
j
].
d©a
,Éxåas[j].
Àn
);

5838 
	`mem˝y
(
ex_tmp
 + 
i
 + 
exåas
[
j
].
Àn
, 
out_buf
 + i,Üen - i);

5840 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
ex_tmp
, 
Àn
 + 
exåas
[
j
].len)) {

5841 
	`ck_‰ì
(
ex_tmp
);

5842 
ab™d⁄_íåy
;

5845 
°age_cur
++;

5850 
ex_tmp
[
i
] = 
out_buf
[i];

5854 
	`ck_‰ì
(
ex_tmp
);

5856 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5858 
°age_föds
[
STAGE_EXTRAS_UI
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5859 
°age_cy˛es
[
STAGE_EXTRAS_UI
] +
°age_max
;

5861 
skù_u£r_exåas
:

5863 i‡(!
a_exåas_˙t
Ë
skù_exåas
;

5865 
°age_«me
 = "autoÉxtras (over)";

5866 
°age_sh‹t
 = "ext_AO";

5867 
°age_cur
 = 0;

5868 
°age_max
 = 
	`MIN
(
a_exåas_˙t
, 
USE_AUTO_EXTRAS
Ë* 
Àn
;

5870 
°age_vÆ_ty≥
 = 
STAGE_VAL_NONE
;

5872 
‹ig_hô_˙t
 = 
√w_hô_˙t
;

5874 
i
 = 0; i < 
Àn
; i++) {

5876 
u32
 
œ°_Àn
 = 0;

5878 
°age_cur_byã
 = 
i
;

5880 
j
 = 0; j < 
	`MIN
(
a_exåas_˙t
, 
USE_AUTO_EXTRAS
); j++) {

5884 i‡(
a_exåas
[
j
].
Àn
 >Üí - 
i
 ||

5885 !
	`memcmp
(
a_exåas
[
j
].
d©a
, 
out_buf
 + 
i
,á_exåas[j].
Àn
) ||

5886 !
	`memchr
(
eff_m≠
 + 
	`EFF_APOS
(
i
), 1, 
	`EFF_SPAN_ALEN
(i, 
a_exåas
[
j
].
Àn
))) {

5888 
°age_max
--;

5893 
œ°_Àn
 = 
a_exåas
[
j
].
Àn
;

5894 
	`mem˝y
(
out_buf
 + 
i
, 
a_exåas
[
j
].
d©a
, 
œ°_Àn
);

5896 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
Àn
)Ë
ab™d⁄_íåy
;

5898 
°age_cur
++;

5903 
	`mem˝y
(
out_buf
 + 
i
, 
ö_buf
 + i, 
œ°_Àn
);

5907 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5909 
°age_föds
[
STAGE_EXTRAS_AO
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

5910 
°age_cy˛es
[
STAGE_EXTRAS_AO
] +
°age_max
;

5912 
skù_exåas
:

5918 i‡(!
queue_cur
->
∑s£d_dë
Ë
	`m¨k_as_dë_d⁄e
(queue_cur);

5924 
havoc_°age
:

5926 
°age_cur_byã
 = -1;

5931 i‡(!
•li˚_cy˛e
) {

5933 
°age_«me
 = "havoc";

5934 
°age_sh‹t
 = "havoc";

5935 
°age_max
 = 
HAVOC_CYCLES
 * 
≥rf_sc‹e
 / 
havoc_div
 / 100;

5939 
u8
 
tmp
[32];

5941 
≥rf_sc‹e
 = 
‹ig_≥rf
;

5943 
	`•rötf
(
tmp
, "•li˚ %u", 
•li˚_cy˛e
);

5944 
°age_«me
 = 
tmp
;

5945 
°age_sh‹t
 = "splice";

5946 
°age_max
 = 
SPLICE_HAVOC
 * 
≥rf_sc‹e
 / 
havoc_div
 / 100;

5950 i‡(
°age_max
 < 
HAVOC_MIN
) stage_max = HAVOC_MIN;

5952 
ãmp_Àn
 = 
Àn
;

5954 
‹ig_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

5956 
havoc_queued
 = 
queued_∑ths
;

5961 
°age_cur
 = 0; sège_cu∏< 
°age_max
; stage_cur++) {

5963 
u32
 
u£_°ackög
 = 1 << (1 + 
	`UR
(
HAVOC_STACK_POW2
));

5965 
°age_cur_vÆ
 = 
u£_°ackög
;

5967 
i
 = 0; i < 
u£_°ackög
; i++) {

5969 
	`UR
(15 + ((
exåas_˙t
 + 
a_exåas_˙t
) ? 2 : 0))) {

5975 
	`FLIP_BIT
(
out_buf
, 
	`UR
(
ãmp_Àn
 << 3));

5982 
out_buf
[
	`UR
(
ãmp_Àn
)] = 
öãª°ög_8
[UR((interesting_8))];

5989 i‡(
ãmp_Àn
 < 2) ;

5991 i‡(
	`UR
(2)) {

5993 *(
u16
*)(
out_buf
 + 
	`UR
(
ãmp_Àn
 - 1)) =

5994 
öãª°ög_16
[
	`UR
((interesting_16) >> 1)];

5998 *(
u16
*)(
out_buf
 + 
	`UR
(
ãmp_Àn
 - 1)Ë
	`SWAP16
(

5999 
öãª°ög_16
[
	`UR
((interesting_16) >> 1)]);

6009 i‡(
ãmp_Àn
 < 4) ;

6011 i‡(
	`UR
(2)) {

6013 *(
u32
*)(
out_buf
 + 
	`UR
(
ãmp_Àn
 - 3)) =

6014 
öãª°ög_32
[
	`UR
((interesting_32) >> 2)];

6018 *(
u32
*)(
out_buf
 + 
	`UR
(
ãmp_Àn
 - 3)Ë
	`SWAP32
(

6019 
öãª°ög_32
[
	`UR
((interesting_32) >> 2)]);

6029 
out_buf
[
	`UR
(
ãmp_Àn
)] -1 + UR(
ARITH_MAX
);

6036 
out_buf
[
	`UR
(
ãmp_Àn
)] +1 + UR(
ARITH_MAX
);

6043 i‡(
ãmp_Àn
 < 2) ;

6045 i‡(
	`UR
(2)) {

6047 
u32
 
pos
 = 
	`UR
(
ãmp_Àn
 - 1);

6049 *(
u16
*)(
out_buf
 + 
pos
Ë-1 + 
	`UR
(
ARITH_MAX
);

6053 
u32
 
pos
 = 
	`UR
(
ãmp_Àn
 - 1);

6054 
u16
 
num
 = 1 + 
	`UR
(
ARITH_MAX
);

6056 *(
u16
*)(
out_buf
 + 
pos
) =

6057 
	`SWAP16
(SWAP16(*(
u16
*)(
out_buf
 + 
pos
)Ë- 
num
);

6067 i‡(
ãmp_Àn
 < 2) ;

6069 i‡(
	`UR
(2)) {

6071 
u32
 
pos
 = 
	`UR
(
ãmp_Àn
 - 1);

6073 *(
u16
*)(
out_buf
 + 
pos
Ë+1 + 
	`UR
(
ARITH_MAX
);

6077 
u32
 
pos
 = 
	`UR
(
ãmp_Àn
 - 1);

6078 
u16
 
num
 = 1 + 
	`UR
(
ARITH_MAX
);

6080 *(
u16
*)(
out_buf
 + 
pos
) =

6081 
	`SWAP16
(SWAP16(*(
u16
*)(
out_buf
 + 
pos
)Ë+ 
num
);

6091 i‡(
ãmp_Àn
 < 4) ;

6093 i‡(
	`UR
(2)) {

6095 
u32
 
pos
 = 
	`UR
(
ãmp_Àn
 - 3);

6097 *(
u32
*)(
out_buf
 + 
pos
Ë-1 + 
	`UR
(
ARITH_MAX
);

6101 
u32
 
pos
 = 
	`UR
(
ãmp_Àn
 - 3);

6102 
u32
 
num
 = 1 + 
	`UR
(
ARITH_MAX
);

6104 *(
u32
*)(
out_buf
 + 
pos
) =

6105 
	`SWAP32
(SWAP32(*(
u32
*)(
out_buf
 + 
pos
)Ë- 
num
);

6115 i‡(
ãmp_Àn
 < 4) ;

6117 i‡(
	`UR
(2)) {

6119 
u32
 
pos
 = 
	`UR
(
ãmp_Àn
 - 3);

6121 *(
u32
*)(
out_buf
 + 
pos
Ë+1 + 
	`UR
(
ARITH_MAX
);

6125 
u32
 
pos
 = 
	`UR
(
ãmp_Àn
 - 3);

6126 
u32
 
num
 = 1 + 
	`UR
(
ARITH_MAX
);

6128 *(
u32
*)(
out_buf
 + 
pos
) =

6129 
	`SWAP32
(SWAP32(*(
u32
*)(
out_buf
 + 
pos
)Ë+ 
num
);

6141 
out_buf
[
	`UR
(
ãmp_Àn
)] ^= 1 + UR(255);

6150 
u32
 
dñ_‰om
, 
dñ_Àn
;

6152 i‡(
ãmp_Àn
 < 2) ;

6156 
dñ_Àn
 = 
	`choo£_block_Àn
(
ãmp_Àn
 - 1);

6158 
dñ_‰om
 = 
	`UR
(
ãmp_Àn
 - 
dñ_Àn
 + 1);

6160 
	`memmove
(
out_buf
 + 
dñ_‰om
, out_bu‡+ dñ_‰om + 
dñ_Àn
,

6161 
ãmp_Àn
 - 
dñ_‰om
 - 
dñ_Àn
);

6163 
ãmp_Àn
 -
dñ_Àn
;

6171 i‡(
ãmp_Àn
 + 
HAVOC_BLK_LARGE
 < 
MAX_FILE
) {

6175 
u32
 
˛⁄e_‰om
, 
˛⁄e_to
, 
˛⁄e_Àn
;

6176 
u8
* 
√w_buf
;

6178 
˛⁄e_Àn
 = 
	`choo£_block_Àn
(
ãmp_Àn
);

6180 
˛⁄e_‰om
 = 
	`UR
(
ãmp_Àn
 - 
˛⁄e_Àn
 + 1);

6181 
˛⁄e_to
 = 
	`UR
(
ãmp_Àn
);

6183 
√w_buf
 = 
	`ck_Æloc_nozîo
(
ãmp_Àn
 + 
˛⁄e_Àn
);

6187 
	`mem˝y
(
√w_buf
, 
out_buf
, 
˛⁄e_to
);

6191 i‡(
	`UR
(4))

6192 
	`mem˝y
(
√w_buf
 + 
˛⁄e_to
, 
out_buf
 + 
˛⁄e_‰om
, 
˛⁄e_Àn
);

6194 
	`mem£t
(
√w_buf
 + 
˛⁄e_to
, 
	`UR
(256), 
˛⁄e_Àn
);

6197 
	`mem˝y
(
√w_buf
 + 
˛⁄e_to
 + 
˛⁄e_Àn
, 
out_buf
 + clone_to,

6198 
ãmp_Àn
 - 
˛⁄e_to
);

6200 
	`ck_‰ì
(
out_buf
);

6201 
out_buf
 = 
√w_buf
;

6202 
ãmp_Àn
 +
˛⁄e_Àn
;

6213 
u32
 
c›y_‰om
, 
c›y_to
, 
c›y_Àn
;

6215 i‡(
ãmp_Àn
 < 2) ;

6217 
c›y_Àn
 = 
	`choo£_block_Àn
(
ãmp_Àn
 - 1);

6219 
c›y_‰om
 = 
	`UR
(
ãmp_Àn
 - 
c›y_Àn
 + 1);

6220 
c›y_to
 = 
	`UR
(
ãmp_Àn
 - 
c›y_Àn
 + 1);

6222 i‡(
	`UR
(4)) {

6224 i‡(
c›y_‰om
 !
c›y_to
)

6225 
	`memmove
(
out_buf
 + 
c›y_to
, out_bu‡+ 
c›y_‰om
, 
c›y_Àn
);

6227 } 
	`mem£t
(
out_buf
 + 
c›y_to
, 
	`UR
(256), 
c›y_Àn
);

6240 i‡(!
exåas_˙t
 || (
a_exåas_˙t
 && 
	`UR
(2))) {

6245 
u32
 
u£_exåa
 = 
	`UR
(
a_exåas_˙t
);

6246 
u32
 
exåa_Àn
 = 
a_exåas
[
u£_exåa
].
Àn
;

6247 
u32
 
ö£π_©
;

6249 i‡(
exåa_Àn
 > 
ãmp_Àn
) ;

6251 
ö£π_©
 = 
	`UR
(
ãmp_Àn
 - 
exåa_Àn
 + 1);

6252 
	`mem˝y
(
out_buf
 + 
ö£π_©
, 
a_exåas
[
u£_exåa
].
d©a
, 
exåa_Àn
);

6258 
u32
 
u£_exåa
 = 
	`UR
(
exåas_˙t
);

6259 
u32
 
exåa_Àn
 = 
exåas
[
u£_exåa
].
Àn
;

6260 
u32
 
ö£π_©
;

6262 i‡(
exåa_Àn
 > 
ãmp_Àn
) ;

6264 
ö£π_©
 = 
	`UR
(
ãmp_Àn
 - 
exåa_Àn
 + 1);

6265 
	`mem˝y
(
out_buf
 + 
ö£π_©
, 
exåas
[
u£_exåa
].
d©a
, 
exåa_Àn
);

6275 
u32
 
u£_exåa
, 
exåa_Àn
, 
ö£π_©
 = 
	`UR
(
ãmp_Àn
);

6276 
u8
* 
√w_buf
;

6281 i‡(!
exåas_˙t
 || (
a_exåas_˙t
 && 
	`UR
(2))) {

6283 
u£_exåa
 = 
	`UR
(
a_exåas_˙t
);

6284 
exåa_Àn
 = 
a_exåas
[
u£_exåa
].
Àn
;

6286 i‡(
ãmp_Àn
 + 
exåa_Àn
 >
MAX_FILE
) ;

6288 
√w_buf
 = 
	`ck_Æloc_nozîo
(
ãmp_Àn
 + 
exåa_Àn
);

6291 
	`mem˝y
(
√w_buf
, 
out_buf
, 
ö£π_©
);

6294 
	`mem˝y
(
√w_buf
 + 
ö£π_©
, 
a_exåas
[
u£_exåa
].
d©a
, 
exåa_Àn
);

6298 
u£_exåa
 = 
	`UR
(
exåas_˙t
);

6299 
exåa_Àn
 = 
exåas
[
u£_exåa
].
Àn
;

6301 i‡(
ãmp_Àn
 + 
exåa_Àn
 >
MAX_FILE
) ;

6303 
√w_buf
 = 
	`ck_Æloc_nozîo
(
ãmp_Àn
 + 
exåa_Àn
);

6306 
	`mem˝y
(
√w_buf
, 
out_buf
, 
ö£π_©
);

6309 
	`mem˝y
(
√w_buf
 + 
ö£π_©
, 
exåas
[
u£_exåa
].
d©a
, 
exåa_Àn
);

6314 
	`mem˝y
(
√w_buf
 + 
ö£π_©
 + 
exåa_Àn
, 
out_buf
 + insert_at,

6315 
ãmp_Àn
 - 
ö£π_©
);

6317 
	`ck_‰ì
(
out_buf
);

6318 
out_buf
 = 
√w_buf
;

6319 
ãmp_Àn
 +
exåa_Àn
;

6329 i‡(
	`comm⁄_fuzz_°uff
(
¨gv
, 
out_buf
, 
ãmp_Àn
))

6330 
ab™d⁄_íåy
;

6335 i‡(
ãmp_Àn
 < 
Àn
Ë
out_buf
 = 
	`ck_ªÆloc
(out_buf,Üen);

6336 
ãmp_Àn
 = 
Àn
;

6337 
	`mem˝y
(
out_buf
, 
ö_buf
, 
Àn
);

6342 i‡(
queued_∑ths
 !
havoc_queued
) {

6344 i‡(
≥rf_sc‹e
 <
HAVOC_MAX_MULT
 * 100) {

6345 
°age_max
 *= 2;

6346 
≥rf_sc‹e
 *= 2;

6349 
havoc_queued
 = 
queued_∑ths
;

6355 
√w_hô_˙t
 = 
queued_∑ths
 + 
unique_¸ashes
;

6357 i‡(!
•li˚_cy˛e
) {

6358 
°age_föds
[
STAGE_HAVOC
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

6359 
°age_cy˛es
[
STAGE_HAVOC
] +
°age_max
;

6361 
°age_föds
[
STAGE_SPLICE
] +
√w_hô_˙t
 - 
‹ig_hô_˙t
;

6362 
°age_cy˛es
[
STAGE_SPLICE
] +
°age_max
;

6365 #i‚de‡
IGNORE_FINDS


6376 
ªåy_•licög
:

6378 i‡(
u£_•licög
 && 
•li˚_cy˛e
++ < 
SPLICE_CYCLES
 &&

6379 
queued_∑ths
 > 1 && 
queue_cur
->
Àn
 > 1) {

6381 
queue_íåy
* 
èrgë
;

6382 
u32
 
tid
, 
•lô_©
;

6383 
u8
* 
√w_buf
;

6384 
s32
 
f_diff
, 
l_diff
;

6389 i‡(
ö_buf
 !
‹ig_ö
) {

6390 
	`ck_‰ì
(
ö_buf
);

6391 
ö_buf
 = 
‹ig_ö
;

6392 
Àn
 = 
queue_cur
->len;

6397 dÿ{ 
tid
 = 
	`UR
(
queued_∑ths
); } tid =
cuºít_íåy
);

6399 
•licög_wôh
 = 
tid
;

6400 
èrgë
 = 
queue
;

6402 
tid
 >100Ë{ 
èrgë
 =Å¨gë->
√xt_100
;Åid -= 100; }

6403 
tid
--Ë
èrgë
 =Å¨gë->
√xt
;

6407 
èrgë
 && (èrgë->
Àn
 < 2 ||Å¨gë =
queue_cur
)) {

6408 
èrgë
 =Å¨gë->
√xt
;

6409 
•licög_wôh
++;

6412 i‡(!
èrgë
Ë
ªåy_•licög
;

6416 
fd
 = 
	`›í
(
èrgë
->
‚ame
, 
O_RDONLY
);

6418 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
èrgë
->
‚ame
);

6420 
√w_buf
 = 
	`ck_Æloc_nozîo
(
èrgë
->
Àn
);

6422 
	`ck_ªad
(
fd
, 
√w_buf
, 
èrgë
->
Àn
,Å¨gë->
‚ame
);

6424 
	`˛o£
(
fd
);

6430 
	`loˇã_diffs
(
ö_buf
, 
√w_buf
, 
	`MIN
(
Àn
, 
èrgë
->Àn), &
f_diff
, &
l_diff
);

6432 i‡(
f_diff
 < 0 || 
l_diff
 < 2 || f_diff ==Ü_diff) {

6433 
	`ck_‰ì
(
√w_buf
);

6434 
ªåy_•licög
;

6439 
•lô_©
 = 
f_diff
 + 
	`UR
(
l_diff
 - f_diff);

6443 
Àn
 = 
èrgë
->len;

6444 
	`mem˝y
(
√w_buf
, 
ö_buf
, 
•lô_©
);

6445 
ö_buf
 = 
√w_buf
;

6447 
	`ck_‰ì
(
out_buf
);

6448 
out_buf
 = 
	`ck_Æloc_nozîo
(
Àn
);

6449 
	`mem˝y
(
out_buf
, 
ö_buf
, 
Àn
);

6451 
havoc_°age
;

6457 
ªt_vÆ
 = 0;

6459 
ab™d⁄_íåy
:

6461 
•licög_wôh
 = -1;

6466 i‡(!
°›_so⁄
 && !
queue_cur
->
ˇl_Áûed
 && !queue_cur->
was_fuzzed
) {

6467 
queue_cur
->
was_fuzzed
 = 1;

6468 
≥ndög_nŸ_fuzzed
--;

6469 i‡(
queue_cur
->
Áv‹ed
Ë
≥ndög_Áv‹ed
--;

6472 
	`munm≠
(
‹ig_ö
, 
queue_cur
->
Àn
);

6474 i‡(
ö_buf
 !
‹ig_ö
Ë
	`ck_‰ì
(in_buf);

6475 
	`ck_‰ì
(
out_buf
);

6476 
	`ck_‰ì
(
eff_m≠
);

6478  
ªt_vÆ
;

6480 #unde‡
FLIP_BIT


6482 
	}
}

6487 
	$sync_fuzzîs
(** 
¨gv
) {

6489 
DIR
* 
sd
;

6490 
dúít
* 
sd_ít
;

6491 
u32
 
sync_˙t
 = 0;

6493 
sd
 = 
	`›ídú
(
sync_dú
);

6494 i‡(!
sd
Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
sync_dú
);

6496 
°age_max
 = 
°age_cur
 = 0;

6497 
cur_dïth
 = 0;

6501 (
sd_ít
 = 
	`ªaddú
(
sd
))) {

6503 
u8
 
°age_tmp
[128];

6505 
DIR
* 
qd
;

6506 
dúít
* 
qd_ít
;

6507 
u8
 *
qd_∑th
, *
qd_syn˚d_∑th
;

6508 
u32
 
mö_ac˚±
 = 0, 
√xt_mö_ac˚±
;

6510 
s32
 
id_fd
;

6514 i‡(
sd_ít
->
d_«me
[0] ='.' || !
	`°rcmp
(
sync_id
, sd_ent->d_name)) ;

6518 
qd_∑th
 = 
	`Æloc_¥ötf
("%s/%s/queue", 
sync_dú
, 
sd_ít
->
d_«me
);

6520 i‡(!(
qd
 = 
	`›ídú
(
qd_∑th
))) {

6521 
	`ck_‰ì
(
qd_∑th
);

6527 
qd_syn˚d_∑th
 = 
	`Æloc_¥ötf
("%s/.syn˚d/%s", 
out_dú
, 
sd_ít
->
d_«me
);

6529 
id_fd
 = 
	`›í
(
qd_syn˚d_∑th
, 
O_RDWR
 | 
O_CREAT
, 0600);

6531 i‡(
id_fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
qd_syn˚d_∑th
);

6533 i‡(
	`ªad
(
id_fd
, &
mö_ac˚±
, (
u32
)) > 0)

6534 
	`l£ek
(
id_fd
, 0, 
SEEK_SET
);

6536 
√xt_mö_ac˚±
 = 
mö_ac˚±
;

6540 
	`•rötf
(
°age_tmp
, "syn¯%u", ++
sync_˙t
);

6541 
°age_«me
 = 
°age_tmp
;

6542 
°age_cur
 = 0;

6543 
°age_max
 = 0;

6548 (
qd_ít
 = 
	`ªaddú
(
qd
))) {

6550 
u8
* 
∑th
;

6551 
s32
 
fd
;

6552 
°©
 
°
;

6554 i‡(
qd_ít
->
d_«me
[0] == '.' ||

6555 
	`ssˇnf
(
qd_ít
->
d_«me
, 
CASE_PREFIX
 "%06u", &
syncög_ˇ£
) != 1 ||

6556 
syncög_ˇ£
 < 
mö_ac˚±
) ;

6560 i‡(
syncög_ˇ£
 >
√xt_mö_ac˚±
)

6561 
√xt_mö_ac˚±
 = 
syncög_ˇ£
 + 1;

6563 
∑th
 = 
	`Æloc_¥ötf
("%s/%s", 
qd_∑th
, 
qd_ít
->
d_«me
);

6565 
fd
 = 
	`›í
(
∑th
, 
O_RDONLY
);

6566 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
∑th
);

6568 i‡(
	`f°©
(
fd
, &
°
)Ë
	`PFATAL
("fstat() failed");

6572 i‡(
°
.
°_size
 && st.°_sizê<
MAX_FILE
) {

6574 
u8
 
Áu…
;

6575 
u8
* 
mem
 = 
	`mm≠
(0, 
°
.
°_size
, 
PROT_READ
, 
MAP_PRIVATE
, 
fd
, 0);

6577 i‡(
mem
 =
MAP_FAILED
Ë
	`PFATAL
("U«bÀÅÿmm≠ '%s'", 
∑th
);

6582 
	`wrôe_to_ã°ˇ£
(
mem
, 
°
.
°_size
);

6584 
Áu…
 = 
	`run_èrgë
(
¨gv
);

6586 i‡(
°›_so⁄
) ;

6588 
syncög_∑πy
 = 
sd_ít
->
d_«me
;

6589 
queued_imp‹ãd
 +
	`ßve_if_öãª°ög
(
¨gv
, 
mem
, 
°
.
°_size
, 
Áu…
);

6590 
syncög_∑πy
 = 0;

6592 
	`munm≠
(
mem
, 
°
.
°_size
);

6594 i‡(!(
°age_cur
++ % 
°©s_upd©e_‰eq
)Ë
	`show_°©s
();

6598 
	`ck_‰ì
(
∑th
);

6599 
	`˛o£
(
fd
);

6603 
	`ck_wrôe
(
id_fd
, &
√xt_mö_ac˚±
, (
u32
), 
qd_syn˚d_∑th
);

6605 
	`˛o£
(
id_fd
);

6606 
	`˛o£dú
(
qd
);

6607 
	`ck_‰ì
(
qd_∑th
);

6608 
	`ck_‰ì
(
qd_syn˚d_∑th
);

6612 
	`˛o£dú
(
sd
);

6614 
	}
}

6619 
	$h™dÀ_°›_sig
(
sig
) {

6621 
°›_so⁄
 = 1;

6623 i‡(
chûd_pid
 > 0Ë
	`kûl
(chûd_pid, 
SIGKILL
);

6624 i‡(
f‹k§v_pid
 > 0Ë
	`kûl
(f‹k§v_pid, 
SIGKILL
);

6626 
	}
}

6631 
	$h™dÀ_skùªq
(
sig
) {

6633 
skù_ªque°ed
 = 1;

6635 
	}
}

6639 
	$h™dÀ_timeout
(
sig
) {

6641 i‡(
chûd_pid
 > 0) {

6643 
chûd_timed_out
 = 1;

6644 
	`kûl
(
chûd_pid
, 
SIGKILL
);

6646 } i‡(
chûd_pid
 =-1 && 
f‹k§v_pid
 > 0) {

6648 
chûd_timed_out
 = 1;

6649 
	`kûl
(
f‹k§v_pid
, 
SIGKILL
);

6653 
	}
}

6660 
EXP_ST
 
	$check_bö¨y
(
u8
* 
‚ame
) {

6662 
u8
* 
ív_∑th
 = 0;

6663 
°©
 
°
;

6665 
s32
 
fd
;

6666 
u8
* 
f_d©a
;

6667 
u32
 
f_Àn
 = 0;

6669 
	`ACTF
("ValidatingÅarget binary...");

6671 i‡(
	`°rchr
(
‚ame
, '/'Ë|| !(
ív_∑th
 = 
	`gëív
("PATH"))) {

6673 
èrgë_∑th
 = 
	`ck_°rdup
(
‚ame
);

6674 i‡(
	`°©
(
èrgë_∑th
, &
°
Ë|| !
	`S_ISREG
(°.
°_mode
) ||

6675 !(
°
.
°_mode
 & 0111Ë|| (
f_Àn
 = st.
°_size
) < 4)

6676 
	`FATAL
("Progøm '%s'ÇŸ found o∏nŸÉxecuèbÀ", 
‚ame
);

6680 
ív_∑th
) {

6682 
u8
 *
cur_ñem
, *
dñim
 = 
	`°rchr
(
ív_∑th
, ':');

6684 i‡(
dñim
) {

6686 
cur_ñem
 = 
	`ck_Æloc
(
dñim
 - 
ív_∑th
 + 1);

6687 
	`mem˝y
(
cur_ñem
, 
ív_∑th
, 
dñim
 -Énv_path);

6688 
dñim
++;

6690 } 
cur_ñem
 = 
	`ck_°rdup
(
ív_∑th
);

6692 
ív_∑th
 = 
dñim
;

6694 i‡(
cur_ñem
[0])

6695 
èrgë_∑th
 = 
	`Æloc_¥ötf
("%s/%s", 
cur_ñem
, 
‚ame
);

6697 
èrgë_∑th
 = 
	`ck_°rdup
(
‚ame
);

6699 
	`ck_‰ì
(
cur_ñem
);

6701 i‡(!
	`°©
(
èrgë_∑th
, &
°
Ë&& 
	`S_ISREG
(°.
°_mode
) &&

6702 (
°
.
°_mode
 & 0111Ë&& (
f_Àn
 = st.
°_size
) >= 4) ;

6704 
	`ck_‰ì
(
èrgë_∑th
);

6705 
èrgë_∑th
 = 0;

6709 i‡(!
èrgë_∑th
Ë
	`FATAL
("Progøm '%s'ÇŸ found o∏nŸÉxecuèbÀ", 
‚ame
);

6713 i‡(
	`gëív
("AFL_SKIP_BIN_CHECK")) ;

6717 i‡((!
	`°∫cmp
(
èrgë_∑th
, "/tmp/", 5Ë&& !
	`°rchr
(target_path + 5, '/')) ||

6718 (!
	`°∫cmp
(
èrgë_∑th
, "/v¨/tmp/", 9Ë&& !
	`°rchr
(target_path + 9, '/')))

6719 
	`FATAL
("Please don't keep binaries in /tmp or /var/tmp");

6721 
fd
 = 
	`›í
(
èrgë_∑th
, 
O_RDONLY
);

6723 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
èrgë_∑th
);

6725 
f_d©a
 = 
	`mm≠
(0, 
f_Àn
, 
PROT_READ
, 
MAP_PRIVATE
, 
fd
, 0);

6727 i‡(
f_d©a
 =
MAP_FAILED
Ë
	`PFATAL
("U«bÀÅÿmm≠ fûê'%s'", 
èrgë_∑th
);

6729 
	`˛o£
(
fd
);

6731 i‡(
f_d©a
[0] == '#' && f_data[1] == '!') {

6733 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


6743 
	`FATAL
("Progøm '%s' i†®shñ»s¸ùt", 
èrgë_∑th
);

6747 #i‚de‡
__APPLE__


6749 i‡(
f_d©a
[0] !0x7‡|| 
	`memcmp
(f_data + 1, "ELF", 3))

6750 
	`FATAL
("Progøm '%s' i†nŸá¿ELF bö¨y", 
èrgë_∑th
);

6754 i‡(
f_d©a
[0] != 0xCF || f_data[1] != 0xFA || f_data[2] != 0xED)

6755 
	`FATAL
("Progøm '%s' i†nŸá 64-bô Mach-O bö¨y", 
èrgë_∑th
);

6759 i‡(!
qemu_mode
 && !
dumb_mode
 &&

6760 !
	`memmem
(
f_d©a
, 
f_Àn
, 
SHM_ENV_VAR
, 
	`°æí
(SHM_ENV_VAR) + 1)) {

6762 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


6773 
doc_∑th
);

6775 
	`FATAL
("No instrumentation detected");

6779 i‡(
qemu_mode
 &&

6780 
	`memmem
(
f_d©a
, 
f_Àn
, 
SHM_ENV_VAR
, 
	`°æí
(SHM_ENV_VAR) + 1)) {

6782 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


6787 
	`FATAL
("Instrumentation found in -Q mode");

6791 i‡(
	`memmem
(
f_d©a
, 
f_Àn
, "libasan.so", 10) ||

6792 
	`memmem
(
f_d©a
, 
f_Àn
, "__mßn_öô", 11)Ë
u£s_aßn
 = 1;

6796 i‡(
	`memmem
(
f_d©a
, 
f_Àn
, 
PERSIST_SIG
, 
	`°æí
(PERSIST_SIG) + 1)) {

6798 
	`OKF
(
cPIN
 "Persistent mode binary detected.");

6799 
	`£ãnv
(
PERSIST_ENV_VAR
, "1", 1);

6800 
no_v¨_check
 = 1;

6802 } i‡(
	`gëív
("AFL_PERSISTENT")) {

6804 
	`WARNF
("AFL_PERSISTENT isÇoÜonger supportedánd may misbehave!");

6808 i‡(
	`memmem
(
f_d©a
, 
f_Àn
, 
DEFER_SIG
, 
	`°æí
(DEFER_SIG) + 1)) {

6810 
	`OKF
(
cPIN
 "Deferred forkserver binary detected.");

6811 
	`£ãnv
(
DEFER_ENV_VAR
, "1", 1);

6813 } i‡(
	`gëív
("AFL_DEFER_FORKSRV")) {

6815 
	`WARNF
("AFL_DEFER_FORKSRV isÇoÜonger supportedánd may misbehave!");

6819 i‡(
	`munm≠
(
f_d©a
, 
f_Àn
)Ë
	`PFATAL
("unmap() failed");

6821 
	}
}

6826 
	$fix_up_b™√r
(
u8
* 
«me
) {

6828 i‡(!
u£_b™√r
) {

6830 i‡(
sync_id
) {

6832 
u£_b™√r
 = 
sync_id
;

6836 
u8
* 
åim
 = 
	`°ºchr
(
«me
, '/');

6837 i‡(!
åim
Ë
u£_b™√r
 = 
«me
; use_banner =Årim + 1;

6843 i‡(
	`°æí
(
u£_b™√r
) > 40) {

6845 
u8
* 
tmp
 = 
	`ck_Æloc
(44);

6846 
	`•rötf
(
tmp
, "%.40s...", 
u£_b™√r
);

6847 
u£_b™√r
 = 
tmp
;

6851 
	}
}

6856 
	$check_if_ây
() {

6858 
wösize
 
ws
;

6860 i‡(
	`io˘l
(1, 
TIOCGWINSZ
, &
ws
)) {

6862 i‡(
î∫o
 =
ENOTTY
) {

6863 
	`OKF
("LooksÜike we'reÇotÑunning onáÅty, so I'll beá bitÜess verbose.");

6864 
nŸ_⁄_ây
 = 1;

6870 
	}
}

6875 
	$check_ãrm_size
() {

6877 
wösize
 
ws
;

6879 
ãrm_too_smÆl
 = 0;

6881 i‡(
	`io˘l
(1, 
TIOCGWINSZ
, &
ws
)) ;

6883 i‡(
ws
.
ws_row
 < 25 || ws.
ws_cﬁ
 < 80Ë
ãrm_too_smÆl
 = 1;

6885 
	}
}

6891 
	$ußge
(
u8
* 
¨gv0
) {

6893 
	`SAYF
("\n%s [ options ] -- /path/to/fuzzed_app [ ... ]\n\n"

6921 
¨gv0
, 
EXEC_TIMEOUT
, 
MEM_LIMIT
, 
doc_∑th
);

6923 
	`exô
(1);

6925 
	}
}

6930 
EXP_ST
 
	$£tup_dús_fds
() {

6932 
u8
* 
tmp
;

6933 
s32
 
fd
;

6935 
	`ACTF
("Setting up output directories...");

6937 i‡(
sync_id
 && 
	`mkdú
(
sync_dú
, 0700Ë&& 
î∫o
 !
EEXIST
)

6938 
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
sync_dú
);

6940 i‡(
	`mkdú
(
out_dú
, 0700)) {

6942 i‡(
î∫o
 !
EEXIST
Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
out_dú
);

6944 
	`maybe_dñëe_out_dú
();

6948 i‡(
ö_∂a˚_ªsume
)

6949 
	`FATAL
("Resumeáttempted but old output directoryÇot found");

6951 
out_dú_fd
 = 
	`›í
(
out_dú
, 
O_RDONLY
);

6953 #i‚de‡
__sun


6955 i‡(
out_dú_fd
 < 0 || 
	`Êock
(out_dú_fd, 
LOCK_EX
 | 
LOCK_NB
))

6956 
	`PFATAL
("UnableÅo flock() output directory.");

6964 
tmp
 = 
	`Æloc_¥ötf
("%s/queue", 
out_dú
);

6965 i‡(
	`mkdú
(
tmp
, 0700)Ë
	`PFATAL
("UnableÅo create '%s'",Åmp);

6966 
	`ck_‰ì
(
tmp
);

6971 
tmp
 = 
	`Æloc_¥ötf
("%s/queue/.°©e/", 
out_dú
);

6972 i‡(
	`mkdú
(
tmp
, 0700)Ë
	`PFATAL
("UnableÅo create '%s'",Åmp);

6973 
	`ck_‰ì
(
tmp
);

6978 
tmp
 = 
	`Æloc_¥ötf
("%s/queue/.°©e/dëîmöi°ic_d⁄e/", 
out_dú
);

6979 i‡(
	`mkdú
(
tmp
, 0700)Ë
	`PFATAL
("UnableÅo create '%s'",Åmp);

6980 
	`ck_‰ì
(
tmp
);

6984 
tmp
 = 
	`Æloc_¥ötf
("%s/queue/.°©e/auto_exåas/", 
out_dú
);

6985 i‡(
	`mkdú
(
tmp
, 0700)Ë
	`PFATAL
("UnableÅo create '%s'",Åmp);

6986 
	`ck_‰ì
(
tmp
);

6990 
tmp
 = 
	`Æloc_¥ötf
("%s/queue/.°©e/ªdund™t_edges/", 
out_dú
);

6991 i‡(
	`mkdú
(
tmp
, 0700)Ë
	`PFATAL
("UnableÅo create '%s'",Åmp);

6992 
	`ck_‰ì
(
tmp
);

6996 
tmp
 = 
	`Æloc_¥ötf
("%s/queue/.°©e/v¨übÀ_behavi‹/", 
out_dú
);

6997 i‡(
	`mkdú
(
tmp
, 0700)Ë
	`PFATAL
("UnableÅo create '%s'",Åmp);

6998 
	`ck_‰ì
(
tmp
);

7002 i‡(
sync_id
) {

7004 
tmp
 = 
	`Æloc_¥ötf
("%s/.syn˚d/", 
out_dú
);

7005 i‡(
	`mkdú
(
tmp
, 0700)Ë
	`PFATAL
("UnableÅo create '%s'",Åmp);

7006 
	`ck_‰ì
(
tmp
);

7012 
tmp
 = 
	`Æloc_¥ötf
("%s/¸ashes", 
out_dú
);

7013 i‡(
	`mkdú
(
tmp
, 0700)Ë
	`PFATAL
("UnableÅo create '%s'",Åmp);

7014 
	`ck_‰ì
(
tmp
);

7018 
tmp
 = 
	`Æloc_¥ötf
("%s/h™gs", 
out_dú
);

7019 i‡(
	`mkdú
(
tmp
, 0700)Ë
	`PFATAL
("UnableÅo create '%s'",Åmp);

7020 
	`ck_‰ì
(
tmp
);

7024 
dev_nuŒ_fd
 = 
	`›í
("/dev/nuŒ", 
O_RDWR
);

7025 i‡(
dev_nuŒ_fd
 < 0Ë
	`PFATAL
("UnableÅo open /dev/null");

7027 
dev_uøndom_fd
 = 
	`›í
("/dev/uøndom", 
O_RDONLY
);

7028 i‡(
dev_uøndom_fd
 < 0Ë
	`PFATAL
("UnableÅo open /dev/urandom");

7032 
tmp
 = 
	`Æloc_¥ötf
("%s/∂Ÿ_d©a", 
out_dú
);

7033 
fd
 = 
	`›í
(
tmp
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

7034 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
tmp
);

7035 
	`ck_‰ì
(
tmp
);

7037 
∂Ÿ_fûe
 = 
	`fd›í
(
fd
, "w");

7038 i‡(!
∂Ÿ_fûe
Ë
	`PFATAL
("fdopen() failed");

7040 
	`Ârötf
(
∂Ÿ_fûe
, "# unix_time, cycles_done, cur_path,Öaths_total, "

7045 
	}
}

7050 
EXP_ST
 
	$£tup_°dio_fûe
() {

7052 
u8
* 
‚
 = 
	`Æloc_¥ötf
("%s/.cur_öput", 
out_dú
);

7054 
	`u∆ök
(
‚
);

7056 
out_fd
 = 
	`›í
(
‚
, 
O_RDWR
 | 
O_CREAT
 | 
O_EXCL
, 0600);

7058 i‡(
out_fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
‚
);

7060 
	`ck_‰ì
(
‚
);

7062 
	}
}

7067 
	$check_¸ash_h™dlög
() {

7069 #ifde‡
__APPLE__


7077 i‡(
	`sy°em
("launchctlÜist 2>/dev/null | grep -q '\\.ReportCrash$'")) ;

7079 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


7091 i‡(!
	`gëív
("AFL_I_DONT_CARE_ABOUT_MISSING_CRASHES"))

7092 
	`FATAL
("CrashÑeporter detected");

7099 
s32
 
fd
 = 
	`›í
("/¥oc/sys/kî√l/c‹e_∑âîn", 
O_RDONLY
);

7100 
u8
 
fch¨
;

7102 i‡(
fd
 < 0) ;

7104 
	`ACTF
("Checking core_pattern...");

7106 i‡(
	`ªad
(
fd
, &
fch¨
, 1) == 1 && fchar == '|') {

7108 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


7119 i‡(!
	`gëív
("AFL_I_DONT_CARE_ABOUT_MISSING_CRASHES"))

7120 
	`FATAL
("PipeátÅhe beginning of 'core_pattern'");

7124 
	`˛o£
(
fd
);

7128 
	}
}

7133 
	$check_˝u_govîn‹
() {

7135 
FILE
* 
f
;

7136 
u8
 
tmp
[128];

7137 
u64
 
mö
 = 0, 
max
 = 0;

7139 i‡(
	`gëív
("AFL_SKIP_CPUFREQ")) ;

7141 
f
 = 
	`f›í
("/sys/devices/system/cpu/cpu0/cpufreq/scaling_governor", "r");

7142 i‡(!
f
) ;

7144 
	`ACTF
("Checking CPU scaling governor...");

7146 i‡(!
	`fgës
(
tmp
, 128, 
f
)Ë
	`PFATAL
("fgets() failed");

7148 
	`f˛o£
(
f
);

7150 i‡(!
	`°∫cmp
(
tmp
, "perf", 4)) ;

7152 
f
 = 
	`f›í
("/sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq", "r");

7154 i‡(
f
) {

7155 i‡(
	`fsˇnf
(
f
, "%Œu", &
mö
) != 1) min = 0;

7156 
	`f˛o£
(
f
);

7159 
f
 = 
	`f›í
("/sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq", "r");

7161 i‡(
f
) {

7162 i‡(
	`fsˇnf
(
f
, "%Œu", &
max
) != 1) max = 0;

7163 
	`f˛o£
(
f
);

7166 i‡(
mö
 =
max
) ;

7168 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


7180 
mö
 / 1024, 
max
 / 1024);

7182 
	`FATAL
("Suboptimal CPU scaling governor");

7184 
	}
}

7189 
	$gë_c‹e_cou¡
() {

7191 
u32
 
cur_ru¬abÀ
 = 0;

7193 #i‡
	`deföed
(
__APPLE__
Ë|| deföed(
__FªeBSD__
Ë|| deföed (
__O≥nBSD__
)

7195 
size_t
 
s
 = (
˝u_c‹e_cou¡
);

7199 #ifde‡
__APPLE__


7201 i‡(
	`sys˘lby«me
("hw.logiˇl˝u", &
˝u_c‹e_cou¡
, &
s
, 
NULL
, 0) < 0)

7206 
s_«me
[2] = { 
CTL_HW
, 
HW_NCPU
 };

7208 i‡(
	`sys˘l
(
s_«me
, 2, &
˝u_c‹e_cou¡
, &
s
, 
NULL
, 0) < 0) ;

7214 #ifde‡
HAVE_AFFINITY


7216 
˝u_c‹e_cou¡
 = 
	`sysc⁄f
(
_SC_NPROCESSORS_ONLN
);

7220 
FILE
* 
f
 = 
	`f›í
("/proc/stat", "r");

7221 
u8
 
tmp
[1024];

7223 i‡(!
f
) ;

7225 
	`fgës
(
tmp
, —mp), 
f
))

7226 i‡(!
	`°∫cmp
(
tmp
, "˝u", 3Ë&& 
	`isdigô
—mp[3])Ë
˝u_c‹e_cou¡
++;

7228 
	`f˛o£
(
f
);

7234 i‡(
˝u_c‹e_cou¡
 > 0) {

7236 
cur_ru¬abÀ
 = (
u32
)
	`gë_ru¬abÀ_¥o˚s£s
();

7238 #i‡
	`deföed
(
__APPLE__
Ë|| deföed(
__FªeBSD__
Ë|| deföed (
__O≥nBSD__
)

7242 
cur_ru¬abÀ
++;

7246 
	`OKF
("You have %u CPU coresánd %uÑunnableÅasks (utilization: %0.0f%%).",

7247 
˝u_c‹e_cou¡
, 
cur_ru¬abÀ
, cur_runnable * 100.0 / cpu_core_count);

7249 i‡(
˝u_c‹e_cou¡
 > 1) {

7251 i‡(
cur_ru¬abÀ
 > 
˝u_c‹e_cou¡
 * 1.5) {

7253 
	`WARNF
("System underápparentÜoad,Öerformance may be spotty.");

7255 } i‡(
cur_ru¬abÀ
 + 1 <
˝u_c‹e_cou¡
) {

7257 
	`OKF
("TryÖ¨ÆÀ»job†- sì %s/∑øŒñ_fuzzög.txt.", 
doc_∑th
);

7265 
˝u_c‹e_cou¡
 = 0;

7266 
	`WARNF
("UnableÅo figure outÅheÇumber of CPU cores.");

7270 
	}
}

7275 
	$fix_up_sync
() {

7277 
u8
* 
x
 = 
sync_id
;

7279 i‡(
dumb_mode
)

7280 
	`FATAL
("-S / -Mánd -náre mutuallyÉxclusive");

7282 i‡(
skù_dëîmöi°ic
) {

7284 i‡(
f‹˚_dëîmöi°ic
)

7285 
	`FATAL
("use -S instead of -M -d");

7287 
	`FATAL
("-Sálready implies -d");

7291 *
x
) {

7293 i‡(!
	`iß um
(*
x
) && *x != '_' && *x != '-')

7294 
	`FATAL
("Non-alphanumeric fuzzer ID specified via -S or -M");

7296 
x
++;

7300 i‡(
	`°æí
(
sync_id
Ë> 32Ë
	`FATAL
("Fuzzer IDÅooÜong");

7302 
x
 = 
	`Æloc_¥ötf
("%s/%s", 
out_dú
, 
sync_id
);

7304 
sync_dú
 = 
out_dú
;

7305 
out_dú
 = 
x
;

7307 i‡(!
f‹˚_dëîmöi°ic
) {

7308 
skù_dëîmöi°ic
 = 1;

7309 
u£_•licög
 = 1;

7312 
	}
}

7317 
	$h™dÀ_ªsize
(
sig
) {

7318 
˛ór_s¸ìn
 = 1;

7319 
	}
}

7324 
	$check_aßn_›ts
() {

7325 
u8
* 
x
 = 
	`gëív
("ASAN_OPTIONS");

7327 i‡(
x
) {

7329 i‡(!
	`°r°r
(
x
, "abort_on_error=1"))

7330 
	`FATAL
("Custom ASAN_OPTIONS set withoutábort_on_error=1 -Ölease fix!");

7332 i‡(!
	`°r°r
(
x
, "symbolize=0"))

7333 
	`FATAL
("Custom ASAN_OPTIONS set without symbolize=0 -Ölease fix!");

7337 
x
 = 
	`gëív
("MSAN_OPTIONS");

7339 i‡(
x
) {

7341 i‡(!
	`°r°r
(
x
, "exô_code=" 
	`STRINGIFY
(
MSAN_ERROR
)))

7342 
	`FATAL
("Custom MSAN_OPTIONS set withoutÉxit_code="

7343 
	`STRINGIFY
(
MSAN_ERROR
) " -Ölease fix!");

7345 i‡(!
	`°r°r
(
x
, "symbolize=0"))

7346 
	`FATAL
("Custom MSAN_OPTIONS set without symbolize=0 -Ölease fix!");

7350 
	}
}

7355 
EXP_ST
 
	$dëe˘_fûe_¨gs
(** 
¨gv
) {

7357 
u32
 
i
 = 0;

7358 
u8
* 
cwd
 = 
	`gëcwd
(
NULL
, 0);

7360 i‡(!
cwd
Ë
	`PFATAL
("getcwd() failed");

7362 
¨gv
[
i
]) {

7364 
u8
* 
Ø_loc
 = 
	`°r°r
(
¨gv
[
i
], "@@");

7366 i‡(
Ø_loc
) {

7368 
u8
 *
Ø_sub°
, *
n_¨g
;

7372 i‡(!
out_fûe
)

7373 
out_fûe
 = 
	`Æloc_¥ötf
("%s/.cur_öput", 
out_dú
);

7377 i‡(
out_fûe
[0] ='/'Ë
Ø_sub°
 = out_file;

7378 
Ø_sub°
 = 
	`Æloc_¥ötf
("%s/%s", 
cwd
, 
out_fûe
);

7382 *
Ø_loc
 = 0;

7383 
n_¨g
 = 
	`Æloc_¥ötf
("%s%s%s", 
¨gv
[
i
], 
Ø_sub°
, 
Ø_loc
 + 2);

7384 
¨gv
[
i
] = 
n_¨g
;

7385 *
Ø_loc
 = '@';

7387 i‡(
out_fûe
[0] !'/'Ë
	`ck_‰ì
(
Ø_sub°
);

7391 
i
++;

7395 
	`‰ì
(
cwd
);

7397 
	}
}

7404 
EXP_ST
 
	$£tup_sig«l_h™dÀrs
() {

7406 
siga˘i⁄
 
ß
;

7408 
ß
.
ß_h™dÀr
 = 
NULL
;

7409 
ß
.
ß_Êags
 = 
SA_RESTART
;

7410 
ß
.
ß_siga˘i⁄
 = 
NULL
;

7412 
	`sigem±y£t
(&
ß
.
ß_mask
);

7416 
ß
.
ß_h™dÀr
 = 
h™dÀ_°›_sig
;

7417 
	`siga˘i⁄
(
SIGHUP
, &
ß
, 
NULL
);

7418 
	`siga˘i⁄
(
SIGINT
, &
ß
, 
NULL
);

7419 
	`siga˘i⁄
(
SIGTERM
, &
ß
, 
NULL
);

7423 
ß
.
ß_h™dÀr
 = 
h™dÀ_timeout
;

7424 
	`siga˘i⁄
(
SIGALRM
, &
ß
, 
NULL
);

7428 
ß
.
ß_h™dÀr
 = 
h™dÀ_ªsize
;

7429 
	`siga˘i⁄
(
SIGWINCH
, &
ß
, 
NULL
);

7433 
ß
.
ß_h™dÀr
 = 
h™dÀ_skùªq
;

7434 
	`siga˘i⁄
(
SIGUSR1
, &
ß
, 
NULL
);

7438 
ß
.
ß_h™dÀr
 = 
SIG_IGN
;

7439 
	`siga˘i⁄
(
SIGTSTP
, &
ß
, 
NULL
);

7440 
	`siga˘i⁄
(
SIGPIPE
, &
ß
, 
NULL
);

7442 
	}
}

7447 ** 
	$gë_qemu_¨gv
(
u8
* 
own_loc
, ** 
¨gv
, 
¨gc
) {

7449 ** 
√w_¨gv
 = 
	`ck_Æloc
((*Ë* (
¨gc
 + 4));

7450 
u8
 *
tmp
, *
˝
, *
r¶
, *
own_c›y
;

7452 
	`mem˝y
(
√w_¨gv
 + 3, 
¨gv
 + 1, (*Ë* 
¨gc
);

7454 
√w_¨gv
[2] = 
èrgë_∑th
;

7455 
√w_¨gv
[1] = "--";

7459 
tmp
 = 
	`gëív
("AFL_PATH");

7461 i‡(
tmp
) {

7463 
˝
 = 
	`Æloc_¥ötf
("%s/aÊ-qemu-åa˚", 
tmp
);

7465 i‡(
	`ac˚ss
(
˝
, 
X_OK
))

7466 
	`FATAL
("U«bÀÅÿföd '%s'", 
tmp
);

7468 
èrgë_∑th
 = 
√w_¨gv
[0] = 
˝
;

7469  
√w_¨gv
;

7473 
own_c›y
 = 
	`ck_°rdup
(
own_loc
);

7474 
r¶
 = 
	`°ºchr
(
own_c›y
, '/');

7476 i‡(
r¶
) {

7478 *
r¶
 = 0;

7480 
˝
 = 
	`Æloc_¥ötf
("%s/aÊ-qemu-åa˚", 
own_c›y
);

7481 
	`ck_‰ì
(
own_c›y
);

7483 i‡(!
	`ac˚ss
(
˝
, 
X_OK
)) {

7485 
èrgë_∑th
 = 
√w_¨gv
[0] = 
˝
;

7486  
√w_¨gv
;

7490 } 
	`ck_‰ì
(
own_c›y
);

7492 i‡(!
	`ac˚ss
(
BIN_PATH
 "/aÊ-qemu-åa˚", 
X_OK
)) {

7494 
èrgë_∑th
 = 
√w_¨gv
[0] = 
	`ck_°rdup
(
BIN_PATH
 "/afl-qemu-trace");

7495  
√w_¨gv
;

7499 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


7509 
	`FATAL
("FailedÅoÜocate 'afl-qemu-trace'.");

7511 
	}
}

7516 
	$ßve_cmdlöe
(
u32
 
¨gc
, ** 
¨gv
) {

7518 
u32
 
Àn
 = 1, 
i
;

7519 
u8
* 
buf
;

7521 
i
 = 0; i < 
¨gc
; i++)

7522 
Àn
 +
	`°æí
(
¨gv
[
i
]) + 1;

7524 
buf
 = 
‹ig_cmdlöe
 = 
	`ck_Æloc
(
Àn
);

7526 
i
 = 0; i < 
¨gc
; i++) {

7528 
u32
 
l
 = 
	`°æí
(
¨gv
[
i
]);

7530 
	`mem˝y
(
buf
, 
¨gv
[
i
], 
l
);

7531 
buf
 +
l
;

7533 i‡(
i
 !
¨gc
 - 1Ë*(
buf
++) = ' ';

7537 *
buf
 = 0;

7539 
	}
}

7542 #i‚de‡
AFL_LIB


7546 
	$maö
(
¨gc
, ** 
¨gv
) {

7548 
s32
 
›t
;

7549 
u64
 
¥ev_queued
 = 0;

7550 
u32
 
sync_öãrvÆ_˙t
 = 0, 
£ek_to
;

7551 
u8
 *
exåas_dú
 = 0;

7552 
u8
 
mem_limô_giví
 = 0;

7553 
u8
 
exô_1
 = !!
	`gëív
("AFL_BENCH_JUST_ONE");

7554 ** 
u£_¨gv
;

7556 
timevÆ
 
tv
;

7557 
timez⁄e
 
tz
;

7559 
	`SAYF
(
cCYA
 "aÊ-fuzz " 
cBRI
 
VERSION
 
cRST
 " by <lcamtuf@google.com>\n");

7561 
doc_∑th
 = 
	`ac˚ss
(
DOC_PATH
, 
F_OK
) ? "docs" : DOC_PATH;

7563 
	`gëtimeofday
(&
tv
, &
tz
);

7564 
	`§™dom
(
tv
.
tv_£c
 ^Åv.
tv_u£c
 ^ 
	`gëpid
());

7566 (
›t
 = 
	`gë›t
(
¨gc
, 
¨gv
, "+i:o:f:m:t:T:dnCB:S:M:x:Q")) > 0)

7568 
›t
) {

7572 i‡(
ö_dú
Ë
	`FATAL
("Multiple -i optionsÇot supported");

7573 
ö_dú
 = 
›èrg
;

7575 i‡(!
	`°rcmp
(
ö_dú
, "-")Ë
ö_∂a˚_ªsume
 = 1;

7581 i‡(
out_dú
Ë
	`FATAL
("Multiple -o optionsÇot supported");

7582 
out_dú
 = 
›èrg
;

7587 
f‹˚_dëîmöi°ic
 = 1;

7592 i‡(
sync_id
Ë
	`FATAL
("Multiple -S or -M optionsÇot supported");

7593 
sync_id
 = 
›èrg
;

7598 i‡(
out_fûe
Ë
	`FATAL
("Multiple -f optionsÇot supported");

7599 
out_fûe
 = 
›èrg
;

7604 i‡(
exåas_dú
Ë
	`FATAL
("Multiple -x optionsÇot supported");

7605 
exåas_dú
 = 
›èrg
;

7610 
u8
 
suffix
 = 0;

7612 i‡(
timeout_giví
Ë
	`FATAL
("Multiple -t optionsÇot supported");

7614 i‡(
	`ssˇnf
(
›èrg
, "%u%c", &
exec_tmout
, &
suffix
) < 1 ||

7615 
›èrg
[0] ='-'Ë
	`FATAL
("Bad syntax used for -t");

7617 i‡(
exec_tmout
 < 5Ë
	`FATAL
("DangerouslyÜow value of -t");

7619 i‡(
suffix
 ='+'Ë
timeout_giví
 = 2; timeout_given = 1;

7627 
u8
 
suffix
 = 'M';

7629 i‡(
mem_limô_giví
Ë
	`FATAL
("Multiple -m optionsÇot supported");

7630 
mem_limô_giví
 = 1;

7632 i‡(!
	`°rcmp
(
›èrg
, "none")) {

7634 
mem_limô
 = 0;

7639 i‡(
	`ssˇnf
(
›èrg
, "%Œu%c", &
mem_limô
, &
suffix
) < 1 ||

7640 
›èrg
[0] ='-'Ë
	`FATAL
("Bad syntax used for -m");

7642 
suffix
) {

7644 'T': 
mem_limô
 *= 1024 * 1024; ;

7645 'G': 
mem_limô
 *= 1024; ;

7646 'k': 
mem_limô
 /= 1024; ;

7649 : 
	`FATAL
("Unsupported suffix or bad syntax for -m");

7653 i‡(
mem_limô
 < 5Ë
	`FATAL
("DangerouslyÜow value of -m");

7655 i‡((
æim_t
Ë=4 && 
mem_limô
 > 2000)

7656 
	`FATAL
("Value of -m out ofÑange on 32-bit systems");

7664 i‡(
skù_dëîmöi°ic
Ë
	`FATAL
("Multiple -d optionsÇot supported");

7665 
skù_dëîmöi°ic
 = 1;

7666 
u£_•licög
 = 1;

7682 i‡(
ö_bôm≠
Ë
	`FATAL
("Multiple -B optionsÇot supported");

7684 
ö_bôm≠
 = 
›èrg
;

7685 
	`ªad_bôm≠
(
ö_bôm≠
);

7690 i‡(
¸ash_mode
Ë
	`FATAL
("Multiple -C optionsÇot supported");

7691 
¸ash_mode
 = 
FAULT_CRASH
;

7696 i‡(
dumb_mode
Ë
	`FATAL
("Multiple -n optionsÇot supported");

7697 i‡(
	`gëív
("AFL_DUMB_FORKSRV")Ë
dumb_mode
 = 2; dumb_mode = 1;

7703 i‡(
u£_b™√r
Ë
	`FATAL
("Multiple -T optionsÇot supported");

7704 
u£_b™√r
 = 
›èrg
;

7709 i‡(
qemu_mode
Ë
	`FATAL
("Multiple -Q optionsÇot supported");

7710 
qemu_mode
 = 1;

7712 i‡(!
mem_limô_giví
Ë
mem_limô
 = 
MEM_LIMIT_QEMU
;

7718 
	`ußge
(
¨gv
[0]);

7722 i‡(
›töd
 =
¨gc
 || !
ö_dú
 || !
out_dú
Ë
	`ußge
(
¨gv
[0]);

7724 
	`£tup_sig«l_h™dÀrs
();

7725 
	`check_aßn_›ts
();

7727 i‡(
sync_id
Ë
	`fix_up_sync
();

7729 i‡(!
	`°rcmp
(
ö_dú
, 
out_dú
))

7730 
	`FATAL
("Inputánd output directories can't beÅhe same");

7732 i‡(
dumb_mode
) {

7734 i‡(
¸ash_mode
Ë
	`FATAL
("-Cánd -náre mutuallyÉxclusive");

7735 i‡(
qemu_mode
Ë
	`FATAL
("-Qánd -náre mutuallyÉxclusive");

7739 i‡(
	`gëív
("AFL_NO_FORKSRV")Ë
no_f‹k£rvî
 = 1;

7740 i‡(
	`gëív
("AFL_NO_CPU_RED")Ë
no_˝u_mëî_ªd
 = 1;

7741 i‡(
	`gëív
("AFL_NO_VAR_CHECK")Ë
no_v¨_check
 = 1;

7742 i‡(
	`gëív
("AFL_SHUFFLE_QUEUE")Ë
shufÊe_queue
 = 1;

7744 i‡(
dumb_mode
 =2 && 
no_f‹k£rvî
)

7745 
	`FATAL
("AFL_DUMB_FORKSRVánd AFL_NO_FORKSRVáre mutuallyÉxclusive");

7747 i‡(
	`gëív
("AFL_LD_PRELOAD"))

7748 
	`£ãnv
("LD_PRELOAD", 
	`gëív
("AFL_LD_PRELOAD"), 1);

7750 
	`ßve_cmdlöe
(
¨gc
, 
¨gv
);

7752 
	`fix_up_b™√r
(
¨gv
[
›töd
]);

7754 
	`check_if_ây
();

7756 
	`gë_c‹e_cou¡
();

7758 #ifde‡
HAVE_AFFINITY


7759 
	`böd_to_‰ì_˝u
();

7762 
	`check_¸ash_h™dlög
();

7763 
	`check_˝u_govîn‹
();

7765 
	`£tup_po°
();

7766 
	`£tup_shm
();

7767 
	`öô_cou¡_˛ass16
();

7769 
	`£tup_dús_fds
();

7770 
	`ªad_ã°ˇ£s
();

7771 
	`lﬂd_auto
();

7773 
	`pivŸ_öputs
();

7775 i‡(
exåas_dú
Ë
	`lﬂd_exåas
(extras_dir);

7777 i‡(!
timeout_giví
Ë
	`föd_timeout
();

7779 
	`dëe˘_fûe_¨gs
(
¨gv
 + 
›töd
 + 1);

7781 i‡(!
out_fûe
Ë
	`£tup_°dio_fûe
();

7783 
	`check_bö¨y
(
¨gv
[
›töd
]);

7785 
°¨t_time
 = 
	`gë_cur_time
();

7787 i‡(
qemu_mode
)

7788 
u£_¨gv
 = 
	`gë_qemu_¨gv
(
¨gv
[0],árgv + 
›töd
, 
¨gc
 - optind);

7790 
u£_¨gv
 = 
¨gv
 + 
›töd
;

7792 
	`≥rf‹m_dry_run
(
u£_¨gv
);

7794 
	`cuŒ_queue
();

7796 
	`show_öô_°©s
();

7798 
£ek_to
 = 
	`föd_°¨t_posôi⁄
();

7800 
	`wrôe_°©s_fûe
(0, 0);

7801 
	`ßve_auto
();

7803 i‡(
°›_so⁄
Ë
°›_fuzzög
;

7807 i‡(!
nŸ_⁄_ây
) {

7808 
	`¶ìp
(4);

7809 
°¨t_time
 += 4000;

7810 i‡(
°›_so⁄
Ë
°›_fuzzög
;

7815 
u8
 
skù≥d_fuzz
;

7817 
	`cuŒ_queue
();

7819 i‡(!
queue_cur
) {

7821 
queue_cy˛e
++;

7822 
cuºít_íåy
 = 0;

7823 
cur_skù≥d_∑ths
 = 0;

7824 
queue_cur
 = 
queue
;

7826 
£ek_to
) {

7827 
cuºít_íåy
++;

7828 
£ek_to
--;

7829 
queue_cur
 = queue_cur->
√xt
;

7832 
	`show_°©s
();

7834 i‡(
nŸ_⁄_ây
) {

7835 
	`ACTF
("E¡îög queuêcy˛ê%Œu.", 
queue_cy˛e
);

7836 
	`fÊush
(
°dout
);

7842 i‡(
queued_∑ths
 =
¥ev_queued
) {

7844 i‡(
u£_•licög
Ë
cy˛es_wo_föds
++; use_splicing = 1;

7846 } 
cy˛es_wo_föds
 = 0;

7848 
¥ev_queued
 = 
queued_∑ths
;

7850 i‡(
sync_id
 && 
queue_cy˛e
 =1 && 
	`gëív
("AFL_IMPORT_FIRST"))

7851 
	`sync_fuzzîs
(
u£_¨gv
);

7855 
skù≥d_fuzz
 = 
	`fuzz_⁄e
(
u£_¨gv
);

7857 i‡(!
°›_so⁄
 && 
sync_id
 && !
skù≥d_fuzz
) {

7859 i‡(!(
sync_öãrvÆ_˙t
++ % 
SYNC_INTERVAL
))

7860 
	`sync_fuzzîs
(
u£_¨gv
);

7864 i‡(!
°›_so⁄
 && 
exô_1
) stop_soon = 2;

7866 i‡(
°›_so⁄
) ;

7868 
queue_cur
 = queue_cur->
√xt
;

7869 
cuºít_íåy
++;

7873 i‡(
queue_cur
Ë
	`show_°©s
();

7875 
	`wrôe_bôm≠
();

7876 
	`wrôe_°©s_fûe
(0, 0);

7877 
	`ßve_auto
();

7879 
°›_fuzzög
:

7881 
	`SAYF
(
CURSOR_SHOW
 
cLRD
 "\n\n+++ Te°ögáb‹ãd %†+++\n" 
cRST
,

7882 
°›_so⁄
 == 2 ? "programatically" : "by user");

7886 i‡(
queue_cy˛e
 =1 && 
	`gë_cur_time
(Ë- 
°¨t_time
 > 30 * 60 * 1000) {

7888 
	`SAYF
("\n" 
cYEL
 "[!] " 
cRST


7890 " (F‹ infÿ⁄Ñesumög, sì %s/README.)\n", 
doc_∑th
);

7894 
	`f˛o£
(
∂Ÿ_fûe
);

7895 
	`de°roy_queue
();

7896 
	`de°roy_exåas
();

7897 
	`ck_‰ì
(
èrgë_∑th
);

7899 
	`Æloc_ªp‹t
();

7901 
	`OKF
("We're done here. HaveáÇice day!\n");

7903 
	`exô
(0);

7905 
	}
}

	@afl-gcc.c

34 
	#AFL_MAIN


	)

36 
	~"c⁄fig.h
"

37 
	~"ty≥s.h
"

38 
	~"debug.h
"

39 
	~"Æloc-öl.h
"

41 
	~<°dio.h
>

42 
	~<uni°d.h
>

43 
	~<°dlib.h
>

44 
	~<°rög.h
>

46 
u8
* 
	gas_∑th
;

47 
u8
** 
	gcc_∑øms
;

48 
u32
 
	gcc_∑r_˙t
 = 1;

49 
u8
 
	gbe_quõt
,

50 
	g˛™g_mode
;

56 
	$föd_as
(
u8
* 
¨gv0
) {

58 
u8
 *
aÊ_∑th
 = 
	`gëív
("AFL_PATH");

59 
u8
 *
¶ash
, *
tmp
;

61 i‡(
aÊ_∑th
) {

63 
tmp
 = 
	`Æloc_¥ötf
("%s/as", 
aÊ_∑th
);

65 i‡(!
	`ac˚ss
(
tmp
, 
X_OK
)) {

66 
as_∑th
 = 
aÊ_∑th
;

67 
	`ck_‰ì
(
tmp
);

71 
	`ck_‰ì
(
tmp
);

75 
¶ash
 = 
	`°ºchr
(
¨gv0
, '/');

77 i‡(
¶ash
) {

79 
u8
 *
dú
;

81 *
¶ash
 = 0;

82 
dú
 = 
	`ck_°rdup
(
¨gv0
);

83 *
¶ash
 = '/';

85 
tmp
 = 
	`Æloc_¥ötf
("%s/aÊ-as", 
dú
);

87 i‡(!
	`ac˚ss
(
tmp
, 
X_OK
)) {

88 
as_∑th
 = 
dú
;

89 
	`ck_‰ì
(
tmp
);

93 
	`ck_‰ì
(
tmp
);

94 
	`ck_‰ì
(
dú
);

98 i‡(!
	`ac˚ss
(
AFL_PATH
 "/as", 
X_OK
)) {

99 
as_∑th
 = 
AFL_PATH
;

103 
	`FATAL
("UnableÅo find AFL wrapper binary for 'as'. Please set AFL_PATH");

105 
	}
}

110 
	$edô_∑øms
(
u32
 
¨gc
, ** 
¨gv
) {

112 
u8
 
f‹tify_£t
 = 0, 
aßn_£t
 = 0;

113 
u8
 *
«me
;

115 #i‡
	`deföed
(
__FªeBSD__
Ë&& deföed(
__x86_64__
)

116 
u8
 
m32_£t
 = 0;

119 
cc_∑øms
 = 
	`ck_Æloc
((
¨gc
 + 64Ë* (
u8
*));

121 
«me
 = 
	`°ºchr
(
¨gv
[0], '/');

122 i‡(!
«me
Ë«mê
¨gv
[0]; name++;

124 i‡(!
	`°∫cmp
(
«me
, "afl-clang", 9)) {

126 
˛™g_mode
 = 1;

128 
	`£ãnv
(
CLANG_ENV_VAR
, "1", 1);

130 i‡(!
	`°rcmp
(
«me
, "afl-clang++")) {

131 
u8
* 
Æt_cxx
 = 
	`gëív
("AFL_CXX");

132 
cc_∑øms
[0] = 
Æt_cxx
 ?á…_cxx : (
u8
*)"clang++";

134 
u8
* 
Æt_cc
 = 
	`gëív
("AFL_CC");

135 
cc_∑øms
[0] = 
Æt_cc
 ?á…_c¯: (
u8
*)"clang";

146 #ifde‡
__APPLE__


148 i‡(!
	`°rcmp
(
«me
, "aÊ-g++")Ë
cc_∑øms
[0] = 
	`gëív
("AFL_CXX");

149 i‡(!
	`°rcmp
(
«me
, "aÊ-gcj")Ë
cc_∑øms
[0] = 
	`gëív
("AFL_GCJ");

150 
cc_∑øms
[0] = 
	`gëív
("AFL_CC");

152 i‡(!
cc_∑øms
[0]) {

154 
	`SAYF
("\n" 
cLRD
 "[-] " 
cRST


159 
	`FATAL
("AFL_CC or AFL_CXXÑequired on MacOS X");

165 i‡(!
	`°rcmp
(
«me
, "afl-g++")) {

166 
u8
* 
Æt_cxx
 = 
	`gëív
("AFL_CXX");

167 
cc_∑øms
[0] = 
Æt_cxx
 ?á…_cxx : (
u8
*)"g++";

168 } i‡(!
	`°rcmp
(
«me
, "afl-gcj")) {

169 
u8
* 
Æt_cc
 = 
	`gëív
("AFL_GCJ");

170 
cc_∑øms
[0] = 
Æt_cc
 ?á…_c¯: (
u8
*)"gcj";

172 
u8
* 
Æt_cc
 = 
	`gëív
("AFL_CC");

173 
cc_∑øms
[0] = 
Æt_cc
 ?á…_c¯: (
u8
*)"gcc";

180 --
¨gc
) {

181 
u8
* 
cur
 = *(++
¨gv
);

183 i‡(!
	`°∫cmp
(
cur
, "-B", 2)) {

185 i‡(!
be_quõt
Ë
	`WARNF
("-B isálready set, overriding");

187 i‡(!
cur
[2] && 
¨gc
 > 1Ë{árgc--; 
¨gv
++; }

192 i‡(!
	`°rcmp
(
cur
, "-integrated-as")) ;

194 i‡(!
	`°rcmp
(
cur
, "-pipe")) ;

196 #i‡
	`deföed
(
__FªeBSD__
Ë&& deföed(
__x86_64__
)

197 i‡(!
	`°rcmp
(
cur
, "-m32")Ë
m32_£t
 = 1;

200 i‡(!
	`°rcmp
(
cur
, "-fsanitize=address") ||

201 !
	`°rcmp
(
cur
, "-fßnôize=mem‹y")Ë
aßn_£t
 = 1;

203 i‡(
	`°r°r
(
cur
, "FORTIFY_SOURCE")Ë
f‹tify_£t
 = 1;

205 
cc_∑øms
[
cc_∑r_˙t
++] = 
cur
;

209 
cc_∑øms
[
cc_∑r_˙t
++] = "-B";

210 
cc_∑øms
[
cc_∑r_˙t
++] = 
as_∑th
;

212 i‡(
˛™g_mode
)

213 
cc_∑øms
[
cc_∑r_˙t
++] = "-no-integrated-as";

215 i‡(
	`gëív
("AFL_HARDEN")) {

217 
cc_∑øms
[
cc_∑r_˙t
++] = "-fstack-protector-all";

219 i‡(!
f‹tify_£t
)

220 
cc_∑øms
[
cc_∑r_˙t
++] = "-D_FORTIFY_SOURCE=2";

224 i‡(
aßn_£t
) {

228 
	`£ãnv
("AFL_USE_ASAN", "1", 1);

230 } i‡(
	`gëív
("AFL_USE_ASAN")) {

232 
cc_∑øms
[
cc_∑r_˙t
++] = "-fsanitize=address";

234 i‡(
	`gëív
("AFL_USE_MSAN"))

235 
	`FATAL
("ASANánd MSANáre mutuallyÉxclusive");

237 } i‡(
	`gëív
("AFL_USE_MSAN")) {

239 
cc_∑øms
[
cc_∑r_˙t
++] = "-fsanitize=memory";

241 i‡(
	`gëív
("AFL_USE_ASAN"))

242 
	`FATAL
("ASANánd MSANáre mutuallyÉxclusive");

246 i‡(!
	`gëív
("AFL_DONT_OPTIMIZE")) {

248 #i‡
	`deföed
(
__FªeBSD__
Ë&& deföed(
__x86_64__
)

254 i‡(!
˛™g_mode
 || !
m32_£t
)

255 
cc_∑øms
[
cc_∑r_˙t
++] = "-g";

259 
cc_∑øms
[
cc_∑r_˙t
++] = "-g";

263 
cc_∑øms
[
cc_∑r_˙t
++] = "-O3";

264 
cc_∑øms
[
cc_∑r_˙t
++] = "-funroll-loops";

269 
cc_∑øms
[
cc_∑r_˙t
++] = "-D__AFL_COMPILER=1";

270 
cc_∑øms
[
cc_∑r_˙t
++] = "-DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=1";

274 
cc_∑øms
[
cc_∑r_˙t
] = 
NULL
;

276 
	}
}

281 
	$maö
(
¨gc
, ** 
¨gv
) {

283 i‡(
	`ißây
(2Ë&& !
	`gëív
("AFL_QUIET")) {

285 
	`SAYF
(
cCYA
 "aÊ-c¯" 
cBRI
 
VERSION
 
cRST
 " by <lcamtuf@google.com>\n");

287 } 
be_quõt
 = 1;

289 i‡(
¨gc
 < 2) {

291 
	`SAYF
("\n"

301 
BIN_PATH
, BIN_PATH);

303 
	`exô
(1);

308 
	`föd_as
(
¨gv
[0]);

310 
	`edô_∑øms
(
¨gc
, 
¨gv
);

312 
	`execvp
(
cc_∑øms
[0], (**)cc_params);

314 
	`FATAL
("O›s, faûedÅÿexecuã '%s' - check you∏PATH", 
cc_∑øms
[0]);

318 
	}
}

	@afl-gotcpu.c

28 
	#AFL_MAIN


	)

29 
	#_GNU_SOURCE


	)

31 
	~<°dio.h
>

32 
	~<°dlib.h
>

33 
	~<uni°d.h
>

34 
	~<°rög.h
>

35 
	~<sched.h
>

37 
	~<sys/time.h
>

38 
	~<sys/times.h
>

39 
	~<sys/ªsour˚.h
>

40 
	~<sys/waô.h
>

42 
	~"ty≥s.h
"

43 
	~"debug.h
"

45 #ifde‡
__löux__


46 
	#HAVE_AFFINITY
 1

	)

52 
u64
 
	$gë_cur_time_us
() {

54 
timevÆ
 
tv
;

55 
timez⁄e
 
tz
;

57 
	`gëtimeofday
(&
tv
, &
tz
);

59  (
tv
.
tv_£c
 * 1000000ULLË+Åv.
tv_u£c
;

61 
	}
}

66 
u64
 
	$gë_˝u_ußge_us
() {

68 
rußge
 
u
;

70 
	`gërußge
(
RUSAGE_SELF
, &
u
);

72  (
u
.
ru_utime
.
tv_£c
 * 1000000ULLË+ u.ru_utime.
tv_u£c
 +

73 (
u
.
ru_°ime
.
tv_£c
 * 1000000ULLË+ u.ru_°ime.
tv_u£c
;

75 
	}
}

80 
u32
 
	$mósuª_¥ìm±i⁄
(
u32
 
èrgë_ms
) {

82 vﬁ©ûê
u32
 
v1
, 
v2
;

84 
u64
 
°_t
, 
í_t
, 
°_c
, 
í_c
, 
ªÆ_dñè
, 
¶i˚_dñè
;

85 
s32
 
lo›_ª≥©s
 = 0;

87 
°_t
 = 
	`gë_cur_time_us
();

88 
°_c
 = 
	`gë_˝u_ußge_us
();

90 
ª≥©_lo›
:

92 
v1
 = 
CTEST_BUSY_CYCLES
;

94 
v1
--Ë
v2
++;

95 
	`sched_yõld
();

97 
í_t
 = 
	`gë_cur_time_us
();

99 i‡(
í_t
 - 
°_t
 < 
èrgë_ms
 * 1000) {

100 
lo›_ª≥©s
++;

101 
ª≥©_lo›
;

107 
í_c
 = 
	`gë_˝u_ußge_us
();

109 
ªÆ_dñè
 = (
í_t
 - 
°_t
) / 1000;

110 
¶i˚_dñè
 = (
í_c
 - 
°_c
) / 1000;

112  
ªÆ_dñè
 * 100 / 
¶i˚_dñè
;

114 
	}
}

119 
	$maö
(
¨gc
, ** 
¨gv
) {

121 #ifde‡
HAVE_AFFINITY


123 
u32
 
˝u_˙t
 = 
	`sysc⁄f
(
_SC_NPROCESSORS_ONLN
),

124 
idÀ_˝us
 = 0, 
maybe_˝us
 = 0, 
i
;

126 
	`SAYF
(
cCYA
 "aÊ-gŸ˝u " 
cBRI
 
VERSION
 
cRST
 " by <lcamtuf@google.com>\n");

128 
	`ACTF
("MeasuringÖer-coreÖreemptionÑate (this willÅake %0.02f sec)...",

129 (()
CTEST_CORE_TRG_MS
) / 1000);

131 
i
 = 0; i < 
˝u_˙t
; i++) {

133 
s32
 
‰
 = 
	`f‹k
();

135 i‡(
‰
 < 0Ë
	`PFATAL
("fork failed");

137 i‡(!
‰
) {

139 
˝u_£t_t
 
c
;

140 
u32
 
utû_≥rc
;

142 
	`CPU_ZERO
(&
c
);

143 
	`CPU_SET
(
i
, &
c
);

145 i‡(
	`sched_£èfföôy
(0, (
c
), &c))

146 
	`PFATAL
("sched_setaffinity failed");

148 
utû_≥rc
 = 
	`mósuª_¥ìm±i⁄
(
CTEST_CORE_TRG_MS
);

150 i‡(
utû_≥rc
 < 110) {

152 
	`SAYF
(" C‹ê#%u: " 
cLGN
 "AVAILABLE\n" 
cRST
, 
i
);

153 
	`exô
(0);

155 } i‡(
utû_≥rc
 < 250) {

157 
	`SAYF
(" C‹ê#%u: " 
cYEL
 "CAUTION " 
cRST
 "(%u%%)\n", 
i
, 
utû_≥rc
);

158 
	`exô
(1);

162 
	`SAYF
(" C‹ê#%u: " 
cLRD
 "OVERBOOKED " 
cRST
 "(%u%%)\n" cRST, 
i
,

163 
utû_≥rc
);

164 
	`exô
(2);

170 
i
 = 0; i < 
˝u_˙t
; i++) {

172 
ªt
;

173 i‡(
	`waôpid
(-1, &
ªt
, 0Ë< 0Ë
	`PFATAL
("waitpid failed");

175 i‡(
	`WEXITSTATUS
(
ªt
Ë=0Ë
idÀ_˝us
++;

176 i‡(
	`WEXITSTATUS
(
ªt
Ë<1Ë
maybe_˝us
++;

180 
	`SAYF
(
cGRA
 "\n>>> ");

182 i‡(
idÀ_˝us
) {

184 i‡(
maybe_˝us
 =
idÀ_˝us
) {

186 
	`SAYF
(
cLGN
 "PASS: " 
cRST
 "You canÑun moreÖrocesses on %u core%s.",

187 
idÀ_˝us
, idle_cpus > 1 ? "s" : "");

191 
	`SAYF
(
cLGN
 "PASS: " 
cRST
 "You canÑun moreÖrocesses on %uÅo %u core%s.",

192 
idÀ_˝us
, 
maybe_˝us
, maybe_cpus > 1 ? "s" : "");

196 
	`SAYF
(
cGRA
 " <<<" 
cRST
 "\n\n");

201 i‡(
maybe_˝us
) {

203 
	`SAYF
(
cYEL
 "CAUTION: " 
cRST
 "You may still have %u core%sávailable.",

204 
maybe_˝us
, maybe_cpus > 1 ? "s" : "");

205 
	`SAYF
(
cGRA
 " <<<" 
cRST
 "\n\n");

210 
	`SAYF
(
cLRD
 "FAIL: " 
cRST
 "All coresáre overbooked.");

211 
	`SAYF
(
cGRA
 " <<<" 
cRST
 "\n\n");

216 
u32
 
utû_≥rc
;

218 
	`SAYF
(
cCYA
 "aÊ-gŸ˝u " 
cBRI
 
VERSION
 
cRST
 " by <lcamtuf@google.com>\n");

222 
	`ACTF
("Measuring grossÖreemptionÑate (this willÅake %0.02f sec)...",

223 (()
CTEST_TARGET_MS
) / 1000);

225 
utû_≥rc
 = 
	`mósuª_¥ìm±i⁄
(
CTEST_TARGET_MS
);

229 
	`SAYF
(
cGRA
 "\n>>> ");

231 i‡(
utû_≥rc
 < 105) {

233 
	`SAYF
(
cLGN
 "PASS: " 
cRST
 "You canÖrobablyÑunádditionalÖrocesses.");

235 } i‡(
utû_≥rc
 < 130) {

237 
	`SAYF
(
cYEL
 "CAUTION: " 
cRST
 "Your CPU may be somewhat overbooked (%u%%).",

238 
utû_≥rc
);

242 
	`SAYF
(
cLRD
 "FAIL: " 
cRST
 "You∏CPU i†ovîbooked (%u%%).", 
utû_≥rc
);

246 
	`SAYF
(
cGRA
 " <<<" 
cRST
 "\n\n");

248  (
utû_≥rc
 > 105) + (util_perc > 130);

252 
	}
}

	@afl-showmap.c

24 
	#AFL_MAIN


	)

26 
	~"c⁄fig.h
"

27 
	~"ty≥s.h
"

28 
	~"debug.h
"

29 
	~"Æloc-öl.h
"

30 
	~"hash.h
"

32 
	~<°dio.h
>

33 
	~<uni°d.h
>

34 
	~<°dlib.h
>

35 
	~<°rög.h
>

36 
	~<time.h
>

37 
	~<î∫o.h
>

38 
	~<sig«l.h
>

39 
	~<dúít.h
>

40 
	~<f˙é.h
>

42 
	~<sys/waô.h
>

43 
	~<sys/time.h
>

44 
	~<sys/shm.h
>

45 
	~<sys/°©.h
>

46 
	~<sys/ty≥s.h
>

47 
	~<sys/ªsour˚.h
>

49 
s32
 
	gchûd_pid
;

51 
u8
* 
	gåa˚_bôs
;

53 
u8
 *
	gout_fûe
,

54 *
	gdoc_∑th
,

55 *
	gèrgë_∑th
,

56 *
	g©_fûe
;

58 
u32
 
	gexec_tmout
;

60 
u64
 
	gmem_limô
 = 
MEM_LIMIT
;

62 
s32
 
	gshm_id
;

64 
u8
 
	gquõt_mode
,

65 
	gedges_⁄ly
,

66 
	gcmö_mode
;

68 vﬁ©ûê
u8


69 
	g°›_so⁄
,

70 
	gchûd_timed_out
,

71 
	gchûd_¸ashed
;

76 c⁄° 
u8
 
	gcou¡_˛ass_lookup
[256] = {

90 
	$˛assify_cou¡s
(
u8
* 
mem
) {

92 
u32
 
i
 = 
MAP_SIZE
;

94 i‡(
edges_⁄ly
) {

96 
i
--) {

97 i‡(*
mem
) *mem = 1;

98 
mem
++;

103 
i
--) {

104 *
mem
 = 
cou¡_˛ass_lookup
[*mem];

105 
mem
++;

110 
	}
}

115 
	$ªmove_shm
() {

117 
	`shm˘l
(
shm_id
, 
IPC_RMID
, 
NULL
);

119 
	}
}

124 
	$£tup_shm
() {

126 
u8
* 
shm_°r
;

128 
shm_id
 = 
	`shmgë
(
IPC_PRIVATE
, 
MAP_SIZE
, 
IPC_CREAT
 | 
IPC_EXCL
 | 0600);

130 i‡(
shm_id
 < 0Ë
	`PFATAL
("shmget() failed");

132 
	`©exô
(
ªmove_shm
);

134 
shm_°r
 = 
	`Æloc_¥ötf
("%d", 
shm_id
);

136 
	`£ãnv
(
SHM_ENV_VAR
, 
shm_°r
, 1);

138 
	`ck_‰ì
(
shm_°r
);

140 
åa˚_bôs
 = 
	`shm©
(
shm_id
, 
NULL
, 0);

142 i‡(!
åa˚_bôs
Ë
	`PFATAL
("shmat() failed");

144 
	}
}

148 
u32
 
	$wrôe_ªsu…s
() {

150 
s32
 
fd
;

151 
FILE
* 
f
;

152 
u32
 
i
, 
ªt
 = 0;

153 
u8
 
cco
 = !!
	`gëív
("AFL_CMIN_CRASHES_ONLY"),

154 
ˇa
 = !!
	`gëív
("AFL_CMIN_ALLOW_ANY");

156 i‡(!
	`°∫cmp
(
out_fûe
, "/dev/", 5)) {

158 
fd
 = 
	`›í
(
out_fûe
, 
O_WRONLY
, 0600);

159 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
out_fûe
);

161 } i‡(!
	`°rcmp
(
out_fûe
, "-")) {

163 
fd
 = 
	`dup
(1);

164 i‡(
fd
 < 0Ë
	`PFATAL
("UnableÅo open stdout");

168 
	`u∆ök
(
out_fûe
);

169 
fd
 = 
	`›í
(
out_fûe
, 
O_WRONLY
 | 
O_CREAT
 | 
O_EXCL
, 0600);

170 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
out_fûe
);

174 
f
 = 
	`fd›í
(
fd
, "w");

176 i‡(!
f
Ë
	`PFATAL
("fdopen() failed");

178 
i
 = 0; i < 
MAP_SIZE
; i++) {

180 i‡(!
åa˚_bôs
[
i
]) ;

181 
ªt
++;

183 i‡(
cmö_mode
) {

185 i‡(
chûd_timed_out
) ;

186 i‡(!
ˇa
 && 
chûd_¸ashed
 !
cco
) ;

188 
	`Ârötf
(
f
, "%u%u\n", 
åa˚_bôs
[
i
], i);

190 } 
	`Ârötf
(
f
, "%06u:%u\n", 
i
, 
åa˚_bôs
[i]);

194 
	`f˛o£
(
f
);

196  
ªt
;

198 
	}
}

203 
	$h™dÀ_timeout
(
sig
) {

205 
chûd_timed_out
 = 1;

206 i‡(
chûd_pid
 > 0Ë
	`kûl
(chûd_pid, 
SIGKILL
);

208 
	}
}

213 
	$run_èrgë
(** 
¨gv
) {

215 
ôimîvÆ
 
ô
;

216 
°©us
 = 0;

218 i‡(!
quõt_mode
)

219 
	`SAYF
("-- Progøm ouçuàbegö†--\n" 
cRST
);

221 
	`MEM_BARRIER
();

223 
chûd_pid
 = 
	`f‹k
();

225 i‡(
chûd_pid
 < 0Ë
	`PFATAL
("fork() failed");

227 i‡(!
chûd_pid
) {

229 
æimô
 
r
;

231 i‡(
quõt_mode
) {

233 
s32
 
fd
 = 
	`›í
("/dev/nuŒ", 
O_RDWR
);

235 i‡(
fd
 < 0 || 
	`dup2
(fd, 1) < 0 || dup2(fd, 2) < 0) {

236 *(
u32
*)
åa˚_bôs
 = 
EXEC_FAIL_SIG
;

237 
	`PFATAL
("Descriptor initialization failed");

240 
	`˛o£
(
fd
);

244 i‡(
mem_limô
) {

246 
r
.
æim_max
 =Ñ.
æim_cur
 = ((
æim_t
)
mem_limô
) << 20;

248 #ifde‡
RLIMIT_AS


250 
	`£ålimô
(
RLIMIT_AS
, &
r
);

254 
	`£ålimô
(
RLIMIT_DATA
, &
r
);

260 
r
.
æim_max
 =Ñ.
æim_cur
 = 0;

261 
	`£ålimô
(
RLIMIT_CORE
, &
r
);

263 
	`execv
(
èrgë_∑th
, 
¨gv
);

265 *(
u32
*)
åa˚_bôs
 = 
EXEC_FAIL_SIG
;

266 
	`exô
(0);

272 i‡(
exec_tmout
) {

274 
chûd_timed_out
 = 0;

275 
ô
.
ô_vÆue
.
tv_£c
 = (
exec_tmout
 / 1000);

276 
ô
.
ô_vÆue
.
tv_u£c
 = (
exec_tmout
 % 1000) * 1000;

280 
	`£tôimî
(
ITIMER_REAL
, &
ô
, 
NULL
);

282 i‡(
	`waôpid
(
chûd_pid
, &
°©us
, 0Ë<0Ë
	`FATAL
("waitpid() failed");

284 
chûd_pid
 = 0;

285 
ô
.
ô_vÆue
.
tv_£c
 = 0;

286 
ô
.
ô_vÆue
.
tv_u£c
 = 0;

287 
	`£tôimî
(
ITIMER_REAL
, &
ô
, 
NULL
);

289 
	`MEM_BARRIER
();

293 i‡(*(
u32
*)
åa˚_bôs
 =
EXEC_FAIL_SIG
)

294 
	`FATAL
("U«bÀÅÿexecuã '%s'", 
¨gv
[0]);

296 
	`˛assify_cou¡s
(
åa˚_bôs
);

298 i‡(!
quõt_mode
)

299 
	`SAYF
(
cRST
 "-- Program outputÉnds --\n");

301 i‡(!
chûd_timed_out
 && !
°›_so⁄
 && 
	`WIFSIGNALED
(
°©us
))

302 
chûd_¸ashed
 = 1;

304 i‡(!
quõt_mode
) {

306 i‡(
chûd_timed_out
)

307 
	`SAYF
(
cLRD
 "\n+++ ProgømÅimed of‡+++\n" 
cRST
);

308 i‡(
°›_so⁄
)

309 
	`SAYF
(
cLRD
 "\n+++ Progømáb‹ãd by u£∏+++\n" 
cRST
);

310 i‡(
chûd_¸ashed
)

311 
	`SAYF
(
cLRD
 "\n+++ Progøm kûÀd by sig«»%u +++\n" 
cRST
, 
	`WTERMSIG
(
°©us
));

316 
	}
}

321 
	$h™dÀ_°›_sig
(
sig
) {

323 
°›_so⁄
 = 1;

325 i‡(
chûd_pid
 > 0Ë
	`kûl
(chûd_pid, 
SIGKILL
);

327 
	}
}

332 
	$£t_up_ívú⁄mít
() {

334 
	`£ãnv
("ASAN_OPTIONS", "abort_on_error=1:"

339 
	`£ãnv
("MSAN_OPTIONS", "exô_code=" 
	`STRINGIFY
(
MSAN_ERROR
) ":"

345 i‡(
	`gëív
("AFL_LD_PRELOAD"))

346 
	`£ãnv
("LD_PRELOAD", 
	`gëív
("AFL_LD_PRELOAD"), 1);

348 
	}
}

353 
	$£tup_sig«l_h™dÀrs
() {

355 
siga˘i⁄
 
ß
;

357 
ß
.
ß_h™dÀr
 = 
NULL
;

358 
ß
.
ß_Êags
 = 
SA_RESTART
;

359 
ß
.
ß_siga˘i⁄
 = 
NULL
;

361 
	`sigem±y£t
(&
ß
.
ß_mask
);

365 
ß
.
ß_h™dÀr
 = 
h™dÀ_°›_sig
;

366 
	`siga˘i⁄
(
SIGHUP
, &
ß
, 
NULL
);

367 
	`siga˘i⁄
(
SIGINT
, &
ß
, 
NULL
);

368 
	`siga˘i⁄
(
SIGTERM
, &
ß
, 
NULL
);

372 
ß
.
ß_h™dÀr
 = 
h™dÀ_timeout
;

373 
	`siga˘i⁄
(
SIGALRM
, &
ß
, 
NULL
);

375 
	}
}

380 
	$dëe˘_fûe_¨gs
(** 
¨gv
) {

382 
u32
 
i
 = 0;

383 
u8
* 
cwd
 = 
	`gëcwd
(
NULL
, 0);

385 i‡(!
cwd
Ë
	`PFATAL
("getcwd() failed");

387 
¨gv
[
i
]) {

389 
u8
* 
Ø_loc
 = 
	`°r°r
(
¨gv
[
i
], "@@");

391 i‡(
Ø_loc
) {

393 
u8
 *
Ø_sub°
, *
n_¨g
;

395 i‡(!
©_fûe
Ë
	`FATAL
("@@ syntax isÇot supported byÅhisÅool.");

399 i‡(
©_fûe
[0] ='/'Ë
Ø_sub°
 =át_file;

400 
Ø_sub°
 = 
	`Æloc_¥ötf
("%s/%s", 
cwd
, 
©_fûe
);

404 *
Ø_loc
 = 0;

405 
n_¨g
 = 
	`Æloc_¥ötf
("%s%s%s", 
¨gv
[
i
], 
Ø_sub°
, 
Ø_loc
 + 2);

406 
¨gv
[
i
] = 
n_¨g
;

407 *
Ø_loc
 = '@';

409 i‡(
©_fûe
[0] !'/'Ë
	`ck_‰ì
(
Ø_sub°
);

413 
i
++;

417 
	`‰ì
(
cwd
);

419 
	}
}

424 
	$show_b™√r
() {

426 
	`SAYF
(
cCYA
 "aÊ-showm≠ " 
cBRI
 
VERSION
 
cRST
 " by <lcamtuf@google.com>\n");

428 
	}
}

432 
	$ußge
(
u8
* 
¨gv0
) {

434 
	`show_b™√r
();

436 
	`SAYF
("\n%s [ options ] -- /path/to/target_app [ ... ]\n\n"

454 "F‹áddôi⁄Æ hñp, c⁄su… %s/README.\n\n" 
cRST
,

456 
¨gv0
, 
MEM_LIMIT
, 
doc_∑th
);

458 
	`exô
(1);

460 
	}
}

465 
	$föd_bö¨y
(
u8
* 
‚ame
) {

467 
u8
* 
ív_∑th
 = 0;

468 
°©
 
°
;

470 i‡(
	`°rchr
(
‚ame
, '/'Ë|| !(
ív_∑th
 = 
	`gëív
("PATH"))) {

472 
èrgë_∑th
 = 
	`ck_°rdup
(
‚ame
);

474 i‡(
	`°©
(
èrgë_∑th
, &
°
Ë|| !
	`S_ISREG
(°.
°_mode
) ||

475 !(
°
.
°_mode
 & 0111Ë|| st.
°_size
 < 4)

476 
	`FATAL
("Progøm '%s'ÇŸ found o∏nŸÉxecuèbÀ", 
‚ame
);

480 
ív_∑th
) {

482 
u8
 *
cur_ñem
, *
dñim
 = 
	`°rchr
(
ív_∑th
, ':');

484 i‡(
dñim
) {

486 
cur_ñem
 = 
	`ck_Æloc
(
dñim
 - 
ív_∑th
 + 1);

487 
	`mem˝y
(
cur_ñem
, 
ív_∑th
, 
dñim
 -Énv_path);

488 
dñim
++;

490 } 
cur_ñem
 = 
	`ck_°rdup
(
ív_∑th
);

492 
ív_∑th
 = 
dñim
;

494 i‡(
cur_ñem
[0])

495 
èrgë_∑th
 = 
	`Æloc_¥ötf
("%s/%s", 
cur_ñem
, 
‚ame
);

497 
èrgë_∑th
 = 
	`ck_°rdup
(
‚ame
);

499 
	`ck_‰ì
(
cur_ñem
);

501 i‡(!
	`°©
(
èrgë_∑th
, &
°
Ë&& 
	`S_ISREG
(°.
°_mode
) &&

502 (
°
.
°_mode
 & 0111Ë&& st.
°_size
 >= 4) ;

504 
	`ck_‰ì
(
èrgë_∑th
);

505 
èrgë_∑th
 = 0;

509 i‡(!
èrgë_∑th
Ë
	`FATAL
("Progøm '%s'ÇŸ found o∏nŸÉxecuèbÀ", 
‚ame
);

513 
	}
}

518 ** 
	$gë_qemu_¨gv
(
u8
* 
own_loc
, ** 
¨gv
, 
¨gc
) {

520 ** 
√w_¨gv
 = 
	`ck_Æloc
((*Ë* (
¨gc
 + 4));

521 
u8
 *
tmp
, *
˝
, *
r¶
, *
own_c›y
;

523 
	`mem˝y
(
√w_¨gv
 + 3, 
¨gv
 + 1, (*Ë* 
¨gc
);

525 
√w_¨gv
[2] = 
èrgë_∑th
;

526 
√w_¨gv
[1] = "--";

530 
tmp
 = 
	`gëív
("AFL_PATH");

532 i‡(
tmp
) {

534 
˝
 = 
	`Æloc_¥ötf
("%s/aÊ-qemu-åa˚", 
tmp
);

536 i‡(
	`ac˚ss
(
˝
, 
X_OK
))

537 
	`FATAL
("U«bÀÅÿföd '%s'", 
tmp
);

539 
èrgë_∑th
 = 
√w_¨gv
[0] = 
˝
;

540  
√w_¨gv
;

544 
own_c›y
 = 
	`ck_°rdup
(
own_loc
);

545 
r¶
 = 
	`°ºchr
(
own_c›y
, '/');

547 i‡(
r¶
) {

549 *
r¶
 = 0;

551 
˝
 = 
	`Æloc_¥ötf
("%s/aÊ-qemu-åa˚", 
own_c›y
);

552 
	`ck_‰ì
(
own_c›y
);

554 i‡(!
	`ac˚ss
(
˝
, 
X_OK
)) {

556 
èrgë_∑th
 = 
√w_¨gv
[0] = 
˝
;

557  
√w_¨gv
;

561 } 
	`ck_‰ì
(
own_c›y
);

563 i‡(!
	`ac˚ss
(
BIN_PATH
 "/aÊ-qemu-åa˚", 
X_OK
)) {

565 
èrgë_∑th
 = 
√w_¨gv
[0] = 
BIN_PATH
 "/afl-qemu-trace";

566  
√w_¨gv
;

570 
	`FATAL
("UnableÅo find 'afl-qemu-trace'.");

572 
	}
}

577 
	$maö
(
¨gc
, ** 
¨gv
) {

579 
s32
 
›t
;

580 
u8
 
mem_limô_giví
 = 0, 
timeout_giví
 = 0, 
qemu_mode
 = 0;

581 
u32
 
t˙t
;

582 ** 
u£_¨gv
;

584 
doc_∑th
 = 
	`ac˚ss
(
DOC_PATH
, 
F_OK
) ? "docs" : DOC_PATH;

586 (
›t
 = 
	`gë›t
(
¨gc
,
¨gv
,"+o:m:t:A:eqZQ")) > 0)

588 
›t
) {

592 i‡(
out_fûe
Ë
	`FATAL
("Multiple -o optionsÇot supported");

593 
out_fûe
 = 
›èrg
;

598 
u8
 
suffix
 = 'M';

600 i‡(
mem_limô_giví
Ë
	`FATAL
("Multiple -m optionsÇot supported");

601 
mem_limô_giví
 = 1;

603 i‡(!
	`°rcmp
(
›èrg
, "none")) {

605 
mem_limô
 = 0;

610 i‡(
	`ssˇnf
(
›èrg
, "%Œu%c", &
mem_limô
, &
suffix
) < 1 ||

611 
›èrg
[0] ='-'Ë
	`FATAL
("Bad syntax used for -m");

613 
suffix
) {

615 'T': 
mem_limô
 *= 1024 * 1024; ;

616 'G': 
mem_limô
 *= 1024; ;

617 'k': 
mem_limô
 /= 1024; ;

620 : 
	`FATAL
("Unsupported suffix or bad syntax for -m");

624 i‡(
mem_limô
 < 5Ë
	`FATAL
("DangerouslyÜow value of -m");

626 i‡((
æim_t
Ë=4 && 
mem_limô
 > 2000)

627 
	`FATAL
("Value of -m out ofÑange on 32-bit systems");

635 i‡(
timeout_giví
Ë
	`FATAL
("Multiple -t optionsÇot supported");

636 
timeout_giví
 = 1;

638 i‡(
	`°rcmp
(
›èrg
, "none")) {

639 
exec_tmout
 = 
	`©oi
(
›èrg
);

641 i‡(
exec_tmout
 < 20 || 
›èrg
[0] == '-')

642 
	`FATAL
("DangerouslyÜow value of -t");

650 i‡(
edges_⁄ly
Ë
	`FATAL
("Multiple -e optionsÇot supported");

651 
edges_⁄ly
 = 1;

656 i‡(
quõt_mode
Ë
	`FATAL
("Multiple -q optionsÇot supported");

657 
quõt_mode
 = 1;

665 
cmö_mode
 = 1;

666 
quõt_mode
 = 1;

672 
©_fûe
 = 
›èrg
;

677 i‡(
qemu_mode
Ë
	`FATAL
("Multiple -Q optionsÇot supported");

678 i‡(!
mem_limô_giví
Ë
mem_limô
 = 
MEM_LIMIT_QEMU
;

680 
qemu_mode
 = 1;

685 
	`ußge
(
¨gv
[0]);

689 i‡(
›töd
 =
¨gc
 || !
out_fûe
Ë
	`ußge
(
¨gv
[0]);

691 
	`£tup_shm
();

692 
	`£tup_sig«l_h™dÀrs
();

694 
	`£t_up_ívú⁄mít
();

696 
	`föd_bö¨y
(
¨gv
[
›töd
]);

698 i‡(!
quõt_mode
) {

699 
	`show_b™√r
();

700 
	`ACTF
("Executög '%s'...\n", 
èrgë_∑th
);

703 
	`dëe˘_fûe_¨gs
(
¨gv
 + 
›töd
);

705 i‡(
qemu_mode
)

706 
u£_¨gv
 = 
	`gë_qemu_¨gv
(
¨gv
[0],árgv + 
›töd
, 
¨gc
 - optind);

708 
u£_¨gv
 = 
¨gv
 + 
›töd
;

710 
	`run_èrgë
(
u£_¨gv
);

712 
t˙t
 = 
	`wrôe_ªsu…s
();

714 i‡(!
quõt_mode
) {

716 i‡(!
t˙t
Ë
	`FATAL
("Nÿö°rumíèti⁄ dëe˘ed" 
cRST
);

717 
	`OKF
("C≠tuªd %uÅu∂e†ö '%s'." 
cRST
, 
t˙t
, 
out_fûe
);

721 
	`exô
(
chûd_¸ashed
 * 2 + 
chûd_timed_out
);

723 
	}
}

	@afl-tmin.c

22 
	#AFL_MAIN


	)

24 
	~"c⁄fig.h
"

25 
	~"ty≥s.h
"

26 
	~"debug.h
"

27 
	~"Æloc-öl.h
"

28 
	~"hash.h
"

30 
	~<°dio.h
>

31 
	~<uni°d.h
>

32 
	~<°dlib.h
>

33 
	~<°rög.h
>

34 
	~<time.h
>

35 
	~<î∫o.h
>

36 
	~<sig«l.h
>

37 
	~<dúít.h
>

38 
	~<f˙é.h
>

40 
	~<sys/waô.h
>

41 
	~<sys/time.h
>

42 
	~<sys/shm.h
>

43 
	~<sys/°©.h
>

44 
	~<sys/ty≥s.h
>

45 
	~<sys/ªsour˚.h
>

47 
s32
 
	gchûd_pid
;

49 
u8
* 
	gåa˚_bôs
;

51 
u8
 *
	gö_fûe
,

52 *
	gout_fûe
,

53 *
	g¥og_ö
,

54 *
	gèrgë_∑th
,

55 *
	gdoc_∑th
;

57 
u8
* 
	gö_d©a
;

59 
u32
 
	gö_Àn
,

60 
	g‹ig_cksum
,

61 
	gtŸÆ_execs
,

62 
	gmis£d_h™gs
,

63 
	gmis£d_¸ashes
,

64 
	gmis£d_∑ths
,

65 
	gexec_tmout
 = 
EXEC_TIMEOUT
;

67 
u64
 
	gmem_limô
 = 
MEM_LIMIT
;

69 
s32
 
	gshm_id
,

70 
	gdev_nuŒ_fd
 = -1;

72 
u8
 
	g¸ash_mode
,

73 
	gexô_¸ash
,

74 
	gedges_⁄ly
,

75 
	gu£_°dö
 = 1;

77 vﬁ©ûê
u8


78 
	g°›_so⁄
,

79 
	gchûd_timed_out
;

84 c⁄° 
u8
 
	gcou¡_˛ass_lookup
[256] = {

98 
	$˛assify_cou¡s
(
u8
* 
mem
) {

100 
u32
 
i
 = 
MAP_SIZE
;

102 i‡(
edges_⁄ly
) {

104 
i
--) {

105 i‡(*
mem
) *mem = 1;

106 
mem
++;

111 
i
--) {

112 *
mem
 = 
cou¡_˛ass_lookup
[*mem];

113 
mem
++;

118 
	}
}

123 
ölöe
 
u8
 
	$™ythög_£t
() {

125 
u32
* 
±r
 = (u32*)
åa˚_bôs
;

126 
u32
 
i
 = (
MAP_SIZE
 >> 2);

128 
i
--Ëi‡(*(
±r
++))  1;

132 
	}
}

138 
	$ªmove_shm
() {

140 
	`u∆ök
(
¥og_ö
);

141 
	`shm˘l
(
shm_id
, 
IPC_RMID
, 
NULL
);

143 
	}
}

148 
	$£tup_shm
() {

150 
u8
* 
shm_°r
;

152 
shm_id
 = 
	`shmgë
(
IPC_PRIVATE
, 
MAP_SIZE
, 
IPC_CREAT
 | 
IPC_EXCL
 | 0600);

154 i‡(
shm_id
 < 0Ë
	`PFATAL
("shmget() failed");

156 
	`©exô
(
ªmove_shm
);

158 
shm_°r
 = 
	`Æloc_¥ötf
("%d", 
shm_id
);

160 
	`£ãnv
(
SHM_ENV_VAR
, 
shm_°r
, 1);

162 
	`ck_‰ì
(
shm_°r
);

164 
åa˚_bôs
 = 
	`shm©
(
shm_id
, 
NULL
, 0);

166 i‡(!
åa˚_bôs
Ë
	`PFATAL
("shmat() failed");

168 
	}
}

173 
	$ªad_öôül_fûe
() {

175 
°©
 
°
;

176 
s32
 
fd
 = 
	`›í
(
ö_fûe
, 
O_RDONLY
);

178 i‡(
fd
 < 0Ë
	`PFATAL
("U«bÀÅÿ›í '%s'", 
ö_fûe
);

180 i‡(
	`f°©
(
fd
, &
°
Ë|| !°.
°_size
)

181 
	`FATAL
("Zero-sized input file.");

183 i‡(
°
.
°_size
 >
TMIN_MAX_FILE
)

184 
	`FATAL
("I≈uàfûêi†toÿœrgê(%u MB max)", 
TMIN_MAX_FILE
 / 1024 / 1024);

186 
ö_Àn
 = 
°
.
°_size
;

187 
ö_d©a
 = 
	`ck_Æloc_nozîo
(
ö_Àn
);

189 
	`ck_ªad
(
fd
, 
ö_d©a
, 
ö_Àn
, 
ö_fûe
);

191 
	`˛o£
(
fd
);

193 
	`OKF
("Ród %u byã%†‰om '%s'.", 
ö_Àn
, in_À¿=1 ? "" : "s", 
ö_fûe
);

195 
	}
}

200 
s32
 
	$wrôe_to_fûe
(
u8
* 
∑th
, u8* 
mem
, 
u32
 
Àn
) {

202 
s32
 
ªt
;

204 
	`u∆ök
(
∑th
);

206 
ªt
 = 
	`›í
(
∑th
, 
O_RDWR
 | 
O_CREAT
 | 
O_EXCL
, 0600);

208 i‡(
ªt
 < 0Ë
	`PFATAL
("U«bÀÅÿ¸óã '%s'", 
∑th
);

210 
	`ck_wrôe
(
ªt
, 
mem
, 
Àn
, 
∑th
);

212 
	`l£ek
(
ªt
, 0, 
SEEK_SET
);

214  
ªt
;

216 
	}
}

221 
	$h™dÀ_timeout
(
sig
) {

223 
chûd_timed_out
 = 1;

224 i‡(
chûd_pid
 > 0Ë
	`kûl
(chûd_pid, 
SIGKILL
);

226 
	}
}

232 
u8
 
	$run_èrgë
(** 
¨gv
, 
u8
* 
mem
, 
u32
 
Àn
, u8 
fú°_run
) {

234 
ôimîvÆ
 
ô
;

235 
°©us
 = 0;

237 
s32
 
¥og_ö_fd
;

238 
u32
 
cksum
;

240 
	`mem£t
(
åa˚_bôs
, 0, 
MAP_SIZE
);

241 
	`MEM_BARRIER
();

243 
¥og_ö_fd
 = 
	`wrôe_to_fûe
(
¥og_ö
, 
mem
, 
Àn
);

245 
chûd_pid
 = 
	`f‹k
();

247 i‡(
chûd_pid
 < 0Ë
	`PFATAL
("fork() failed");

249 i‡(!
chûd_pid
) {

251 
æimô
 
r
;

253 i‡(
	`dup2
(
u£_°dö
 ? 
¥og_ö_fd
 : 
dev_nuŒ_fd
, 0) < 0 ||

254 
	`dup2
(
dev_nuŒ_fd
, 1) < 0 ||

255 
	`dup2
(
dev_nuŒ_fd
, 2) < 0) {

257 *(
u32
*)
åa˚_bôs
 = 
EXEC_FAIL_SIG
;

258 
	`PFATAL
("dup2() failed");

262 
	`˛o£
(
dev_nuŒ_fd
);

263 
	`˛o£
(
¥og_ö_fd
);

265 i‡(
mem_limô
) {

267 
r
.
æim_max
 =Ñ.
æim_cur
 = ((
æim_t
)
mem_limô
) << 20;

269 #ifde‡
RLIMIT_AS


271 
	`£ålimô
(
RLIMIT_AS
, &
r
);

275 
	`£ålimô
(
RLIMIT_DATA
, &
r
);

281 
r
.
æim_max
 =Ñ.
æim_cur
 = 0;

282 
	`£ålimô
(
RLIMIT_CORE
, &
r
);

284 
	`execv
(
èrgë_∑th
, 
¨gv
);

286 *(
u32
*)
åa˚_bôs
 = 
EXEC_FAIL_SIG
;

287 
	`exô
(0);

291 
	`˛o£
(
¥og_ö_fd
);

295 
chûd_timed_out
 = 0;

296 
ô
.
ô_vÆue
.
tv_£c
 = (
exec_tmout
 / 1000);

297 
ô
.
ô_vÆue
.
tv_u£c
 = (
exec_tmout
 % 1000) * 1000;

299 
	`£tôimî
(
ITIMER_REAL
, &
ô
, 
NULL
);

301 i‡(
	`waôpid
(
chûd_pid
, &
°©us
, 0Ë<0Ë
	`FATAL
("waitpid() failed");

303 
chûd_pid
 = 0;

304 
ô
.
ô_vÆue
.
tv_£c
 = 0;

305 
ô
.
ô_vÆue
.
tv_u£c
 = 0;

307 
	`£tôimî
(
ITIMER_REAL
, &
ô
, 
NULL
);

309 
	`MEM_BARRIER
();

313 i‡(*(
u32
*)
åa˚_bôs
 =
EXEC_FAIL_SIG
)

314 
	`FATAL
("U«bÀÅÿexecuã '%s'", 
¨gv
[0]);

316 
	`˛assify_cou¡s
(
åa˚_bôs
);

317 
tŸÆ_execs
++;

319 i‡(
°›_so⁄
) {

320 
	`SAYF
(
cRST
 
cLRD
 "\n+++ Minimizationáborted by user +++\n" cRST);

321 
	`exô
(1);

326 i‡(
chûd_timed_out
) {

328 
mis£d_h™gs
++;

335 i‡(
	`WIFSIGNALED
(
°©us
) ||

336 (
	`WIFEXITED
(
°©us
Ë&& 
	`WEXITSTATUS
(°©usË=
MSAN_ERROR
) ||

337 (
	`WIFEXITED
(
°©us
Ë&& 
	`WEXITSTATUS
(°©usË&& 
exô_¸ash
)) {

339 i‡(
fú°_run
Ë
¸ash_mode
 = 1;

341 i‡(
¸ash_mode
) {

347 
mis£d_¸ashes
++;

356 i‡(
¸ash_mode
) {

358 
mis£d_∑ths
++;

363 
cksum
 = 
	`hash32
(
åa˚_bôs
, 
MAP_SIZE
, 
HASH_CONST
);

365 i‡(
fú°_run
Ë
‹ig_cksum
 = 
cksum
;

367 i‡(
‹ig_cksum
 =
cksum
)  1;

369 
mis£d_∑ths
++;

372 
	}
}

377 
u32
 
	$√xt_p2
(
u32
 
vÆ
) {

379 
u32
 
ªt
 = 1;

380 
vÆ
 > 
ªt
)Ñet <<= 1;

381  
ªt
;

383 
	}
}

388 
	$möimize
(** 
¨gv
) {

390 
u32
 
Æpha_m≠
[256];

392 
u8
* 
tmp_buf
 = 
	`ck_Æloc_nozîo
(
ö_Àn
);

393 
u32
 
‹ig_Àn
 = 
ö_Àn
, 
°age_o_Àn
;

395 
u32
 
dñ_Àn
, 
£t_Àn
, 
dñ_pos
, 
£t_pos
, 
i
, 
Æpha_size
, 
cur_∑ss
 = 0;

396 
u32
 
syms_ªmoved
, 
Æpha_dñ0
 = 0, 
Æpha_dñ1
, 
Æpha_dñ2
, 
Æpha_d_tŸÆ
 = 0;

397 
u8
 
ch™ged_™y
, 
¥ev_dñ
;

403 
£t_Àn
 = 
	`√xt_p2
(
ö_Àn
 / 
TMIN_SET_STEPS
);

404 
£t_pos
 = 0;

406 i‡(
£t_Àn
 < 
TMIN_SET_MIN_SIZE
) set_len = TMIN_SET_MIN_SIZE;

408 
	`ACTF
(
cBRI
 "Sègê#0: " 
cRST
 "One-time blockÇormalization...");

410 
£t_pos
 < 
ö_Àn
) {

412 
u8
 
ªs
;

413 
u32
 
u£_Àn
 = 
	`MIN
(
£t_Àn
, 
ö_Àn
 - 
£t_pos
);

415 
i
 = 0; i < 
u£_Àn
; i++)

416 i‡(
ö_d©a
[
£t_pos
 + 
i
] != '0') ;

418 i‡(
i
 !
u£_Àn
) {

420 
	`mem˝y
(
tmp_buf
, 
ö_d©a
, 
ö_Àn
);

421 
	`mem£t
(
tmp_buf
 + 
£t_pos
, '0', 
u£_Àn
);

423 
ªs
 = 
	`run_èrgë
(
¨gv
, 
tmp_buf
, 
ö_Àn
, 0);

425 i‡(
ªs
) {

427 
	`mem£t
(
ö_d©a
 + 
£t_pos
, '0', 
u£_Àn
);

428 
ch™ged_™y
 = 1;

429 
Æpha_dñ0
 +
u£_Àn
;

435 
£t_pos
 +
£t_Àn
;

439 
Æpha_d_tŸÆ
 +
Æpha_dñ0
;

441 
	`OKF
("BlockÇ‹mÆiz©i⁄ com∂ëe, %u byã%†ª∂a˚d.", 
Æpha_dñ0
,

442 
Æpha_dñ0
 == 1 ? "" : "s");

444 
√xt_∑ss
:

446 
	`ACTF
(
cYEL
 "--- " 
cBRI
 "Pas†#%u " cYEL "---", ++
cur_∑ss
);

447 
ch™ged_™y
 = 0;

453 
dñ_Àn
 = 
	`√xt_p2
(
ö_Àn
 / 
TRIM_START_STEPS
);

454 
°age_o_Àn
 = 
ö_Àn
;

456 
	`ACTF
(
cBRI
 "Sègê#1: " 
cRST
 "Removing blocks of data...");

458 
√xt_dñ_blksize
:

460 i‡(!
dñ_Àn
) del_len = 1;

461 
dñ_pos
 = 0;

462 
¥ev_dñ
 = 1;

464 
	`SAYF
(
cGRA
 " BlockÜígth = %u,Ñemaöög sizê%u\n" 
cRST
,

465 
dñ_Àn
, 
ö_Àn
);

467 
dñ_pos
 < 
ö_Àn
) {

469 
u8
 
ªs
;

470 
s32
 
èû_Àn
;

472 
èû_Àn
 = 
ö_Àn
 - 
dñ_pos
 - 
dñ_Àn
;

473 i‡(
èû_Àn
 < 0)Åail_len = 0;

480 i‡(!
¥ev_dñ
 && 
èû_Àn
 && !
	`memcmp
(
ö_d©a
 + 
dñ_pos
 - 
dñ_Àn
,

481 
ö_d©a
 + 
dñ_pos
, 
dñ_Àn
)) {

483 
dñ_pos
 +
dñ_Àn
;

488 
¥ev_dñ
 = 0;

491 
	`mem˝y
(
tmp_buf
, 
ö_d©a
, 
dñ_pos
);

494 
	`mem˝y
(
tmp_buf
 + 
dñ_pos
, 
ö_d©a
 + dñ_po†+ 
dñ_Àn
, 
èû_Àn
);

496 
ªs
 = 
	`run_èrgë
(
¨gv
, 
tmp_buf
, 
dñ_pos
 + 
èû_Àn
, 0);

498 i‡(
ªs
) {

500 
	`mem˝y
(
ö_d©a
, 
tmp_buf
, 
dñ_pos
 + 
èû_Àn
);

501 
¥ev_dñ
 = 1;

502 
ö_Àn
 = 
dñ_pos
 + 
èû_Àn
;

504 
ch™ged_™y
 = 1;

506 } 
dñ_pos
 +
dñ_Àn
;

510 i‡(
dñ_Àn
 > 1 && 
ö_Àn
 >= 1) {

512 
dñ_Àn
 /= 2;

513 
√xt_dñ_blksize
;

517 
	`OKF
("BlockÑemovÆ com∂ëe, %u byã†dñëed.", 
°age_o_Àn
 - 
ö_Àn
);

519 i‡(!
ö_Àn
 && 
ch™ged_™y
)

520 
	`WARNF
(
cLRD
 "Dow¿tÿzîÿbyã†- checkÅhêcomm™dÜöê™d memÜimô!" 
cRST
);

522 i‡(
cur_∑ss
 > 1 && !
ch™ged_™y
Ë
föÆize_Æl
;

528 
Æpha_size
 = 0;

529 
Æpha_dñ1
 = 0;

530 
syms_ªmoved
 = 0;

532 
	`mem£t
(
Æpha_m≠
, 0, 256 * (
u32
));

534 
i
 = 0; i < 
ö_Àn
; i++) {

535 i‡(!
Æpha_m≠
[
ö_d©a
[
i
]]Ë
Æpha_size
++;

536 
Æpha_m≠
[
ö_d©a
[
i
]]++;

539 
	`ACTF
(
cBRI
 "Sègê#2: " 
cRST
 "Minimizing symbols (%u codeÖoint%s)...",

540 
Æpha_size
,álpha_size == 1 ? "" : "s");

542 
i
 = 0; i < 256; i++) {

544 
u32
 
r
;

545 
u8
 
ªs
;

547 i‡(
i
 ='0' || !
Æpha_m≠
[i]) ;

549 
	`mem˝y
(
tmp_buf
, 
ö_d©a
, 
ö_Àn
);

551 
r
 = 0;Ñ < 
ö_Àn
;Ñ++)

552 i‡(
tmp_buf
[
r
] =
i
)Åmp_buf[r] = '0';

554 
ªs
 = 
	`run_èrgë
(
¨gv
, 
tmp_buf
, 
ö_Àn
, 0);

556 i‡(
ªs
) {

558 
	`mem˝y
(
ö_d©a
, 
tmp_buf
, 
ö_Àn
);

559 
syms_ªmoved
++;

560 
Æpha_dñ1
 +
Æpha_m≠
[
i
];

561 
ch™ged_™y
 = 1;

567 
Æpha_d_tŸÆ
 +
Æpha_dñ1
;

569 
	`OKF
("Symbol minimization finished, %u symbol%s (%u byte%s)Ñeplaced.",

570 
syms_ªmoved
, syms_removed == 1 ? "" : "s",

571 
Æpha_dñ1
,álpha_del1 == 1 ? "" : "s");

577 
Æpha_dñ2
 = 0;

579 
	`ACTF
(
cBRI
 "Sègê#3: " 
cRST
 "Character minimization...");

581 
	`mem˝y
(
tmp_buf
, 
ö_d©a
, 
ö_Àn
);

583 
i
 = 0; i < 
ö_Àn
; i++) {

585 
u8
 
ªs
, 
‹ig
 = 
tmp_buf
[
i
];

587 i‡(
‹ig
 == '0') ;

588 
tmp_buf
[
i
] = '0';

590 
ªs
 = 
	`run_èrgë
(
¨gv
, 
tmp_buf
, 
ö_Àn
, 0);

592 i‡(
ªs
) {

594 
ö_d©a
[
i
] = '0';

595 
Æpha_dñ2
++;

596 
ch™ged_™y
 = 1;

598 } 
tmp_buf
[
i
] = 
‹ig
;

602 
Æpha_d_tŸÆ
 +
Æpha_dñ2
;

604 
	`OKF
("Character minimization done, %u byte%sÑeplaced.",

605 
Æpha_dñ2
,álpha_del2 == 1 ? "" : "s");

607 i‡(
ch™ged_™y
Ë
√xt_∑ss
;

609 
föÆize_Æl
:

611 
	`SAYF
("\n"

612 
cGRA
 " Fûêsizêªdu˚d by : " 
cRST
 "%0.02f%% (to %u byte%s)\n"

613 
cGRA
 " Ch¨a˘î†sim∂ifõd : " 
cRST
 "%0.02f%%\n"

614 
cGRA
 " Numbî o‡exec†d⁄ê: " 
cRST
 "%u\n"

615 
cGRA
 " FruôÀs†exec†: " 
cRST
 "path=%u crash=%u hang=%s%u\n\n",

616 100 - (()
ö_Àn
Ë* 100 / 
‹ig_Àn
, in_len, in_len == 1 ? "" : "s",

617 (()(
Æpha_d_tŸÆ
)Ë* 100 / (
ö_Àn
 ? in_len : 1),

618 
tŸÆ_execs
, 
mis£d_∑ths
, 
mis£d_¸ashes
, 
mis£d_h™gs
 ? 
cLRD
 : "",

619 
mis£d_h™gs
);

621 i‡(
tŸÆ_execs
 > 50 && 
mis£d_h™gs
 * 10 >Åotal_execs)

622 
	`WARNF
(
cLRD
 "Fªquíàtimeout†-Ñesu…†may bêskewed." 
cRST
);

624 
	}
}

630 
	$h™dÀ_°›_sig
(
sig
) {

632 
°›_so⁄
 = 1;

634 i‡(
chûd_pid
 > 0Ë
	`kûl
(chûd_pid, 
SIGKILL
);

636 
	}
}

641 
	$£t_up_ívú⁄mít
() {

643 
u8
* 
x
;

645 
dev_nuŒ_fd
 = 
	`›í
("/dev/nuŒ", 
O_RDWR
);

646 i‡(
dev_nuŒ_fd
 < 0Ë
	`PFATAL
("UnableÅo open /dev/null");

648 i‡(!
¥og_ö
) {

650 
u8
* 
u£_dú
 = ".";

652 i‡(!
	`ac˚ss
(
u£_dú
, 
R_OK
 | 
W_OK
 | 
X_OK
)) {

654 
u£_dú
 = 
	`gëív
("TMPDIR");

655 i‡(!
u£_dú
) use_dir = "/tmp";

657 
¥og_ö
 = 
	`Æloc_¥ötf
("%s/.aÊ-tmö-ãmp-%u", 
u£_dú
, 
	`gëpid
());

665 
x
 = 
	`gëív
("ASAN_OPTIONS");

667 i‡(
x
) {

669 i‡(!
	`°r°r
(
x
, "abort_on_error=1"))

670 
	`FATAL
("Custom ASAN_OPTIONS set withoutábort_on_error=1 -Ölease fix!");

672 i‡(!
	`°r°r
(
x
, "symbolize=0"))

673 
	`FATAL
("Custom ASAN_OPTIONS set without symbolize=0 -Ölease fix!");

677 
x
 = 
	`gëív
("MSAN_OPTIONS");

679 i‡(
x
) {

681 i‡(!
	`°r°r
(
x
, "exô_code=" 
	`STRINGIFY
(
MSAN_ERROR
)))

682 
	`FATAL
("Custom MSAN_OPTIONS set withoutÉxit_code="

683 
	`STRINGIFY
(
MSAN_ERROR
) " -Ölease fix!");

685 i‡(!
	`°r°r
(
x
, "symbolize=0"))

686 
	`FATAL
("Custom MSAN_OPTIONS set without symbolize=0 -Ölease fix!");

690 
	`£ãnv
("ASAN_OPTIONS", "abort_on_error=1:"

695 
	`£ãnv
("MSAN_OPTIONS", "exô_code=" 
	`STRINGIFY
(
MSAN_ERROR
) ":"

701 i‡(
	`gëív
("AFL_LD_PRELOAD"))

702 
	`£ãnv
("LD_PRELOAD", 
	`gëív
("AFL_LD_PRELOAD"), 1);

704 
	}
}

709 
	$£tup_sig«l_h™dÀrs
() {

711 
siga˘i⁄
 
ß
;

713 
ß
.
ß_h™dÀr
 = 
NULL
;

714 
ß
.
ß_Êags
 = 
SA_RESTART
;

715 
ß
.
ß_siga˘i⁄
 = 
NULL
;

717 
	`sigem±y£t
(&
ß
.
ß_mask
);

721 
ß
.
ß_h™dÀr
 = 
h™dÀ_°›_sig
;

722 
	`siga˘i⁄
(
SIGHUP
, &
ß
, 
NULL
);

723 
	`siga˘i⁄
(
SIGINT
, &
ß
, 
NULL
);

724 
	`siga˘i⁄
(
SIGTERM
, &
ß
, 
NULL
);

728 
ß
.
ß_h™dÀr
 = 
h™dÀ_timeout
;

729 
	`siga˘i⁄
(
SIGALRM
, &
ß
, 
NULL
);

731 
	}
}

736 
	$dëe˘_fûe_¨gs
(** 
¨gv
) {

738 
u32
 
i
 = 0;

739 
u8
* 
cwd
 = 
	`gëcwd
(
NULL
, 0);

741 i‡(!
cwd
Ë
	`PFATAL
("getcwd() failed");

743 
¨gv
[
i
]) {

745 
u8
* 
Ø_loc
 = 
	`°r°r
(
¨gv
[
i
], "@@");

747 i‡(
Ø_loc
) {

749 
u8
 *
Ø_sub°
, *
n_¨g
;

753 i‡(
¥og_ö
[0] ='/'Ë
Ø_sub°
 =Örog_in;

754 
Ø_sub°
 = 
	`Æloc_¥ötf
("%s/%s", 
cwd
, 
¥og_ö
);

758 *
Ø_loc
 = 0;

759 
n_¨g
 = 
	`Æloc_¥ötf
("%s%s%s", 
¨gv
[
i
], 
Ø_sub°
, 
Ø_loc
 + 2);

760 
¨gv
[
i
] = 
n_¨g
;

761 *
Ø_loc
 = '@';

763 i‡(
¥og_ö
[0] !'/'Ë
	`ck_‰ì
(
Ø_sub°
);

767 
i
++;

771 
	`‰ì
(
cwd
);

773 
	}
}

778 
	$ußge
(
u8
* 
¨gv0
) {

780 
	`SAYF
("\n%s [ options ] -- /path/to/target_app [ ... ]\n\n"

801 
¨gv0
, 
EXEC_TIMEOUT
, 
MEM_LIMIT
, 
doc_∑th
);

803 
	`exô
(1);

805 
	}
}

810 
	$föd_bö¨y
(
u8
* 
‚ame
) {

812 
u8
* 
ív_∑th
 = 0;

813 
°©
 
°
;

815 i‡(
	`°rchr
(
‚ame
, '/'Ë|| !(
ív_∑th
 = 
	`gëív
("PATH"))) {

817 
èrgë_∑th
 = 
	`ck_°rdup
(
‚ame
);

819 i‡(
	`°©
(
èrgë_∑th
, &
°
Ë|| !
	`S_ISREG
(°.
°_mode
) ||

820 !(
°
.
°_mode
 & 0111Ë|| st.
°_size
 < 4)

821 
	`FATAL
("Progøm '%s'ÇŸ found o∏nŸÉxecuèbÀ", 
‚ame
);

825 
ív_∑th
) {

827 
u8
 *
cur_ñem
, *
dñim
 = 
	`°rchr
(
ív_∑th
, ':');

829 i‡(
dñim
) {

831 
cur_ñem
 = 
	`ck_Æloc
(
dñim
 - 
ív_∑th
 + 1);

832 
	`mem˝y
(
cur_ñem
, 
ív_∑th
, 
dñim
 -Énv_path);

833 
dñim
++;

835 } 
cur_ñem
 = 
	`ck_°rdup
(
ív_∑th
);

837 
ív_∑th
 = 
dñim
;

839 i‡(
cur_ñem
[0])

840 
èrgë_∑th
 = 
	`Æloc_¥ötf
("%s/%s", 
cur_ñem
, 
‚ame
);

842 
èrgë_∑th
 = 
	`ck_°rdup
(
‚ame
);

844 
	`ck_‰ì
(
cur_ñem
);

846 i‡(!
	`°©
(
èrgë_∑th
, &
°
Ë&& 
	`S_ISREG
(°.
°_mode
) &&

847 (
°
.
°_mode
 & 0111Ë&& st.
°_size
 >= 4) ;

849 
	`ck_‰ì
(
èrgë_∑th
);

850 
èrgë_∑th
 = 0;

854 i‡(!
èrgë_∑th
Ë
	`FATAL
("Progøm '%s'ÇŸ found o∏nŸÉxecuèbÀ", 
‚ame
);

858 
	}
}

863 ** 
	$gë_qemu_¨gv
(
u8
* 
own_loc
, ** 
¨gv
, 
¨gc
) {

865 ** 
√w_¨gv
 = 
	`ck_Æloc
((*Ë* (
¨gc
 + 4));

866 
u8
 *
tmp
, *
˝
, *
r¶
, *
own_c›y
;

868 
	`mem˝y
(
√w_¨gv
 + 3, 
¨gv
 + 1, (*Ë* 
¨gc
);

872 
√w_¨gv
[2] = 
èrgë_∑th
;

873 
√w_¨gv
[1] = "--";

875 
tmp
 = 
	`gëív
("AFL_PATH");

877 i‡(
tmp
) {

879 
˝
 = 
	`Æloc_¥ötf
("%s/aÊ-qemu-åa˚", 
tmp
);

881 i‡(
	`ac˚ss
(
˝
, 
X_OK
))

882 
	`FATAL
("U«bÀÅÿföd '%s'", 
tmp
);

884 
èrgë_∑th
 = 
√w_¨gv
[0] = 
˝
;

885  
√w_¨gv
;

889 
own_c›y
 = 
	`ck_°rdup
(
own_loc
);

890 
r¶
 = 
	`°ºchr
(
own_c›y
, '/');

892 i‡(
r¶
) {

894 *
r¶
 = 0;

896 
˝
 = 
	`Æloc_¥ötf
("%s/aÊ-qemu-åa˚", 
own_c›y
);

897 
	`ck_‰ì
(
own_c›y
);

899 i‡(!
	`ac˚ss
(
˝
, 
X_OK
)) {

901 
èrgë_∑th
 = 
√w_¨gv
[0] = 
˝
;

902  
√w_¨gv
;

906 } 
	`ck_‰ì
(
own_c›y
);

908 i‡(!
	`ac˚ss
(
BIN_PATH
 "/aÊ-qemu-åa˚", 
X_OK
)) {

910 
èrgë_∑th
 = 
√w_¨gv
[0] = 
BIN_PATH
 "/afl-qemu-trace";

911  
√w_¨gv
;

915 
	`FATAL
("UnableÅo find 'afl-qemu-trace'.");

917 
	}
}

922 
	$maö
(
¨gc
, ** 
¨gv
) {

924 
s32
 
›t
;

925 
u8
 
mem_limô_giví
 = 0, 
timeout_giví
 = 0, 
qemu_mode
 = 0;

926 ** 
u£_¨gv
;

928 
doc_∑th
 = 
	`ac˚ss
(
DOC_PATH
, 
F_OK
) ? "docs" : DOC_PATH;

930 
	`SAYF
(
cCYA
 "aÊ-tmö " 
cBRI
 
VERSION
 
cRST
 " by <lcamtuf@google.com>\n");

932 (
›t
 = 
	`gë›t
(
¨gc
,
¨gv
,"+i:o:f:m:t:xeQ")) > 0)

934 
›t
) {

938 i‡(
ö_fûe
Ë
	`FATAL
("Multiple -i optionsÇot supported");

939 
ö_fûe
 = 
›èrg
;

944 i‡(
out_fûe
Ë
	`FATAL
("Multiple -o optionsÇot supported");

945 
out_fûe
 = 
›èrg
;

950 i‡(
¥og_ö
Ë
	`FATAL
("Multiple -f optionsÇot supported");

951 
u£_°dö
 = 0;

952 
¥og_ö
 = 
›èrg
;

957 i‡(
edges_⁄ly
Ë
	`FATAL
("Multiple -e optionsÇot supported");

958 
edges_⁄ly
 = 1;

963 i‡(
exô_¸ash
Ë
	`FATAL
("Multiple -x optionsÇot supported");

964 
exô_¸ash
 = 1;

969 
u8
 
suffix
 = 'M';

971 i‡(
mem_limô_giví
Ë
	`FATAL
("Multiple -m optionsÇot supported");

972 
mem_limô_giví
 = 1;

974 i‡(!
	`°rcmp
(
›èrg
, "none")) {

976 
mem_limô
 = 0;

981 i‡(
	`ssˇnf
(
›èrg
, "%Œu%c", &
mem_limô
, &
suffix
) < 1 ||

982 
›èrg
[0] ='-'Ë
	`FATAL
("Bad syntax used for -m");

984 
suffix
) {

986 'T': 
mem_limô
 *= 1024 * 1024; ;

987 'G': 
mem_limô
 *= 1024; ;

988 'k': 
mem_limô
 /= 1024; ;

991 : 
	`FATAL
("Unsupported suffix or bad syntax for -m");

995 i‡(
mem_limô
 < 5Ë
	`FATAL
("DangerouslyÜow value of -m");

997 i‡((
æim_t
Ë=4 && 
mem_limô
 > 2000)

998 
	`FATAL
("Value of -m out ofÑange on 32-bit systems");

1006 i‡(
timeout_giví
Ë
	`FATAL
("Multiple -t optionsÇot supported");

1007 
timeout_giví
 = 1;

1009 
exec_tmout
 = 
	`©oi
(
›èrg
);

1011 i‡(
exec_tmout
 < 10 || 
›èrg
[0] == '-')

1012 
	`FATAL
("DangerouslyÜow value of -t");

1018 i‡(
qemu_mode
Ë
	`FATAL
("Multiple -Q optionsÇot supported");

1019 i‡(!
mem_limô_giví
Ë
mem_limô
 = 
MEM_LIMIT_QEMU
;

1021 
qemu_mode
 = 1;

1026 
	`ußge
(
¨gv
[0]);

1030 i‡(
›töd
 =
¨gc
 || !
ö_fûe
 || !
out_fûe
Ë
	`ußge
(
¨gv
[0]);

1032 
	`£tup_shm
();

1033 
	`£tup_sig«l_h™dÀrs
();

1035 
	`£t_up_ívú⁄mít
();

1037 
	`föd_bö¨y
(
¨gv
[
›töd
]);

1038 
	`dëe˘_fûe_¨gs
(
¨gv
 + 
›töd
);

1040 i‡(
qemu_mode
)

1041 
u£_¨gv
 = 
	`gë_qemu_¨gv
(
¨gv
[0],árgv + 
›töd
, 
¨gc
 - optind);

1043 
u£_¨gv
 = 
¨gv
 + 
›töd
;

1045 
	`SAYF
("\n");

1047 
	`ªad_öôül_fûe
();

1049 
	`ACTF
("Performing dryÑun (memÜimit = %llu MB,Åimeout = %u ms%s)...",

1050 
mem_limô
, 
exec_tmout
, 
edges_⁄ly
 ? ",Édges only" : "");

1052 
	`run_èrgë
(
u£_¨gv
, 
ö_d©a
, 
ö_Àn
, 1);

1054 i‡(
chûd_timed_out
)

1055 
	`FATAL
("Target binaryÅimes out (adjusting -t may help).");

1057 i‡(!
¸ash_mode
) {

1059 
	`OKF
("ProgramÅerminatesÇormally, minimizing in "

1060 
cCYA
 "ö°rumíãd" 
cRST
 " mode.");

1062 i‡(!
	`™ythög_£t
()Ë
	`FATAL
("No instrumentation detected.");

1066 
	`OKF
("ProgømÉxô†wôhá sig«l, möimizög i¿" 
cMGN
 "¸ash" 
cRST


1071 
	`möimize
(
u£_¨gv
);

1073 
	`ACTF
("Wrôög ouçuàtÿ'%s'...", 
out_fûe
);

1075 
	`˛o£
(
	`wrôe_to_fûe
(
out_fûe
, 
ö_d©a
, 
ö_Àn
));

1077 
	`OKF
("We're done here. HaveáÇice day!\n");

1079 
	`exô
(0);

1081 
	}
}

	@alloc-inl.h

21 #i‚de‡
_HAVE_ALLOC_INL_H


22 
	#_HAVE_ALLOC_INL_H


	)

24 
	~<°dio.h
>

25 
	~<°dlib.h
>

26 
	~<°rög.h
>

28 
	~"c⁄fig.h
"

29 
	~"ty≥s.h
"

30 
	~"debug.h
"

34 
	#Æloc_¥ötf
(
_°r
...) ({ \

35 
u8
* 
_tmp
; \

36 
s32
 
_Àn
 = 
	`¢¥ötf
(
NULL
, 0, 
_°r
); \

37 i‡(
_Àn
 < 0Ë
	`FATAL
("Whoa, snprintf() fails?!"); \

38 
_tmp
 = 
	`ck_Æloc
(
_Àn
 + 1); \

39 
	`¢¥ötf
((*)
_tmp
, 
_Àn
 + 1, 
_°r
); \

40 
_tmp
; \

41 })

	)

46 
	#ALLOC_CHECK_SIZE
(
_s
) do { \

47 i‡((
_s
Ë> 
MAX_ALLOC
) \

48 
	`ABORT
("BadáŒo¯ªque°: %u byãs", (
_s
)); \

49 } 0)

	)

53 
	#ALLOC_CHECK_RESULT
(
_r
, 
_s
) do { \

54 i‡(!(
_r
)) \

55 
	`ABORT
("Ouào‡mem‹y: c™'àÆloˇã %u byãs", (
_s
)); \

56 } 0)

	)

60 
	#ALLOC_MAGIC_C1
 0xFF00FF00

	)

61 
	#ALLOC_MAGIC_F
 0xFE00FE00

	)

62 
	#ALLOC_MAGIC_C2
 0xF0

	)

66 
	#ALLOC_C1
(
_±r
Ë(((
u32
*)(_±r))[-2])

	)

67 
	#ALLOC_S
(
_±r
Ë(((
u32
*)(_±r))[-1])

	)

68 
	#ALLOC_C2
(
_±r
Ë(((
u8
*)(_±r))[
	`ALLOC_S
(_±r)])

	)

70 
	#ALLOC_OFF_HEAD
 8

	)

71 
	#ALLOC_OFF_TOTAL
 (
ALLOC_OFF_HEAD
 + 1)

	)

75 
	#ALLOC_BLK_INC
 256

	)

79 
	#CHECK_PTR
(
_p
) do { \

80 i‡(
_p
) { \

81 i‡(
	`ALLOC_C1
(
_p
Ë^ 
ALLOC_MAGIC_C1
) {\

82 i‡(
	`ALLOC_C1
(
_p
Ë=
ALLOC_MAGIC_F
) \

83 
	`ABORT
("Useáfter free."); \

84 
	`ABORT
("Corrupted headálloc canary."); \

86 i‡(
	`ALLOC_C2
(
_p
Ë^ 
ALLOC_MAGIC_C2
) \

87 
	`ABORT
("CorruptedÅailálloc canary."); \

89 } 0)

	)

91 
	#CHECK_PTR_EXPR
(
_p
) ({ \

92 
	`ty≥of
 (
_p
Ë
_tmp
 = (_p); \

93 
	`CHECK_PTR
(
_tmp
); \

94 
_tmp
; \

95 })

	)

101 
ölöe
 * 
	$DFL_ck_Æloc_nozîo
(
u32
 
size
) {

103 * 
ªt
;

105 i‡(!
size
Ë 
NULL
;

107 
	`ALLOC_CHECK_SIZE
(
size
);

108 
ªt
 = 
	`mÆloc
(
size
 + 
ALLOC_OFF_TOTAL
);

109 
	`ALLOC_CHECK_RESULT
(
ªt
, 
size
);

111 
ªt
 +
ALLOC_OFF_HEAD
;

113 
	`ALLOC_C1
(
ªt
Ë
ALLOC_MAGIC_C1
;

114 
	`ALLOC_S
(
ªt
Ë
size
;

115 
	`ALLOC_C2
(
ªt
Ë
ALLOC_MAGIC_C2
;

117  
ªt
;

119 
	}
}

124 
ölöe
 * 
	$DFL_ck_Æloc
(
u32
 
size
) {

126 * 
mem
;

128 i‡(!
size
Ë 
NULL
;

129 
mem
 = 
	`DFL_ck_Æloc_nozîo
(
size
);

131  
	`mem£t
(
mem
, 0, 
size
);

133 
	}
}

139 
ölöe
 
	$DFL_ck_‰ì
(* 
mem
) {

141 i‡(!
mem
) ;

143 
	`CHECK_PTR
(
mem
);

145 #ifde‡
DEBUG_BUILD


148 
	`mem£t
(
mem
, 0xFF, 
	`ALLOC_S
(mem));

152 
	`ALLOC_C1
(
mem
Ë
ALLOC_MAGIC_F
;

154 
	`‰ì
(
mem
 - 
ALLOC_OFF_HEAD
);

156 
	}
}

163 
ölöe
 * 
	$DFL_ck_ªÆloc
(* 
‹ig
, 
u32
 
size
) {

165 * 
ªt
;

166 
u32
 
ﬁd_size
 = 0;

168 i‡(!
size
) {

170 
	`DFL_ck_‰ì
(
‹ig
);

171  
NULL
;

175 i‡(
‹ig
) {

177 
	`CHECK_PTR
(
‹ig
);

179 #i‚de‡
DEBUG_BUILD


180 
	`ALLOC_C1
(
‹ig
Ë
ALLOC_MAGIC_F
;

183 
ﬁd_size
 = 
	`ALLOC_S
(
‹ig
);

184 
‹ig
 -
ALLOC_OFF_HEAD
;

186 
	`ALLOC_CHECK_SIZE
(
ﬁd_size
);

190 
	`ALLOC_CHECK_SIZE
(
size
);

192 #i‚de‡
DEBUG_BUILD


194 
ªt
 = 
	`ªÆloc
(
‹ig
, 
size
 + 
ALLOC_OFF_TOTAL
);

195 
	`ALLOC_CHECK_RESULT
(
ªt
, 
size
);

202 
ªt
 = 
	`mÆloc
(
size
 + 
ALLOC_OFF_TOTAL
);

203 
	`ALLOC_CHECK_RESULT
(
ªt
, 
size
);

205 i‡(
‹ig
) {

207 
	`mem˝y
(
ªt
 + 
ALLOC_OFF_HEAD
, 
‹ig
 + ALLOC_OFF_HEAD, 
	`MIN
(
size
, 
ﬁd_size
));

208 
	`mem£t
(
‹ig
 + 
ALLOC_OFF_HEAD
, 0xFF, 
ﬁd_size
);

210 
	`ALLOC_C1
(
‹ig
 + 
ALLOC_OFF_HEAD
Ë
ALLOC_MAGIC_F
;

212 
	`‰ì
(
‹ig
);

218 
ªt
 +
ALLOC_OFF_HEAD
;

220 
	`ALLOC_C1
(
ªt
Ë
ALLOC_MAGIC_C1
;

221 
	`ALLOC_S
(
ªt
Ë
size
;

222 
	`ALLOC_C2
(
ªt
Ë
ALLOC_MAGIC_C2
;

224 i‡(
size
 > 
ﬁd_size
)

225 
	`mem£t
(
ªt
 + 
ﬁd_size
, 0, 
size
 - old_size);

227  
ªt
;

229 
	}
}

235 
ölöe
 * 
	$DFL_ck_ªÆloc_block
(* 
‹ig
, 
u32
 
size
) {

237 #i‚de‡
DEBUG_BUILD


239 i‡(
‹ig
) {

241 
	`CHECK_PTR
(
‹ig
);

243 i‡(
	`ALLOC_S
(
‹ig
Ë>
size
)  orig;

245 
size
 +
ALLOC_BLK_INC
;

251  
	`DFL_ck_ªÆloc
(
‹ig
, 
size
);

253 
	}
}

258 
ölöe
 
u8
* 
	$DFL_ck_°rdup
(
u8
* 
°r
) {

260 * 
ªt
;

261 
u32
 
size
;

263 i‡(!
°r
Ë 
NULL
;

265 
size
 = 
	`°æí
((*)
°r
) + 1;

267 
	`ALLOC_CHECK_SIZE
(
size
);

268 
ªt
 = 
	`mÆloc
(
size
 + 
ALLOC_OFF_TOTAL
);

269 
	`ALLOC_CHECK_RESULT
(
ªt
, 
size
);

271 
ªt
 +
ALLOC_OFF_HEAD
;

273 
	`ALLOC_C1
(
ªt
Ë
ALLOC_MAGIC_C1
;

274 
	`ALLOC_S
(
ªt
Ë
size
;

275 
	`ALLOC_C2
(
ªt
Ë
ALLOC_MAGIC_C2
;

277  
	`mem˝y
(
ªt
, 
°r
, 
size
);

279 
	}
}

285 
ölöe
 * 
	$DFL_ck_memdup
(* 
mem
, 
u32
 
size
) {

287 * 
ªt
;

289 i‡(!
mem
 || !
size
Ë 
NULL
;

291 
	`ALLOC_CHECK_SIZE
(
size
);

292 
ªt
 = 
	`mÆloc
(
size
 + 
ALLOC_OFF_TOTAL
);

293 
	`ALLOC_CHECK_RESULT
(
ªt
, 
size
);

295 
ªt
 +
ALLOC_OFF_HEAD
;

297 
	`ALLOC_C1
(
ªt
Ë
ALLOC_MAGIC_C1
;

298 
	`ALLOC_S
(
ªt
Ë
size
;

299 
	`ALLOC_C2
(
ªt
Ë
ALLOC_MAGIC_C2
;

301  
	`mem˝y
(
ªt
, 
mem
, 
size
);

303 
	}
}

309 
ölöe
 
u8
* 
	$DFL_ck_memdup_°r
(
u8
* 
mem
, 
u32
 
size
) {

311 
u8
* 
ªt
;

313 i‡(!
mem
 || !
size
Ë 
NULL
;

315 
	`ALLOC_CHECK_SIZE
(
size
);

316 
ªt
 = 
	`mÆloc
(
size
 + 
ALLOC_OFF_TOTAL
 + 1);

317 
	`ALLOC_CHECK_RESULT
(
ªt
, 
size
);

319 
ªt
 +
ALLOC_OFF_HEAD
;

321 
	`ALLOC_C1
(
ªt
Ë
ALLOC_MAGIC_C1
;

322 
	`ALLOC_S
(
ªt
Ë
size
;

323 
	`ALLOC_C2
(
ªt
Ë
ALLOC_MAGIC_C2
;

325 
	`mem˝y
(
ªt
, 
mem
, 
size
);

326 
ªt
[
size
] = 0;

328  
ªt
;

330 
	}
}

333 #i‚de‡
DEBUG_BUILD


338 
	#ck_Æloc
 
DFL_ck_Æloc


	)

339 
	#ck_Æloc_nozîo
 
DFL_ck_Æloc_nozîo


	)

340 
	#ck_ªÆloc
 
DFL_ck_ªÆloc


	)

341 
	#ck_ªÆloc_block
 
DFL_ck_ªÆloc_block


	)

342 
	#ck_°rdup
 
DFL_ck_°rdup


	)

343 
	#ck_memdup
 
DFL_ck_memdup


	)

344 
	#ck_memdup_°r
 
DFL_ck_memdup_°r


	)

345 
	#ck_‰ì
 
DFL_ck_‰ì


	)

347 
	#Æloc_ªp‹t
()

	)

356 
	#ALLOC_BUCKETS
 4096

	)

358 
	sTRK_obj
 {

359 *
	m±r
;

360 *
	mfûe
, *
	mfunc
;

361 
u32
 
	mlöe
;

364 #ifde‡
AFL_MAIN


366 
TRK_obj
* 
	gTRK
[
ALLOC_BUCKETS
];

367 
u32
 
	gTRK_˙t
[
ALLOC_BUCKETS
];

369 
	#Æloc_ªp‹t
(Ë
	`TRK_ªp‹t
()

	)

373 
TRK_obj
* 
TRK
[
ALLOC_BUCKETS
];

374 
u32
 
TRK_˙t
[
ALLOC_BUCKETS
];

376 
	#Æloc_ªp‹t
()

	)

382 
	#TRKH
(
_±r
Ë(((((
u32
)(_±r)Ë>> 16Ë^ ((u32)(_±r))Ë% 
ALLOC_BUCKETS
)

	)

387 
ölöe
 
	$TRK_Æloc_buf
(* 
±r
, c⁄° * 
fûe
, c⁄° * 
func
,

388 
u32
 
löe
) {

390 
u32
 
i
, 
buckë
;

392 i‡(!
±r
) ;

394 
buckë
 = 
	`TRKH
(
±r
);

398 
i
 = 0; i < 
TRK_˙t
[
buckë
]; i++)

400 i‡(!
TRK
[
buckë
][
i
].
±r
) {

402 
TRK
[
buckë
][
i
].
±r
 =Ötr;

403 
TRK
[
buckë
][
i
].
fûe
 = (*)file;

404 
TRK
[
buckë
][
i
].
func
 = (*)func;

405 
TRK
[
buckë
][
i
].
löe
 =Üine;

412 
TRK
[
buckë
] = 
	`DFL_ck_ªÆloc_block
(TRK[bucket],

413 (
TRK_˙t
[
buckë
] + 1Ë* (
TRK_obj
));

415 
TRK
[
buckë
][
i
].
±r
 =Ötr;

416 
TRK
[
buckë
][
i
].
fûe
 = (*)file;

417 
TRK
[
buckë
][
i
].
func
 = (*)func;

418 
TRK
[
buckë
][
i
].
löe
 =Üine;

420 
TRK_˙t
[
buckë
]++;

422 
	}
}

427 
ölöe
 
	$TRK_‰ì_buf
(* 
±r
, c⁄° * 
fûe
, c⁄° * 
func
,

428 
u32
 
löe
) {

430 
u32
 
i
, 
buckë
;

432 i‡(!
±r
) ;

434 
buckë
 = 
	`TRKH
(
±r
);

438 
i
 = 0; i < 
TRK_˙t
[
buckë
]; i++)

440 i‡(
TRK
[
buckë
][
i
].
±r
 ==Ötr) {

442 
TRK
[
buckë
][
i
].
±r
 = 0;

447 
	`WARNF
("ALLOC: AttemptÅo freeÇon-allocated memory in %s (%s:%u)",

448 
func
, 
fûe
, 
löe
);

450 
	}
}

455 
ölöe
 
	$TRK_ªp‹t
() {

457 
u32
 
i
, 
buckë
;

459 
	`fÊush
(0);

461 
buckë
 = 0; buckë < 
ALLOC_BUCKETS
; bucket++)

462 
i
 = 0; i < 
TRK_˙t
[
buckë
]; i++)

463 i‡(
TRK
[
buckë
][
i
].
±r
)

464 
	`WARNF
("ALLOC: MemoryÇever freed, created in %s (%s:%u)",

465 
TRK
[
buckë
][
i
].
func
, TRK[buckë][i].
fûe
, TRK[buckë][i].
löe
);

467 
	}
}

472 
ölöe
 * 
	$TRK_ck_Æloc
(
u32
 
size
, c⁄° * 
fûe
, c⁄° * 
func
,

473 
u32
 
löe
) {

475 * 
ªt
 = 
	`DFL_ck_Æloc
(
size
);

476 
	`TRK_Æloc_buf
(
ªt
, 
fûe
, 
func
, 
löe
);

477  
ªt
;

479 
	}
}

482 
ölöe
 * 
	$TRK_ck_ªÆloc
(* 
‹ig
, 
u32
 
size
, c⁄° * 
fûe
,

483 c⁄° * 
func
, 
u32
 
löe
) {

485 * 
ªt
 = 
	`DFL_ck_ªÆloc
(
‹ig
, 
size
);

486 
	`TRK_‰ì_buf
(
‹ig
, 
fûe
, 
func
, 
löe
);

487 
	`TRK_Æloc_buf
(
ªt
, 
fûe
, 
func
, 
löe
);

488  
ªt
;

490 
	}
}

493 
ölöe
 * 
	$TRK_ck_ªÆloc_block
(* 
‹ig
, 
u32
 
size
, c⁄° * 
fûe
,

494 c⁄° * 
func
, 
u32
 
löe
) {

496 * 
ªt
 = 
	`DFL_ck_ªÆloc_block
(
‹ig
, 
size
);

497 
	`TRK_‰ì_buf
(
‹ig
, 
fûe
, 
func
, 
löe
);

498 
	`TRK_Æloc_buf
(
ªt
, 
fûe
, 
func
, 
löe
);

499  
ªt
;

501 
	}
}

504 
ölöe
 * 
	$TRK_ck_°rdup
(
u8
* 
°r
, c⁄° * 
fûe
, c⁄° * 
func
,

505 
u32
 
löe
) {

507 * 
ªt
 = 
	`DFL_ck_°rdup
(
°r
);

508 
	`TRK_Æloc_buf
(
ªt
, 
fûe
, 
func
, 
löe
);

509  
ªt
;

511 
	}
}

514 
ölöe
 * 
	$TRK_ck_memdup
(* 
mem
, 
u32
 
size
, c⁄° * 
fûe
,

515 c⁄° * 
func
, 
u32
 
löe
) {

517 * 
ªt
 = 
	`DFL_ck_memdup
(
mem
, 
size
);

518 
	`TRK_Æloc_buf
(
ªt
, 
fûe
, 
func
, 
löe
);

519  
ªt
;

521 
	}
}

524 
ölöe
 * 
	$TRK_ck_memdup_°r
(* 
mem
, 
u32
 
size
, c⁄° * 
fûe
,

525 c⁄° * 
func
, 
u32
 
löe
) {

527 * 
ªt
 = 
	`DFL_ck_memdup_°r
(
mem
, 
size
);

528 
	`TRK_Æloc_buf
(
ªt
, 
fûe
, 
func
, 
löe
);

529  
ªt
;

531 
	}
}

534 
ölöe
 
	$TRK_ck_‰ì
(* 
±r
, c⁄° * 
fûe
,

535 c⁄° * 
func
, 
u32
 
löe
) {

537 
	`TRK_‰ì_buf
(
±r
, 
fûe
, 
func
, 
löe
);

538 
	`DFL_ck_‰ì
(
±r
);

540 
	}
}

544 
	#ck_Æloc
(
_p1
) \

545 
	`TRK_ck_Æloc
(
_p1
, 
__FILE__
, 
__FUNCTION__
, 
__LINE__
)

	)

547 
	#ck_Æloc_nozîo
(
_p1
) \

548 
	`TRK_ck_Æloc
(
_p1
, 
__FILE__
, 
__FUNCTION__
, 
__LINE__
)

	)

550 
	#ck_ªÆloc
(
_p1
, 
_p2
) \

551 
	`TRK_ck_ªÆloc
(
_p1
, 
_p2
, 
__FILE__
, 
__FUNCTION__
, 
__LINE__
)

	)

553 
	#ck_ªÆloc_block
(
_p1
, 
_p2
) \

554 
	`TRK_ck_ªÆloc_block
(
_p1
, 
_p2
, 
__FILE__
, 
__FUNCTION__
, 
__LINE__
)

	)

556 
	#ck_°rdup
(
_p1
) \

557 
	`TRK_ck_°rdup
(
_p1
, 
__FILE__
, 
__FUNCTION__
, 
__LINE__
)

	)

559 
	#ck_memdup
(
_p1
, 
_p2
) \

560 
	`TRK_ck_memdup
(
_p1
, 
_p2
, 
__FILE__
, 
__FUNCTION__
, 
__LINE__
)

	)

562 
	#ck_memdup_°r
(
_p1
, 
_p2
) \

563 
	`TRK_ck_memdup_°r
(
_p1
, 
_p2
, 
__FILE__
, 
__FUNCTION__
, 
__LINE__
)

	)

565 
	#ck_‰ì
(
_p1
) \

566 
	`TRK_ck_‰ì
(
_p1
, 
__FILE__
, 
__FUNCTION__
, 
__LINE__
)

	)

	@config.h

17 #i‚de‡
_HAVE_CONFIG_H


18 
	#_HAVE_CONFIG_H


	)

20 
	~"ty≥s.h
"

24 
	#VERSION
 "2.19b"

	)

35 
	#USE_COLOR


	)

39 
	#FANCY_BOXES


	)

43 
	#EXEC_TIMEOUT
 1000

	)

47 
	#EXEC_TM_ROUND
 20

	)

51 #i‚de‡
__x86_64__


52 
	#MEM_LIMIT
 25

	)

54 
	#MEM_LIMIT
 50

	)

59 
	#MEM_LIMIT_QEMU
 200

	)

64 
	#CAL_CYCLES
 10

	)

65 
	#CAL_CYCLES_LONG
 40

	)

69 
	#CAL_CYCLES_NO_VAR
 4

	)

73 
	#HANG_LIMIT
 250

	)

77 
	#KEEP_UNIQUE_HANG
 500

	)

78 
	#KEEP_UNIQUE_CRASH
 5000

	)

82 
	#HAVOC_CYCLES
 5000

	)

87 
	#HAVOC_MAX_MULT
 16

	)

91 
	#HAVOC_MIN
 10

	)

102 
	#HAVOC_STACK_POW2
 7

	)

108 
	#HAVOC_BLK_SMALL
 32

	)

109 
	#HAVOC_BLK_MEDIUM
 128

	)

110 
	#HAVOC_BLK_LARGE
 1500

	)

115 
	#SKIP_TO_NEW_PROB
 99

	)

116 
	#SKIP_NFAV_OLD_PROB
 95

	)

117 
	#SKIP_NFAV_NEW_PROB
 75

	)

121 
	#SPLICE_CYCLES
 20

	)

125 
	#SPLICE_HAVOC
 500

	)

129 
	#ARITH_MAX
 35

	)

134 
	#TRIM_MIN_BYTES
 4

	)

135 
	#TRIM_START_STEPS
 16

	)

136 
	#TRIM_END_STEPS
 1024

	)

140 
	#MAX_FILE
 (1 * 1024 * 1024)

	)

144 
	#TMIN_MAX_FILE
 (10 * 1024 * 1024)

	)

148 
	#TMIN_SET_MIN_SIZE
 4

	)

149 
	#TMIN_SET_STEPS
 128

	)

153 
	#MAX_DICT_FILE
 128

	)

157 
	#MIN_AUTO_EXTRA
 3

	)

158 
	#MAX_AUTO_EXTRA
 32

	)

164 
	#MAX_DET_EXTRAS
 200

	)

170 
	#USE_AUTO_EXTRAS
 50

	)

171 
	#MAX_AUTO_EXTRAS
 (
USE_AUTO_EXTRAS
 * 10)

	)

177 
	#EFF_MAP_SCALE2
 3

	)

181 
	#EFF_MIN_LEN
 128

	)

186 
	#EFF_MAX_PERC
 90

	)

190 
	#UI_TARGET_HZ
 5

	)

194 
	#STATS_UPDATE_SEC
 60

	)

195 
	#PLOT_UPDATE_SEC
 5

	)

199 
	#AVG_SMOOTHING
 16

	)

203 
	#SYNC_INTERVAL
 5

	)

207 
	#OUTPUT_GRACE
 25

	)

215 
	#INTERESTING_8
 \

224 127

	)

226 
	#INTERESTING_16
 \

236 32767

	)

238 
	#INTERESTING_32
 \

246 2147483647

	)

256 
	#RESEED_RNG
 10000

	)

261 
	#MAX_LINE
 8192

	)

265 
	#SHM_ENV_VAR
 "__AFL_SHM_ID"

	)

269 
	#CLANG_ENV_VAR
 "__AFL_CLANG_MODE"

	)

270 
	#AS_LOOP_ENV_VAR
 "__AFL_AS_LOOPCHECK"

	)

271 
	#PERSIST_ENV_VAR
 "__AFL_PERSISTENT"

	)

272 
	#DEFER_ENV_VAR
 "__AFL_DEFER_FORKSRV"

	)

276 
	#PERSIST_SIG
 "##SIG_AFL_PERSISTENT##"

	)

277 
	#DEFER_SIG
 "##SIG_AFL_DEFER_FORKSRV##"

	)

281 
	#EXEC_FAIL_SIG
 0x„e1dód

	)

285 
	#MSAN_ERROR
 86

	)

290 
	#FORKSRV_FD
 198

	)

295 
	#FORK_WAIT_MULT
 10

	)

301 
	#CAL_TMOUT_PERC
 125

	)

302 
	#CAL_TMOUT_ADD
 50

	)

306 
	#CAL_CHANCES
 3

	)

314 
	#MAP_SIZE_POW2
 16

	)

315 
	#MAP_SIZE
 (1 << 
MAP_SIZE_POW2
)

	)

319 
	#MAX_ALLOC
 0x40000000

	)

323 
	#HASH_CONST
 0xa5b35705

	)

327 
	#CTEST_TARGET_MS
 5000

	)

328 
	#CTEST_CORE_TRG_MS
 1000

	)

329 
	#CTEST_BUSY_CYCLES
 (10 * 1000 * 1000)

	)

	@debug.h

17 #i‚de‡
_HAVE_DEBUG_H


18 
	#_HAVE_DEBUG_H


	)

20 
	~<î∫o.h
>

22 
	~"ty≥s.h
"

23 
	~"c⁄fig.h
"

29 #ifde‡
USE_COLOR


31 
	#cBLK
 "\x1b[0;30m"

	)

32 
	#cRED
 "\x1b[0;31m"

	)

33 
	#cGRN
 "\x1b[0;32m"

	)

34 
	#cBRN
 "\x1b[0;33m"

	)

35 
	#cBLU
 "\x1b[0;34m"

	)

36 
	#cMGN
 "\x1b[0;35m"

	)

37 
	#cCYA
 "\x1b[0;36m"

	)

38 
	#cLGR
 "\x1b[0;37m"

	)

39 
	#cGRA
 "\x1b[1;90m"

	)

40 
	#cLRD
 "\x1b[1;91m"

	)

41 
	#cLGN
 "\x1b[1;92m"

	)

42 
	#cYEL
 "\x1b[1;93m"

	)

43 
	#cLBL
 "\x1b[1;94m"

	)

44 
	#cPIN
 "\x1b[1;95m"

	)

45 
	#cLCY
 "\x1b[1;96m"

	)

46 
	#cBRI
 "\x1b[1;97m"

	)

47 
	#cRST
 "\x1b[0m"

	)

49 
	#bgBLK
 "\x1b[40m"

	)

50 
	#bgRED
 "\x1b[41m"

	)

51 
	#bgGRN
 "\x1b[42m"

	)

52 
	#bgBRN
 "\x1b[43m"

	)

53 
	#bgBLU
 "\x1b[44m"

	)

54 
	#bgMGN
 "\x1b[45m"

	)

55 
	#bgCYA
 "\x1b[46m"

	)

56 
	#bgLGR
 "\x1b[47m"

	)

57 
	#bgGRA
 "\x1b[100m"

	)

58 
	#bgLRD
 "\x1b[101m"

	)

59 
	#bgLGN
 "\x1b[102m"

	)

60 
	#bgYEL
 "\x1b[103m"

	)

61 
	#bgLBL
 "\x1b[104m"

	)

62 
	#bgPIN
 "\x1b[105m"

	)

63 
	#bgLCY
 "\x1b[106m"

	)

64 
	#bgBRI
 "\x1b[107m"

	)

68 
	#cBLK
 ""

	)

69 
	#cRED
 ""

	)

70 
	#cGRN
 ""

	)

71 
	#cBRN
 ""

	)

72 
	#cBLU
 ""

	)

73 
	#cMGN
 ""

	)

74 
	#cCYA
 ""

	)

75 
	#cLGR
 ""

	)

76 
	#cGRA
 ""

	)

77 
	#cLRD
 ""

	)

78 
	#cLGN
 ""

	)

79 
	#cYEL
 ""

	)

80 
	#cLBL
 ""

	)

81 
	#cPIN
 ""

	)

82 
	#cLCY
 ""

	)

83 
	#cBRI
 ""

	)

84 
	#cRST
 ""

	)

86 
	#bgBLK
 ""

	)

87 
	#bgRED
 ""

	)

88 
	#bgGRN
 ""

	)

89 
	#bgBRN
 ""

	)

90 
	#bgBLU
 ""

	)

91 
	#bgMGN
 ""

	)

92 
	#bgCYA
 ""

	)

93 
	#bgLGR
 ""

	)

94 
	#bgGRA
 ""

	)

95 
	#bgLRD
 ""

	)

96 
	#bgLGN
 ""

	)

97 
	#bgYEL
 ""

	)

98 
	#bgLBL
 ""

	)

99 
	#bgPIN
 ""

	)

100 
	#bgLCY
 ""

	)

101 
	#bgBRI
 ""

	)

109 #ifde‡
FANCY_BOXES


111 
	#SET_G1
 "\x1b)0"

	)

112 
	#RESET_G1
 "\x1b)B"

	)

113 
	#bSTART
 "\x0e"

	)

114 
	#bSTOP
 "\x0f"

	)

115 
	#bH
 "q"

	)

116 
	#bV
 "x"

	)

117 
	#bLT
 "l"

	)

118 
	#bRT
 "k"

	)

119 
	#bLB
 "m"

	)

120 
	#bRB
 "j"

	)

121 
	#bX
 "n"

	)

122 
	#bVR
 "t"

	)

123 
	#bVL
 "u"

	)

124 
	#bHT
 "v"

	)

125 
	#bHB
 "w"

	)

129 
	#SET_G1
 ""

	)

130 
	#RESET_G1
 ""

	)

131 
	#bSTART
 ""

	)

132 
	#bSTOP
 ""

	)

133 
	#bH
 "-"

	)

134 
	#bV
 "|"

	)

135 
	#bLT
 "+"

	)

136 
	#bRT
 "+"

	)

137 
	#bLB
 "+"

	)

138 
	#bRB
 "+"

	)

139 
	#bX
 "+"

	)

140 
	#bVR
 "+"

	)

141 
	#bVL
 "+"

	)

142 
	#bHT
 "+"

	)

143 
	#bHB
 "+"

	)

151 
	#TERM_HOME
 "\x1b[H"

	)

152 
	#TERM_CLEAR
 
TERM_HOME
 "\x1b[2J"

	)

153 
	#cEOL
 "\x1b[0K"

	)

154 
	#CURSOR_HIDE
 "\x1b[?25l"

	)

155 
	#CURSOR_SHOW
 "\x1b[?25h"

	)

163 #ifde‡
MESSAGES_TO_STDOUT


164 
	#SAYF
(
x
...Ë
	`¥ötf
(x)

	)

166 
	#SAYF
(
x
...Ë
	`Ârötf
(
°dîr
, x)

	)

171 
	#WARNF
(
x
...) do { \

172 
	`SAYF
(
cYEL
 "[!] " 
cBRI
 "WARNING: " 
cRST
 
x
); \

173 
	`SAYF
(
cRST
 "\n"); \

174 } 0)

	)

178 
	#ACTF
(
x
...) do { \

179 
	`SAYF
(
cLBL
 "[*] " 
cRST
 
x
); \

180 
	`SAYF
(
cRST
 "\n"); \

181 } 0)

	)

185 
	#OKF
(
x
...) do { \

186 
	`SAYF
(
cLGN
 "[+] " 
cRST
 
x
); \

187 
	`SAYF
(
cRST
 "\n"); \

188 } 0)

	)

192 
	#BADF
(
x
...) do { \

193 
	`SAYF
(
cLRD
 "\n[-] " 
cRST
 
x
); \

194 
	`SAYF
(
cRST
 "\n"); \

195 } 0)

	)

199 
	#FATAL
(
x
...) do { \

200 
	`SAYF
(
bSTOP
 
RESET_G1
 
CURSOR_SHOW
 
cRST
 
cLRD
 "\n[-] PROGRAM ABORT : " \

201 
cBRI
 
x
); \

202 
	`SAYF
(
cLRD
 "\¿ Loˇti⁄ : " 
cRST
 "%s(), %s:%u\n\n", \

203 
__FUNCTION__
, 
__FILE__
, 
__LINE__
); \

204 
	`exô
(1); \

205 } 0)

	)

209 
	#ABORT
(
x
...) do { \

210 
	`SAYF
(
bSTOP
 
RESET_G1
 
CURSOR_SHOW
 
cRST
 
cLRD
 "\n[-] PROGRAM ABORT : " \

211 
cBRI
 
x
); \

212 
	`SAYF
(
cLRD
 "\¿ St›Üoˇti⁄ : " 
cRST
 "%s(), %s:%u\n\n", \

213 
__FUNCTION__
, 
__FILE__
, 
__LINE__
); \

214 
	`ab‹t
(); \

215 } 0)

	)

219 
	#PFATAL
(
x
...) do { \

220 
	`fÊush
(
°dout
); \

221 
	`SAYF
(
bSTOP
 
RESET_G1
 
CURSOR_SHOW
 
cRST
 
cLRD
 "\n[-] SYSTEM ERROR : " \

222 
cBRI
 
x
); \

223 
	`SAYF
(
cLRD
 "\¿ St›Üoˇti⁄ : " 
cRST
 "%s(), %s:%u\n", \

224 
__FUNCTION__
, 
__FILE__
, 
__LINE__
); \

225 
	`SAYF
(
cLRD
 " OS mesßgê: " 
cRST
 "%s\n", 
	`°ªº‹
(
î∫o
)); \

226 
	`exô
(1); \

227 } 0)

	)

232 
	#RPFATAL
(
ªs
, 
x
...) do { \

233 i‡(
ªs
 < 0Ë
	`PFATAL
(
x
); 
	`FATAL
(x); \

234 } 0)

	)

239 
	#ck_wrôe
(
fd
, 
buf
, 
Àn
, 
‚
) do { \

240 
u32
 
_Àn
 = (
Àn
); \

241 
s32
 
_ªs
 = 
	`wrôe
(
fd
, 
buf
, 
_Àn
); \

242 i‡(
_ªs
 !
_Àn
Ë
	`RPFATAL
(_ªs, "Sh‹àwrôêtÿ%s", 
‚
); \

243 } 0)

	)

245 
	#ck_ªad
(
fd
, 
buf
, 
Àn
, 
‚
) do { \

246 
u32
 
_Àn
 = (
Àn
); \

247 
s32
 
_ªs
 = 
	`ªad
(
fd
, 
buf
, 
_Àn
); \

248 i‡(
_ªs
 !
_Àn
Ë
	`RPFATAL
(_ªs, "Sh‹àªad from %s", 
‚
); \

249 } 0)

	)

	@experimental/argv_fuzzing/argv-fuzz-inl.h

34 #i‚de‡
_HAVE_ARGV_FUZZ_INL


35 
	#_HAVE_ARGV_FUZZ_INL


	)

37 
	~<uni°d.h
>

39 
	#AFL_INIT_ARGV
(Ëdÿ{ 
¨gv
 = 
	`aÊ_öô_¨gv
(&
¨gc
); } 0)

	)

41 
	#AFL_INIT_SET0
(
_p
) do { \

42 
¨gv
 = 
	`aÊ_öô_¨gv
(&
¨gc
); \

43 
¨gv
[0] = (
_p
); \

44 i‡(!
¨gc
)árgc = 1; \

45 } 0)

	)

47 
	#MAX_CMDLINE_LEN
 100000

	)

48 
	#MAX_CMDLINE_PAR
 1000

	)

50 ** 
	$aÊ_öô_¨gv
(* 
¨gc
) {

52 
ö_buf
[
MAX_CMDLINE_LEN
];

53 * 
ªt
[
MAX_CMDLINE_PAR
];

55 * 
±r
 = 
ö_buf
;

56 
rc
 = 0;

58 i‡(
	`ªad
(0, 
ö_buf
, 
MAX_CMDLINE_LEN
 - 2) < 0);

60 *
±r
) {

62 
ªt
[
rc
] = 
±r
;

63 i‡(
ªt
[
rc
][0] == 0x02 && !ret[rc][1])Ñet[rc]++;

64 
rc
++;

66 *
±r
)Ötr++;

67 
±r
++;

71 *
¨gc
 = 
rc
;

73  
ªt
;

75 
	}
}

77 #unde‡
MAX_CMDLINE_LEN


78 #unde‡
MAX_CMDLINE_PAR


	@experimental/instrumented_cmp/instrumented_cmp.c

36 
	~<°dio.h
>

37 
	~<°dlib.h
>

38 
	~<uni°d.h
>

42 
ölöe
 
	$my_memcmp
(* 
±r1
, * 
±r2
, 
Àn
)

43 
	`__©åibuã__
((
Æways_ölöe
));

45 
ölöe
 
	$my_memcmp
(* 
±r1
, * 
±r2
, 
Àn
) {

47 
Àn
--Ëi‡(*(
±r1
++Ë^ *(
±r2
++))  1;

50 
	}
}

52 
	#memcmp
 
my_memcmp


	)

56 
	gtmp
[16];

58 
	$maö
(
¨gc
, ** 
¨gv
) {

60 
Àn
 = 
	`ªad
(0, 
tmp
, (tmp));

62 i‡(
Àn
 !(
tmp
)) {

64 
	`¥ötf
("Truncated file!\n");

65 
	`exô
(1);

69 i‡(!
	`memcmp
(
tmp
 + 5, "sesame", 6)) {

73 * 
x
 = (*)0x12345678;

74 *
x
 = 1;

76 } 
	`¥ötf
("BadÖassword.\n");

80 
	}
}

	@experimental/persistent_demo/persistent_demo.c

25 
	~<°dio.h
>

26 
	~<°dlib.h
>

27 
	~<uni°d.h
>

28 
	~<sig«l.h
>

29 
	~<°rög.h
>

34 
	$maö
(
¨gc
, ** 
¨gv
) {

36 
buf
[100];

44 
	`__AFL_LOOP
(1000)) {

51 
	`mem£t
(
buf
, 0, 100);

60 
	`ªad
(0, 
buf
, 100);

65 i‡(
buf
[0] == 'f') {

66 
	`¥ötf
("one\n");

67 i‡(
buf
[1] == 'o') {

68 
	`¥ötf
("two\n");

69 i‡(
buf
[2] == 'o') {

70 
	`¥ötf
("three\n");

71 i‡(
buf
[3] == '!') {

72 
	`¥ötf
("four\n");

73 
	`ab‹t
();

89 
	}
}

	@experimental/post_library/post_library.so.c

69 
	~<°dio.h
>

70 
	~<°dlib.h
>

71 
	~<°rög.h
>

75 
	#HEADER
 "GIF89a"

	)

79 c⁄° * 
	$aÊ_po°¥o˚ss
(c⁄° * 
ö_buf
,

80 * 
Àn
) {

82 * 
ßved_buf
;

83 * 
√w_buf
;

88 i‡(*
Àn
 < 
	`°æí
(
HEADER
)Ë 
NULL
;

92 i‡(!
	`memcmp
(
ö_buf
, 
HEADER
, 
	`°æí
(HEADER)))  in_buf;

97 
√w_buf
 = 
	`ªÆloc
(
ßved_buf
, *
Àn
);

103 i‡(!
√w_buf
Ë 
ö_buf
;

104 
ßved_buf
 = 
√w_buf
;

108 
	`mem˝y
(
√w_buf
, 
ö_buf
, *
Àn
);

112 
	`mem˝y
(
√w_buf
, 
HEADER
, 
	`°æí
(HEADER));

117  
√w_buf
;

119 
	}
}

	@experimental/post_library/post_library_png.so.c

26 
	~<°dio.h
>

27 
	~<°dlib.h
>

28 
	~<°döt.h
>

29 
	~<°rög.h
>

30 
	~<zlib.h
>

32 
	~<¨∑/öë.h
>

36 
	#UP4K
(
_i
Ë((((_iË>> 12Ë+ 1Ë<< 12)

	)

38 c⁄° * 
	$aÊ_po°¥o˚ss
(c⁄° * 
ö_buf
,

39 * 
Àn
) {

41 * 
ßved_buf
;

42 
ßved_Àn
;

44 * 
√w_buf
 = (*)
ö_buf
;

45 
pos
 = 8;

50 i‡(*
Àn
 < 8Ë 
ö_buf
;

55 
pos
 + 12 <*
Àn
) {

57 
chunk_Àn
, 
ªÆ_cksum
, 
fûe_cksum
;

61 
chunk_Àn
 = 
	`¡ohl
(*(
uöt32_t
*)(
ö_buf
 + 
pos
));

65 i‡(
chunk_Àn
 > 1024 * 1024 || 
pos
 + 12 + chunk_À¿> *
Àn
) ;

70 
ªÆ_cksum
 = 
	`ht⁄l
(
	`¸c32
(0, 
ö_buf
 + 
pos
 + 4, 
chunk_Àn
 + 4));

74 
fûe_cksum
 = *(
uöt32_t
*)(
ö_buf
 + 
pos
 + 8 + 
chunk_Àn
);

78 i‡(
ªÆ_cksum
 !
fûe_cksum
) {

83 i‡(
√w_buf
 =
ö_buf
) {

85 i‡(*
Àn
 <
ßved_Àn
) {

87 
√w_buf
 = 
ßved_buf
;

91 
√w_buf
 = 
	`ªÆloc
(
ßved_buf
, 
	`UP4K
(*
Àn
));

92 i‡(!
√w_buf
Ë 
ö_buf
;

93 
ßved_buf
 = 
√w_buf
;

94 
ßved_Àn
 = 
	`UP4K
(*
Àn
);

95 
	`mem˝y
(
√w_buf
, 
ö_buf
, *
Àn
);

101 *(
uöt32_t
*)(
√w_buf
 + 
pos
 + 8 + 
chunk_Àn
Ë
ªÆ_cksum
;

107 
pos
 +12 + 
chunk_Àn
;

111  
√w_buf
;

113 
	}
}

	@hash.h

27 #i‚de‡
_HAVE_HASH_H


28 
	#_HAVE_HASH_H


	)

30 
	~"ty≥s.h
"

32 #ifde‡
__x86_64__


34 
	#ROL64
(
_x
, 
_r
Ë((((
u64
)(_x)Ë<< (_r)Ë| (((u64)(_x)Ë>> (64 - (_r))))

	)

36 
ölöe
 
u32
 
	$hash32
(c⁄° * 
key
, 
u32
 
Àn
, u32 
£ed
) {

38 c⁄° 
u64
* 
d©a
 = (u64*)
key
;

39 
u64
 
h1
 = 
£ed
 ^ 
Àn
;

41 
Àn
 >>= 3;

43 
Àn
--) {

45 
u64
 
k1
 = *
d©a
++;

47 
k1
 *= 0x87c37b91114253d5ULL;

48 
k1
 = 
	`ROL64
(k1, 31);

49 
k1
 *= 0x4cf5ad432745937fULL;

51 
h1
 ^
k1
;

52 
h1
 = 
	`ROL64
(h1, 27);

53 
h1
 = h1 * 5 + 0x52dce729;

57 
h1
 ^= h1 >> 33;

58 
h1
 *= 0xff51afd7ed558ccdULL;

59 
h1
 ^= h1 >> 33;

60 
h1
 *= 0xc4ceb9fe1a85ec53ULL;

61 
h1
 ^= h1 >> 33;

63  
h1
;

65 
	}
}

69 
	#ROL32
(
_x
, 
_r
Ë((((
u32
)(_x)Ë<< (_r)Ë| (((u32)(_x)Ë>> (32 - (_r))))

	)

71 
ölöe
 
u32
 
	$hash32
(c⁄° * 
key
, 
u32
 
Àn
, u32 
£ed
) {

73 c⁄° 
u32
* 
d©a
 = (u32*)
key
;

74 
u32
 
h1
 = 
£ed
 ^ 
Àn
;

76 
Àn
 >>= 2;

78 
Àn
--) {

80 
u32
 
k1
 = *
d©a
++;

82 
k1
 *= 0xcc9e2d51;

83 
k1
 = 
	`ROL32
(k1, 15);

84 
k1
 *= 0x1b873593;

86 
h1
 ^
k1
;

87 
h1
 = 
	`ROL32
(h1, 13);

88 
h1
 = h1 * 5 + 0xe6546b64;

92 
h1
 ^= h1 >> 16;

93 
h1
 *= 0x85ebca6b;

94 
h1
 ^= h1 >> 13;

95 
h1
 *= 0xc2b2ae35;

96 
h1
 ^= h1 >> 16;

98  
h1
;

100 
	}
}

	@llvm_mode/afl-clang-fast.c

24 
	#AFL_MAIN


	)

26 
	~"../c⁄fig.h
"

27 
	~"../ty≥s.h
"

28 
	~"../debug.h
"

29 
	~"../Æloc-öl.h
"

31 
	~<°dio.h
>

32 
	~<uni°d.h
>

33 
	~<°dlib.h
>

34 
	~<°rög.h
>

36 
u8
* 
	gobj_∑th
;

37 
u8
** 
	gcc_∑øms
;

38 
u32
 
	gcc_∑r_˙t
 = 1;

43 
	$föd_obj
(
u8
* 
¨gv0
) {

45 
u8
 *
aÊ_∑th
 = 
	`gëív
("AFL_PATH");

46 
u8
 *
¶ash
, *
tmp
;

48 i‡(
aÊ_∑th
) {

50 
tmp
 = 
	`Æloc_¥ötf
("%s/aÊ-Œvm-π.o", 
aÊ_∑th
);

52 i‡(!
	`ac˚ss
(
tmp
, 
R_OK
)) {

53 
obj_∑th
 = 
aÊ_∑th
;

54 
	`ck_‰ì
(
tmp
);

58 
	`ck_‰ì
(
tmp
);

62 
¶ash
 = 
	`°ºchr
(
¨gv0
, '/');

64 i‡(
¶ash
) {

66 
u8
 *
dú
;

68 *
¶ash
 = 0;

69 
dú
 = 
	`ck_°rdup
(
¨gv0
);

70 *
¶ash
 = '/';

72 
tmp
 = 
	`Æloc_¥ötf
("%s/aÊ-Œvm-π.o", 
dú
);

74 i‡(!
	`ac˚ss
(
tmp
, 
R_OK
)) {

75 
obj_∑th
 = 
dú
;

76 
	`ck_‰ì
(
tmp
);

80 
	`ck_‰ì
(
tmp
);

81 
	`ck_‰ì
(
dú
);

85 i‡(!
	`ac˚ss
(
AFL_PATH
 "/aÊ-Œvm-π.o", 
R_OK
)) {

86 
obj_∑th
 = 
AFL_PATH
;

90 
	`FATAL
("UnableÅo find 'afl-llvm-rt.o' or 'afl-llvm-pass.so'. Please set AFL_PATH");

92 
	}
}

97 
	$edô_∑øms
(
u32
 
¨gc
, ** 
¨gv
) {

99 
u8
 
f‹tify_£t
 = 0, 
aßn_£t
 = 0, 
x_£t
 = 0, 
maybe_lökög
 = 1, 
bô_mode
 = 0;

100 
u8
 *
«me
;

102 
cc_∑øms
 = 
	`ck_Æloc
((
¨gc
 + 64Ë* (
u8
*));

104 
«me
 = 
	`°ºchr
(
¨gv
[0], '/');

105 i‡(!
«me
Ë«mê
¨gv
[0]; name++;

107 i‡(!
	`°rcmp
(
«me
, "afl-clang-fast++")) {

108 
u8
* 
Æt_cxx
 = 
	`gëív
("AFL_CXX");

109 
cc_∑øms
[0] = 
Æt_cxx
 ?á…_cxx : (
u8
*)"clang++";

111 
u8
* 
Æt_cc
 = 
	`gëív
("AFL_CC");

112 
cc_∑øms
[0] = 
Æt_cc
 ?á…_c¯: (
u8
*)"clang";

122 #ifde‡
USE_TRACE_PC


123 
cc_∑øms
[
cc_∑r_˙t
++] = "-fsanitize-coverage=bb,trace-pc";

125 
cc_∑øms
[
cc_∑r_˙t
++] = "-Xclang";

126 
cc_∑øms
[
cc_∑r_˙t
++] = "-load";

127 
cc_∑øms
[
cc_∑r_˙t
++] = "-Xclang";

128 
cc_∑øms
[
cc_∑r_˙t
++] = 
	`Æloc_¥ötf
("%s/aÊ-Œvm-∑ss.so", 
obj_∑th
);

131 
cc_∑øms
[
cc_∑r_˙t
++] = "-Qunused-arguments";

133 --
¨gc
) {

134 
u8
* 
cur
 = *(++
¨gv
);

136 i‡(!
	`°rcmp
(
cur
, "-m32")Ë
bô_mode
 = 32;

137 i‡(!
	`°rcmp
(
cur
, "-m64")Ë
bô_mode
 = 64;

139 i‡(!
	`°rcmp
(
cur
, "-x")Ë
x_£t
 = 1;

141 i‡(!
	`°rcmp
(
cur
, "-c") || !strcmp(cur, "-S") || !strcmp(cur, "-E") ||

142 !
	`°rcmp
(
cur
, "-v")Ë
maybe_lökög
 = 0;

144 i‡(!
	`°rcmp
(
cur
, "-fsanitize=address") ||

145 !
	`°rcmp
(
cur
, "-fßnôize=mem‹y")Ë
aßn_£t
 = 1;

147 i‡(
	`°r°r
(
cur
, "FORTIFY_SOURCE")Ë
f‹tify_£t
 = 1;

149 i‡(!
	`°rcmp
(
cur
, "-sh¨ed")Ë
maybe_lökög
 = 0;

151 
cc_∑øms
[
cc_∑r_˙t
++] = 
cur
;

155 i‡(
	`gëív
("AFL_HARDEN")) {

157 
cc_∑øms
[
cc_∑r_˙t
++] = "-fstack-protector-all";

159 i‡(!
f‹tify_£t
)

160 
cc_∑øms
[
cc_∑r_˙t
++] = "-D_FORTIFY_SOURCE=2";

164 i‡(!
aßn_£t
) {

166 i‡(
	`gëív
("AFL_USE_ASAN")) {

168 
cc_∑øms
[
cc_∑r_˙t
++] = "-fsanitize=address";

170 i‡(
	`gëív
("AFL_USE_MSAN"))

171 
	`FATAL
("ASANánd MSANáre mutuallyÉxclusive");

173 } i‡(
	`gëív
("AFL_USE_MSAN")) {

175 
cc_∑øms
[
cc_∑r_˙t
++] = "-fsanitize=memory";

177 i‡(
	`gëív
("AFL_USE_ASAN"))

178 
	`FATAL
("ASANánd MSANáre mutuallyÉxclusive");

184 #ifde‡
USE_TRACE_PC


186 i‡(
	`gëív
("AFL_INST_RATIO"))

187 
	`FATAL
("AFL_INST_RATIOÇotávailableát compileÅime with 'trace-pc'.");

191 i‡(!
	`gëív
("AFL_DONT_OPTIMIZE")) {

193 
cc_∑øms
[
cc_∑r_˙t
++] = "-g";

194 
cc_∑øms
[
cc_∑r_˙t
++] = "-O3";

195 
cc_∑øms
[
cc_∑r_˙t
++] = "-funroll-loops";

199 
cc_∑øms
[
cc_∑r_˙t
++] = "-D__AFL_HAVE_MANUAL_CONTROL=1";

200 
cc_∑øms
[
cc_∑r_˙t
++] = "-D__AFL_COMPILER=1";

201 
cc_∑øms
[
cc_∑r_˙t
++] = "-DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=1";

223 
cc_∑øms
[
cc_∑r_˙t
++] = "-D__AFL_LOOP(_A)="

225 " _B = (ch¨*)\"" 
PERSIST_SIG
 "\"; "

226 #ifde‡
__APPLE__


235 
cc_∑øms
[
cc_∑r_˙t
++] = "-D__AFL_INIT()="

237 " _A = (ch¨*)\"" 
DEFER_SIG
 "\"; "

238 #ifde‡
__APPLE__


247 i‡(
maybe_lökög
) {

249 i‡(
x_£t
) {

250 
cc_∑øms
[
cc_∑r_˙t
++] = "-x";

251 
cc_∑øms
[
cc_∑r_˙t
++] = "none";

254 
bô_mode
) {

257 
cc_∑øms
[
cc_∑r_˙t
++] = 
	`Æloc_¥ötf
("%s/aÊ-Œvm-π.o", 
obj_∑th
);

261 
cc_∑øms
[
cc_∑r_˙t
++] = 
	`Æloc_¥ötf
("%s/aÊ-Œvm-π-32.o", 
obj_∑th
);

263 i‡(
	`ac˚ss
(
cc_∑øms
[
cc_∑r_˙t
 - 1], 
R_OK
))

264 
	`FATAL
("-m32 isÇot supported by your compiler");

269 
cc_∑øms
[
cc_∑r_˙t
++] = 
	`Æloc_¥ötf
("%s/aÊ-Œvm-π-64.o", 
obj_∑th
);

271 i‡(
	`ac˚ss
(
cc_∑øms
[
cc_∑r_˙t
 - 1], 
R_OK
))

272 
	`FATAL
("-m64 isÇot supported by your compiler");

280 
cc_∑øms
[
cc_∑r_˙t
] = 
NULL
;

282 
	}
}

287 
	$maö
(
¨gc
, ** 
¨gv
) {

289 i‡(
	`ißây
(2Ë&& !
	`gëív
("AFL_QUIET")) {

291 
	`SAYF
(
cCYA
 "aÊ-˛™g-Á° " 
cBRI
 
VERSION
 
cRST
 " by <lszekeres@google.com>\n");

295 i‡(
¨gc
 < 2) {

297 
	`SAYF
("\n"

310 
BIN_PATH
, BIN_PATH);

312 
	`exô
(1);

317 
	`föd_obj
(
¨gv
[0]);

319 
	`edô_∑øms
(
¨gc
, 
¨gv
);

321 
	`execvp
(
cc_∑øms
[0], (**)cc_params);

323 
	`FATAL
("O›s, faûedÅÿexecuã '%s' - check you∏PATH", 
cc_∑øms
[0]);

327 
	}
}

	@llvm_mode/afl-llvm-pass.so.cc

25 
	~"../c⁄fig.h
"

26 
	~"../debug.h
"

28 
	~<°dio.h
>

29 
	~<°dlib.h
>

30 
	~<uni°d.h
>

32 
	~"Œvm/ADT/Sèti°ic.h
"

33 
	~"Œvm/IR/IRBuûdî.h
"

34 
	~"Œvm/IR/LegacyPassM™agî.h
"

35 
	~"Œvm/IR/ModuÀ.h
"

36 
	~"Œvm/Suµ‹t/Debug.h
"

37 
	~"Œvm/Tønsf‹ms/IPO/PassM™agîBuûdî.h
"

38 
	~"Œvm/DebugInfo.h
"

40 
usög
 
«me•a˚
 
	gŒvm
;

42 
	#AFL_TMP_FILE
 "/tmp/aÊ_tmp_fûe"

	)

44 
	g«me•a˚
 {

46 ˛as†
	cAFLCovîage
 : 
public
 
ModuÀPass
 {

48 
public
:

50 
ID
;

51 
AFLCovîage
(Ë: 
ModuÀPass
(
ID
) { }

53 
boﬁ
 
runOnModuÀ
(
ModuÀ
 &
M
Ë
ovîride
;

55 c⁄° *
gëPassName
(Ëc⁄° 
	govîride
 {

58 
boﬁ
 
gëIn°ru˘i⁄DebugInfo
(c⁄° 
Œvm
::
In°ru˘i⁄
 *
I
,

59 
°d
::
°rög
 &
Fûe
,

60 &
Löe
);

66 
	$ªadIndex
(* 
fd_fûe_«me
)

69 
FILE
 *
fd
;

70 
ödex
;

72 
fd
 = 
	`f›í
–
fd_fûe_«me
, "r" );

73 i‡–
fd
 =
NULL
 ) {

74 
	`Ârötf
 ( 
°dîr
, "couldn't open file '%s'; %s\n",

75 
fd_fûe_«me
, 
	`°ªº‹
(
î∫o
) );

79 if–
	`fsˇnf
(
fd
, "%d", &
ödex
) != 1 )

82 if–
	`f˛o£
(
fd
Ë=
EOF
 ) {

83 
	`Ârötf
 ( 
°dîr
, "couldn't close file '%s'; %s\n",

84 
fd_fûe_«me
, 
	`°ªº‹
(
î∫o
) );

85 
	`exô
 (
EXIT_FAILURE
);

88  
ödex
;

89 
	}
}

91 
	$wrôeIndex
(* 
fd_fûe_«me
, 
vÆue
)

94 
FILE
 *
fd
;

96 
fd
 = 
	`f›í
–
fd_fûe_«me
, "w" );

97 i‡–
fd
 =
NULL
 ) {

98 
	`Ârötf
 ( 
°dîr
, "couldn't open file '%s'; %s\n",

99 
fd_fûe_«me
, 
	`°ªº‹
(
î∫o
) );

103 if–
	`Ârötf
–
fd
, "%d", 
vÆue
) != 1 )

106 if–
	`f˛o£
(
fd
Ë=
EOF
 ) {

107 
	`Ârötf
 ( 
°dîr
, "couldn't close file '%s'; %s\n",

108 
fd_fûe_«me
, 
	`°ªº‹
(
î∫o
) );

109 
	`exô
 (
EXIT_FAILURE
);

114 
	}
}

116 * 
	$Æloc_¥ötf
(c⁄° * 
_°r
, ...) {

117 * 
_tmp
;

118 
va_li°
 
≠
;

119 
	`va_°¨t
(
≠
, 
_°r
);

120 
_Àn
 = 
	`¢¥ötf
(
NULL
, 0, 
_°r
);

121 i‡(
_Àn
 < 0Ë
	`FATAL
("Whoa, snprintf() fails?!");

122 
_tmp
 = (*)
	`mÆloc
(
_Àn
 + 1);

123 
	`¢¥ötf
((*)
_tmp
, 
_Àn
 + 1, 
_°r
);

124 
	`va_íd
(
≠
);

125  
_tmp
;

126 
	}
}

128 
	g°d
::
°rög
 
	$gëDSPIP©h
(
DILoˇti⁄
 
Loc
) {

129 
°d
::
°rög
 
dú
 = 
Loc
.
	`gëDúe˘‹y
();

130 
°d
::
°rög
 
fûe
 = 
Loc
.
	`gëFûíame
();

131 i‡(
dú
.
	`em±y
(Ë|| 
fûe
[0] == '/') {

132  
fûe
;

133 } i‡(*
dú
.
	`rbegö
() == '/') {

134  
dú
 + 
fûe
;

136  
dú
 + "/" + 
fûe
;

138 
	}
}

140 
boﬁ
 
	gAFLCovîage
::
gëIn°ru˘i⁄DebugInfo
(c⁄° 
Œvm
::
In°ru˘i⁄
 *
I
,

141 
°d
::
°rög
 &
Fûe
,

142 &
Löe
) {

143 i‡(
MDNode
 *
	gN
 = 
I
->
gëMëad©a
("dbg")) {

144 
DILoˇti⁄
 
Loc
(
N
);

145 
	gFûe
 = 
gëDSPIP©h
(
Loc
);

146 
	gLöe
 = 
Loc
.
gëLöeNumbî
();

147  
	gåue
;

150  
	gÁl£
;

155 
	gAFLCovîage
::
ID
 = 0;

158 
boﬁ
 
	gAFLCovîage
::
	$runOnModuÀ
(
ModuÀ
 &
M
) {

160 
LLVMC⁄ãxt
 &
C
 = 
M
.
	`gëC⁄ãxt
();

162 
I¡egîTy≥
 *
I¡8Ty
 = I¡egîTy≥::
	`gëI¡8Ty
(
C
);

163 
I¡egîTy≥
 *
I¡32Ty
 = I¡egîTy≥::
	`gëI¡32Ty
(
C
);

167 
be_quõt
 = 0;

169 i‡(
	`ißây
(2Ë&& !
	`gëív
("AFL_QUIET")) {

171 
	`SAYF
(
cCYA
 "aÊ-Œvm-∑s†" 
cBRI
 
VERSION
 
cRST
 " by <lszekeres@google.com>\n");

173 } 
be_quõt
 = 1;

177 * 
ö°_øtio_°r
 = 
	`gëív
("AFL_INST_RATIO");

178 
ö°_øtio
 = 100;

180 i‡(
ö°_øtio_°r
) {

182 i‡(
	`ssˇnf
(
ö°_øtio_°r
, "%u", &
ö°_øtio
) != 1 || !inst_ratio ||

183 
ö°_øtio
 > 100)

184 
	`FATAL
("Bad value of AFL_INST_RATIO (must be between 1ánd 100)");

188 
ö°_blocks
 = 0;

189 
ö°_blocks
 = 
	`ªadIndex
(
AFL_TMP_FILE
);

190 if–
ö°_blocks
 == -1 ) {

191 
	`¥ötf
("error whenÑeadIndex\n");

192 
	`exô
(0);

194 
	`§™d
(
ö°_blocks
);

200 
GlobÆV¨übÀ
 *
AFLM≠På
 =

201 
√w
 
	`GlobÆV¨übÀ
(
M
, 
PoöãrTy≥
::
	`gë
(
I¡8Ty
, 0), 
Ál£
,

202 
GlobÆVÆue
::
Exã∫ÆLökage
, 0, "__afl_area_ptr");

204 
GlobÆV¨übÀ
 *
AFLPªvLoc
 = 
√w
 
	`GlobÆV¨übÀ
(

205 
M
, 
I¡32Ty
, 
Ál£
, 
GlobÆVÆue
::
Exã∫ÆLökage
, 0, "__afl_prev_loc",

206 0, 
GlobÆV¨übÀ
::
GíîÆDy«micTLSModñ
, 0, 
Ál£
);

211 autÿ&
F
 : 
M
)

212 autÿ&
BB
 : 
F
) {

214 
BasicBlock
::
ôî©‹
 
IP
 = 
BB
.
	`gëFú°In£πi⁄Pt
();

215 
IRBuûdî
<> 
	`IRB
(&(*
IP
));

217 i‡(
	`R
(100Ë>
ö°_øtio
) ;

221 
cur_loc
 = 
	`R
(
MAP_SIZE
);

222 
	`¥ötf
("bbID=%d, m≠ID=%d, func=%s\n", 
ö°_blocks
, 
cur_loc
,

223 
F
.
	`gëName
().
	`°r
().
	`c_°r
());

224 autÿ&
II
 : 
BB
) {

225 
°d
::
°rög
 
fûíame
;

226 
löe
;

227 
boﬁ
 
bRë
 = 
	`gëIn°ru˘i⁄DebugInfo
–&
II
, 
fûíame
, 
löe
);

228 if–
bRë
 ) {

229 
	`¥ötf
("%s:%d\n", 
fûíame
.
	`c_°r
(), 
löe
);

233 
C⁄°™tI¡
 *
CurLoc
 = C⁄°™tI¡::
	`gë
(
I¡32Ty
, 
cur_loc
);

237 
LﬂdIn°
 *
PªvLoc
 = 
IRB
.
	`Cª©eLﬂd
(
AFLPªvLoc
);

238 
PªvLoc
->
	`£tMëad©a
(
M
.
	`gëMDKödID
("noßnôize"), 
MDNode
::
	`gë
(
C
, 
N⁄e
));

239 
VÆue
 *
PªvLocCa°ed
 = 
IRB
.
	`Cª©eZExt
(
PªvLoc
, IRB.
	`gëI¡32Ty
());

243 
LﬂdIn°
 *
M≠På
 = 
IRB
.
	`Cª©eLﬂd
(
AFLM≠På
);

244 
M≠På
->
	`£tMëad©a
(
M
.
	`gëMDKödID
("noßnôize"), 
MDNode
::
	`gë
(
C
, 
N⁄e
));

245 
VÆue
 *
M≠PåIdx
 =

246 
IRB
.
	`Cª©eGEP
(
M≠På
, IRB.
	`Cª©eX‹
(
PªvLocCa°ed
, 
CurLoc
));

250 
LﬂdIn°
 *
Cou¡î
 = 
IRB
.
	`Cª©eLﬂd
(
M≠PåIdx
);

251 
Cou¡î
->
	`£tMëad©a
(
M
.
	`gëMDKödID
("noßnôize"), 
MDNode
::
	`gë
(
C
, 
N⁄e
));

252 
VÆue
 *
In¸
 = 
IRB
.
	`Cª©eAdd
(
Cou¡î
, 
C⁄°™tI¡
::
	`gë
(
I¡8Ty
, 1));

253 
IRB
.
	`Cª©eSt‹e
(
In¸
, 
M≠PåIdx
)

254 ->
	`£tMëad©a
(
M
.
	`gëMDKödID
("noßnôize"), 
MDNode
::
	`gë
(
C
, 
N⁄e
));

258 
St‹eIn°
 *
St‹e
 =

259 
IRB
.
	`Cª©eSt‹e
(
C⁄°™tI¡
::
	`gë
(
I¡32Ty
, 
cur_loc
 >> 1), 
AFLPªvLoc
);

260 
St‹e
->
	`£tMëad©a
(
M
.
	`gëMDKödID
("noßnôize"), 
MDNode
::
	`gë
(
C
, 
N⁄e
));

262 
ö°_blocks
++;

266 
	`wrôeIndex
(
AFL_TMP_FILE
, 
ö°_blocks
);

269 i‡(!
be_quõt
) {

271 i‡(!
ö°_blocks
Ë
	`WARNF
("No instrumentationÅargets found.");

272 
	`OKF
("Instrumented %uÜocations (%s mode,Ñatio %u%%).",

273 
ö°_blocks
,

274 
	`gëív
("AFL_HARDEN") ? "hardened" : "non-hardened",

275 
ö°_øtio
);

279  
åue
;

281 
	}
}

284 
ªgi°îAFLPass
(c⁄° 
PassM™agîBuûdî
 &,

285 
Àgacy
::
PassM™agîBa£
 &
PM
) {

287 
PM
.
add
(
√w
 
AFLCovîage
());

292 
Regi°îSènd¨dPas£s
 
Regi°îAFLPass
(

293 
PassM™agîBuûdî
::
EP_O±imizîLa°
, 
ªgi°îAFLPass
);

295 
Regi°îSènd¨dPas£s
 
Regi°îAFLPass0
(

296 
PassM™agîBuûdî
::
EP_E«bÀdOnO±Levñ0
, 
ªgi°îAFLPass
);

	@llvm_mode/afl-llvm-rt.o.c

22 
	~"../c⁄fig.h
"

23 
	~"../ty≥s.h
"

25 
	~<°dio.h
>

26 
	~<°dlib.h
>

27 
	~<sig«l.h
>

28 
	~<uni°d.h
>

29 
	~<as£π.h
>

31 
	~<sys/mm™.h
>

32 
	~<sys/shm.h
>

33 
	~<sys/waô.h
>

34 
	~<sys/ty≥s.h
>

41 
u8
 
	g__aÊ_¨ó_öôül
[
MAP_SIZE
];

42 
u8
* 
	g__aÊ_¨ó_±r
 = 
__aÊ_¨ó_öôül
;

44 
__thªad
 
u32
 
	g__aÊ_¥ev_loc
;

49 
u8
 
	gis_≥rsi°ít
;

54 
	$__aÊ_m≠_shm
() {

56 
u8
 *
id_°r
 = 
	`gëív
(
SHM_ENV_VAR
);

62 i‡(
id_°r
) {

64 
u32
 
shm_id
 = 
	`©oi
(
id_°r
);

66 
__aÊ_¨ó_±r
 = 
	`shm©
(
shm_id
, 
NULL
, 0);

70 i‡(
__aÊ_¨ó_±r
 =(*)-1Ë
	`_exô
(1);

75 
__aÊ_¨ó_±r
[0] = 1;

79 
	}
}

84 
	$__aÊ_°¨t_f‹k£rvî
() {

86 
u8
 
tmp
[4];

87 
s32
 
chûd_pid
;

89 
u8
 
chûd_°›≥d
 = 0;

94 i‡(
	`wrôe
(
FORKSRV_FD
 + 1, 
tmp
, 4) != 4) ;

98 
u32
 
was_kûÀd
;

99 
°©us
;

103 i‡(
	`ªad
(
FORKSRV_FD
, &
was_kûÀd
, 4Ë!4Ë
	`_exô
(1);

109 i‡(
chûd_°›≥d
 && 
was_kûÀd
) {

110 
chûd_°›≥d
 = 0;

111 i‡(
	`waôpid
(
chûd_pid
, &
°©us
, 0Ë< 0Ë
	`_exô
(1);

114 i‡(!
chûd_°›≥d
) {

118 
chûd_pid
 = 
	`f‹k
();

119 i‡(
chûd_pid
 < 0Ë
	`_exô
(1);

123 i‡(!
chûd_pid
) {

125 
	`˛o£
(
FORKSRV_FD
);

126 
	`˛o£
(
FORKSRV_FD
 + 1);

136 
	`kûl
(
chûd_pid
, 
SIGCONT
);

137 
chûd_°›≥d
 = 0;

143 i‡(
	`wrôe
(
FORKSRV_FD
 + 1, &
chûd_pid
, 4Ë!4Ë
	`_exô
(1);

145 i‡(
	`waôpid
(
chûd_pid
, &
°©us
, 
is_≥rsi°ít
 ? 
WUNTRACED
 : 0) < 0)

146 
	`_exô
(1);

152 i‡(
	`WIFSTOPPED
(
°©us
)Ë
chûd_°›≥d
 = 1;

156 i‡(
	`wrôe
(
FORKSRV_FD
 + 1, &
°©us
, 4Ë!4Ë
	`_exô
(1);

160 
	}
}

165 
	$__aÊ_≥rsi°ít_lo›
(
max_˙t
) {

167 
u8
 
fú°_∑ss
 = 1;

168 
u32
 
cy˛e_˙t
;

170 i‡(
fú°_∑ss
) {

172 
cy˛e_˙t
 = 
max_˙t
;

173 
fú°_∑ss
 = 0;

178 i‡(
is_≥rsi°ít
 && --
cy˛e_˙t
) {

180 
	`øi£
(
SIGSTOP
);

185 
	}
}

191 
	$__aÊ_m™uÆ_öô
() {

193 
u8
 
öô_d⁄e
;

195 i‡(!
öô_d⁄e
) {

197 
	`__aÊ_m≠_shm
();

198 
	`__aÊ_°¨t_f‹k£rvî
();

199 
öô_d⁄e
 = 1;

203 
	}
}

206 
__aÊ_åa˚_pc_öô
();

211 
__©åibuã__
((
	$c⁄°ru˘‹
(0))Ë
	$__aÊ_auto_öô
() {

213 
is_≥rsi°ít
 = !!
	`gëív
(
PERSIST_ENV_VAR
);

215 
	`__aÊ_åa˚_pc_öô
();

217 i‡(
	`gëív
(
DEFER_ENV_VAR
)) ;

219 
	`__aÊ_m™uÆ_öô
();

221 
	}
}

238 
u32
 
	gö°_øtio_sˇÀd
 = 
MIN
(4096, 
MAP_SIZE
);

240 
	$__ßnôizî_cov_åa˚_pc
() {

242 
u32
 
cur
 = ((u32)
	`__buûtö_ªtu∫_addªss
(0)Ë& 
	`MIN
(4095, 
MAP_SIZE
 - 1);

244 i‡(
cur
 > 
ö°_øtio_sˇÀd
) ;

246 
__aÊ_¨ó_±r
[
cur
 ^ 
__aÊ_¥ev_loc
]++;

248 #i‡
MAP_SIZE_POW2
 > 12

249 
__aÊ_¥ev_loc
 = 
cur
 << (
MAP_SIZE_POW2
 - 12);

251 
__aÊ_¥ev_loc
 = 
cur
 >> 1;

254 
	}
}

261 
	$__aÊ_åa˚_pc_öô
() {

263 
u8
* 
x
 = 
	`gëív
("AFL_INST_RATIO");

265 i‡(!
x
) ;

267 
ö°_øtio_sˇÀd
 = 
	`©oi
(
x
);

269 i‡(!
ö°_øtio_sˇÀd
 || inst_ratio_scaled > 100) {

270 
	`Ârötf
(
°dîr
, "[-] ERROR: Invalid AFL_INST_RATIO (must be 1-100).\n");

271 
	`ab‹t
();

274 
ö°_øtio_sˇÀd
 = in°_øtio_sˇÀd * 
	`MIN
(4096, 
MAP_SIZE
) / 100;

276 
	}
}

281 
	$__ßnôizî_cov_moduÀ_öô
(Ë
	`__©åibuã__
((
wók
));

282 
	$__ßnôizî_cov_moduÀ_öô
(Ë{ 
	}
}

	@qemu_mode/patches/afl-qemu-cpu-inl.h

29 
	~<sys/shm.h
>

30 
	~"../../c⁄fig.h
"

41 
	#AFL_QEMU_CPU_SNIPPET1
 do { \

42 
	`aÊ_ªque°_t¶
(
pc
, 
cs_ba£
, 
Êags
); \

43 } 0)

	)

49 
	#AFL_QEMU_CPU_SNIPPET2
 do { \

50 if(
tb
->
pc
 =
aÊ_íåy_poöt
) { \

51 
	`aÊ_£tup
(); \

52 
	`aÊ_f‹k£rvî
(
ív
); \

54 
	`aÊ_maybe_log
(
tb
->
pc
); \

55 } 0)

	)

60 
	#TSL_FD
 (
FORKSRV_FD
 - 1)

	)

64 *
	gaÊ_¨ó_±r
;

68 
abi_ul⁄g
 
	gaÊ_íåy_poöt
,

69 
	gaÊ_°¨t_code
,

70 
	gaÊ_íd_code
;

74 
	gaÊ_f‹k_chûd
;

75 
	gaÊ_f‹k§v_pid
;

79 
	gaÊ_ö°_rms
 = 
MAP_SIZE
;

83 
aÊ_£tup
();

84 
aÊ_f‹k£rvî
(
CPUArchSèã
*);

85 
ölöe
 
aÊ_maybe_log
(
abi_ul⁄g
);

87 
aÊ_waô_t¶
(
CPUArchSèã
*, );

88 
aÊ_ªque°_t¶
(
èrgë_ul⁄g
,Å¨gë_ul⁄g, 
uöt64_t
);

90 
Tøn¶©i⁄Block
 *
tb_föd_¶ow
(
CPUArchSèã
*, 
èrgë_ul⁄g
,

91 
èrgë_ul⁄g
, 
uöt64_t
);

96 
	saÊ_t¶
 {

97 
èrgë_ul⁄g
 
	mpc
;

98 
èrgë_ul⁄g
 
	mcs_ba£
;

99 
uöt64_t
 
	mÊags
;

110 
	$aÊ_£tup
() {

112 *
id_°r
 = 
	`gëív
(
SHM_ENV_VAR
),

113 *
ö°_r
 = 
	`gëív
("AFL_INST_RATIO");

115 
shm_id
;

117 i‡(
ö°_r
) {

119 
r
;

121 
r
 = 
	`©oi
(
ö°_r
);

123 i‡(
r
 > 100)Ñ = 100;

124 i‡(!
r
)Ñ = 1;

126 
aÊ_ö°_rms
 = 
MAP_SIZE
 * 
r
 / 100;

130 i‡(
id_°r
) {

132 
shm_id
 = 
	`©oi
(
id_°r
);

133 
aÊ_¨ó_±r
 = 
	`shm©
(
shm_id
, 
NULL
, 0);

135 i‡(
aÊ_¨ó_±r
 =(*)-1Ë
	`exô
(1);

140 i‡(
ö°_r
Ë
aÊ_¨ó_±r
[0] = 1;

145 i‡(
	`gëív
("AFL_INST_LIBS")) {

147 
aÊ_°¨t_code
 = 0;

148 
aÊ_íd_code
 = (
abi_ul⁄g
)-1;

152 
	}
}

157 
	$aÊ_f‹k£rvî
(
CPUArchSèã
 *
ív
) {

159 
tmp
[4];

161 i‡(!
aÊ_¨ó_±r
) ;

166 i‡(
	`wrôe
(
FORKSRV_FD
 + 1, 
tmp
, 4) != 4) ;

168 
aÊ_f‹k§v_pid
 = 
	`gëpid
();

174 
pid_t
 
chûd_pid
;

175 
°©us
, 
t_fd
[2];

179 i‡(
	`ªad
(
FORKSRV_FD
, 
tmp
, 4Ë!4Ë
	`exô
(2);

184 i‡(
	`pùe
(
t_fd
Ë|| 
	`dup2
—_fd[1], 
TSL_FD
Ë< 0Ë
	`exô
(3);

185 
	`˛o£
(
t_fd
[1]);

187 
chûd_pid
 = 
	`f‹k
();

188 i‡(
chûd_pid
 < 0Ë
	`exô
(4);

190 i‡(!
chûd_pid
) {

194 
aÊ_f‹k_chûd
 = 1;

195 
	`˛o£
(
FORKSRV_FD
);

196 
	`˛o£
(
FORKSRV_FD
 + 1);

197 
	`˛o£
(
t_fd
[0]);

204 
	`˛o£
(
TSL_FD
);

206 i‡(
	`wrôe
(
FORKSRV_FD
 + 1, &
chûd_pid
, 4Ë!4Ë
	`exô
(5);

210 
	`aÊ_waô_t¶
(
ív
, 
t_fd
[0]);

214 i‡(
	`waôpid
(
chûd_pid
, &
°©us
, 0Ë< 0Ë
	`exô
(6);

215 i‡(
	`wrôe
(
FORKSRV_FD
 + 1, &
°©us
, 4Ë!4Ë
	`exô
(7);

219 
	}
}

224 
ölöe
 
	$aÊ_maybe_log
(
abi_ul⁄g
 
cur_loc
) {

226 
__thªad
 
abi_ul⁄g
 
¥ev_loc
;

231 i‡(
cur_loc
 > 
aÊ_íd_code
 || cur_lo¯< 
aÊ_°¨t_code
 || !
aÊ_¨ó_±r
)

238 
cur_loc
 = (cur_loc >> 4) ^ (cur_loc << 8);

239 
cur_loc
 &
MAP_SIZE
 - 1;

244 i‡(
cur_loc
 >
aÊ_ö°_rms
) ;

246 
aÊ_¨ó_±r
[
cur_loc
 ^ 
¥ev_loc
]++;

247 
¥ev_loc
 = 
cur_loc
 >> 1;

249 
	}
}

257 
	$aÊ_ªque°_t¶
(
èrgë_ul⁄g
 
pc
,Å¨gë_ul⁄g 
cb
, 
uöt64_t
 
Êags
) {

259 
aÊ_t¶
 
t
;

261 i‡(!
aÊ_f‹k_chûd
) ;

263 
t
.
pc
 =Öc;

264 
t
.
cs_ba£
 = 
cb
;

265 
t
.
Êags
 = flags;

267 i‡(
	`wrôe
(
TSL_FD
, &
t
, (
aÊ_t¶
)) != (afl_tsl))

270 
	}
}

276 
	$aÊ_waô_t¶
(
CPUArchSèã
 *
ív
, 
fd
) {

278 
aÊ_t¶
 
t
;

284 i‡(
	`ªad
(
fd
, &
t
, (
aÊ_t¶
)) != (afl_tsl))

287 
	`tb_föd_¶ow
(
ív
, 
t
.
pc
,Å.
cs_ba£
,Å.
Êags
);

291 
	`˛o£
(
fd
);

293 
	}
}

	@test-instr.c

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<uni°d.h
>

21 
	$maö
(
¨gc
, ** 
¨gv
) {

23 
buf
[8];

25 i‡(
	`ªad
(0, 
buf
, 8) < 1) {

26 
	`¥ötf
("Hum?\n");

27 
	`exô
(1);

30 i‡(
buf
[0] == '0')

31 
	`¥ötf
("LooksÜikeá zeroÅo me!\n");

33 
	`¥ötf
("AÇon-zero value? How quaint!\n");

35 
	`exô
(0);

37 
	}
}

	@types.h

17 #i‚de‡
_HAVE_TYPES_H


18 
	#_HAVE_TYPES_H


	)

20 
	~<°döt.h
>

21 
	~<°dlib.h
>

23 
uöt8_t
 
	tu8
;

24 
uöt16_t
 
	tu16
;

25 
uöt32_t
 
	tu32
;

43 #ifde‡
__x86_64__


44 
	tu64
;

46 
uöt64_t
 
	tu64
;

49 
öt8_t
 
	ts8
;

50 
öt16_t
 
	ts16
;

51 
öt32_t
 
	ts32
;

52 
öt64_t
 
	ts64
;

54 #i‚de‡
MIN


55 
	#MIN
(
_a
,
_b
Ë((_aË> (_bË? (_bË: (_a))

	)

56 
	#MAX
(
_a
,
_b
Ë((_aË> (_bË? (_aË: (_b))

	)

59 
	#SWAP16
(
_x
) ({ \

60 
u16
 
_ªt
 = (
_x
); \

61 (
u16
)((
_ªt
 << 8) | (_ret >> 8)); \

62 })

	)

64 
	#SWAP32
(
_x
) ({ \

65 
u32
 
_ªt
 = (
_x
); \

66 (
u32
)((
_ªt
 << 24) | (_ret >> 24) | \

67 ((
_ªt
 << 8) & 0x00FF0000) | \

68 ((
_ªt
 >> 8) & 0x0000FF00)); \

69 })

	)

71 
	#R
(
x
Ë(
	`øndom
(Ë% (x))

	)

73 
	#STRINGIFY_INTERNAL
(
x
Ë#x

	)

74 
	#STRINGIFY
(
x
Ë
	`STRINGIFY_INTERNAL
(x)

	)

76 
	#MEM_BARRIER
() \

77 
asm
 vﬁ©ûe("" ::: "mem‹y")

	)

79 
	#likñy
(
_x
Ë
	`__buûtö_ex≥˘
(!!(_x), 1)

	)

80 
	#u∆ikñy
(
_x
Ë
	`__buûtö_ex≥˘
(!!(_x), 0)

	)

	@
1
.
0
23
498
afl-analyze.c
afl-as.c
afl-as.h
afl-fuzz.c
afl-gcc.c
afl-gotcpu.c
afl-showmap.c
afl-tmin.c
alloc-inl.h
config.h
debug.h
experimental/argv_fuzzing/argv-fuzz-inl.h
experimental/instrumented_cmp/instrumented_cmp.c
experimental/persistent_demo/persistent_demo.c
experimental/post_library/post_library.so.c
experimental/post_library/post_library_png.so.c
hash.h
llvm_mode/afl-clang-fast.c
llvm_mode/afl-llvm-pass.so.cc
llvm_mode/afl-llvm-rt.o.c
qemu_mode/patches/afl-qemu-cpu-inl.h
test-instr.c
types.h
